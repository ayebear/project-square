!function(){"use strict";function e(e){return"function"==typeof e}function t(e){return""+(e.x||0)+","+(e.y||0)}function n(e){var t=e.split(",");return t.length=2,{x:parseInt(t[0])||0,y:parseInt(t[1])||0}}function i(e){return 180*Math.atan2(e.y,e.x)/Math.PI}function o(e,t){var n=Object.assign({},e);for(var i in t)delete n[i];return n}function r(e){e.children.sort(function(e,t){return e.zIndex=e.zIndex||0,t.zIndex=t.zIndex||0,e.zIndex-t.zIndex})}function a(e,t){var n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)}function l(e,t){return t={exports:{}},e(t,t.exports),t.exports}function s(e,t,n,i){var o=c(t,n,i);if(o===1/0)e=null;else{e=e||[];for(var r=0;r<t.length;r++)e[r]=t[r]+n[r]*o}return e}function c(e,t,n){for(var i=e.length,o=-(1/0),r=+(1/0),a=0;a<i;a++){var l=(n[0][a]-e[a])/t[a],s=(n[1][a]-e[a])/t[a];if(l>s){var c=l;l=s,s=c}if(s<o||l>r)return 1/0;l>o&&(o=l),s<r&&(r=s)}return o>r?1/0:o}function u(e){var t=ee[e];return{r:t&ne,g:t&ie,b:t&oe}}function h(e){return Z[(e.r?ne:0)+(e.g?ie:0)+(e.b?oe:0)]}function y(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"add";if(e in ee&&t in ee&&n in re){var i=u(e),o=u(t),r=re[n],a={r:r(i.r,o.r),g:r(i.g,o.g),b:r(i.b,o.b)};return h(a)}return"none"}function f(){var e=PIXI.loader;e.add("textures","data/textures.json"),e.load(d)}function d(){N.init(),requestAnimationFrame(p)}function p(e){D.val=(e-ae)/1e3,ae=e,D.total=e,N.run();var t=!1;return q.process("redirect",function(e){window.location=e,t=!0}),!t&&void requestAnimationFrame(p)}var v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},g=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),m=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},w=function(){function e(t,n){_(this,e),this.world=t,this.id=n,this.data={}}return g(e,[{key:"has",value:function(){for(var e=this,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];var o=[].concat(n);return o.every(function(t){return t in e.data})}},{key:"get",value:function(e){if(this.has(e))return this.data[e]}},{key:"access",value:function(e){return this.has(e)||this.set(e),this.data[e]}},{key:"set",value:function(e){var t=this.world.components[e],n="undefined"==typeof t?"undefined":v(t);if("function"===n){for(var i=arguments.length,o=Array(i>1?i-1:0),r=1;r<i;r++)o[r-1]=arguments[r];this.data[e]=new(Function.prototype.bind.apply(t,[null].concat(o)))}else"string"===n?this.data[e]=JSON.parse(t):this.data[e]={};return this}},{key:"update",value:function(e,t){var n=this.access(e);for(var i in t)n[i]=t[i];return this}},{key:"remove",value:function(e){if(e in this.data){var t=this.data[e];"function"==typeof t.onRemove&&t.onRemove(),delete this.data[e]}return this}},{key:"removeAll",value:function(){for(var e in this.data)this.remove(e);this.data={}}},{key:"destroy",value:function(){this.id&&(this.removeAll(),delete this.world.entities[this.id],this.id=void 0)}},{key:"valid",value:function(){return this.world&&void 0!==this.id}},{key:"toString",value:function(){return JSON.stringify(this.data)}},{key:"parse",value:function(e){var t=JSON.parse(e);for(var n in t){var i=this.access(n);"function"==typeof i.fromJSON?i.fromJSON(t[n]):this.update(n,t[n])}return this}}]),e}(),x=w,b={Entity:x},k=b.Entity,z=function(){function t(){_(this,t),this.systems=[],this.entities={},this.components={},this.entityTemplates={},this.idCounter=1,this.index={}}return g(t,[{key:"component",value:function(e,t){"object"===("undefined"==typeof t?"undefined":v(t))&&(t=JSON.stringify(t));var n="undefined"==typeof t?"undefined":v(t);if("function"===n||"string"===n||"undefined"===n)return this.components[e]=t,e}},{key:"entity",value:function(e){var t=this.idCounter++,n=new k(this,t);if(e&&e in this.entityTemplates){var i=this.entityTemplates[e];for(var o in i){var r=JSON.parse(i[o]);n.update(o,r)}}return this.entities[t]=n,n}},{key:"system",value:function(t,n){if(e(n)){var i=new n;return i.components=t,this.systems.push(i),this.systems.length-1}}},{key:"init",value:function(){var t=!0,n=!1,i=void 0;try{for(var o,r=this.systems[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var a=o.value;e(a.init)&&a.init.call(a)}}catch(e){n=!0,i=e}finally{try{!t&&r.return&&r.return()}finally{if(n)throw i}}}},{key:"run",value:function(){var t=!0,n=!1,i=void 0;try{for(var o,r=this.systems[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var a=o.value;e(a.pre)&&a.pre.call(a),e(a.every)&&this.every(a.components,a.every,a),e(a.post)&&a.post.call(a)}}catch(e){n=!0,i=e}finally{try{!t&&r.return&&r.return()}finally{if(n)throw i}}}},{key:"every",value:function(e,t,n){var i=this.query(e),o=!0,r=!1,a=void 0;try{for(var l,s=function(){var i=l.value,o=e.map(function(e){return i.get(e)});o.push(i),o.every(function(e){return e})&&(void 0===n?t.apply(void 0,m(o)):t.call.apply(t,[n].concat(m(o))))},c=i[Symbol.iterator]();!(o=(l=c.next()).done);o=!0)s()}catch(e){r=!0,a=e}finally{try{!o&&c.return&&c.return()}finally{if(r)throw a}}}},{key:"prototype",value:function(e){var t=0;if("string"==typeof e&&(e=JSON.parse(e)),"object"===("undefined"==typeof e?"undefined":v(e)))for(var n in e){var i=e[n],o={};for(var r in i)o[r]=JSON.stringify(i[r]);this.entityTemplates[n]=o,++t}return t}},{key:"query",value:function(e){var t=[];for(var n in this.entities){var i=this.entities[n];i.has.apply(i,m(e))&&t.push(i)}return t}}]),t}(),T=z;Math.toRadians=function(e){return e*Math.PI/180},Math.toDegrees=function(e){return 180*e/Math.PI};var C=l(function(e){function t(e,t,n,i,o){function r(e){return!!e&&("number"==typeof e.x&&"number"==typeof e.y&&"number"==typeof e.w&&"number"==typeof e.h&&(!(isNaN(e.x)||isNaN(e.y)||isNaN(e.w)||isNaN(e.h))&&!(e.w<0||e.h<0)))}function a(e,t){return e.x==t.x&&e.y==t.y&&e.w==t.w&&e.h==t.h}function l(e,t,n,i){return{x:e,y:t,w:n,h:i,c:[],l:[],n:[]}}function s(e,t,n,i){return Math.sqrt((n-e)*(n-e)+(i-t)*(i-t))}function c(e,t,n,i,o,r,a){a||(a=-1);var l=o*o+r*r;if(0==l)return null;if(l=(e*r-t*o-n*r+i*o)/l,Math.abs(o)>Math.abs(r))var c=(e-n-l*r)/o;else var c=(t-i+l*o)/r;if(c>=0&&c<=a||a<0)return{s:c,t:l,x:n+c*o,y:i+c*r,dist:Math.abs(l)};if(c<0){var u=s(e,t,n,i);return{s:c,dist:u}}var u=s(e,t,n+a*o,i+a*r);return{s:c,dist:u}}function u(e,t,n){if(!e||!t)return!0;var i=c(t.x+.5*t.w,t.y+.5*t.h,e.x,e.y,e.dx,e.dy,e.dist);if(i){if(i.dist-=n,i.dist<0)return!0;if(i.dist*i.dist<=t.w*t.w+t.h*t.h)return!0}return!1}function h(e,t,n){return!e||!t||!(e.x+e.w<t.x-n||e.y+e.h<t.y-n||e.x-n>t.x+t.w||e.y-n>t.y+t.h)}function y(e,t){var n=!1;t.w*t.h>e.w*e.h*z&&(n=!0),(t.x<e.x||t.y<e.y||t.x+t.w>e.x+e.w||t.y+t.h>e.y+e.h)&&(n=!0);for(var i=null,o=0;o<e.n.length;o++)if(h(t,e.n[o],0)){if(i){n=!0;break}i=e.n[o]}return{leaf:n,childnode:i}}function f(e,t){var n=y(e,t);if(n.leaf)e.l.push(t);else{if(!n.childnode)return;g(n.childnode,t)}}function d(e,t){e.x="number"==typeof t.x?t.x:e.x,e.y="number"==typeof t.y?t.y:e.y,e.w="number"==typeof t.w?t.w:e.w,e.h="number"==typeof t.h?t.h:e.h}function p(e,t,n,i){if("object"==("undefined"==typeof n?"undefined":v(n))&&"undefined"==typeof i&&(i=n,n=!1),!r(t)||"undefined"==typeof i)return!1;n?"string"!=typeof n&&(n="id"):n=!1;for(var o=0;o<e.c.length;o++)if(n&&e.c[o][n]==t[n]||!n&&a(e.c[o],t)){var l=e.c[o];return d(l,i),(l.x>e.x+e.w||l.y>e.y+e.h||l.x+l.w<e.x||l.y+l.h<e.y)&&(e.c.splice(o,1),g(T,l)),!0}for(var o=0;o<e.l.length;o++)if(n&&e.l[o][n]==t[n]||!n&&a(e.l[o],t)){var l=e.l[o];return d(l,i),(l.x>e.x+e.w||l.y>e.y+e.h||l.x+l.w<e.x||l.y+l.h<e.y)&&(e.l.splice(o,1),g(T,l)),!0}var s=y(e,t);return!(s.leaf||!s.childnode||!p(s.childnode,t,n))}function _(e,t,n){if(!r(t))return 0;n?"string"!=typeof n&&(n="id"):n=!1;for(var i=0,o=0;o<e.c.length;o++)(n&&e.c[o][n]==t[n]||!n&&a(e.c[o],t))&&(i++,e.c.splice(o,1),o--);for(var o=0;o<e.l.length;o++)(n&&e.l[o][n]==t[n]||!n&&a(e.l[o],t))&&(i++,e.l.splice(o,1),o--);var l=y(e,t);return!l.leaf&&l.childnode?i+_(l.childnode,t,n):i}function g(e,t){if(r(t))if(0==e.n.length){if(e.c.push(t),e.c.length>k){var n=e.w/2,i=e.h/2;e.n.push(l(e.x,e.y,n,i),l(e.x+n,e.y,n,i),l(e.x,e.y+i,n,i),l(e.x+n,e.y+i,n,i));for(var o=0;o<e.c.length;o++)f(e,e.c[o]);e.c=[]}}else f(e,t)}function m(e,t,n,i,o,r){for(var a=0;a<t.l.length;a++)if(!o||e(n,t.l[a],i))if("object"==("undefined"==typeof r?"undefined":v(r)))r.push(t.l[a]);else if(!r(t.l[a]))return!1;for(var a=0;a<t.c.length;a++)if(!o||e(n,t.c[a],i))if("object"==("undefined"==typeof r?"undefined":v(r)))r.push(t.c[a]);else if(!r(t.c[a]))return!1;for(var l=0;l<t.n.length;l++)if(e(n,t.n[l],i))if("object"==("undefined"==typeof r?"undefined":v(r)))r.concat(m(e,t.n[l],n,i,o,r));else if(!m(e,t.n[l],n,i,o,r))return!1;return!0}function w(e,t,n,i){return m(h,e,t,n,!0,i)}function x(e,t,n,i){return m(u,e,t,n,!1,i)}function b(e,t,n,i){if("function"!=typeof n&&"object"!=("undefined"==typeof n?"undefined":v(n))||"undefined"!=typeof i||(i=n,n=0),"undefined"==typeof i&&(i=[],n=0),null==t?w(e,t,n,i):"number"!=typeof t.x||"number"!=typeof t.y||isNaN(t.x)||isNaN(t.y)||("number"!=typeof t.dx||"number"!=typeof t.dy||isNaN(t.dx)||isNaN(t.dy)?"number"!=typeof t.w||"number"!=typeof t.h||isNaN(t.w)||isNaN(t.h)||w(e,t,n,i):x(e,t,n,i)),"object"==("undefined"==typeof i?"undefined":v(i)))return i}("number"!=typeof e||isNaN(e))&&(e=0),("number"!=typeof t||isNaN(t))&&(t=0),("number"!=typeof n||isNaN(n))&&(n=10),("number"!=typeof i||isNaN(i))&&(i=10);var k=25,z=.5;o&&("number"==typeof o.maxchildren&&o.maxchildren>0&&(k=o.maxchildren),"number"==typeof o.leafratio&&o.leafratio>=0&&(z=o.leafratio));var T=l(e,t,n,i);return{get:function(e,t,n){return b(T,e,t,n)},put:function(e){g(T,e)},update:function(e,t,n){return p(T,e,t,n)},remove:function(e,t){return _(T,e,t)},clear:function(){T=l(e,t,n,i)},stringify:function(){var o={x:e,y:t,w:n,h:i,maxc:k,leafratio:z,root:T};try{return JSON.stringify(o)}catch(e){return null}},parse:function(o){"string"==typeof o&&(o=JSON.parse(o)),e=o.x,t=o.y,n=o.w,i=o.h,k=o.maxc,z=o.leafratio,T=o.root}}}"undefined"!=typeof e&&(e.exports=t)}),S=s,P=c;S.distance=P;var I=function(){function e(){_(this,e),this.quadTree=C(0,0,65536,65536)}return g(e,[{key:"entToObj",value:function(e,t){t=t||e.get("aabb");var n=t.rect.getPosition();return{x:n.x,y:n.y,w:t.rect.size.width,h:t.rect.size.height,ent:e}}},{key:"clear",value:function(){this.quadTree.clear()}},{key:"update",value:function(e,t){this.quadTree.put(this.entToObj(e,t))}},{key:"getCollisions",value:function(e,t){var n={},i=e.has("movable");return this.quadTree.get(this.entToObj(e,t),function(t){return(i||t.ent.has("movable"))&&e.id!==t.ent.id&&(n[t.ent.id]=t.ent),!0}),n}},{key:"getRayAabbCollision",value:function(e,t,n){var i=new Float32Array([t.x,t.y]),o=new Float32Array([n.x,n.y]),r=e.getPosition(),a=[[r.x,r.y],[r.x+e.size.width,r.y+e.size.height]];return S.distance(i,o,a)}},{key:"getLineCollisions",value:function(e,t,n){var i=this,o=[];return this.quadTree.get({x:e.x,y:e.y,dx:t.x,dy:t.y,dist:n},function(r){var a=i.getRayAabbCollision(r.ent.get("aabb").rect,e,t);return a>0&&a<=n&&o.push({ent:r.ent,distance:a}),!0}),o.sort(function(e,t){return e.distance-t.distance}),o}}]),e}(),N=new T,D={val:0,total:0},M={width:window.innerWidth-4,height:window.innerHeight-4},E=new PIXI.Container,L=new PIXI.Container,O=new PIXI.Container,K=new PIXI.Container;E.addChild(L),E.addChild(O),E.addChild(K);var A=new I,R={player:null},j=function(){function e(){_(this,e),this.data={}}return g(e,[{key:"exists",value:function(e){return e in this.data}},{key:"count",value:function(e){return e in this.data?this.data[e].length:0}},{key:"send",value:function(e,t){e in this.data||(this.data[e]=[]),this.data[e].push(t)}},{key:"loop",value:function(e,t){if(e in this.data){var n=this.data[e],i=!0,o=!1,r=void 0;try{for(var a,l=n[Symbol.iterator]();!(i=(a=l.next()).done);i=!0){var s=a.value;t(s)}}catch(e){o=!0,r=e}finally{try{!i&&l.return&&l.return()}finally{if(o)throw r}}}}},{key:"process",value:function(e,t){this.loop(e,t),this.clear(e)}},{key:"clear",value:function(e){delete this.data[e]}},{key:"clearAll",value:function(){this.data={}}}]),e}(),q=new j,X=function(){function e(t,n,i){_(this,e),this.position=t?{x:t.x,y:t.y}:{x:0,y:0},this.size=n?{width:n.width,height:n.height}:{width:0,height:0},this.offset=i?{x:i.x,y:i.y}:{x:0,y:0}}return g(e,[{key:"getPosition",value:function(){return{x:this.position.x+this.offset.x,y:this.position.y+this.offset.y}}},{key:"getCenter",value:function(){return{x:this.position.x+this.offset.x+this.size.width/2,y:this.position.y+this.offset.y+this.size.height/2}}},{key:"setPosition",value:function(e){var t={x:e.x-this.offset.x,y:e.y-this.offset.y};return(t.x!==this.position.x||t.y!==this.position.y)&&(this.position.x=t.x,this.position.y=t.y,!0)}},{key:"collides",value:function(e){return!1}},{key:"intersects",value:function(e){var t=this.getPosition(),n=e.getPosition();return t.x<n.x+e.size.width&&n.x<t.x+this.size.width&&t.y<n.y+e.size.height&&n.y<t.y+this.size.height}},{key:"handleCollision",value:function(e){if(this.intersects(e)){var t=this.getPosition(),n=e.getPosition(),i={x:n.x+e.size.width/2-(t.x+this.size.width/2),y:n.y+e.size.height/2-(t.y+this.size.height/2)},o={x:e.size.width/2+this.size.width/2-Math.abs(i.x),y:e.size.height/2+this.size.height/2-Math.abs(i.y)};return o.y<o.x?i.y<0?t.y+=o.y:i.y>0?t.y-=o.y:console.log("ERROR: posA.y="+t.y+", penVec.y="+o.y):o.y>o.x&&(i.x<0?t.x+=o.x:i.x>0?t.x-=o.x:console.log("ERROR: posA.x="+t.x+", penVec.x="+o.x)),this.setPosition(t)}return!1}}]),e}();N.component("position",function(e,t){this.x=e||0,this.y=t||0}),N.component("velocity",function(e,t){this.x=e||0,this.y=t||0}),N.component("sprite",function(e,t,n){var i=this;this.s=new PIXI.Sprite(PIXI.utils.TextureCache[t+".png"]),this.s.anchor.x=.5,this.s.anchor.y=.5,this.s.zIndex=n||0,e.addChild(this.s),r(e),this.onRemove=function(){e.removeChild(i.s)},this.set=function(e){i.s.texture=PIXI.utils.TextureCache[e+".png"]}}),N.component("inputMovement",function(e){var t=1024;this.speed=e||t,this.lastDirection={x:0,y:0}}),N.component("pixiStage",function(e){this.root=e}),N.component("tilemap",function(e){this.tiles=e}),N.component("cameraFollows",function(){var e=this;this.update=function(){e.center=!0;var t=.33,n=E.scale.x;e.borderSize={x:t*(M.width/n),y:t*(M.height/n)},e.deadzone=new PIXI.Rectangle(e.borderSize.x,e.borderSize.y,M.width/n-2*e.borderSize.x,M.height/n-2*e.borderSize.y)},this.update()}),N.component("color",function(e,t,n){var i=this;this.name=e||"none",this.mutable=t||!0,this.base=n||"",this.changed=!1,this.change=function(e){i.mutable&&(i.name=e||"none",i.changed=!0)},this.clear=function(){i.change("none")}}),N.component("colorChanger",function(e){this.action=e}),N.component("colorArea",function(){}),N.component("magnet",function(){this.permanent=!1,this.polarity=""}),N.component("pushable",function(){}),N.component("pullable",function(){}),N.component("action",function(e){var t=this;this.key=e,this.pressed=!1,Mousetrap.bind(e,function(){t.pressed=!0},"keydown"),Mousetrap.bind(e,function(){t.pressed=!1},"keyup")}),N.component("cloneTool",function(e){var t=this;this.direction=0,this.directionDelta={x:1,y:0},this.count=0,this.cloneToolSprite=new PIXI.Sprite(PIXI.utils.TextureCache["clone_tool_0.png"]),this.cloneToolSprite.anchor.x=.5,this.cloneToolSprite.anchor.y=.5,e.s.addChild(this.cloneToolSprite),this.onRemove=function(){e.s.removeChild(t.cloneToolSprite)},this.setDirection=function(e){if(t.directionDelta.x!=e.x||t.directionDelta.y!=e.y){t.directionDelta.x=e.x,t.directionDelta.y=e.y;var n=i(t.directionDelta),o=Math.toRadians(n);return t.direction=n,t.cloneToolSprite.rotation=o,!0}return!1},this.setClones=function(e){e>=0&&e<=6&&(t.count=e,t.cloneToolSprite.texture=PIXI.utils.TextureCache["clone_tool_"+t.count+".png"])},this.use=function(){t.count>0&&t.setClones(t.count-1)},this.add=function(){t.setClones(t.count+1)},this.getOptions=function(){return{direction:t.directionDelta,count:t.count}},this.setOptions=function(e){t.setDirection(e.direction),t.setClones(e.count)}}),N.component("sliding",function(){}),N.component("mergable",function(e,t){this.isParent=e||!1,this.cloneId=t||0}),N.component("mirror",function(e){this.axes=e||{x:-1,y:1}}),N.component("animated",function(){this.tweening=!1}),N.component("player",function(){}),N.component("movable",function(){}),N.component("aabb",function(e,t,n){this.rect=new X(e,t,n)}),N.component("collisions",function(){var e=this;this.next={},this.current={},this.previous={},this.empty=function(){return 0===Object.keys(e.next).length&&0===Object.keys(e.current).length&&0===Object.keys(e.previous).length}}),N.component("hasNewCollisions",function(){}),N.component("partOfLayer",function(e){this.layer=e}),N.component("puzzlePortal",function(e){this.puzzle=e}),N.component("puzzleGoal",function(e){var t=this;this.completed=e||!1,this.setCompleted=function(e,n){if(t.completed!==e){t.completed=e;var i=n.get("sprite");i&&i.set(t.completed?"puzzle_end_done":"puzzle_end")}}}),N.component("noSwap",function(){}),N.component("noClone",function(){}),N.component("skip",function(){}),N.component("clonePower",function(){}),N.component("destroyer",function(){}),N.component("destroyable",function(){}),N.component("water",function(){}),N.component("waterRamp",function(){}),N.component("swimming",function(){});var F={0:"block_light_off_blue",1:"block_light_off_cyan",2:"block_light_off_green",3:"block_light_off_magenta",4:"block_light_off_none",5:"block_light_off_red",6:"block_light_off_white",7:"block_light_off_yellow",8:"block_light_on_blue",9:"block_light_on_cyan",10:"block_light_on_green",11:"block_light_on_magenta",12:"block_light_on_none",13:"block_light_on_red",14:"block_light_on_white",15:"block_light_on_yellow",16:"block_none",17:"block_none_glass",18:"block_none_laser",19:"block_none_mirror",20:"clone_power",21:"color_adder_blue",22:"color_adder_cyan",23:"color_adder_green",24:"color_adder_magenta",25:"color_adder_red",26:"color_adder_white",27:"color_adder_yellow",28:"color_area_none",29:"color_area_blue",30:"color_area_cyan",31:"color_area_green",32:"color_area_magenta",33:"color_area_red",34:"color_area_white",35:"color_area_yellow",36:"color_subtractor_blue",37:"color_subtractor_cyan",38:"color_subtractor_green",39:"color_subtractor_magenta",40:"color_subtractor_red",41:"color_subtractor_white",42:"color_subtractor_yellow",43:"color_swapper_blue",44:"color_swapper_cyan",45:"color_swapper_green",46:"color_swapper_magenta",47:"color_swapper_none",48:"color_swapper_red",49:"color_swapper_white",50:"color_swapper_yellow",61:"exit",62:"glass",63:"ice",64:"lava",65:"light_source_none",66:"light_source_blue",67:"light_source_cyan",68:"light_source_green",69:"light_source_magenta",70:"light_source_red",71:"light_source_white",72:"light_source_yellow",73:"normal",74:"player_blue",75:"player_cyan",76:"player_green",77:"player_magenta",78:"player_none",79:"player_red",80:"player_white",81:"player_yellow",82:"portal_solved",83:"portal_unexplored",84:"portal_unsolved",85:"puzzle_end",86:"puzzle_end_done",87:"puzzle_start",88:"sign_blocks",89:"sign_colors",90:"sign_mirrors",91:"sign_sliding",92:"switch",93:"switch_laser",94:"water",95:"normal_advanced",96:"normal_cloning",97:"normal_blocks",98:"normal_colors",102:"normal_invisible",103:"color_setter_blue",104:"color_setter_cyan",105:"color_setter_green",106:"color_setter_magenta",107:"color_setter_none",108:"color_setter_red",109:"color_setter_white",110:"color_setter_yellow",111:"wall",112:"sign_cloning",113:"controls"},J={"lvl-140,95":{"152,98":[97,64],"152,100":[97],"153,99":[111],"152,99":[111],"145,98":[97],"152,95":[97],"140,95":[97,87],"151,95":[97],"151,99":[97],"145,95":[97],"146,98":[111],"141,98":[97],"141,97":[97],"150,98":[97,64],"146,95":[97],"142,97":[97,94],"144,95":[97],"149,97":[97],"141,95":[97],"140,97":[97],"144,96":[111],"151,97":[97],"149,95":[97],"151,96":[111],"147,98":[97,64],"146,97":[97,85],"147,97":[97,64],"145,96":[111],"149,96":[97,94],"142,95":[97],"154,95":[97,20],"152,96":[97,94],"150,96":[97,94],"148,95":[97],"142,96":[111],"148,97":[97],"145,97":[97],"151,100":[97],"154,97":[97],"154,99":[97],"151,98":[97,94],"154,98":[97,64],"150,97":[97],"153,96":[97,94],"140,96":[111],"153,100":[97,20],"146,96":[111],"154,96":[97,94],"147,95":[97],"143,97":[97],"149,98":[97,64],"142,98":[97,94],"144,98":[97],"150,95":[97],"152,97":[97],"148,96":[97,94],"143,96":[111],"141,96":[111],"143,98":[97],"140,98":[97],"153,98":[97,64],"154,100":[97],"153,97":[97],"144,97":[97],"143,95":[97],"148,98":[97,64],"147,96":[111],"153,95":[97]},"lvl-116,126":{"114,127":[111],"110,123":[111],"115,125":[111],"114,125":[111],"115,124":[98],"110,124":[98,85],"116,124":[98,87],"111,125":[111],"112,123":[111],"114,126":[98,108],"112,127":[111],"112,125":[111],"111,123":[111],"114,123":[111],"115,127":[111],"113,128":[98],"115,128":[98],"116,127":[111],"111,127":[111],"116,126":[98,87],"110,126":[98,85],"113,124":[98],"111,124":[98],"111,126":[98],"113,122":[98],"110,128":[98,85],"112,122":[98,29],"110,127":[111],"112,128":[98,28],"116,128":[98,87],"116,123":[111],"114,122":[98,103],"113,127":[111],"110,125":[111],"115,123":[111],"111,122":[98],"116,125":[111],"114,124":[98,105],"112,126":[98,33],"113,125":[111],"113,126":[98],"112,124":[98,31],"110,122":[98,85],"116,122":[98,87],"115,126":[98],"113,123":[111],"115,122":[98],"114,128":[98,107],"111,128":[98]},"lvl-130,56":{"127,55":[97,94,28],"125,51":[97],"125,56":[97,20],"126,51":[97],"127,56":[97,103],"128,52":[97,94,33],"131,51":[97],"125,52":[97],"127,54":[97],"125,54":[97],"125,50":[97,64],"130,55":[97,94,28],"126,56":[97,87],"131,50":[97,64],"128,50":[111],"128,55":[111],"129,50":[97,64,33],"128,51":[97,20,28],"130,50":[97,64,33],"127,50":[97,64,29],"125,55":[97,94],"130,51":[97],"131,52":[97],"128,56":[97,94,32],"126,55":[97,94,28],"128,53":[97,94,29],"129,54":[97],"131,54":[97],"129,55":[97,94,28],"126,50":[97,64,29],"129,56":[97,108],"130,56":[97,87],"131,55":[97,94],"130,54":[97],"129,52":[97],"130,53":[97],"127,52":[97],"127,53":[97],"126,52":[97],"129,51":[97],"126,53":[97],"131,56":[97,20],"127,51":[97],"126,54":[97],"131,53":[97],"129,53":[97],"125,53":[97],"130,52":[97],"128,54":[97,85,32]},"lvl-126,80":{"125,78":[97],"124,77":[97],"121,77":[97],"125,80":[97],"125,79":[97],"121,79":[97,85],"123,78":[97,35],"122,77":[97],"123,77":[97,35],"126,77":[97,108],"123,79":[97,35],"125,77":[97],"124,80":[97],"126,79":[97,105],"124,79":[97],"126,80":[97,87],"126,78":[97],"124,78":[97,20],"122,79":[97],"122,80":[97],"121,78":[97],"121,80":[97],"122,78":[97],"123,80":[97,35]},"lvl-116,118":{"114,120":[98,21],"116,118":[98,87],"112,118":[98,32],"110,114":[98,85],"115,117":[111],"116,120":[98,87],"110,117":[111],"110,118":[98,85],"116,117":[111],"116,119":[111],"112,117":[111],"113,117":[111],"113,118":[98],"112,120":[98,30],"115,114":[98,21],"114,119":[111],"112,114":[98,34],"116,116":[98,87],"113,120":[98],"116,114":[98,87],"111,114":[98],"116,115":[111],"111,118":[98],"113,116":[98],"114,115":[111],"110,120":[98,85],"110,119":[111],"112,116":[98,35],"114,118":[98,25],"113,115":[111],"114,116":[98,25],"111,120":[98],"112,119":[111],"115,120":[98,23],"111,117":[111],"111,119":[111],"113,114":[98,25],"115,116":[98,23],"115,118":[98,21],"110,116":[98,85],"114,114":[98,23],"115,115":[111],"110,115":[111],"112,115":[111],"114,117":[111],"113,119":[111],"111,116":[98],"115,119":[111],"111,115":[111]},"lvl-128,65":{"124,60":[97,40],"125,66":[97,64],"123,61":[111],"128,64":[111],"128,63":[97],"125,62":[97],"131,63":[97,24],"129,58":[97,64],"132,59":[97],"130,66":[97],"130,62":[97],"126,59":[97],"132,63":[97],"129,65":[97],"126,60":[97],"125,63":[97],"132,66":[97],"128,60":[97,94],"123,63":[111],"132,58":[97,64],"123,62":[111],"125,64":[97],"131,64":[111],"132,65":[97],"131,58":[97,64],"125,65":[97],"130,65":[97],"127,61":[111],"127,63":[111],"131,59":[97],"123,65":[111],"126,64":[97],"129,66":[97],"126,61":[97],"129,59":[97],"128,59":[97,94],"133,63":[97],"131,65":[97],"125,60":[97],"131,62":[97,38],"124,64":[97,36],"123,58":[111],"126,58":[97],"128,61":[111],"132,61":[97,94],"124,61":[97],"126,63":[97],"123,60":[111],"127,65":[97,34],"133,62":[97],"133,64":[111],"124,62":[97,38],"127,60":[97,31],"133,59":[97],"131,66":[97],"127,66":[111],"132,60":[97],"130,61":[111],"126,65":[97],"132,64":[111],"124,59":[97],"133,61":[97,94],"130,63":[97],"129,62":[111],"128,62":[97,85],"126,62":[97],"130,58":[97,64],"129,64":[111],"130,64":[111],"128,58":[97,64],"133,66":[97,109],"125,58":[97],"133,58":[97,64],"132,62":[97],"131,61":[111],"126,66":[97,64],"124,65":[97],"130,60":[97],"127,58":[97,64],"127,62":[111],"129,60":[97],"125,61":[97],"125,59":[97],"128,66":[97],"124,66":[97,64],"124,63":[97],"130,59":[97],"129,61":[111],"127,64":[111],"133,65":[97],"124,58":[97,20,30],"123,66":[111],"127,59":[97,31],"123,59":[111],"128,65":[97,87],"129,63":[97,94,34],"131,60":[97],"123,64":[111],"133,60":[97]},"lvl-137,102":{"127,100":[97],"132,102":[97,94],"129,100":[97],"136,105":[111],"132,106":[97],"133,106":[97],"130,101":[111],"137,100":[97],"137,101":[111],"137,104":[97],"131,102":[97],"135,100":[97],"131,105":[111],"137,106":[111],"130,103":[111],"127,102":[97],"135,98":[97],"133,105":[111],"131,104":[97],"129,104":[97],"132,100":[97,64],"132,103":[97,94],"129,98":[97],"131,98":[97,94],"132,101":[97,94],"128,103":[111],"135,105":[111],"135,102":[97],"131,99":[111],"128,105":[111],"136,98":[97],"127,105":[97,94],"128,106":[97],"131,100":[111],"133,99":[111],"137,98":[97],"136,102":[97],"134,103":[111],"129,105":[111],"132,98":[97],"127,98":[97],"133,101":[111],"134,105":[111],"132,105":[97,94],"133,102":[97],"127,104":[97],"127,106":[97],"136,100":[97],"129,99":[111],"137,105":[97,64],"127,99":[97,94],"134,102":[97,20],"131,106":[97],"133,104":[97],"129,106":[97],"135,101":[111],"136,101":[111],"134,100":[97,20],"128,102":[97],"130,100":[97,85],"128,98":[97],"135,99":[111],"130,105":[111],"129,101":[111],"133,103":[111],"128,101":[111],"131,103":[111],"132,99":[97,94],"128,99":[111],"135,104":[97],"128,100":[97],"127,103":[97],"137,102":[97,87],"129,103":[111],"135,103":[111],"134,104":[97,20],"137,103":[111],"136,106":[97],"134,106":[97],"128,104":[97],"130,106":[97],"130,99":[111],"136,99":[111],"129,102":[97],"136,103":[111],"127,101":[111],"131,101":[111],"133,98":[97,94],"137,99":[97],"134,99":[111],"130,98":[97],"134,101":[111],"130,104":[97,20],"130,102":[97,20],"135,106":[97],"136,104":[97],"133,100":[97],"134,98":[97],"132,104":[97,94]},"lvl-116,114":{"114,120":[98,21],"116,118":[98,87],"112,118":[98,32],"110,114":[98,85],"115,117":[111],"116,120":[98,87],"110,117":[111],"110,118":[98,85],"116,117":[111],"116,119":[111],"112,117":[111],"113,117":[111],"113,118":[98],"112,120":[98,30],"115,114":[98,21],"114,119":[111],"112,114":[98,34],"116,116":[98,87],"113,120":[98],"116,114":[98,87],"111,114":[98],"116,115":[111],"111,118":[98],"113,116":[98],"114,115":[111],"110,120":[98,85],"110,119":[111],"112,116":[98,35],"114,118":[98,25],"113,115":[111],"114,116":[98,25],"111,120":[98],"112,119":[111],"115,120":[98,23],"111,117":[111],"111,119":[111],"113,114":[98,25],"115,116":[98,23],"115,118":[98,21],"110,116":[98,85],"114,114":[98,23],"115,115":[111],"110,115":[111],"112,115":[111],"114,117":[111],"113,119":[111],"111,116":[98],"115,119":[111],"111,115":[111]},"lvl-126,71":{"126,71":[97,87],"120,73":[97,85],"122,73":[97],"120,72":[97],"124,70":[97,64,35],"126,69":[97],"126,72":[97],"121,70":[97,94,33],"122,69":[97],"125,70":[97],"124,71":[111],"125,71":[97],"121,72":[111],"125,69":[97],"126,73":[97,20],"120,69":[97],"123,71":[111],"126,70":[97],"122,72":[97,110],"122,70":[97],"123,70":[97,108],"124,72":[97,64],"124,73":[97,64],"121,69":[97,94,33],"123,69":[97],"120,70":[97],"122,71":[111],"123,72":[97],"120,71":[97],"125,73":[97],"121,73":[111],"121,71":[111],"125,72":[97],"123,73":[97],"124,69":[97,64,35]},"lvl-107,114":{"107,115":[98,36],"106,115":[98],"104,115":[98],"105,114":[98],"103,113":[98,85,33],"103,115":[98,40],"106,113":[98],"107,113":[98],"104,114":[98],"103,114":[98],"104,113":[98],"105,113":[98,109],"105,115":[98,38],"106,114":[98],"107,114":[98,87]},"lvl-140,119":{"141,119":[97],"143,119":[97,64],"145,120":[97],"142,120":[97],"140,118":[97],"144,118":[97],"140,120":[97],"145,118":[97],"140,119":[97,87],"144,120":[97],"145,119":[97,85],"144,119":[97],"141,118":[97,20],"142,118":[97],"142,119":[97],"141,120":[97],"143,118":[97,64],"143,120":[97,64]},"lvl-116,120":{"114,120":[98,21],"116,118":[98,87],"112,118":[98,32],"110,114":[98,85],"115,117":[111],"116,120":[98,87],"110,117":[111],"110,118":[98,85],"110,116":[98,85],"116,119":[111],"112,117":[111],"113,117":[111],"113,118":[98],"112,120":[98,30],"115,114":[98,21],"114,119":[111],"112,114":[98,34],"116,116":[98,87],"113,120":[98],"116,114":[98,87],"111,114":[98],"116,117":[111],"115,115":[111],"113,116":[98],"114,115":[111],"110,120":[98,85],"110,119":[111],"112,116":[98,35],"114,118":[98,25],"113,115":[111],"114,116":[98,25],"111,120":[98],"112,119":[111],"115,120":[98,23],"111,117":[111],"111,119":[111],"113,114":[98,25],"115,116":[98,23],"110,115":[111],"116,115":[111],"114,114":[98,23],"111,118":[98],"115,118":[98,21],"112,115":[111],"114,117":[111],"113,119":[111],"111,116":[98],"115,119":[111],"111,115":[111]},"lvl-116,128":{"110,123":[111],"115,125":[111],"114,125":[111],"114,122":[98,103],"110,124":[98,85],"116,124":[98,87],"111,125":[111],"112,123":[111],"114,126":[98,108],"112,127":[111],"112,125":[111],"114,123":[111],"115,127":[111],"113,128":[98],"115,128":[98],"116,127":[111],"111,127":[111],"116,126":[98,87],"110,126":[98,85],"112,122":[98,29],"111,124":[98],"111,126":[98],"111,123":[111],"110,128":[98,85],"113,124":[98],"110,127":[111],"112,128":[98,28],"116,128":[98,87],"116,123":[111],"115,124":[98],"113,127":[111],"111,122":[98],"110,125":[111],"115,123":[111],"113,122":[98],"116,125":[111],"114,127":[111],"114,124":[98,105],"112,126":[98,33],"113,125":[111],"113,126":[98],"112,124":[98,31],"110,122":[98,85],"116,122":[98,87],"115,126":[98],"113,123":[111],"115,122":[98],"114,128":[98,107],"111,128":[98]},world:{"132,88":[73],"116,124":[83],"127,70":[73],"128,75":[73],"138,115":[97],"121,128":[98],"138,108":[97],"108,114":[98],"117,113":[98],"108,120":[98],"117,120":[98],"138,94":[97],"108,123":[98],"139,94":[97],"128,71":[73],"131,87":[73],"128,70":[73],"128,59":[73],"113,109":[98],"139,96":[97],"124,128":[98],"117,115":[98],"138,112":[97],"117,96":[98],"128,68":[73],"120,89":[73],"127,78":[73],"139,123":[97],"131,85":[73],"131,131":[95],"127,63":[73],"138,100":[97],"118,124":[98],"125,128":[73],"128,74":[73],"127,53":[73],"117,91":[98],"139,115":[97],"117,90":[73],"126,127":[73],"128,76":[73],"117,124":[98],"110,109":[98],"123,87":[73],"128,61":[73],"122,127":[98],"117,107":[98],"138,120":[97],"130,127":[73],"127,84":[73],"138,127":[97],"127,82":[73],"117,103":[98],"138,106":[97],"140,95":[83],"126,85":[73],"118,115":[98],"118,112":[98],"118,104":[98],"128,78":[73],"139,125":[97],"129,71":[73],"129,78":[73],"128,62":[73],"124,86":[73],"126,80":[83],"138,97":[97],"118,108":[98],"139,101":[97],"129,64":[73],"138,104":[97],"117,127":[98],"128,85":[73],"139,93":[97],"139,89":[73],"126,71":[83],"116,128":[83],"138,124":[97],"133,88":[73],"128,87":[73],"129,65":[73],"137,89":[73],"139,103":[97],"127,62":[73],"129,128":[73],"121,89":[73],"129,60":[73],"117,125":[98],"129,79":[73],"138,105":[97],"139,90":[73],"117,117":[98],"125,127":[73],"138,126":[97],"130,87":[73],"139,127":[97],"129,127":[73],"129,76":[73],"127,128":[73],"116,122":[83],"127,68":[73],"128,57":[73],"133,127":[97],"137,128":[97],"112,109":[98],"117,98":[98],"117,93":[98],"139,113":[97],
"137,90":[73],"127,69":[73],"116,120":[83],"130,86":[73],"131,86":[73],"119,88":[73],"137,88":[73],"118,107":[98],"133,128":[97],"118,91":[73],"118,126":[98],"119,128":[98],"138,110":[97],"122,87":[73],"116,118":[83],"138,96":[97],"116,116":[83],"118,117":[98],"117,104":[98],"129,77":[73],"129,75":[73],"108,117":[98],"126,86":[73],"139,106":[97],"129,54":[73],"119,127":[98],"129,55":[73],"127,79":[73],"118,101":[98],"120,88":[73],"125,131":[95],"139,109":[97],"140,125":[83],"127,61":[73],"139,128":[97],"118,94":[98],"138,91":[73],"129,59":[73],"127,74":[73],"136,90":[73],"117,102":[98],"134,128":[97],"117,100":[98],"134,88":[73],"138,95":[97],"127,55":[73],"121,88":[73],"132,87":[73],"127,127":[73],"129,80":[73],"128,132":[95],"109,109":[98],"117,108":[98],"131,82":[112],"124,87":[73],"134,87":[73],"138,121":[97],"137,127":[97],"139,118":[97],"138,117":[97],"128,52":[73],"127,60":[73],"127,59":[73],"127,54":[73],"120,127":[98],"118,118":[98],"117,126":[98],"138,103":[97],"138,101":[97],"129,62":[73],"127,85":[73],"129,61":[73],"117,114":[98],"127,76":[73],"139,102":[97],"117,89":[73],"128,82":[73],"116,114":[83],"118,120":[98],"139,91":[97],"127,83":[73],"137,102":[83],"118,100":[98],"130,128":[73],"129,132":[95],"129,83":[73],"138,118":[97],"128,55":[73],"123,86":[73],"107,119":[83],"129,73":[73],"121,87":[73],"126,87":[73],"138,125":[97],"127,65":[73],"138,107":[97],"139,126":[97],"138,92":[97],"118,114":[98],"127,77":[73],"128,65":[83],"125,129":[95],"116,100":[83],"122,88":[73],"118,121":[98],"128,79":[73],"134,127":[97],"128,64":[73],"135,89":[73],"126,128":[73],"129,70":[73],"129,58":[73],"130,132":[95],"138,99":[97],"132,128":[97],"129,67":[73],"133,87":[73],"108,112":[98],"117,121":[98],"126,132":[95],"139,121":[97],"117,92":[98],"125,132":[95],"139,112":[97],"118,105":[98],"127,73":[73],"129,57":[73],"135,88":[73],"117,112":[98],"108,116":[98],"129,53":[73],"128,58":[73],"137,114":[83],"124,127":[98],"117,110":[98],"118,103":[98],"130,85":[73],"138,113":[97],"131,132":[95],"118,128":[98],"118,89":[73],"135,127":[97],"129,66":[73],"128,80":[73],"123,88":[73],"107,114":[83],"128,66":[73],"125,86":[73],"129,72":[73],"139,92":[97],"118,106":[98],"127,87":[73],"118,111":[98],"135,128":[97],"127,67":[73],"139,98":[97],"139,110":[97],"127,81":[73],"107,110":[83],"117,116":[98],"139,100":[97],"127,52":[73],"121,127":[98],"139,119":[97],"132,86":[73],"117,99":[98],"138,93":[97],"128,84":[73],"124,88":[73],"120,125":[89],"120,90":[73],"118,97":[98],"117,97":[98],"136,128":[97],"117,128":[98],"129,87":[73],"139,95":[97],"127,72":[73],"139,117":[97],"116,126":[83],"108,124":[98],"138,123":[97],"127,75":[73],"125,87":[73],"118,123":[98],"118,116":[98],"108,111":[98],"118,92":[98],"114,109":[98],"128,72":[73],"118,99":[98],"118,127":[98],"138,98":[97],"130,56":[83],"139,116":[97],"129,74":[73],"111,109":[98],"123,127":[98],"129,52":[73],"136,89":[73],"117,94":[98],"128,126":[83],"118,93":[98],"127,64":[73],"118,119":[98],"128,60":[73],"129,82":[73],"128,77":[73],"117,101":[98],"127,71":[73],"108,110":[98],"118,98":[98],"131,128":[73],"128,54":[73],"128,83":[73],"117,109":[98],"136,88":[73],"127,56":[73],"118,110":[98],"128,81":[73],"139,107":[97],"117,122":[98],"115,109":[98],"138,128":[97],"108,109":[98],"139,120":[97],"108,118":[98],"139,111":[97],"140,119":[83],"139,104":[97],"139,105":[97],"135,87":[73],"118,125":[98],"131,127":[73],"122,128":[98],"128,86":[73],"139,99":[97],"136,127":[97],"128,73":[73],"138,122":[97],"129,84":[73],"128,53":[73],"120,128":[98],"128,127":[73],"139,114":[97],"127,132":[95],"128,130":[113],"128,63":[73],"128,67":[73],"132,127":[97],"117,118":[98],"123,128":[98],"125,130":[95],"134,89":[73],"127,86":[73],"117,119":[98],"131,130":[95],"118,113":[98],"138,89":[73],"138,90":[73],"139,122":[97],"118,109":[98],"117,105":[98],"129,81":[73],"119,90":[73],"118,95":[98],"139,97":[97],"129,86":[73],"125,85":[73],"118,122":[98],"107,123":[83],"138,109":[97],"127,66":[73],"117,111":[98],"126,56":[83],"127,57":[73],"127,80":[73],"138,116":[97],"118,90":[73],"117,123":[98],"129,69":[73],"117,106":[98],"138,111":[97],"108,119":[98],"128,56":[73],"138,114":[97],"138,102":[97],"108,121":[98],"108,122":[98],"129,56":[73],"118,96":[98],"128,128":[73],"108,113":[98],"127,58":[73],"140,108":[83],"136,125":[112],"117,95":[98],"138,119":[97],"128,69":[73],"131,129":[95],"131,81":[89],"133,86":[73],"119,89":[73],"139,124":[97],"129,68":[73],"139,108":[97],"116,109":[98],"129,63":[73],"129,85":[73],"130,77":[83],"122,89":[73],"118,102":[98],"108,115":[98]},"lvl-107,110":{"103,111":[98,40],"104,110":[98],"106,110":[98],"107,111":[98,36],"106,111":[98],"103,110":[98],"105,110":[98],"104,111":[98],"104,109":[98],"105,111":[98,38],"106,109":[98],"107,109":[98],"105,109":[98,109],"103,109":[98,85,35],"107,110":[98,87]},"lvl-140,108":{"147,111":[97,64],"145,112":[97,64],"141,112":[97,64],"143,107":[97],"142,106":[97,64],"141,107":[97],"142,109":[97,94],"141,108":[97,20],"142,111":[97],"141,111":[97],"142,110":[97],"147,107":[97,64],"142,107":[97],"143,109":[97,94],"140,109":[97,64],"144,107":[97],"144,109":[97,94],"147,106":[97,64],"147,109":[97,64],"146,108":[97],"142,108":[97],"147,110":[97,64],"144,111":[97],"147,112":[97,64],"140,107":[97,64],"144,110":[97],"145,106":[97,64],"143,111":[97],"146,107":[97],"143,108":[97],"143,106":[97,64],"142,112":[97,64],"144,106":[97,64],"145,108":[97],"141,106":[97,64],"143,110":[97],"140,111":[97,64],"140,108":[97,87],"140,110":[97,64],"146,111":[97],"140,112":[97,64],"145,109":[97,94],"141,110":[97,85],"146,106":[97,64],"147,108":[111],"146,112":[111],"144,108":[97],"145,110":[97],"145,107":[97],"140,106":[97,64],"141,109":[97,94],"146,109":[97,94],"143,112":[97,64],"146,110":[97],"145,111":[97],"144,112":[97,64]},"lvl-126,56":{"127,55":[97,94,28],"125,51":[97],"125,56":[97,20],"126,51":[97],"127,56":[97,103],"128,52":[97,94,33],"131,51":[97],"125,52":[97],"127,54":[97],"125,54":[97],"125,50":[97,64],"127,51":[97],"128,51":[97,20,28],"127,50":[97,64,29],"131,50":[97,64],"128,50":[111],"128,55":[111],"129,50":[97,64,33],"126,56":[97,87],"130,50":[97,64,33],"130,55":[97,94,28],"125,55":[97,94],"130,51":[97],"131,52":[97],"126,52":[97],"126,55":[97,94,28],"128,53":[97,94,29],"129,54":[97],"129,55":[97,94,28],"126,50":[97,64,29],"129,56":[97,108],"130,56":[97,87],"130,54":[97],"129,52":[97],"130,53":[97],"127,52":[97],"127,53":[97],"131,54":[97],"129,51":[97],"126,53":[97],"128,56":[97,94,32],"131,56":[97,20],"131,55":[97,94],"126,54":[97],"131,53":[97],"129,53":[97],"125,53":[97],"130,52":[97],"128,54":[97,85,32]},"lvl-116,100":{"111,99":[98],"108,101":[98,40],"113,100":[98],"116,99":[98],"108,99":[98,85,31],"108,100":[98],"110,100":[98],"112,101":[98,35],"110,99":[98,38],"109,101":[98],"111,101":[98],"114,101":[98,21],"113,99":[98],"113,101":[98],"110,101":[98,36],"112,100":[98,35],"114,100":[98],"115,100":[98],"116,100":[98,87],"109,100":[98],"112,99":[98,35],"115,101":[98],"109,99":[98],"111,100":[98],"114,99":[98,23],"115,99":[98],"116,101":[98,25]},"lvl-137,114":{"133,117":[97],"134,114":[97],"135,115":[97,64],"136,115":[97],"137,113":[97],"132,116":[97,94],"132,115":[97],"137,115":[97],"133,118":[97,85],"134,118":[97],"135,113":[97,94],"136,113":[97,20],"133,114":[97],"135,114":[97,94],"134,113":[97],"132,117":[97],"132,114":[97],"134,115":[97],"132,113":[97],"133,113":[97],"137,114":[97,87],"134,116":[97,94],"132,118":[97],"133,115":[97],"134,117":[97],"136,114":[97],"133,116":[97,94]},"lvl-128,126":{"127,122":[73,85],"128,122":[73],"129,123":[73],"127,124":[73],"128,124":[73],"127,123":[111],"128,125":[111],"127,125":[73],"129,126":[73],"129,124":[73],"129,122":[73],"128,123":[111],"129,125":[111],"128,126":[73,87],"127,126":[73]},"lvl-107,123":{"105,123":[98],"107,124":[98,42],"104,124":[98],"105,124":[98,39],"101,123":[98,85,29],"103,123":[98],"103,124":[98,37],"106,122":[98],"102,122":[98],"101,122":[98],"103,122":[98,104],"105,122":[98,106],"101,124":[98],"107,123":[98,87],"102,124":[98],"104,123":[98],"102,123":[98],"106,124":[98],"104,122":[98],"107,122":[98,110],"106,123":[98]},"lvl-116,124":{"110,123":[111],"115,125":[111],"114,125":[111],"115,124":[98],"110,124":[98,85],"116,124":[98,87],"111,125":[111],"112,123":[111],"114,126":[98,108],"112,127":[111],"111,127":[111],"111,123":[111],"114,123":[111],"115,127":[111],"113,128":[98],"115,128":[98],"114,127":[111],"116,126":[98,87],"110,126":[98,85],"113,124":[98],"111,124":[98],"111,126":[98],"113,122":[98],"110,128":[98,85],"112,122":[98,29],"116,128":[98,87],"112,128":[98,28],"110,127":[111],"116,127":[111],"116,123":[111],"114,122":[98,103],"113,127":[111],"110,125":[111],"115,123":[111],"111,122":[98],"116,125":[111],"114,124":[98,105],"115,122":[98],"112,126":[98,33],"113,125":[111],"113,126":[98],"112,124":[98,31],"110,122":[98,85],"116,122":[98,87],"115,126":[98],"113,123":[111],"112,125":[111],"114,128":[98,107],"111,128":[98]},"lvl-107,119":{"104,118":[98],"106,120":[98],"107,119":[98,87],"103,120":[98,85,33],"104,119":[98],"106,118":[98],"107,120":[98],"105,119":[98],"106,119":[98],"105,118":[98,39],"107,118":[98,42],"104,120":[98],"103,119":[98],"103,118":[98,37],"105,120":[98,109]},"lvl-140,125":{"143,124":[97,94],"141,124":[97,20],"141,126":[97],"144,124":[97],"141,125":[97],"144,126":[97],"140,124":[97],"143,126":[97,94],"145,124":[97],"142,126":[97],"142,125":[97],"140,126":[97],"144,125":[97],"145,126":[97],"142,124":[97],"145,125":[97,85],"140,125":[97,87],"143,125":[97,94]},"lvl-130,77":{"138,77":[97,85],"135,76":[97],"133,75":[97,94],"132,75":[97,94],"130,78":[97],"134,74":[97],"138,74":[97,103],"131,75":[97,94],"137,75":[111],"135,73":[97],"133,77":[97],"136,74":[97,29],"132,73":[97],"134,77":[97],"136,78":[97,32],"135,78":[97],"131,74":[97],"133,73":[97],"135,75":[111],"135,77":[97],"133,74":[97],"131,78":[97],"138,75":[111],"130,74":[97],"130,73":[97],"134,78":[97,108],"132,77":[97],"131,77":[97],"134,75":[97,94],"137,74":[97],"137,78":[97],"138,73":[97,20,28],"134,73":[97],"138,78":[97],"133,76":[97],"130,76":[97],"136,75":[111],"136,76":[97,32],"132,74":[97],"136,77":[97,32],"137,76":[97],"132,78":[97],"132,76":[97],"137,73":[97],"137,77":[97],"131,73":[97],"130,75":[111],"135,74":[97],"130,77":[97,87],"133,78":[97],"131,76":[97],"138,76":[97],"134,76":[97,20],"136,73":[97,28]},"lvl-116,122":{"110,123":[111],"115,125":[111],"114,125":[111],"115,124":[98],"110,124":[98,85],"116,124":[98,87],"111,125":[111],"112,123":[111],"114,126":[98,108],"112,127":[111],"111,127":[111],"111,123":[111],"114,123":[111],"115,127":[111],"116,122":[98,87],"115,128":[98],"114,127":[111],"116,126":[98,87],"110,126":[98,85],"113,124":[98],"111,124":[98],"111,126":[98],"113,122":[98],"110,128":[98,85],"112,122":[98,29],"116,128":[98,87],"112,128":[98,28],"110,127":[111],"116,127":[111],"116,123":[111],"114,122":[98,103],"113,127":[111],"110,125":[111],"115,123":[111],"111,122":[98],"116,125":[111],"114,124":[98,105],"115,122":[98],"112,126":[98,33],"113,125":[111],"113,126":[98],"112,124":[98,31],"110,122":[98,85],"113,128":[98],"115,126":[98],"113,123":[111],"112,125":[111],"114,128":[98,107],"111,128":[98]},"lvl-116,116":{"114,120":[98,21],"116,118":[98,87],"112,118":[98,32],"110,114":[98,85],"115,117":[111],"116,120":[98,87],"110,117":[111],"110,118":[98,85],"116,117":[111],"116,119":[111],"112,117":[111],"113,117":[111],"113,118":[98],"112,120":[98,30],"115,114":[98,21],"114,119":[111],"112,114":[98,34],"116,116":[98,87],"113,120":[98],"116,114":[98,87],"111,114":[98],"116,115":[111],"111,118":[98],"113,116":[98],"114,115":[111],"110,120":[98,85],"110,119":[111],"112,116":[98,35],"114,118":[98,25],"113,115":[111],"114,116":[98,25],"111,120":[98],"112,119":[111],"115,120":[98,23],"111,117":[111],"111,119":[111],"113,114":[98,25],"115,116":[98,23],"115,118":[98,21],"110,116":[98,85],"114,114":[98,23],"115,115":[111],"110,115":[111],"112,115":[111],"114,117":[111],"113,119":[111],"111,116":[98],"115,119":[111],"111,115":[111]}},V={clone_power:"20",block_light_off_blue:"0",color_setter_green:"105",block_light_on_blue:"8",portal_unexplored:"83",light_source_blue:"66",color_setter_yellow:"110",color_swapper_blue:"43",puzzle_start:"87",block_light_off_yellow:"7",portal_solved:"82",color_setter_magenta:"106",block_light_off_white:"6",light_source_magenta:"69",normal:"73",block_light_on_green:"10",puzzle_end_done:"86",wall:"111",color_subtractor_red:"40",color_setter_blue:"103",block_none_mirror:"19",color_adder_green:"23",player_cyan:"75",color_swapper_magenta:"46",lava:"64",color_adder_magenta:"24",normal_cloning:"96",block_light_on_magenta:"11",player_yellow:"81",block_none_laser:"18",color_adder_white:"26",color_area_blue:"29",color_swapper_green:"45",light_source_white:"71",color_area_cyan:"30",color_setter_red:"108",player_magenta:"77",normal_colors:"98",color_area_yellow:"35",color_swapper_yellow:"50",player_red:"79",color_adder_yellow:"27",color_adder_blue:"21",block_none:"16",color_subtractor_yellow:"42",light_source_none:"65",color_setter_white:"109",block_light_on_yellow:"15",light_source_cyan:"67",player_white:"80",sign_colors:"89",block_light_on_none:"12",light_source_red:"70",normal_invisible:"102",color_setter_none:"107",sign_cloning:"112",switch:"92",ice:"63",water:"94",player_none:"78",color_area_none:"28",color_area_white:"34",color_swapper_cyan:"44",light_source_yellow:"72",block_light_on_cyan:"9",sign_mirrors:"90",switch_laser:"93",color_swapper_white:"49",color_swapper_none:"47",color_subtractor_white:"41",color_subtractor_green:"38",color_subtractor_blue:"36",block_light_off_none:"4",block_light_off_red:"5",puzzle_end:"85",controls:"113",block_light_off_cyan:"1",player_green:"76",block_light_on_white:"14",light_source_green:"68",color_area_magenta:"32",color_subtractor_cyan:"37",color_adder_cyan:"22",normal_advanced:"95",color_setter_cyan:"104",block_light_off_magenta:"3",glass:"62",block_none_glass:"17",color_subtractor_magenta:"39",player_blue:"74",color_swapper_red:"48",color_area_green:"31",block_light_off_green:"2",block_light_on_red:"13",color_area_red:"33",portal_unsolved:"84",sign_sliding:"91",color_adder_red:"25",normal_blocks:"97",exit:"61",sign_blocks:"88"},G={width:256,height:256},B={idToName:F,layers:J,nameToId:V,tileSize:G},W=function(){function e(t){_(this,e),this.root=new PIXI.Container,this.root.zIndex=-10,t.addChild(this.root),r(t),this.data={},this.currentLayer=null,this.sprites={},this.changes={}}return g(e,[{key:"load",value:function(e,t){this.tileSize=e.tileSize,this.idToName=e.idToName,this.nameToId=e.nameToId,this.data=t}},{key:"clear",value:function(){this.currentLayer=null,this.root.removeChildren(),this.sprites={},this.changes={}}},{key:"showLayers",value:function(e,t){if(e instanceof Array&&t){this.clear();var n=!0,i=!1,o=void 0;try{for(var r,a=e[Symbol.iterator]();!(n=(r=a.next()).done);n=!0){var l=r.value;this.addLayer(l)}}catch(e){i=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw o}}this.currentLayer=t}}},{key:"showLayer",value:function(e){this.clear(),this.addLayer(e),this.currentLayer=e}},{key:"reload",value:function(){this.showLayer(this.currentLayer)}},{key:"addLayer",value:function(e){var t=this.data[e];for(var i in t){var o=n(i),r=t[i],a=this.createTileSprite(o,r);this.root.addChild(a),this.sprites[i]=a}}},{key:"getTileTexture",value:function(e){return PIXI.utils.TextureCache[this.idToName[e]+".png"]}},{key:"getTile",value:function(e){var n=t(e);return n in this.changes?this.changes[n]:this.data[this.currentLayer][n]}},{key:"getTileName",value:function(e){var t=this.getTile(e);return t?this.idToName[t]:null}},{key:"getVisualPosition",value:function(e){return{x:e.x*this.tileSize.width,y:e.y*this.tileSize.height}}},{key:"createTileSprite",value:function(e,t){var n=new PIXI.Sprite(this.getTileTexture(t)),i=this.getVisualPosition(e);return n.position.x=i.x,n.position.y=i.y,n.anchor.x=.5,n.anchor.y=.5,n}},{key:"setTile",value:function(e,n){var i=t(e);this.sprites[i].texture=this.getTileTexture(n),this.changes[i]=n,"world"==this.currentLayer&&(this.data[this.currentLayer][i]=n)}},{key:"setByName",value:function(e,t){this.setTile(e,this.nameToId[t])}},{key:"getTileRectangle",value:function(e){return new X(this.getVisualPosition(e),{width:this.tileSize.width,height:this.tileSize.height})}}]),e}(),H=["empty","wall"],U=function(){function e(t){_(this,e),this.tiles=t,this.collidableTiles=new Set;var n=!0,i=!1,o=void 0;try{for(var r,a=H[Symbol.iterator]();!(n=(r=a.next()).done);n=!0){var l=r.value;this.collidableTiles.add(l)}}catch(e){i=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw o}}}return g(e,[{key:"isCollidableTile",value:function(e){var t=this.tiles.getTileName(e);return null===t||this.collidableTiles.has(t)}},{key:"handleCollision",value:function(e){for(var t={x:Math.floor(e.position.x/this.tiles.tileSize.width),y:Math.floor(e.position.y/this.tiles.tileSize.height)},n={x:Math.ceil((e.position.x+e.size.width)/this.tiles.tileSize.width),y:Math.ceil((e.position.y+e.size.height)/this.tiles.tileSize.height)},i=t.y;i<=n.y;++i)for(var o=t.x;o<=n.x;++o){var r={x:o,y:i};if(this.isCollidableTile(r)){var a=this.tiles.getTileRectangle(r);e.handleCollision(a)}}}},{key:"getMaxDistance",value:function(e,t,n){var i=0,o={x:0===t.x?0:t.x>0?1:-1,y:0===t.y?0:t.y>0?1:-1};if(0===o.x||0===o.y){for(var r={x:Math.floor(e.x/this.tiles.tileSize.width),y:Math.floor(e.y/this.tiles.tileSize.height)},l=0,s=this.isCollidableTile(r);!s;)s=this.isCollidableTile({x:r.x+o.x,y:r.y+o.y}),s||(++l,r.x+=o.x,r.y+=o.y);var c=void 0;c=0===o.x?{x:e.x,y:r.y*this.tiles.tileSize.height+(o.y+1)/2*this.tiles.tileSize.height}:{x:r.x*this.tiles.tileSize.width+(o.x+1)/2*this.tiles.tileSize.width,y:e.y},i=a(e,c)}return i}}]),e}(),$=new W(O),Q=new U($);N.system([],function(){function e(){_(this,e),this.puzzlePortals={}}return g(e,[{key:"init",value:function(){this.setData(B),this.loadTiles({layer:"world"}),this.puzzleCamera=N.entity()}},{key:"pre",value:function(){var e=this;q.process("updatePuzzlePortal",function(t){e.puzzlePortals[t.id]=t.state,console.log(e.puzzlePortals)}),q.process("loadTiles",function(t){e.loadTiles(t)})}},{key:"setData",value:function(e){this.fullMapData=e.layers;var t={};for(var n in e.layers){var i=e.layers[n],o={};for(var r in i)o[r]=i[r][0];t[n]=o}var a={tileSize:e.tileSize,idToName:e.idToName,nameToId:e.nameToId};$.load(a,t)}},{key:"clearEntities",value:function(){N.every(["partOfLayer"],function(e,t){t.destroy()})}},{key:"getPuzzleCenter",value:function(){if(null==$.currentLayer)return console.log("ERROR: No current layer"),{x:0,y:0};var e=$.data[$.currentLayer],t={x:1/0,y:1/0},i={x:0,y:0};for(var o in e){var r=n(o);t.x=Math.min(t.x,r.x),t.y=Math.min(t.y,r.y),i.x=Math.max(i.x,r.x),i.y=Math.max(i.y,r.y)}var a=$.getVisualPosition({x:(i.x+t.x)/2,y:(i.y+t.y)/2});return a}},{key:"setupPlayer",value:function(e){if(q.send("clearPlayer"),q.send("resetKeys"),R.player){var t=R.player.get("position");if(t.x=e.puzzle.position.x,t.y=e.puzzle.position.y,"world"===e.layer)this.puzzleCamera.removeAll(),R.player.set("cameraFollows");else{var n=this.getPuzzleCenter();R.player.remove("cameraFollows"),this.puzzleCamera.set("cameraFollows").set("aabb",n)}}}},{key:"forEachTile",value:function(e,t,i){var o=new Set,r=!0,a=!1,l=void 0;try{for(var s,c=t[Symbol.iterator]();!(r=(s=c.next()).done);r=!0){var u=s.value;o.add(parseInt($.nameToId[u]))}}catch(e){a=!0,l=e}finally{try{!r&&c.return&&c.return()}finally{if(a)throw l}}for(var h in this.fullMapData[e]){var y=this.fullMapData[e][h],f=0,d=!0,p=!1,v=void 0;try{for(var _,g=y[Symbol.iterator]();!(d=(_=g.next()).done);d=!0){var m=_.value;if(o.has(m)){var w={id:h,name:$.idToName[m],position:$.getVisualPosition(n(h)),layer:e,layerLevel:f};i(w)}++f}}catch(e){p=!0,v=e}finally{try{!d&&g.return&&g.return()}finally{if(p)throw v}}}}},{key:"createEntity",value:function(e,t,n){n=n||e.layerLevel+1;var i=N.entity().set("position",e.position.x,e.position.y).set("sprite",O,e.name,n).set("partOfLayer",e.layer);"number"==typeof t&&(t={width:t,height:t}),t=t||{width:$.tileSize.width,height:$.tileSize.height};var o={x:($.tileSize.width-t.width)/2,y:($.tileSize.height-t.height)/2};return i.set("aabb",i.get("position"),t,o),i}},{key:"getColors",value:function(e){var t=["blue","yellow","red","green","cyan","magenta","white","none"];return t.map(function(t){return e+t})}},{key:"setupColors",value:function(e,t,n,i,o,r,a){var l=this;this.forEachTile(e,this.getColors(t),function(e){var s=e.name.substring(t.length);l.createEntity(e,r,a).set("color",s,o,t).set(n,i)})}},{key:"loadTiles",value:function(e){var t=this;e.puzzle||(e.puzzle={position:{x:128*$.tileSize.width,y:128*$.tileSize.height}}),$.showLayer(e.layer),this.clearEntities(),this.setupPlayer(e),this.forEachTile(e.layer,["portal_unexplored","portal_unsolved","portal_solved"],function(e){e.id in t.puzzlePortals&&(e.name=t.puzzlePortals[e.id],console.log("Stored state: "+e.name));t.createEntity(e,0).set("puzzlePortal",{layer:"lvl-"+e.id,position:e.position,state:e.name,tileId:e.id})}),this.forEachTile(e.layer,["puzzle_end","puzzle_end_done"],function(e){t.createEntity(e,64).set("puzzleGoal","puzzle_end_done"===e.name)}),this.setupColors(e.layer,"color_adder_","colorChanger","add",!1,150),this.setupColors(e.layer,"color_subtractor_","colorChanger","subtract",!1,{width:180,height:60}),this.setupColors(e.layer,"color_swapper_","colorChanger","swap",!0,180),this.setupColors(e.layer,"color_setter_","colorChanger","set",!1,{width:180,height:120}),this.setupColors(e.layer,"color_area_","colorArea",void 0,!1,256),this.forEachTile(e.layer,["clone_power"],function(e){t.createEntity(e,128).set("clonePower")}),this.forEachTile(e.layer,["lava"],function(e){t.createEntity(e,200).set("destroyer")}),this.forEachTile(e.layer,["water"],function(e){t.createEntity(e).set("water")}),this.forEachTile(e.layer,["water_ramp_up","water_ramp_down","water_ramp_right","water_ramp_left"],function(e){t.createEntity(e).set("waterRamp")})}}]),e}());var Y=l(function(e){!function(t,n,i){function o(e,t,n){return e.addEventListener?void e.addEventListener(t,n,!1):void e.attachEvent("on"+t,n)}function r(e){if("keypress"==e.type){var t=String.fromCharCode(e.which);return e.shiftKey||(t=t.toLowerCase()),t}return g[e.which]?g[e.which]:m[e.which]?m[e.which]:String.fromCharCode(e.which).toLowerCase()}function a(e,t){return e.sort().join(",")===t.sort().join(",")}function l(e){var t=[];return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t}function s(e){return e.preventDefault?void e.preventDefault():void(e.returnValue=!1)}function c(e){return e.stopPropagation?void e.stopPropagation():void(e.cancelBubble=!0)}function u(e){return"shift"==e||"ctrl"==e||"alt"==e||"meta"==e}function h(){if(!_){_={};for(var e in g)e>95&&e<112||g.hasOwnProperty(e)&&(_[g[e]]=e)}return _}function y(e,t,n){return n||(n=h()[e]?"keydown":"keypress"),"keypress"==n&&t.length&&(n="keydown"),n}function f(e){return"+"===e?["+"]:(e=e.replace(/\+{2}/g,"+plus"),e.split("+"))}function d(e,t){var n,i,o,r=[];for(n=f(e),o=0;o<n.length;++o)i=n[o],x[i]&&(i=x[i]),t&&"keypress"!=t&&w[i]&&(i=w[i],r.push("shift")),u(i)&&r.push(i);return t=y(i,r,t),{key:i,modifiers:r,action:t}}function p(e,t){return null!==e&&e!==n&&(e===t||p(e.parentNode,t))}function v(e){function t(e){e=e||{};var t,n=!1;for(t in w)e[t]?n=!0:w[t]=0;n||(k=!1)}function i(e,t,n,i,o,r){var l,s,c=[],h=n.type;if(!g._callbacks[e])return[];for("keyup"==h&&u(e)&&(t=[e]),l=0;l<g._callbacks[e].length;++l)if(s=g._callbacks[e][l],(i||!s.seq||w[s.seq]==s.level)&&h==s.action&&("keypress"==h&&!n.metaKey&&!n.ctrlKey||a(t,s.modifiers))){var y=!i&&s.combo==o,f=i&&s.seq==i&&s.level==r;(y||f)&&g._callbacks[e].splice(l,1),c.push(s)}return c}function h(e,t,n,i){g.stopCallback(t,t.target||t.srcElement,n,i)||e(t,n)===!1&&(s(t),c(t))}function y(e){"number"!=typeof e.which&&(e.which=e.keyCode);var t=r(e);if(t)return"keyup"==e.type&&x===t?void(x=!1):void g.handleKey(t,l(e),e)}function f(){clearTimeout(m),m=setTimeout(t,1e3)}function p(e,n,i,o){function a(t){return function(){k=t,++w[e],f()}}function l(n){h(i,n,e),"keyup"!==o&&(x=r(n)),setTimeout(t,10)}w[e]=0;for(var s=0;s<n.length;++s){var c=s+1===n.length,u=c?l:a(o||d(n[s+1]).action);_(n[s],u,o,e,s)}}function _(e,t,n,o,r){g._directMap[e+":"+n]=t,e=e.replace(/\s+/g," ");var a,l=e.split(" ");return l.length>1?void p(e,l,t,n):(a=d(e,n),g._callbacks[a.key]=g._callbacks[a.key]||[],i(a.key,a.modifiers,{type:a.action},o,e,r),void g._callbacks[a.key][o?"unshift":"push"]({callback:t,modifiers:a.modifiers,action:a.action,seq:o,level:r,combo:e}))}var g=this;if(e=e||n,!(g instanceof v))return new v(e);g.target=e,g._callbacks={},g._directMap={};var m,w={},x=!1,b=!1,k=!1;g._handleKey=function(e,n,o){var r,a=i(e,n,o),l={},s=0,c=!1;for(r=0;r<a.length;++r)a[r].seq&&(s=Math.max(s,a[r].level));for(r=0;r<a.length;++r)if(a[r].seq){if(a[r].level!=s)continue;c=!0,l[a[r].seq]=1,h(a[r].callback,o,a[r].combo,a[r].seq)}else c||h(a[r].callback,o,a[r].combo);var y="keypress"==o.type&&b;o.type!=k||u(e)||y||t(l),b=c&&"keydown"==o.type},g._bindMultiple=function(e,t,n){for(var i=0;i<e.length;++i)_(e[i],t,n)},o(e,"keypress",y),o(e,"keydown",y),o(e,"keyup",y)}if(t){for(var _,g={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},m={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},w={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},x={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},b=1;b<20;++b)g[111+b]="f"+b;for(b=0;b<=9;++b)g[b+96]=b;v.prototype.bind=function(e,t,n){var i=this;return e=e instanceof Array?e:[e],i._bindMultiple.call(i,e,t,n),i},v.prototype.unbind=function(e,t){var n=this;return n.bind.call(n,e,function(){},t)},v.prototype.trigger=function(e,t){var n=this;return n._directMap[e+":"+t]&&n._directMap[e+":"+t]({},e),n},v.prototype.reset=function(){var e=this;return e._callbacks={},e._directMap={},e},v.prototype.stopCallback=function(e,t){var n=this;return!((" "+t.className+" ").indexOf(" mousetrap ")>-1)&&(!p(t,n.target)&&("INPUT"==t.tagName||"SELECT"==t.tagName||"TEXTAREA"==t.tagName||t.isContentEditable))},v.prototype.handleKey=function(){var e=this;return e._handleKey.apply(e,arguments)},v.addKeycodes=function(e){for(var t in e)e.hasOwnProperty(t)&&(g[t]=e[t]);_=null},v.init=function(){var e=v(n);for(var t in e)"_"!==t.charAt(0)&&(v[t]=function(t){return function(){return e[t].apply(e,arguments)}}(t))},v.init(),t.Mousetrap=v,"undefined"!=typeof e&&e.exports&&(e.exports=v),"function"==typeof define&&define.amd&&define(function(){return v})}}("undefined"!=typeof window?window:null,"undefined"!=typeof window?document:null)});touchInput.attach(),N.system([],function(){function e(){var t=this;_(this,e),this.keysDown={i:!1,o:!1},Y.bind("u",function(){t.setScale(.5)}),Y.bind("i",function(){t.keysDown.i=!0}),Y.bind("i",function(){t.keysDown.i=!1},"keyup"),Y.bind("o",function(){t.keysDown.o=!0}),Y.bind("o",function(){t.keysDown.o=!1},"keyup")}return g(e,[{key:"init",value:function(){this.setScale(.3)}},{key:"pre",value:function(){this.keysDown.i&&this.setScale(this.getScale()*(1+1*D.val)),this.keysDown.o&&this.setScale(this.getScale()*(1-1*D.val))}},{key:"setScale",value:function(e){E.scale.x=e,E.scale.y=e,q.send("updateCamera")}},{key:"getScale",value:function(){return E.scale.x}}]),e}()),N.system(["inputMovement","velocity"],function(){function e(){var t=this;_(this,e),this.moveDelta={x:0,y:0},this.lastMoveDelta={x:0,y:0},this.keys={},this.touching=!1,this.runningSpeed=1,Y.bind("shift",function(){t.runningSpeed=4}),Y.bind("shift",function(){t.runningSpeed=1},"keyup")}return g(e,[{key:"init",value:function(){this.initKeyboardInput(),this.initTouchInput()}},{key:"pre",value:function(){var e=this;if(q.process("resetKeys",function(){e.resetKeys()}),!this.touching){this.moveDelta={x:0,y:0};for(var t in this.keys){var n=this.keys[t];n.down&&(this.moveDelta.x+=n.delta.x,this.moveDelta.y+=n.delta.y)}}if(0!==this.moveDelta.x||0!==this.moveDelta.y){var i=Math.sqrt(this.moveDelta.x*this.moveDelta.x+this.moveDelta.y*this.moveDelta.y);this.moveDelta.x/=i,this.moveDelta.y/=i,this.lastMoveDelta.x=this.moveDelta.x,this.lastMoveDelta.y=this.moveDelta.y}}},{key:"every",value:function(e,t){t.x=this.moveDelta.x*e.speed*this.runningSpeed,t.y=this.moveDelta.y*e.speed*this.runningSpeed,e.lastDirection.x=this.lastMoveDelta.x,e.lastDirection.y=this.lastMoveDelta.y}},{key:"makeKey",value:function(e,t){return{delta:{x:e,y:t},down:!1}}},{key:"resetKeys",value:function(){for(var e in this.keys)this.keys[e].down=!1}},{key:"bindKey",value:function(e){var t=this;Y.bind(e,function(){t.keys[e].down=!0}),Y.bind(e,function(){t.keys[e].down=!1},"keyup")}},{key:"initKeyboardInput",value:function(){this.keys={w:this.makeKey(0,-1),a:this.makeKey(-1,0),s:this.makeKey(0,1),d:this.makeKey(1,0),up:this.makeKey(0,-1),left:this.makeKey(-1,0),down:this.makeKey(0,1),right:this.makeKey(1,0)};for(var e in this.keys)this.bindKey(e)}},{key:"handleTouchStart",value:function(e){this.touching=!0,this.handleTouch(e)}},{key:"handleTouch",value:function(e){var t={x:e.touch.position[0],y:e.touch.position[1]},n=R.player.get("sprite").s.toGlobal(new PIXI.Point(0,0)),i={x:t.x-n.x,y:t.y-n.y};this.moveDelta=i}},{key:"handleTouchEnd",value:function(){this.touching=!1}},{key:"initTouchInput",value:function(){var e=this;touchInput.on("touchBegan",function(t){e.handleTouchStart(t),t.touch.on("moved",function(t){e.handleTouch(t)}),t.touch.on("ended",function(){e.handleTouchEnd()})})}}]),e}()),N.system([],function(){function e(){_(this,e)}return g(e,[{key:"init",value:function(){var e=this;this.cloneId=0;var t={x:128*$.tileSize.width,y:128*$.tileSize.height};R.player=this.createPlayer(t);var n=function(){e.clone()};Mousetrap.bind("space",n)}},{key:"clone",value:function(){var e=this.scan();e.clone?this.swapToClone(e):e.position?this.addClone(e):console.log("Cannot clone/swap here.")}},{key:"getEndPosition",value:function(e,t,n,i){var o=n-i.size.width/2,r={x:e.x+t.x*o,y:e.y+t.y*o},a={x:r.x-$.tileSize.width/2,y:r.y-$.tileSize.height/2};return a}},{key:"scan",value:function(){var e={},t=R.player,n=t.get("aabb").rect,i=n.getCenter(),o=t.get("cloneTool").directionDelta;if(0===o.x&&0===o.y)return e;var r=Q.getMaxDistance(i,o,n),a=A.getLineCollisions(i,o,r),l=!0,s=!1,c=void 0;try{for(var u,h=a[Symbol.iterator]();!(l=(u=h.next()).done);l=!0){var y=u.value,f=y.ent,d=f.has("aabb");if(d&&f.has("colorArea")){var p=f.get("color"),v=t.get("color");if(p.name!==v.name)return y.distance>=1.5*n.size.width&&(e.position=this.getEndPosition(i,o,y.distance,n)),e}var _=f.has("player")&&!f.has("cloneTool");if(_)return console.log("Found clone!"),e.clone=f,e}}catch(e){s=!0,c=e}finally{try{!l&&h.return&&h.return()}finally{if(s)throw c}}return r>=1.5*n.size.width&&(e.position=this.getEndPosition(i,o,r,n)),e}},{key:"addClone",value:function(e){var t=R.player.get("cloneTool");t&&t.count>0?(t.use(),this.createPlayer(e.position,R.player)):console.log("No more clones available.")}},{key:"swapToClone",value:function(e){console.log("Swapping to clone...");var t=R.player.get("cloneTool").getOptions();R.player.remove("cloneTool"),R.player.get("mergable").isParent=!1,R.player=e.clone,R.player.set("cloneTool",R.player.get("sprite")),R.player.get("cloneTool").setOptions(t),R.player.get("mergable").isParent=!0}},{key:"createPlayer",value:function(e,t){this.cloneId++;var n=N.entity().set("player").set("movable").set("position",e.x,e.y).set("velocity").set("inputMovement").set("sprite",O,"player_none",10).set("color","none",!0,"player_").set("mergable",!t,this.cloneId).set("destroyable").set("new"),i=16;return n.set("aabb",n.get("position"),{
width:$.tileSize.width-2*i,height:$.tileSize.height-2*i},{x:i,y:i}),t?n.get("color").change(t.get("color").name):(n.set("cameraFollows"),n.set("cloneTool",n.get("sprite"))),console.log("Created player with entity id: "+n.id),n}}]),e}()),N.system(["position","velocity"],function(){function e(){_(this,e)}return g(e,[{key:"every",value:function(e,t,n){e.x+=t.x*D.val,e.y+=t.y*D.val;var i=n.get("aabb");i&&(i.rect.position.x=e.x,i.rect.position.y=e.y)}}]),e}()),N.system(["aabb"],function(){function e(){_(this,e)}return g(e,[{key:"pre",value:function(){A.clear()}},{key:"every",value:function(e,t){A.update(t,e)}}]),e}()),N.system(["aabb"],function(){function e(){_(this,e),this.skipped=new Set}return g(e,[{key:"pre",value:function(){var e=this;this.skipped.clear(),N.every(["skip"],function(t,n){e.skipped.add(n.id)})}},{key:"every",value:function(e,t){var n=A.getCollisions(t,e),i=t.get("collisions");if(n||i){i||(i=t.access("collisions"));var r=i.current;if(i.current=n,i.next=o(i.current,r),i.previous=o(r,i.current),this.skipped.size>=1)for(var a in i.current)this.skipped.has(parseInt(a))&&(i.next[a]=i.current[a]);Object.keys(i.next).length>0?t.set("hasNewCollisions"):t.remove("hasNewCollisions"),i.empty()&&t.remove("collisions")}}},{key:"post",value:function(){N.every(["skip"],function(e,t){t.remove("skip")})}}]),e}()),N.system(["aabb","color","colorArea","collisions","hasNewCollisions"],function(){function e(){_(this,e)}return g(e,[{key:"every",value:function(e,t,n,i,o,r){for(var a in i.current){var l=i.current[a],s=l.get("color"),c=l.get("aabb");if(c&&s&&s.name!==t.name){c.rect.handleCollision(e.rect);l.set("skip")}}}}]),e}()),N.system(["aabb","water","collisions","hasNewCollisions"],function(){function e(){_(this,e)}return g(e,[{key:"every",value:function(e,t,n,i,o){if(!o.has("swimming"))for(var r in n.current){var a=n.current[r],l=a.get("aabb");l&&(l.rect.handleCollision(e.rect),a.set("skip"))}}}]),e}()),N.system(["aabb","velocity"],function(){function e(){_(this,e)}return g(e,[{key:"every",value:function(e,t,n){(0!==t.x||0!==t.y||n.has("new"))&&Q.handleCollision(e.rect)}}]),e}()),N.system([],function(){function e(){_(this,e),this.currentPuzzle=null,this.lastPuzzle=null}return g(e,[{key:"enterLevel",value:function(e){e&&(q.send("loadTiles",{layer:e.layer,puzzle:e}),this.currentPuzzle=e)}},{key:"exitLevel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.currentPuzzle&&(e&&console.log("Puzzle complete!"),"portal_solved"!==this.currentPuzzle.state&&(this.currentPuzzle.state=e?"portal_solved":"portal_unsolved"),q.send("updatePuzzlePortal",{id:this.currentPuzzle.tileId,state:this.currentPuzzle.state}),q.send("loadTiles",{layer:"world",puzzle:this.currentPuzzle}),this.currentPuzzle=null)}},{key:"init",value:function(){var e=this;Mousetrap.bind("esc",function(){e.exitLevel()}),Mousetrap.bind("r",function(){e.enterLevel(e.currentPuzzle)})}},{key:"pre",value:function(){var e=this;q.process("restart",function(){e.enterLevel(e.currentPuzzle)}),N.every(["puzzlePortal","collisions","hasNewCollisions"],function(t,n,i,o){null!==e.lastPuzzle?e.lastPuzzle=null:null===e.lastPuzzle&&R.player.id in n.next&&(e.enterLevel(t.puzzle),e.lastPuzzle=o.id)},this),N.every(["puzzleGoal","collisions","hasNewCollisions"],function(t,n,i){t.completed&&R.player.id in n.current&&e.exitLevel(t.completed)},this)}}]),e}());var Z=["none","red","green","yellow","blue","magenta","cyan","white"],ee={};for(var te in Z)ee[Z[te]]=te;var ne=1,ie=2,oe=4,re={add:function(e,t){return e||t},subtract:function(e,t){return e&&!t},xor:function(e,t){return e^t}};N.system(["color","colorChanger","collisions","hasNewCollisions"],function(){function e(){_(this,e)}return g(e,[{key:"every",value:function(e,t,n,i,o){for(var r in n.next){var a=n.next[r];!a.has("skip")&&a.has("color")&&this.changeColor(e,a.get("color"),t.action)}}},{key:"changeColor",value:function(e,t,n){if("swap"===n){var i=t.name;t.change(e.name),e.change(i)}else"set"===n?t.change(e.name):t.change(y(t.name,e.name,n))}}]),e}()),N.system(["clonePower","collisions","hasNewCollisions"],function(){function e(){_(this,e)}return g(e,[{key:"every",value:function(e,t,n,i){for(var o in t.next){var r=t.next[o];r.has("player")&&(R.player.get("cloneTool").add(),i.destroy())}}}]),e}()),N.system(["destroyer","collisions","hasNewCollisions"],function(){function e(){_(this,e)}return g(e,[{key:"every",value:function(e,t,n,i){for(var o in t.next){var r=t.next[o];if(r.has("destroyable")){if(r.has("player")&&!r.has("cloneTool")&&R.player.get("cloneTool").add(),r.has("cloneTool")){q.send("restart");break}r.destroy()}}}}]),e}()),N.system(["mergable","collisions","hasNewCollisions"],function(){function e(){_(this,e)}return g(e,[{key:"every",value:function(e,t,n,i){for(var o in t.next){var r=t.next[o];r.has("mergable")&&this.merge(i,r)}}},{key:"merge",value:function(e,t){var n=null,i=e.get("mergable"),o=t.get("mergable");return i&&o?n=i.isParent||i.cloneId>o.cloneId?this.mergeComponents(e,t):this.mergeComponents(t,e):console.log("Error: Cannot merge unmergable entities."),n||(console.log("Warning: Nothing was merged?"),n=e),n}},{key:"mergeComponents",value:function(e,t){var n=e.get("color"),i=t.get("color");return n&&i&&n.change(y(n.name,i.name)),t.has("player")&&R.player.get("cloneTool").add(),t.destroy(),e}}]),e}()),N.system(["cloneTool"],function(){function e(){_(this,e)}return g(e,[{key:"every",value:function(e,t){var n=t.get("inputMovement");if(n){var i=t.get("cloneTool");i&&i.setDirection(n.lastDirection)}}}]),e}()),N.system(["puzzleGoal"],function(){function e(){_(this,e),this.solved=!0}return g(e,[{key:"pre",value:function(){var e=this;this.solved=!0,N.every(["light"],function(t,n){t.lit||(e.solved=!1)})}},{key:"every",value:function(e,t){e.setCompleted(this.solved,t)}}]),e}()),N.system(["position","aabb"],function(){function e(){_(this,e)}return g(e,[{key:"every",value:function(e,t,n){e.x=t.rect.position.x,e.y=t.rect.position.y}}]),e}()),N.system([],function(){function e(){_(this,e)}return g(e,[{key:"pre",value:function(){q.process("clearPlayer",function(e){N.every(["player"],function(e,t){t.has("cloneTool")||t.destroy()}),R.player.get("cloneTool").setClones(0),R.player.get("color").change()})}}]),e}()),N.system(["sprite","position"],function(){function e(){_(this,e)}return g(e,[{key:"every",value:function(e,t,n){e.s.position.x=t.x,e.s.position.y=t.y}}]),e}()),N.system(["color","sprite"],function(){function e(){_(this,e)}return g(e,[{key:"every",value:function(e,t,n){e.changed&&(t.set(e.base+e.name),e.changed=!1)}}]),e}()),N.system(["aabb","cameraFollows"],function(){function e(){_(this,e)}return g(e,[{key:"every",value:function(e,t){var n=e.rect.getCenter();q.exists("updateCamera")&&(t.update(),q.clear("updateCamera")),t.center&&(this.centerCamera(n,t),t.center=!1),n.x>t.deadzone.x+t.deadzone.width&&(t.deadzone.x=n.x-t.deadzone.width),n.x<t.deadzone.x&&(t.deadzone.x=n.x),n.y>t.deadzone.y+t.deadzone.height&&(t.deadzone.y=n.y-t.deadzone.height),n.y<t.deadzone.y&&(t.deadzone.y=n.y),O.position.x=-t.deadzone.x+t.borderSize.x,O.position.y=-t.deadzone.y+t.borderSize.y}},{key:"centerCamera",value:function(e,t){t.deadzone.x=e.x-t.deadzone.width/2,t.deadzone.y=e.y-t.deadzone.height/2}}]),e}()),N.system(["pixiStage"],function(){function e(){_(this,e),this.renderer=null}return g(e,[{key:"init",value:function(){this.renderer=PIXI.autoDetectRenderer(M.width,M.height,{antialias:!1}),document.body.appendChild(this.renderer.view),N.entity().set("pixiStage",E)}},{key:"every",value:function(e){this.renderer.render(e.root)}}]),e}()),N.system(["new"],function(){function e(){_(this,e)}return g(e,[{key:"every",value:function(e,t){t.remove("new")}}]),e}());var ae=0;f()}();

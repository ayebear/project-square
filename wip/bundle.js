!function(){"use strict";function e(e,t){if(e&&"function"==typeof e[t]){for(var n,r=arguments.length,i=Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];return(n=e[t]).call.apply(n,[e].concat(i))}}function t(e){return"function"==typeof e}function n(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function r(e,t){return t={exports:{}},e(t,t.exports),t.exports}function i(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}function o(e){var t=Tn.call(e,jn),n=e[jn];try{e[jn]=void 0;var r=!0}catch(e){}var i=En.call(e);return r&&(t?e[jn]=n:delete e[jn]),i}function a(e){return Mn.call(e)}function s(e){return null==e?void 0===e?Bn:Dn:Fn&&Fn in Object(e)?Ln(e):Cn(e)}function u(e){return null!=e&&"object"==(void 0===e?"undefined":qt(e))}function l(e){return Nn(e)&&Rn(e)==Gn}function c(e){return $n(e)||Kn(e)||!!(Yn&&e&&e[Yn])}function d(e,t,n,r,i){var o=-1,a=e.length;for(n||(n=Jn),i||(i=[]);++o<a;){var s=e[o];t>0&&n(s)?t>1?d(s,t-1,n,r,i):bn(i,s):r||(i[i.length]=s)}return i}function f(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}function h(){this.__data__=[],this.size=0}function v(e,t){return e===t||e!==e&&t!==t}function p(e,t){for(var n=e.length;n--;)if(tr(e[n][0],t))return n;return-1}function _(e){var t=this.__data__,n=nr(t,e);return!(n<0)&&(n==t.length-1?t.pop():ir.call(t,n,1),--this.size,!0)}function y(e){var t=this.__data__,n=nr(t,e);return n<0?void 0:t[n][1]}function m(e){return nr(this.__data__,e)>-1}function g(e,t){var n=this.__data__,r=nr(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function b(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function k(){this.__data__=new lr,this.size=0}function w(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function x(e){return this.__data__.get(e)}function A(e){return this.__data__.has(e)}function S(e){var t=void 0===e?"undefined":qt(e);return null!=e&&("object"==t||"function"==t)}function O(e){if(!vr(e))return!1;var t=Rn(e);return t==_r||t==yr||t==pr||t==mr}function I(e){return!!wr&&wr in e}function P(e){if(null!=e){try{return Sr.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function T(e){return!(!vr(e)||xr(e))&&(gr(e)?zr:Pr).test(Or(e))}function E(e,t){return null==e?void 0:e[t]}function j(e,t){var n=Cr(e,t);return Mr(n)?n:void 0}function L(){this.__data__=Nr?Nr(null):{},this.size=0}function z(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function M(e){var t=this.__data__;if(Nr){var n=t[e];return n===Wr?void 0:n}return Vr.call(t,e)?t[e]:void 0}function C(e){var t=this.__data__;return Nr?void 0!==t[e]:Hr.call(t,e)}function D(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Nr&&void 0===t?Yr:t,this}function B(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function F(){this.size=0,this.__data__={hash:new Qr,map:new(Fr||lr),string:new Qr}}function R(e){var t=void 0===e?"undefined":qt(e);return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function N(e,t){var n=e.__data__;return ei(t)?n["string"==typeof t?"string":"hash"]:n.map}function G(e){var t=ti(this,e).delete(e);return this.size-=t?1:0,t}function q(e){return ti(this,e).get(e)}function W(e){return ti(this,e).has(e)}function U(e,t){var n=ti(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function V(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function X(e,t){var n=this.__data__;if(n instanceof lr){var r=n.__data__;if(!Fr||r.length<si-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new ai(r)}return n.set(e,t),this.size=n.size,this}function K(e){var t=this.__data__=new lr(e);this.size=t.size}function H(e){return this.__data__.set(e,ci),this}function $(e){return this.__data__.has(e)}function Y(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new ai;++t<n;)this.add(e[t])}function J(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function Q(e,t){return e.has(t)}function Z(e,t,n,r,i,o){var a=n&_i,s=e.length,u=t.length;if(s!=u&&!(a&&u>s))return!1;var l=o.get(e);if(l&&o.get(t))return l==t;var c=-1,d=!0,f=n&yi?new hi:void 0;for(o.set(e,t),o.set(t,e);++c<s;){var h=e[c],v=t[c];if(r)var p=a?r(v,h,c,t,e,o):r(h,v,c,e,t,o);if(void 0!==p){if(p)continue;d=!1;break}if(f){if(!vi(t,function(e,t){if(!pi(f,t)&&(h===e||i(h,e,n,r,o)))return f.push(t)})){d=!1;break}}else if(h!==v&&!i(h,v,n,r,o)){d=!1;break}}return o.delete(e),o.delete(t),d}function ee(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}function te(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}function ne(e,t,n,r,i,o,a){switch(n){case Ci:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Mi:return!(e.byteLength!=t.byteLength||!o(new bi(e),new bi(t)));case Si:case Oi:case Ti:return tr(+e,+t);case Ii:return e.name==t.name&&e.message==t.message;case Ei:case Li:return e==t+"";case Pi:var s=ki;case ji:var u=r&xi;if(s||(s=wi),e.size!=t.size&&!u)return!1;var l=a.get(e);if(l)return l==t;r|=Ai,a.set(e,t);var c=mi(s(e),s(t),r,i,o,a);return a.delete(e),c;case zi:if(Bi)return Bi.call(e)==Bi.call(t)}return!1}function re(e,t,n){var r=t(e);return $n(e)?r:bn(r,n(e))}function ie(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o}function oe(){return[]}function ae(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function se(){return!1}function ue(e,t){return!!(t=null==t?Yi:t)&&("number"==typeof e||Ji.test(e))&&e>-1&&e%1==0&&e<t}function le(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=Zi}function ce(e){return Nn(e)&&eo(e.length)&&!!to[Rn(e)]}function de(e){return function(t){return e(t)}}function fe(e,t){var n=$n(e),r=!n&&Kn(e),i=!n&&!r&&$i(e),o=!n&&!r&&!i&&so(e),a=n||r||i||o,s=a?Ki(e.length,String):[],u=s.length;for(var l in e)!t&&!lo.call(e,l)||a&&("length"==l||i&&("offset"==l||"parent"==l)||o&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||Qi(l,u))||s.push(l);return s}function he(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||fo)}function ve(e,t){return function(n){return e(t(n))}}function pe(e){if(!ho(e))return _o(e);var t=[];for(var n in Object(e))mo.call(e,n)&&"constructor"!=n&&t.push(n);return t}function _e(e){return null!=e&&eo(e.length)&&!gr(e)}function ye(e){return bo(e)?co(e):go(e)}function me(e){return Ri(e,ko,Xi)}function ge(e,t,n,r,i,o){var a=n&xo,s=wo(e),u=s.length;if(u!=wo(t).length&&!a)return!1;for(var l=u;l--;){var c=s[l];if(!(a?c in t:So.call(t,c)))return!1}var d=o.get(e);if(d&&o.get(t))return d==t;var f=!0;o.set(e,t),o.set(t,e);for(var h=a;++l<u;){c=s[l];var v=e[c],p=t[c];if(r)var _=a?r(p,v,c,t,e,o):r(v,p,c,e,t,o);if(!(void 0===_?v===p||i(v,p,n,r,o):_)){f=!1;break}h||(h="constructor"==c)}if(f&&!h){var y=e.constructor,m=t.constructor;y!=m&&"constructor"in e&&"constructor"in t&&!("function"==typeof y&&y instanceof y&&"function"==typeof m&&m instanceof m)&&(f=!1)}return o.delete(e),o.delete(t),f}function be(e,t,n,r,i,o){var a=$n(e),s=$n(t),u=a?Uo:Go(e),l=s?Uo:Go(t);u=u==Wo?Vo:u,l=l==Wo?Vo:l;var c=u==Vo,d=l==Vo,f=u==l;if(f&&$i(e)){if(!$i(t))return!1;a=!0,c=!1}if(f&&!c)return o||(o=new li),a||so(e)?mi(e,t,n,r,i,o):Fi(e,t,u,n,r,i,o);if(!(n&qo)){var h=c&&Ko.call(e,"__wrapped__"),v=d&&Ko.call(t,"__wrapped__");if(h||v){var p=h?e.value():e,_=v?t.value():t;return o||(o=new li),i(p,_,n,r,o)}}return!!f&&(o||(o=new li),Oo(e,t,n,r,i,o))}function ke(e,t,n,r,i){return e===t||(null==e||null==t||!Nn(e)&&!Nn(t)?e!==e&&t!==t:Ho(e,t,n,r,ke,i))}function we(e,t,n,r){var i=n.length,o=i,a=!r;if(null==e)return!o;for(e=Object(e);i--;){var s=n[i];if(a&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<o;){s=n[i];var u=s[0],l=e[u],c=s[1];if(a&&s[2]){if(void 0===l&&!(u in e))return!1}else{var d=new li;if(r)var f=r(l,c,u,e,t,d);if(!(void 0===f?$o(c,l,Yo|Jo,r,d):f))return!1}}return!0}function xe(e){return e===e&&!vr(e)}function Ae(e){for(var t=ko(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,Zo(i)]}return t}function Se(e,t){return function(n){return null!=n&&(n[e]===t&&(void 0!==t||e in Object(n)))}}function Oe(e){var t=ea(e);return 1==t.length&&t[0][2]?ta(t[0][0],t[0][1]):function(n){return n===e||Qo(n,e,t)}}function Ie(e){return"symbol"==(void 0===e?"undefined":qt(e))||Nn(e)&&Rn(e)==ra}function Pe(e,t){if($n(e))return!1;var n=void 0===e?"undefined":qt(e);return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!ia(e))||(aa.test(e)||!oa.test(e)||null!=t&&e in Object(t))}function Te(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(ua);var n=function n(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=e.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(Te.Cache||ai),n}function Ee(e){var t=la(e,function(e){return n.size===ca&&n.clear(),e}),n=t.cache;return t}function je(e){if("string"==typeof e)return e;if($n(e))return Zn(e,je)+"";if(ia(e))return ga?ga.call(e):"";var t=e+"";return"0"==t&&1/e==-ya?"-0":t}function Le(e){return null==e?"":ba(e)}function ze(e,t){return $n(e)?e:sa(e,t)?[e]:_a(ka(e))}function Me(e){if("string"==typeof e||ia(e))return e;var t=e+"";return"0"==t&&1/e==-xa?"-0":t}function Ce(e,t){t=wa(t,e);for(var n=0,r=t.length;null!=e&&n<r;)e=e[Aa(t[n++])];return n&&n==r?e:void 0}function De(e,t,n){var r=null==e?void 0:Sa(e,t);return void 0===r?n:r}function Be(e,t){return null!=e&&t in Object(e)}function Fe(e,t,n){t=wa(t,e);for(var r=-1,i=t.length,o=!1;++r<i;){var a=Aa(t[r]);if(!(o=null!=e&&n(e,a)))break;e=e[a]}return o||++r!=i?o:!!(i=null==e?0:e.length)&&eo(i)&&Qi(a,i)&&($n(e)||Kn(e))}function Re(e,t){return null!=e&&Pa(e,t,Ia)}function Ne(e,t){return sa(e)&&Zo(t)?ta(Aa(e),t):function(n){var r=Oa(n,e);return void 0===r&&r===t?Ta(n,e):$o(t,r,Ea|ja)}}function Ge(e){return e}function qe(e){return function(t){return null==t?void 0:t[e]}}function We(e){return function(t){return Sa(t,e)}}function Ue(e){return sa(e)?Ma(Aa(e)):Ca(e)}function Ve(e){return"function"==typeof e?e:null==e?za:"object"==(void 0===e?"undefined":qt(e))?$n(e)?La(e[0],e[1]):na(e):Da(e)}function Xe(e){return function(t,n,r){for(var i=-1,o=Object(t),a=r(t),s=a.length;s--;){var u=a[e?s:++i];if(!1===n(o[u],u,o))break}return t}}function Ke(e,t){return e&&Na(e,t,ko)}function He(e,t){return function(n,r){if(null==n)return n;if(!bo(n))return e(n,r);for(var i=n.length,o=t?i:-1,a=Object(n);(t?o--:++o<i)&&!1!==r(a[o],o,a););return n}}function $e(e,t){var n=-1,r=bo(e)?Array(e.length):[];return Ua(e,function(e,i,o){r[++n]=t(e,i,o)}),r}function Ye(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}function Je(e,t){if(e!==t){var n=void 0!==e,r=null===e,i=e===e,o=ia(e),a=void 0!==t,s=null===t,u=t===t,l=ia(t);if(!s&&!l&&!o&&e>t||o&&a&&u&&!s&&!l||r&&a&&u||!n&&u||!i)return 1;if(!r&&!o&&!l&&e<t||l&&n&&i&&!r&&!o||s&&n&&i||!a&&i||!u)return-1}return 0}function Qe(e,t,n){for(var r=-1,i=e.criteria,o=t.criteria,a=i.length,s=n.length;++r<a;){var u=Ka(i[r],o[r]);if(u){if(r>=s)return u;return u*("desc"==n[r]?-1:1)}}return e.index-t.index}function Ze(e,t,n){var r=-1;t=Zn(t.length?t:[za],ro(Ba));var i=Va(e,function(e,n,i){return{criteria:Zn(t,function(t){return t(e)}),index:++r,value:e}});return Xa(i,function(e,t){return Ha(e,t,n)})}function et(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function tt(e,t,n){return t=Ja(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,o=Ja(r.length-t,0),a=Array(o);++i<o;)a[i]=r[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=r[i];return s[t]=n(a),Ya(e,this,s)}}function nt(e){return function(){return e}}function rt(e){var t=0,n=0;return function(){var r=as(),i=os-(r-n);if(n=r,i>0){if(++t>=is)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function it(e,t){return ls(Qa(e,t,za),e+"")}function ot(e,t,n){if(!vr(n))return!1;var r=void 0===t?"undefined":qt(t);return!!("number"==r?bo(n)&&Qi(t,n.length):"string"==r&&t in n)&&tr(n[t],e)}function at(e,t){for(var n,r=-1,i=e.length;++r<i;){var o=t(e[r]);void 0!==o&&(n=void 0===n?o:n+o)}return n}function st(e){return e&&e.length?vs(e,za):0}function ut(e){return(e.x||0)+","+(e.y||0)}function lt(e){var t=e.split(",");return t.length=2,{x:parseInt(t[0])||0,y:parseInt(t[1])||0}}function ct(e){e.children.sort(function(e,t){return e.zIndex=e.zIndex||0,t.zIndex=t.zIndex||0,e.zIndex-t.zIndex})}function dt(e,t){if(e&&"debug"in e&&console.log("invoke("+t+"): "+e.debug),e&&"function"==typeof e[t]){for(var n,r=arguments.length,i=Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];return(n=e[t]).call.apply(n,[e].concat(i))}}function ft(e){if("function"==typeof e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.apply(void 0,n)}}function ht(e,t){return(e%t+t)%t}function vt(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;return{x:e.x+(t.x-e.x)*n,y:e.y+(t.y-e.y)*n}}function pt(e){var t=void 0;return e.text?(t=new PIXI.Text(e.text,e.style),console.warn("Memory leak will occur soon, do not use PIXI.Text objects...")):e.texture?(t=new PIXI.Sprite(e.texture),t.anchor.x=e.anchor.x,t.anchor.y=e.anchor.y,t.tint=e.tint):t=new PIXI.Container,t.x=e.x,t.y=e.y,t.scale.x=e.scale.x,t.scale.y=e.scale.y,t.zIndex=e.zIndex,t.alpha=e.alpha,t.visible=e.visible,t.rotation=e.rotation,t}function _t(e){var t=pt(e);if(e.children){var n=!0,r=!1,i=void 0;try{for(var o,a=e.children[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;t.addChild(_t(s))}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}}return t}function yt(e,t){return Math.floor(Math.random()*(t-e))+e}function mt(e){if(e.length)return e[yt(0,e.length)]}function gt(e,t){var n="floor",r=e.find(t,void 0,"terrain");return r&&(n=r.get("terrain")),n}function bt(e){return e.has("sprite")?e.get("sprite").zIndex||0:0}function kt(e){return hs(e,function(e){return bt(e)})}function wt(e){return e?new PIXI.Sprite(PIXI.utils.TextureCache[e+".png"]):new PIXI.Sprite}function xt(e,t){var n=e.get("sprite");if(n){var r=n.sprite,i=wt(t);if(i)return i.anchor.set(.5),r.addChild(i),t}}function At(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return 16711680*((e&_s.r)>>2)+65280*((e&_s.g)>>1)+255*(e&_s.b)}function St(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=new Set(e.split("").filter(function(e){return e in _s}));return ps([].concat(Yt(t)).map(function(e){return _s[e]}))}function Ot(e,t){return e.x*t.y>e.y*t.x}function It(e,t,n){var r={x:Math.floor(n.x/e.width),y:Math.floor(n.y/e.height)},i={x:n.x-e.width*r.x- -t.x*r.y,y:n.y-e.height*r.y- -t.y*r.x};return i.x<0||i.y<0||i.x>=e.width||i.y>=e.height?0===t.x||0===t.y?{x:ht(i.x,e.width),y:ht(i.y,e.height)}:null:i}function Pt(e){return!!(e&&e.valid()&&e.has("timeImmune"))}function Tt(e){e.has("render")&&e.set("toRender")}function Et(e){var t="dead";return e.has("dead")||(t=xu[ut(e.get("direction"))]||xu.default),"player_"+t}function jt(e,t){for(var n=e.get("position"),r=arguments.length,i=Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];return i.map(function(e){var r={x:n.x+e[0],y:n.y+e[1]};return Gs.has(r,t)})}function Lt(e){return ju[2+e.x+2*e.y]||ju[0]}function zt(e){return e&&e.get("primary")===e.get("secondary")}function Mt(e){return e>0?"positive":e<0?"negative":"zero"}function Ct(e){var t=e.get("axis");return"block_offset_"+t+"_"+Mt(bs.offset[t])}function Dt(e){return"level_goal"+(e.get("levelGoal").completed?"_solved":"")}function Bt(){document.body.appendChild(Bs.view),PIXI.loader.add("textures","data/textures-1.json").load(Ft)}function Ft(e,t){Ds.initialize(),Bs.ticker.add(function(e){var t=Bs.ticker.elapsedMS/1e3;Ds.run(t)})}var Rt=e,Nt=t,Gt={invoke:Rt,isFunction:Nt},qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Wt=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Ut=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Vt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Xt=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},Kt=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},Ht=function e(t,n,r,i){var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var a=Object.getPrototypeOf(t);null!==a&&e(a,n,r,i)}else if("value"in o&&o.writable)o.value=r;else{var s=o.set;void 0!==s&&s.call(i,r)}return r},$t=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),Yt=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},Jt=Gt.invoke,Qt=function(){function e(t,n){Wt(this,e),this.world=t,this._id=n,this.data={}}return Ut(e,[{key:"has",value:function(){for(var e=this,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.every(function(t){return t in e.data})}},{key:"get",value:function(e){return this.data[e]}},{key:"access",value:function(e){if(!this.has(e)){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.set.apply(this,[e].concat(n))}return this.data[e]}},{key:"set",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return this.valid()&&e in this.world.components?this.data[e]=new(Function.prototype.bind.apply(this.world.components[e],[null].concat([this],n))):n.length>0?this.data[e]=n[0]:this.data[e]={},this.valid()&&this.world.index.add(this,e),Jt.apply(void 0,[this.data[e],"onCreate",this].concat(n)),this}},{key:"update",value:function(e,t){var n=this.access(e);for(var r in t)n[r]=t[r];return this}},{key:"remove",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;u in this.data&&(Jt(this.data[u],"onRemove"),this.valid()&&this.world.index.remove(this,u),delete this.data[u])}}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return this}},{key:"removeAll",value:function(){if(this.remove.apply(this,Yt(this.components)),this.components.length>0)throw new Error("Failed to remove all components. Components must have been added during the removeAll().");return this}},{key:"destroy",value:function(){this.removeAll(),this.valid()&&(this.world.entities.delete(this._id),this._id=void 0)}},{key:"valid",value:function(){return this.world&&void 0!==this._id}},{key:"toString",value:function(){return String(this._id)}},{key:"toJSON",value:function(){return JSON.stringify(this.data)}},{key:"fromJSON",value:function(e){var t=JSON.parse(e);for(var n in t){var r=this.access(n);"function"==typeof r.fromJSON?r.fromJSON(t[n]):this.update(n,t[n])}return this}},{key:"attach",value:function(e){if(e&&!this.valid()){var t;this.world=e,this._id=this.world.idCounter++,this.world.entities.set(this._id,this),(t=this.world.index).add.apply(t,[this].concat(Yt(this.components)))}}},{key:"detach",value:function(){if(this.valid()){var e;(e=this.world.index).remove.apply(e,[this].concat(Yt(this.components))),this.world.entities.delete(this._id),this._id=void 0,this.world=void 0}}},{key:"id",get:function(){return this._id},set:function(e){throw new Error("Cannot set entity id")}},{key:"components",get:function(){return Object.keys(this.data)},set:function(e){throw new Error("Cannot set components in this way. See entity.set().")}}]),e}(),Zt=Qt,en={Entity:Zt},tn=r(function(e){!function(t){function n(e,t,n,r){var o=t&&t.prototype instanceof i?t:i,a=Object.create(o.prototype),s=new h(r||[]);return a._invoke=l(e,n,s),a}function r(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function i(){}function o(){}function a(){}function s(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function u(e){function t(n,i,o,a){var s=r(e[n],e,i);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"===(void 0===l?"undefined":qt(l))&&m.call(l,"__await")?Promise.resolve(l.__await).then(function(e){t("next",e,o,a)},function(e){t("throw",e,o,a)}):Promise.resolve(l).then(function(e){u.value=e,o(u)},a)}a(s.arg)}function n(e,n){function r(){return new Promise(function(r,i){t(e,n,r,i)})}return i=i?i.then(r,r):r()}var i;this._invoke=n}function l(e,t,n){var i=A;return function(o,a){if(i===O)throw new Error("Generator is already running");if(i===I){if("throw"===o)throw a;return p()}for(n.method=o,n.arg=a;;){var s=n.delegate;if(s){var u=c(s,n);if(u){if(u===P)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===A)throw i=I,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=O;var l=r(e,t,n);if("normal"===l.type){if(i=n.done?I:S,l.arg===P)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=I,n.method="throw",n.arg=l.arg)}}}function c(e,t){var n=e.iterator[t.method];if(n===_){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=_,c(e,t),"throw"===t.method))return P;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return P}var i=r(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,P;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=_),t.delegate=null,P):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,P)}function d(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function f(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function h(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(d,this),this.reset(!0)}function v(e){if(e){var t=e[b];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(m.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=_,t.done=!0,t};return r.next=r}}return{next:p}}function p(){return{value:_,done:!0}}var _,y=Object.prototype,m=y.hasOwnProperty,g="function"==typeof Symbol?Symbol:{},b=g.iterator||"@@iterator",k=g.asyncIterator||"@@asyncIterator",w=g.toStringTag||"@@toStringTag",x=t.regeneratorRuntime;if(x)return void(e.exports=x);x=t.regeneratorRuntime=e.exports,x.wrap=n;var A="suspendedStart",S="suspendedYield",O="executing",I="completed",P={},T={};T[b]=function(){return this};var E=Object.getPrototypeOf,j=E&&E(E(v([])));j&&j!==y&&m.call(j,b)&&(T=j);var L=a.prototype=i.prototype=Object.create(T);o.prototype=L.constructor=a,a.constructor=o,a[w]=o.displayName="GeneratorFunction",x.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===o||"GeneratorFunction"===(t.displayName||t.name))},x.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,w in e||(e[w]="GeneratorFunction")),e.prototype=Object.create(L),e},x.awrap=function(e){return{__await:e}},s(u.prototype),u.prototype[k]=function(){return this},x.AsyncIterator=u,x.async=function(e,t,r,i){var o=new u(n(e,t,r,i));return x.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},s(L),L[w]="Generator",L[b]=function(){return this},L.toString=function(){return"[object Generator]"},x.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},x.values=v,h.prototype={constructor:h,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=_,this.done=!1,this.delegate=null,this.method="next",this.arg=_,this.tryEntries.forEach(f),!e)for(var t in this)"t"===t.charAt(0)&&m.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=_)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){function t(t,r){return o.type="throw",o.arg=e,n.next=t,r&&(n.method="next",n.arg=_),!!r}if(this.done)throw e;for(var n=this,r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var a=m.call(i,"catchLoc"),s=m.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&m.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,P):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),P},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),f(n),P}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;f(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:v(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=_),P}}}(function(){return this}()||Function("return this")())}),nn=function(){return this}()||Function("return this")(),rn=nn.regeneratorRuntime&&Object.getOwnPropertyNames(nn).indexOf("regeneratorRuntime")>=0,on=rn&&nn.regeneratorRuntime;nn.regeneratorRuntime=void 0;var an=tn;if(rn)nn.regeneratorRuntime=on;else try{delete nn.regeneratorRuntime}catch(e){nn.regeneratorRuntime=void 0}var sn=an,un=function(e,t,n,r){return t<r[e]?n:e},ln=function(){function e(t){Wt(this,e),this.world=t,this.clear()}return Ut(e,[{key:"clear",value:function(){this.index={}}},{key:"access",value:function(e){return this.index[e]||(this.index[e]=new Map)}},{key:"query",value:sn.mark(function e(){for(var t=this,n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];var o,a,s,u,l,c,d,f;return sn.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==r.length){e.next=3;break}return e.delegateYield(this.world.entities.values(),"t0",2);case 2:return e.abrupt("return");case 3:o=r.map(function(e){return t.access(e).size}).reduce(un,0),a=r[o],s=!0,u=!1,l=void 0,e.prev=8,c=this.index[a].values()[Symbol.iterator]();case 10:if(s=(d=c.next()).done){e.next=18;break}if(f=d.value,!f.has.apply(f,r)){e.next=15;break}return e.next=15,f;case 15:s=!0,e.next=10;break;case 18:e.next=24;break;case 20:e.prev=20,e.t1=e.catch(8),u=!0,l=e.t1;case 24:e.prev=24,e.prev=25,!s&&c.return&&c.return();case 27:if(e.prev=27,!u){e.next=30;break}throw l;case 30:return e.finish(27);case 31:return e.finish(24);case 32:case"end":return e.stop()}},e,this,[[8,20,24,32],[25,,27,31]])})},{key:"add",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=!0,o=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;this.access(l).set(e.id,e)}}catch(e){o=!0,a=e}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}}},{key:"remove",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=!0,o=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;this.access(l).delete(e.id)}}catch(e){o=!0,a=e}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}}}]),e}(),cn=ln,dn={SimpleIndex:cn},fn=Gt.invoke,hn=Gt.isFunction,vn=en.Entity,pn=dn.SimpleIndex,_n=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pn;Wt(this,e),this.systems=[],this.entities=new Map,this.components={},this.entityTemplates={},this.idCounter=1,this.index=new t(this)}return Ut(e,[{key:"clear",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.entities[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value,a=$t(o,2),s=(a[0],a[1]);for(var u in s.data){var l=s.data[u];fn(l,"onRemove")}}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}this.entities=new Map,this.index.clear()}},{key:"component",value:function(e,t){if(hn(t))return this.components[e]=t,e}},{key:"entity",value:function(e){var t=this.idCounter++,n=new vn(this,t);if(e&&e in this.entityTemplates){var r=this.entityTemplates[e];for(var i in r){var o=JSON.parse(r[i]);n.update(i,o)}}return this.entities.set(t,n),n}},{key:"system",value:function(){for(var e=[],t=void 0,n=void 0,r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];if(Array.isArray(i[0])?(e=i[0],t=i[1],n=i.slice(2)):(t=i[0],n=i.slice(1)),hn(t)){var a=new(Function.prototype.bind.apply(t,[null].concat(Yt(n))));return a.components=e,this.systems.push(a)-1}}},{key:"initialize",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=!0,i=!1,o=void 0;try{for(var a,s=this.systems[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;fn.apply(void 0,[u,"initialize"].concat(t))}}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}}},{key:"run",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=!0,i=!1,o=void 0;try{for(var a,s=this.systems[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value;fn.apply(void 0,[u,"pre"].concat(t)),hn(u.every)&&this.every.apply(this,[u.components,u.every.bind(u)].concat(t)),fn.apply(void 0,[u,"post"].concat(t))}}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}}},{key:"every",value:function(e,t){var n,r=(n=this.index).query.apply(n,Yt(e));if(!hn(t))return r;for(var i=arguments.length,o=Array(i>2?i-2:0),a=2;a<i;a++)o[a-2]=arguments[a];var s=!0,u=!1,l=void 0;try{for(var c,d=r[Symbol.iterator]();!(s=(c=d.next()).done);s=!0){var f=c.value;if("break"===function(n){var r=e.map(function(e){return n.get(e)});if(!1===t.apply(void 0,Yt(r).concat([n],o)))return"break"}(f))break}}catch(e){u=!0,l=e}finally{try{!s&&d.return&&d.return()}finally{if(u)throw l}}}},{key:"get",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return[].concat(Yt(this.every(t)))}},{key:"prototype",value:function(e){var t=0;if("string"==typeof e&&(e=JSON.parse(e)),"object"===(void 0===e?"undefined":qt(e)))for(var n in e){var r=e[n],i={};for(var o in r)i[o]=JSON.stringify(r[o]);this.entityTemplates[n]=i,++t}return t}}]),e}(),yn=_n,mn={World:yn
},gn=(function(){function e(t){Wt(this,e),this.world=t,this.clear()}Ut(e,[{key:"clear",value:function(){this.index={}}},{key:"query",value:sn.mark(function e(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var i;return sn.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==n.length){e.next=3;break}return e.delegateYield(this.world.entities.values(),"t0",2);case 2:return e.abrupt("return");case 3:if(!((i=this.hashComponents(n))in this.index)){e.next=7;break}return e.delegateYield(this.index[i].entities.values(),"t1",6);case 6:return e.abrupt("return");case 7:return e.delegateYield(this.build(i,n).entities.values(),"t2",8);case 8:case"end":return e.stop()}},e,this)})},{key:"hashComponents",value:function(e){return JSON.stringify(e.sort())}},{key:"build",value:function(e,t){var n=new Map,r=!0,i=!1,o=void 0;try{for(var a,s=this.world.entities[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var u=a.value,l=$t(u,2),c=(l[0],l[1]);c.has.apply(c,Yt(t))&&n.set(c.id,c)}}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return this.index[e]={components:new Set(t),entities:n}}},{key:"add",value:function(e){for(var t in this.index){var n=this.index[t];e.has.apply(e,Yt(n.components))&&n.entities.set(e.id,e)}}},{key:"remove",value:function(e){for(var t=this,n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var o in this.index)!function(n){var i=t.index[n];r.some(function(e){return i.components.has(e)})&&i.entities.delete(e.id)}(o)}}])}(),mn.World),bn=i,kn="object"==("undefined"==typeof global?"undefined":qt(global))&&global&&global.Object===Object&&global,wn=kn,xn="object"==("undefined"==typeof self?"undefined":qt(self))&&self&&self.Object===Object&&self,An=wn||xn||Function("return this")(),Sn=An,On=Sn.Symbol,In=On,Pn=Object.prototype,Tn=Pn.hasOwnProperty,En=Pn.toString,jn=In?In.toStringTag:void 0,Ln=o,zn=Object.prototype,Mn=zn.toString,Cn=a,Dn="[object Null]",Bn="[object Undefined]",Fn=In?In.toStringTag:void 0,Rn=s,Nn=u,Gn="[object Arguments]",qn=l,Wn=Object.prototype,Un=Wn.hasOwnProperty,Vn=Wn.propertyIsEnumerable,Xn=qn(function(){return arguments}())?qn:function(e){return Nn(e)&&Un.call(e,"callee")&&!Vn.call(e,"callee")},Kn=Xn,Hn=Array.isArray,$n=Hn,Yn=In?In.isConcatSpreadable:void 0,Jn=c,Qn=d,Zn=f,er=h,tr=v,nr=p,rr=Array.prototype,ir=rr.splice,or=_,ar=y,sr=m,ur=g;b.prototype.clear=er,b.prototype.delete=or,b.prototype.get=ar,b.prototype.has=sr,b.prototype.set=ur;var lr=b,cr=k,dr=w,fr=x,hr=A,vr=S,pr="[object AsyncFunction]",_r="[object Function]",yr="[object GeneratorFunction]",mr="[object Proxy]",gr=O,br=Sn["__core-js_shared__"],kr=br,wr=function(){var e=/[^.]+$/.exec(kr&&kr.keys&&kr.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),xr=I,Ar=Function.prototype,Sr=Ar.toString,Or=P,Ir=/[\\^$.*+?()[\]{}|]/g,Pr=/^\[object .+?Constructor\]$/,Tr=Function.prototype,Er=Object.prototype,jr=Tr.toString,Lr=Er.hasOwnProperty,zr=RegExp("^"+jr.call(Lr).replace(Ir,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Mr=T,Cr=E,Dr=j,Br=Dr(Sn,"Map"),Fr=Br,Rr=Dr(Object,"create"),Nr=Rr,Gr=L,qr=z,Wr="__lodash_hash_undefined__",Ur=Object.prototype,Vr=Ur.hasOwnProperty,Xr=M,Kr=Object.prototype,Hr=Kr.hasOwnProperty,$r=C,Yr="__lodash_hash_undefined__",Jr=D;B.prototype.clear=Gr,B.prototype.delete=qr,B.prototype.get=Xr,B.prototype.has=$r,B.prototype.set=Jr;var Qr=B,Zr=F,ei=R,ti=N,ni=G,ri=q,ii=W,oi=U;V.prototype.clear=Zr,V.prototype.delete=ni,V.prototype.get=ri,V.prototype.has=ii,V.prototype.set=oi;var ai=V,si=200,ui=X;K.prototype.clear=cr,K.prototype.delete=dr,K.prototype.get=fr,K.prototype.has=hr,K.prototype.set=ui;var li=K,ci="__lodash_hash_undefined__",di=H,fi=$;Y.prototype.add=Y.prototype.push=di,Y.prototype.has=fi;var hi=Y,vi=J,pi=Q,_i=1,yi=2,mi=Z,gi=Sn.Uint8Array,bi=gi,ki=ee,wi=te,xi=1,Ai=2,Si="[object Boolean]",Oi="[object Date]",Ii="[object Error]",Pi="[object Map]",Ti="[object Number]",Ei="[object RegExp]",ji="[object Set]",Li="[object String]",zi="[object Symbol]",Mi="[object ArrayBuffer]",Ci="[object DataView]",Di=In?In.prototype:void 0,Bi=Di?Di.valueOf:void 0,Fi=ne,Ri=re,Ni=ie,Gi=oe,qi=Object.prototype,Wi=qi.propertyIsEnumerable,Ui=Object.getOwnPropertySymbols,Vi=Ui?function(e){return null==e?[]:(e=Object(e),Ni(Ui(e),function(t){return Wi.call(e,t)}))}:Gi,Xi=Vi,Ki=ae,Hi=se,$i=r(function(e,t){var n=t&&!t.nodeType&&t,r=n&&!0&&e&&!e.nodeType&&e,i=r&&r.exports===n,o=i?Sn.Buffer:void 0,a=o?o.isBuffer:void 0,s=a||Hi;e.exports=s}),Yi=9007199254740991,Ji=/^(?:0|[1-9]\d*)$/,Qi=ue,Zi=9007199254740991,eo=le,to={};to["[object Float32Array]"]=to["[object Float64Array]"]=to["[object Int8Array]"]=to["[object Int16Array]"]=to["[object Int32Array]"]=to["[object Uint8Array]"]=to["[object Uint8ClampedArray]"]=to["[object Uint16Array]"]=to["[object Uint32Array]"]=!0,to["[object Arguments]"]=to["[object Array]"]=to["[object ArrayBuffer]"]=to["[object Boolean]"]=to["[object DataView]"]=to["[object Date]"]=to["[object Error]"]=to["[object Function]"]=to["[object Map]"]=to["[object Number]"]=to["[object Object]"]=to["[object RegExp]"]=to["[object Set]"]=to["[object String]"]=to["[object WeakMap]"]=!1;var no=ce,ro=de,io=r(function(e,t){var n=t&&!t.nodeType&&t,r=n&&!0&&e&&!e.nodeType&&e,i=r&&r.exports===n,o=i&&wn.process,a=function(){try{return o&&o.binding&&o.binding("util")}catch(e){}}();e.exports=a}),oo=io&&io.isTypedArray,ao=oo?ro(oo):no,so=ao,uo=Object.prototype,lo=uo.hasOwnProperty,co=fe,fo=Object.prototype,ho=he,vo=ve,po=vo(Object.keys,Object),_o=po,yo=Object.prototype,mo=yo.hasOwnProperty,go=pe,bo=_e,ko=ye,wo=me,xo=1,Ao=Object.prototype,So=Ao.hasOwnProperty,Oo=ge,Io=Dr(Sn,"DataView"),Po=Io,To=Dr(Sn,"Promise"),Eo=To,jo=Dr(Sn,"Set"),Lo=jo,zo=Dr(Sn,"WeakMap"),Mo=zo,Co=Or(Po),Do=Or(Fr),Bo=Or(Eo),Fo=Or(Lo),Ro=Or(Mo),No=Rn;(Po&&"[object DataView]"!=No(new Po(new ArrayBuffer(1)))||Fr&&"[object Map]"!=No(new Fr)||Eo&&"[object Promise]"!=No(Eo.resolve())||Lo&&"[object Set]"!=No(new Lo)||Mo&&"[object WeakMap]"!=No(new Mo))&&(No=function(e){var t=Rn(e),n="[object Object]"==t?e.constructor:void 0,r=n?Or(n):"";if(r)switch(r){case Co:return"[object DataView]";case Do:return"[object Map]";case Bo:return"[object Promise]";case Fo:return"[object Set]";case Ro:return"[object WeakMap]"}return t});var Go=No,qo=1,Wo="[object Arguments]",Uo="[object Array]",Vo="[object Object]",Xo=Object.prototype,Ko=Xo.hasOwnProperty,Ho=be,$o=ke,Yo=1,Jo=2,Qo=we,Zo=xe,ea=Ae,ta=Se,na=Oe,ra="[object Symbol]",ia=Ie,oa=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,aa=/^\w*$/,sa=Pe,ua="Expected a function";Te.Cache=ai;var la=Te,ca=500,da=Ee,fa=/^\./,ha=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,va=/\\(\\)?/g,pa=da(function(e){var t=[];return fa.test(e)&&t.push(""),e.replace(ha,function(e,n,r,i){t.push(r?i.replace(va,"$1"):n||e)}),t}),_a=pa,ya=1/0,ma=In?In.prototype:void 0,ga=ma?ma.toString:void 0,ba=je,ka=Le,wa=ze,xa=1/0,Aa=Me,Sa=Ce,Oa=De,Ia=Be,Pa=Fe,Ta=Re,Ea=1,ja=2,La=Ne,za=Ge,Ma=qe,Ca=We,Da=Ue,Ba=Ve,Fa=Xe,Ra=Fa(),Na=Ra,Ga=Ke,qa=He,Wa=qa(Ga),Ua=Wa,Va=$e,Xa=Ye,Ka=Je,Ha=Qe,$a=Ze,Ya=et,Ja=Math.max,Qa=tt,Za=nt,es=function(){try{var e=Dr(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),ts=es,ns=ts?function(e,t){return ts(e,"toString",{configurable:!0,enumerable:!1,value:Za(t),writable:!0})}:za,rs=ns,is=800,os=16,as=Date.now,ss=rt,us=ss(rs),ls=us,cs=it,ds=ot,fs=cs(function(e,t){if(null==e)return[];var n=t.length;return n>1&&ds(e,t[0],t[1])?t=[]:n>2&&ds(t[0],t[1],t[2])&&(t=[t[0]]),$a(e,Qn(t,1),[])}),hs=fs,vs=at,ps=st;Array.prototype.top=function(){if(this.length>=1)return this[this.length-1]};var _s={r:4,g:2,b:1},ys=function(){function e(){Wt(this,e),this.gameSize=this.getGameSize()}return Ut(e,[{key:"clear",value:function(){this.bounds=void 0}},{key:"update",value:function(){this.gameSize=this.getGameSize(),this.bounds=this.getBounds(),this.levelCenter=this.getLevelCenter(this.bounds),this.levelSize=this.getLevelSize(this.bounds)}},{key:"getGameSize",value:function(){return{width:window.innerWidth,height:window.innerHeight}}},{key:"getBounds",value:function(){var e={};return e.upperLeft={x:1/0,y:1/0},e.bottomRight={x:-1/0,y:-1/0},Ds.every(["partOfLayer","position"],function(t,n){e.upperLeft.x=Math.min(e.upperLeft.x,n.x),e.upperLeft.y=Math.min(e.upperLeft.y,n.y),e.bottomRight.x=Math.max(e.bottomRight.x,n.x),e.bottomRight.y=Math.max(e.bottomRight.y,n.y)}),e.size={width:1+e.bottomRight.x-e.upperLeft.x,height:1+e.bottomRight.y-e.upperLeft.y},e}},{key:"getLevelCenter",value:function(e){return qs.getVisualPosition({x:(e.bottomRight.x+e.upperLeft.x)/2,y:(e.bottomRight.y+e.upperLeft.y)/2})}},{key:"getLevelSize",value:function(e){var t=qs.getVisualPosition(this.bounds.upperLeft),n=qs.getVisualPosition({x:this.bounds.bottomRight.x+1,y:this.bounds.bottomRight.y+1});return{width:n.x-t.x,height:n.y-t.y}}},{key:"getZeroPosition",value:function(e){return{x:e.x-this.bounds.upperLeft.x,y:e.y-this.bounds.upperLeft.y}}},{key:"getFullPosition",value:function(e){return{x:e.x+this.bounds.upperLeft.x,y:e.y+this.bounds.upperLeft.y}}}]),e}(),ms=new ys,gs=function(){function e(){Wt(this,e),this._offset={x:0,y:0}}return Ut(e,[{key:"applyOffsetEffects",value:function(){Gs.offset=this._offset,Ws.offset=this._offset,Ws.fullUpdate=!0,Ws.update(),Ds.every(["wall"],function(e,t){t.set("computeWallShape")}),Ds.every(["offsetBlock"],function(e,t){t.set("toRender")})}},{key:"setOffset",value:function(e,t,n){var r={x:ms.bounds.size.width,y:ms.bounds.size.height},i=this._offset[t]>0||0===this._offset[t]&&n<0?-r[e]:r[e];this._offset[e]=ht(n,i),this.applyOffsetEffects()}},{key:"offset",set:function(e){e.x===this._offset.x&&e.y===this._offset.y||(this._offset={x:e.x,y:e.y},this.applyOffsetEffects())},get:function(){return this._offset}},{key:"offsetX",set:function(e){this.setOffset("x","y",e)},get:function(){return this._offset.x}},{key:"offsetY",set:function(e){this.setOffset("y","x",e)},get:function(){return this._offset.y}}]),e}(),bs=new gs,ks=function(){function e(){Wt(this,e),this.clear()}return Ut(e,[{key:"clear",value:function(){this.index={},this.previous={},this.offset={x:0,y:0}}},{key:"update",value:function(e){var t=!1,n=e.get("position");if(n&&e.valid()){t=this.wrap(n);var r=ut(n);r in this.index||(this.index[r]=new Map),this.index[r].has(e.id)||(this.index[r].set(e.id,e),e.id in this.previous&&this.index[this.previous[e.id]].delete(e.id),this.previous[e.id]=r)}return t}},{key:"get",value:function(e){if(e){var t=this.getWrapped(e);if(t){var n=this.index[ut(t)];if(n)return n}}return new Map}},{key:"getSorted",value:function(e){var t=this.get(e);return kt([].concat(Yt(t.values())))}},{key:"remove",value:function(e){var t=e.get("position");if(t){var n=ut(t);n in this.index&&this.index[n].delete(e.id),delete this.previous[e.id]}}},{key:"has",value:function(e){for(var t=this.get(e),n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var o=!0,a=!1,s=void 0;try{for(var u,l=t.values()[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var c=u.value;if(c.has.apply(c,r))return!0}}catch(e){a=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(a)throw s}}return!1}},{key:"find",value:function(e,t){for(var n=this.getSorted(e),r=arguments.length,i=Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];var a=!0,s=!1,u=void 0;try{for(var l,c=n[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var d=l.value;if(d.has.apply(d,i)&&(!t||t.id!==d.id))return d}}catch(e){s=!0,u=e}finally{try{!a&&c.return&&c.return()}finally{if(s)throw u}}}},{key:"every",value:function(e,t,n){var r=this.getSorted(e),i=!0,o=!1,a=void 0;try{for(var s,u=r[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;!function(e){if(e.has.apply(e,Yt(t))){var r=t.map(function(t){return e.get(t)});n.apply(void 0,Yt(r).concat([e]))}}(l)}}catch(e){o=!0,a=e}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}}},{key:"count",value:function(e){for(var t=0,n=this.get(e),r=arguments.length,i=Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];var a=!0,s=!1,u=void 0;try{for(var l,c=n.values()[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var d=l.value;d.has.apply(d,i)&&++t}}catch(e){s=!0,u=e}finally{try{!a&&c.return&&c.return()}finally{if(s)throw u}}return t}},{key:"getWrapped",value:function(e){if(ms.bounds&&e){var t=ms.getZeroPosition(e),n=It(ms.bounds.size,this.offset,t);if(!n)return n;if(n.x!==t.x||n.y!==t.y)return ms.getFullPosition(n)}return e}},{key:"wrap",value:function(e){if(e){var t=this.getWrapped(e);if(t&&(e._x!==t.x||e._y!==t.y))return e._x=t.x,e._y=t.y,!0}return!1}}]),e}(),ws=function(){function e(){Wt(this,e),this.loaders={},this.loadTile=this.loadTile.bind(this),this.middlewares=[]}return Ut(e,[{key:"setData",value:function(e){this.levels=e.levels,this.options={tileSize:e.tileSize,idToName:e.idToName,nameToId:e.nameToId}}},{key:"middleware",value:function(e){"function"==typeof e&&this.middlewares.push(e)}},{key:"register",value:function(e,t){var n=!0,r=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;s in this.loaders?this.loaders[s].push(t):this.loaders[s]=[t]}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}}},{key:"invokeLoaders",value:function(e,t){if(e.name in this.loaders){var n=!0,r=!1,i=void 0;try{for(var o,a=this.loaders[e.name][Symbol.iterator]();!(n=(o=a.next()).done);n=!0){(0,o.value)(t,e)}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}}}},{key:"loadTile",value:function(e,t){var n=this.createEntity(e,t);return this.invokeLoaders(e,n),n}},{key:"loadTiles",value:function(e){ms.clear(),this.clearEntities(),this.forEachTile(this.levels[e],this.loadTile),ms.update()}},{key:"forEachTile",value:function(e,t){this.level=e;for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];for(var o in e.data){var a=e.data[o],s=0,u=!0,l=!1,c=void 0;try{for(var d,f=a[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var h=d.value;if(h in this.options.idToName){var v={id:o,name:this.options.idToName[h],position:lt(o),spritePosition:this.getVisualPosition(lt(o)),layerLevel:s};t.apply(void 0,[v].concat(r))}++s}}catch(e){l=!0,c=e}finally{try{!u&&f.return&&f.return()}finally{if(l)throw c}}}}},{key:"getVisualPosition",value:function(e){return{x:e.x*this.options.tileSize.width,y:e.y*this.options.tileSize.height}}},{key:"createEntity",value:function(e,t){t=t||e.layerLevel+1;var n=Ds.entity().set("position",e.position.x,e.position.y).set("sprite",Ns,e.name,t,e.spritePosition).set("partOfLayer",e.layer),r=!0,i=!1,o=void 0;try{for(var a,s=this.middlewares[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){(0,a.value)({entity:n,tile:e,loaders:this.loaders})}}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}},{key:"clearEntities",value:function(){Ds.every(["partOfLayer"],function(e,t){t.destroy()})}}]),e}(),xs=function(){function e(){Wt(this,e),this.buckets=new PIXI.Container,this.index=new Map,this.toUpdate=new Set}return Ut(e,[{key:"clear",value:function(){this.buckets.removeChildren(),this.index.clear(),this.toUpdate.clear()}},{key:"addChild",value:function(e){var t=parseInt(e.zIndex)||0;e.zIndex=t,this.index.has(t)||this.addBucket(t),this.getBucket(t).addChild(e),this.toUpdate.add(t)}},{key:"removeChild",value:function(e){var t=parseInt(e.zIndex)||0;this.index.has(t)&&(this.getBucket(t).removeChild(e),this.toUpdate.add(t))}},{key:"getBucket",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.buckets.children[this.index.get(e)]}},{key:"addBucket",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=new PIXI.Container;t.zIndex=e,this.buckets.addChild(t),ct(this.buckets),this.index=this.build(this.buckets)}},{key:"build",value:function(e){var t=new Map;return e.children.forEach(function(e,n){t.set(e.zIndex,n)}),t}}]),e}(),As=function(){function e(){Wt(this,e),this.data={}}return Ut(e,[{key:"exists",value:function(e){return this.data[e]&&this.data[e].length>0}},{key:"count",value:function(e){return e in this.data?this.data[e].length:0}},{key:"send",value:function(e,t){e in this.data||(this.data[e]=[]),this.data[e].push(t)}},{key:"replace",value:function(e,t){this.clear(e),this.send(e,t)}},{key:"first",value:function(e,t){if(e in this.data){var n=this.data[e],r=!0,i=!1,o=void 0;try{for(var a,s=n[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){return a.value}}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}}return t}},{key:"loop",value:function(e,t){if(e in this.data){var n=this.data[e],r=!0,i=!1,o=void 0;try{for(var a,s=n[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){t(a.value)}}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}}}},{key:"process",value:function(e,t){this.loop(e,t),this.clear(e)}},{key:"clear",value:function(e){delete this.data[e]}},{key:"clearAll",value:function(){this.data={}}}]),e}(),Ss=new As,Os=function(){function e(t,n,r){Wt(this,e),this.stage=t.buckets,this.buckets=t,this.app=n,this.outputStage=r,this.gridSize={},this.offset={x:0,y:0}}return Ut(e,[{key:"generateSprites",value:function(e){var t=new PIXI.Container;t.zIndex=e.zIndex;var n=!0,r=!1,i=void 0;try{for(var o,a=this.levelPositions[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,u=_t(e);u.x=s.x,u.y=s.y,t.addChild(u)}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return t}},{key:"runFullUpdate",value:function(){this.outputStage.removeChildren();var e=!0,t=!1,n=void 0;try{for(var r,i=this.stage.children[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value,a=this.generateSprites(o);this.outputStage.addChild(a)}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}}},{key:"runSmartUpdate",value:function(){for(var e=0;e<this.outputStage.children.length;){var t=this.outputStage.children[e].zIndex;this.buckets.toUpdate.has(t)?this.outputStage.removeChildAt(e):++e}var n=!0,r=!1,i=void 0;try{for(var o,a=this.stage.children[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;if(this.buckets.toUpdate.has(s.zIndex)){var u=this.generateSprites(s);this.outputStage.addChild(u)}}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}ct(this.outputStage)}},{key:"renderLayers",value:function(){this.fullUpdate||this.outputStage.children.length!==this.stage.children.length?(this.runFullUpdate(),this.fullUpdate=void 0):this.runSmartUpdate(),this.buckets.toUpdate.clear()}},{key:"generateLevelPositions",value:function(e,t,n){for(var r=[],i=new PIXI.Rectangle(-e.x/t/2-this.bounds.x-this.bounds.width,-e.y/t/2-this.bounds.y-this.bounds.height,e.x/t+2*this.bounds.width,e.y/t+2*this.bounds.height),o=-this.gridSize.y;o<=this.gridSize.y;++o)for(var a=-this.gridSize.x;a<=this.gridSize.x;++a){var s={x:a*ms.bounds.size.width+-this.offset.x*o,y:o*ms.bounds.size.height+-this.offset.y*a},u={x:s.x*qs.options.tileSize.width-this.bounds.x,y:s.y*qs.options.tileSize.height-this.bounds.y};i.contains(u.x,u.y)&&r.push(u)}return r}},{key:"update",value:function(e){if(this.bounds=e||this.bounds,!this.bounds)return void console.warn("this.bounds is not defined, skipping this update");var t={x:this.app.renderer.width,y:this.app.renderer.height},n={x:Math.ceil(t.x/(this.bounds.width*this.scale))+1,y:Math.ceil(t.y/(this.bounds.height*this.scale))+1};this.gridSize.x===n.x&&this.gridSize.y===n.y||(this.gridSize=n,this.fullUpdate=!0),this.fullUpdate&&(this.levelPositions=this.generateLevelPositions(t,this.scale,ms.bounds.size)),this.renderLayers()}},{key:"scale",get:function(){return this.outputStage.scale.x},set:function(e){e=Math.min(e,1),this.outputStage.scale.x=e,this.outputStage.scale.y=e,Ss.send("updateCamera")}}]),e}(),Is={64:"ice",65:"lava",74:"floor",84:"level_start",89:"sign_blocks",92:"sign_sliding",95:"space",112:"wall",114:"controls",127:"sign_danger",128:"time_immune_area",130:"sign_time",137:"sign_bridges",141:"floor_laser",144:"block_goal",146:"time_immune_changer",153:"block_goal_ti",166:"grass",177:"block_laser_u",178:"block_laser_d",179:"block_laser_l",180:"block_laser_r",181:"block_mirror_ur_dl",182:"block_mirror_ul_dr",183:"block_mirror_dl",184:"block_mirror_ur",185:"block_mirror_dr",186:"block_mirror_ul",193:"block_offset_y_zero",196:"block_offset_x_zero",197:"offset_placeholder_positive",198:"offset_placeholder_negative",199:"color",200:"color_rgb",201:"color_rb",202:"color_gb",203:"color_rg",204:"color_b",205:"color_g",206:"color_r",207:"sign_colors",208:"level_goal",209:"block_mirror_bu",210:"block_mirror_bl",211:"block_mirror_bd",212:"block_mirror_br",213:"wall_glass",214:"unwalkable"},Ps=[{data:{"3,3":[214,114],"3,4":[112],"3,5":[74,141,200,84],"3,6":[112],"4,3":[112],"4,4":[112],"4,5":[74],"4,6":[112],"5,3":[74],"5,4":[74,0,0,144,200],"5,5":[74],"5,6":[112],"6,3":[74,208],"6,4":[74],"6,5":[74],"6,6":[112],"7,3":[112],"7,4":[112],"7,5":[112],"7,6":[112]},name:"Placeholder 3,5",start:"3,5"},{data:{"11,3":[112],"11,4":[74],"11,5":[74,141,200],"11,6":[112],"12,3":[112],"12,4":[74,0,0,144,200],"12,5":[112],"12,6":[112],"13,3":[74,208],"13,4":[74,0,0,84],"13,5":[74],"13,6":[112],"14,3":[74],"14,4":[74],"14,5":[74],"14,6":[112],"15,3":[112],"15,4":[112],"15,5":[74],"15,6":[112],"16,3":[112],"16,4":[112],"16,5":[74],"16,6":[112]},name:"Placeholder 13,4",start:"13,4"},{data:{"20,3":[112],"20,4":[74],"20,5":[112],"20,6":[112],"21,3":[74],"21,4":[74],"21,5":[74],"21,6":[74],"22,3":[112],"22,4":[74,141,200],"22,5":[74,0,0,144,200],"22,6":[112],"23,3":[112],"23,4":[74,208],"23,5":[74],"23,6":[112],"24,3":[112],"24,4":[74,0,0,84],"24,5":[112],"24,6":[112]},name:"Placeholder 24,4",start:"24,4"},{data:{"28,3":[112],"28,4":[112],"28,5":[112],"28,6":[112],"28,7":[214],"29,3":[112],"29,4":[74],"29,5":[74],"29,6":[112],"29,7":[112],"30,3":[74],"30,4":[74,141,204],"30,5":[74],"30,6":[112],"30,7":[74],"31,3":[74],"31,4":[74],"31,5":[74],"31,6":[74],"31,7":[74],"32,3":[74],"32,4":[112],"32,5":[74],"32,6":[112],"32,7":[74],"33,3":[112],"33,4":[112],"33,5":[74],"33,6":[112],"33,7":[112],"34,3":[74,0,0,144,204],"34,4":[74],"34,5":[74,141,200],"34,6":[74],"34,7":[74],"35,3":[112],"35,4":[74,208],"35,5":[74,0,0,84],"35,6":[112],"35,7":[112]},name:"Placeholder 35,5",start:"35,5"},{data:{"39,10":[74],"39,11":[74],"39,12":[112],"39,13":[112],"39,3":[112],"39,4":[74],"39,5":[74],"39,6":[112],"39,7":[112],"39,8":[112],"39,9":[74],"40,10":[112],"40,11":[112],"40,12":[74],"40,13":[74],"40,3":[112],"40,4":[74,0,0,144,206],"40,5":[74],"40,6":[74],"40,7":[74],"40,8":[74],"40,9":[74],"41,10":[74],"41,11":[112],"41,12":[74],"41,13":[74],"41,3":[112],"41,4":[74],"41,5":[112],"41,6":[74],"41,7":[112],"41,8":[74],"41,9":[74],"42,10":[74],"42,11":[112],"42,12":[74],"42,13":[74],"42,3":[112],"42,4":[74],"42,5":[112],"42,6":[74],"42,7":[112],"42,8":[74],"42,9":[74],"43,10":[74],"43,11":[112],"43,12":[74],"43,13":[112],"43,3":[112],"43,4":[74],"43,5":[112],"43,6":[74],"43,7":[112],"43,8":[74],"43,9":[112],"44,10":[74],"44,11":[74],"44,12":[74],"44,13":[112],"44,3":[112],"44,4":[74],"44,5":[112],"44,6":[74],"44,7":[112],"44,8":[74],"44,9":[74],"45,10":[112],"45,11":[74,141,206,84],"45,12":[74],"45,13":[112],"45,3":[112],"45,4":[74],"45,5":[112],"45,6":[74],"45,7":[112],"45,8":[112],"45,9":[112],"46,10":[112],"46,11":[74],"46,12":[74],"46,13":[112],"46,3":[112],"46,4":[74],"46,5":[112],"46,6":[74],"46,7":[112],"46,8":[112],"46,9":[112],"47,10":[112],"47,11":[74],"47,12":[74],"47,13":[74],"47,3":[112],"47,4":[74],"47,5":[112],"47,6":[74],"47,7":[74],"47,8":[74],"47,9":[74],"48,10":[112],"48,11":[74],"48,12":[74],"48,13":[74],"48,3":[112],"48,4":[74],"48,5":[112],"48,6":[74],"48,7":[112],"48,8":[74,208],"48,9":[74],"49,10":[112],"49,11":[112],"49,12":[112],"49,13":[112],"49,3":[74],"49,4":[74],"49,5":[74],"49,6":[74],"49,7":[74],"49,8":[74],"49,9":[74],"50,10":[112],"50,11":[112],"50,12":[112],"50,13":[74],"50,3":[74],"50,4":[74],"50,5":[74],"50,6":[112],"50,7":[112],"50,8":[74],"50,9":[74],"51,10":[112],"51,11":[74],"51,12":[74],"51,13":[74],"51,3":[112],"51,4":[112],"51,5":[112],"51,6":[112],"51,7":[112],"51,8":[112],"51,9":[112]},name:"Placeholder 45,11",start:"45,11"},{data:{"55,3":[74,141,200],"55,4":[74,141,200],"55,5":[74,0,0,84],"56,3":[74,0,0,144,200],"56,4":[74,0,0,144,200],"56,5":[74],"57,3":[112],"57,4":[74],"57,5":[112],"58,3":[112],"58,4":[74],"58,5":[112],"59,3":[74],"59,4":[74],"59,5":[112],"60,3":[74],"60,4":[74],"60,5":[112],"61,3":[74,208],"61,4":[74],"61,5":[112],"62,3":[112],"62,4":[112],"62,5":[112]},name:"Placeholder 55,5",start:"55,5"},{data:{"66,3":[112],"66,4":[112],"66,5":[74],"66,6":[112],"66,7":[112],"67,3":[74],"67,4":[74,0,0,144,203],"67,5":[74],"67,6":[74,0,0,144,202],"67,7":[74],"68,3":[112],"68,4":[74,141,203],"68,5":[74,141,202],"68,6":[74],"68,7":[74],"69,3":[112],"69,4":[74,208],"69,5":[74,0,0,84],"69,6":[112],"69,7":[112]},name:"Placeholder 69,5",start:"69,5"},{data:{"73,3":[112],"73,4":[74],"73,5":[74],"73,6":[112],"73,7":[112],"73,8":[112],"74,3":[74],"74,4":[74],"74,5":[74],"74,6":[112],"74,7":[112],"74,8":[74,208,0,84],"75,3":[112],"75,4":[74],"75,5":[74],"75,6":[74],"75,7":[112],"75,8":[74],"76,3":[112],"76,4":[74],"76,5":[74,141,200,144,204],"76,6":[74],"76,7":[112],"76,8":[74],"77,3":[112],"77,4":[74],"77,5":[74,141,204,144,200],"77,6":[74],"77,7":[112],"77,8":[74],"78,3":[112],"78,4":[74],"78,5":[112],"78,6":[112],"78,7":[112],"78,8":[74],"79,3":[112],"79,4":[74],"79,5":[74],"79,6":[74],"79,7":[74],"79,8":[74],"80,3":[112],"80,4":[112],"80,5":[112],"80,6":[112],"80,7":[112],"80,8":[112]},name:"Placeholder 74,8",start:"74,8"},{data:{"84,3":[112],"84,4":[74],"84,5":[74],"84,6":[112],"84,7":[112],"84,8":[112],"85,3":[74],"85,4":[74],"85,5":[74],"85,6":[74],"85,7":[74],"85,8":[74,208,0,84],"86,3":[112],"86,4":[74],"86,5":[74,141,200,144,205],"86,6":[74],"86,7":[112],"86,8":[74],"87,3":[112],"87,4":[74],"87,5":[112],"87,6":[74],"87,7":[112],"87,8":[74],"88,3":[74],"88,4":[74],"88,5":[74,141,205,144,200],"88,6":[74],"88,7":[112],"88,8":[74],"89,3":[74],"89,4":[112],"89,5":[112],"89,6":[112],"89,7":[112],"89,8":[74]},name:"Placeholder 85,8",start:"85,8"},{data:{"100,10":[112],"100,11":[112],"100,12":[74],"100,13":[74],"100,14":[74],"100,3":[112],"100,4":[74,141,205],"100,5":[112],"100,6":[74,0,0,144,205],"100,7":[74],"100,8":[112],"100,9":[112],"101,10":[74],"101,11":[74],"101,12":[74],"101,13":[112],"101,14":[112],"101,3":[112],"101,4":[74,141,201],"101,5":[74],"101,6":[74],"101,7":[112],"101,8":[112],"101,9":[112],"102,10":[74],"102,11":[112],"102,12":[112],"102,13":[112],"102,14":[74],"102,3":[74],"102,4":[74],"102,5":[112],"102,6":[112],"102,7":[112],"102,8":[112],"102,9":[74],"103,10":[112],"103,11":[112],"103,12":[112],"103,13":[74],"103,14":[74],"103,3":[74],"103,4":[74],"103,5":[112],"103,6":[112],"103,7":[112],"103,8":[74],"103,9":[74],"104,10":[112],"104,11":[112],"104,12":[74],"104,13":[74],"104,14":[74],"104,3":[74],"104,4":[112],"104,5":[112],"104,6":[112],"104,7":[74],"104,8":[74],"104,9":[112],"105,10":[112],"105,11":[74],"105,12":[74],"105,13":[74],"105,14":[74],"105,3":[112],"105,4":[112],"105,5":[112],"105,6":[74],"105,7":[74],"105,8":[112],"105,9":[112],"94,10":[74],"94,11":[74],"94,12":[74],"94,13":[74],"94,14":[112],"94,3":[112],"94,4":[112],"94,5":[74],"94,6":[74],"94,7":[112],"94,8":[112],"94,9":[112],"95,10":[74],"95,11":[74],"95,12":[74],"95,13":[112],"95,14":[112],"95,3":[112],"95,4":[74],"95,5":[74],"95,6":[112],"95,7":[112],"95,8":[112],"95,9":[74],"96,10":[74],"96,11":[74],"96,12":[112],"96,13":[74,208,0,84],"96,14":[74],"96,3":[74],"96,4":[74],"96,5":[112],"96,6":[112],"96,7":[112],"96,8":[74],"96,9":[74],"97,10":[74],"97,11":[112],"97,12":[112],"97,13":[112],"97,14":[112],"97,3":[112],"97,4":[112],"97,5":[112],"97,6":[112],"97,7":[74],"97,8":[74],"97,9":[74],"98,10":[112],"98,11":[112],"98,12":[74],"98,13":[74],"98,14":[74],"98,3":[74],"98,4":[74],"98,5":[74],"98,6":[74],"98,7":[74],"98,8":[74],"98,9":[74],"99,10":[112],"99,11":[112],"99,12":[74],"99,13":[112],"99,14":[74],"99,3":[112],"99,4":[112],"99,5":[112],"99,6":[74],"99,7":[74,0,0,144,201],"99,8":[74],"99,9":[112]},name:"Placeholder 96,13",start:"96,13"},{data:{"110,10":[112],"110,11":[214],"110,12":[214],"110,13":[214],"110,14":[214],"110,3":[112],"110,4":[112],"110,5":[112],"110,6":[112],"110,7":[112],"110,8":[112],"110,9":[112],"111,10":[112],"111,11":[112],"111,12":[214],"111,13":[214],"111,14":[214],"111,3":[112],"111,4":[74,141,205],"111,5":[74,141,200],"111,6":[74],"111,7":[74],"111,8":[74],"111,9":[74],"112,10":[74],"112,11":[112],"112,12":[112],"112,13":[214],"112,14":[214],"112,3":[112],"112,4":[112],"112,5":[112],"112,6":[112],"112,7":[112],"112,8":[74],"112,9":[74],"113,10":[74],"113,11":[74],"113,12":[112],"113,13":[214],"113,14":[214],"113,3":[214],"113,4":[214],"113,5":[214],"113,6":[214],"113,7":[112],"113,8":[74],"113,9":[74],"114,10":[74],"114,11":[74],"114,12":[112],"114,13":[112],"114,14":[112],"114,3":[214],"114,4":[214],"114,5":[214],"114,6":[214],"114,7":[112],"114,8":[112],"114,9":[74],"115,10":[74],"115,11":[74],"115,12":[74,0,0,144,206],"115,13":[74],"115,14":[112],"115,3":[214],"115,4":[214],"115,5":[214],"115,6":[214],"115,7":[214],"115,8":[112],"115,9":[112],"116,10":[74],"116,11":[74,0,0,144,200],"116,12":[74,0,0,144,205],"116,13":[74,208],"116,14":[112],"116,3":[214],"116,4":[214],"116,5":[214],"116,6":[214],"116,7":[214],"116,8":[214],"116,9":[112],"117,10":[74],"117,11":[74],"117,12":[74,0,0,144,204],"117,13":[74],"117,14":[112],"117,3":[112],"117,4":[112],"117,5":[214],"117,6":[214],"117,7":[214],"117,8":[112],"117,9":[112],"118,10":[74],"118,11":[74],"118,12":[112],"118,13":[74],"118,14":[74],"118,3":[74],"118,4":[112],"118,5":[112],"118,6":[214],"118,7":[112],"118,8":[112],"118,9":[74],"119,10":[74],"119,11":[74],"119,12":[112],"119,13":[112],"119,14":[112],"119,3":[74],"119,4":[74],"119,5":[112],"119,6":[214],"119,7":[112],"119,8":[74],"119,9":[74],"120,10":[74],"120,11":[112],"120,12":[112],"120,13":[214],"120,14":[112],"120,3":[112],"120,4":[74],"120,5":[112],"120,6":[112],"120,7":[112],"120,8":[74],"120,9":[74],"121,10":[112],"121,11":[112],"121,12":[214],"121,13":[214],"121,14":[214],"121,3":[112],"121,4":[74,141,204],"121,5":[74,141,206],"121,6":[74,0,0,84],"121,7":[74],"121,8":[74],"121,9":[74]},name:"Placeholder 121,6",start:"121,6"},{data:{"125,3":[74],"125,4":[74],"125,5":[112],"125,6":[74],"125,7":[74],"125,8":[112],"125,9":[74],"126,3":[74],"126,4":[74,208],"126,5":[74],"126,6":[74,0,0,144,203],"126,7":[74,0,0,84],"126,8":[112],"126,9":[74],"127,3":[74],"127,4":[112],"127,5":[74],"127,6":[74,0,0,144,205],"127,7":[74],"127,8":[112],"127,9":[112],"128,3":[74],"128,4":[112],"128,5":[74],"128,6":[74,141,206,144,202],"128,7":[74],"128,8":[112],"128,9":[112],"129,3":[74],"129,4":[112],"129,5":[74],"129,6":[74,141,201,144,204],"129,7":[74],"129,8":[112],"129,9":[112],"130,3":[74],"130,4":[112],"130,5":[74],"130,6":[74,141,204,144,201],"130,7":[74],"130,8":[112],"130,9":[112],"131,3":[74],"131,4":[74],"131,5":[74],"131,6":[74,141,202,144,206],"131,7":[74],"131,8":[74],"131,9":[74],"132,3":[74],"132,4":[112],"132,5":[112],"132,6":[74,141,205],"132,7":[112],"132,8":[112],"132,9":[74],"133,3":[112],"133,4":[214],"133,5":[112],"133,6":[74,141,203],"133,7":[112],"133,8":[214],"133,9":[112],"134,3":[112],"134,4":[112],"134,5":[112],"134,6":[112],"134,7":[112],"134,8":[112],"134,9":[112]},name:"Placeholder 126,7",start:"126,7"},{data:{"3,28":[112],"3,29":[112],"3,30":[74],"3,31":[74],"3,32":[112],"4,28":[74],"4,29":[74],"4,30":[74,141,200],"4,31":[74],"4,32":[112],"5,28":[74],"5,29":[74],"5,30":[112],"5,31":[112],"5,32":[112],"6,28":[112],"6,29":[74],"6,30":[112],"6,31":[74,208],"6,32":[112],"7,28":[112],"7,29":[74,141,200,144],"7,30":[112],"7,31":[74],"7,32":[112],"8,28":[112],"8,29":[74,0,0,84],"8,30":[112],"8,31":[74],"8,32":[112]},name:"Placeholder 8,29",start:"8,29"},{data:{"13,28":[112],"13,29":[112],"13,30":[112],"13,31":[112],"14,28":[74],"14,29":[74],"14,30":[74],"14,31":[112],"15,28":[74],
"15,29":[74,0,0,144,202],"15,30":[74,208],"15,31":[112],"16,28":[74],"16,29":[112],"16,30":[112],"16,31":[74],"17,28":[74],"17,29":[74,141,202,144],"17,30":[74,0,0,84],"17,31":[74]},name:"Placeholder 17,30",start:"17,30"},{data:{"21,28":[74,141,200],"21,29":[74],"21,30":[74,0,0,84],"22,28":[74,208],"22,29":[74,0,0,144],"22,30":[112],"23,28":[112],"23,29":[74],"23,30":[112],"24,28":[74,0,0,144,200],"24,29":[74],"24,30":[74],"25,28":[74,141,206],"25,29":[74],"25,30":[74,141,206],"26,28":[112],"26,29":[112],"26,30":[112]},name:"Placeholder 21,30",start:"21,30"},{data:{"30,28":[112],"30,29":[74],"30,30":[74,0,0,84],"30,31":[112],"31,28":[112],"31,29":[74],"31,30":[74,141,200],"31,31":[74],"32,28":[112],"32,29":[74],"32,30":[74,0,0,144,200],"32,31":[74],"33,28":[112],"33,29":[74],"33,30":[112],"33,31":[112],"34,28":[112],"34,29":[74],"34,30":[112],"34,31":[214],"35,28":[112],"35,29":[74,141,200,144],"35,30":[112],"35,31":[214],"36,28":[112],"36,29":[74,208],"36,30":[112],"36,31":[112],"37,28":[112],"37,29":[74],"37,30":[74],"37,31":[112]},name:"Placeholder 30,30",start:"30,30"},{data:{"42,28":[112],"42,29":[112],"42,30":[112],"42,31":[112],"43,28":[112],"43,29":[74],"43,30":[74],"43,31":[112],"44,28":[112],"44,29":[74],"44,30":[74,0,0,144,203],"44,31":[74],"45,28":[112],"45,29":[74,141,203],"45,30":[74],"45,31":[74],"46,28":[112],"46,29":[74,141,200],"46,30":[112],"46,31":[112],"47,28":[112],"47,29":[74],"47,30":[74],"47,31":[112],"48,28":[74],"48,29":[74],"48,30":[74,0,0,144,200],"48,31":[74,208],"49,28":[74],"49,29":[74,0,0,144],"49,30":[74,0,0,84],"49,31":[112]},name:"Placeholder 49,30",start:"49,30"},{data:{"54,28":[112],"54,29":[74,141,206],"54,30":[74,0,0,84],"55,28":[112],"55,29":[74],"55,30":[74],"56,28":[74,0,0,144,200],"56,29":[74,0,0,144],"56,30":[74,141,200,144,206],"57,28":[74],"57,29":[74,208],"57,30":[74],"58,28":[112],"58,29":[112],"58,30":[74],"59,28":[112],"59,29":[112],"59,30":[74]},name:"Placeholder 54,30",start:"54,30"},{data:{"64,28":[112],"64,29":[112],"64,30":[112],"64,31":[112],"65,28":[112],"65,29":[74,141,200],"65,30":[112],"65,31":[112],"66,28":[74],"66,29":[74,141,203,144,200],"66,30":[74,208],"66,31":[112],"67,28":[74],"67,29":[74,141,206,144,206],"67,30":[74],"67,31":[112],"68,28":[74],"68,29":[74,0,0,144],"68,30":[74],"68,31":[112],"69,28":[74],"69,29":[74,0,0,144,203],"69,30":[74,0,0,84],"69,31":[74],"70,28":[112],"70,29":[74],"70,30":[74],"70,31":[112]},name:"Placeholder 69,30",start:"69,30"},{data:{"75,28":[112],"75,29":[112],"75,30":[74],"75,31":[112],"76,28":[74],"76,29":[74],"76,30":[74],"76,31":[74],"77,28":[74],"77,29":[74,0,0,144,204],"77,30":[74,0,0,84],"77,31":[74],"78,28":[74,0,0,144,205],"78,29":[112],"78,30":[74,0,0,144,206],"78,31":[112],"79,28":[74],"79,29":[74],"79,30":[74],"79,31":[112],"80,28":[112],"80,29":[74],"80,30":[112],"80,31":[112],"81,28":[112],"81,29":[74],"81,30":[112],"81,31":[214],"82,28":[112],"82,29":[74],"82,30":[112],"82,31":[214],"83,28":[112],"83,29":[74],"83,30":[112],"83,31":[214],"84,28":[112],"84,29":[74],"84,30":[112],"84,31":[112],"85,28":[74],"85,29":[74],"85,30":[74],"85,31":[74],"86,28":[74],"86,29":[74],"86,30":[74],"86,31":[74],"87,28":[74,141,205,144],"87,29":[112],"87,30":[74,141,206],"87,31":[112],"88,28":[74,208],"88,29":[74,141,204],"88,30":[112],"88,31":[112],"89,28":[74],"89,29":[74],"89,30":[74],"89,31":[74],"90,28":[74],"90,29":[74],"90,30":[74],"90,31":[112]},name:"Placeholder 77,30",start:"77,30"},{data:{"100,28":[112],"100,29":[74,141,200],"100,30":[74,141,200],"100,31":[112],"100,32":[74,141,200],"100,33":[74,141,200],"100,34":[74,141,200],"101,28":[112],"101,29":[112],"101,30":[74,141,200],"101,31":[74,141,200,144],"101,32":[74,141,200,144],"101,33":[74,141,200,144],"101,34":[74,141,200,144],"102,28":[112],"102,29":[74,208],"102,30":[74,141,200],"102,31":[112],"102,32":[74,141,200],"102,33":[74,141,200],"102,34":[74,141,200],"103,28":[112],"103,29":[112],"103,30":[74,141,200],"103,31":[112],"103,32":[74],"103,33":[74],"103,34":[74,0,0,84],"94,28":[112],"94,29":[112],"94,30":[74,141,200],"94,31":[112],"94,32":[112],"94,33":[112],"94,34":[112],"95,28":[112],"95,29":[74,141,200],"95,30":[74,141,200],"95,31":[74,141,200],"95,32":[112],"95,33":[74,141,200],"95,34":[74,141,200],"96,28":[112],"96,29":[74,141,200],"96,30":[74],"96,31":[74,141,200],"96,32":[74,141,200,144],"96,33":[74,141,200],"96,34":[74],"97,28":[112],"97,29":[112],"97,30":[112],"97,31":[112],"97,32":[112],"97,33":[74,141,200],"97,34":[74,141,200],"98,28":[112],"98,29":[74,141,200],"98,30":[74,141,200],"98,31":[112],"98,32":[74,141,206],"98,33":[74,141,200],"98,34":[112],"99,28":[112],"99,29":[74,141,200],"99,30":[74,141,200,144,206],"99,31":[112],"99,32":[74,141,200],"99,33":[74,141,200],"99,34":[112]},name:"Placeholder 103,34",start:"103,34"},{data:{"3,64":[74],"3,65":[74],"3,66":[74,141,204],"3,67":[74],"3,68":[74],"3,69":[74],"4,64":[112],"4,65":[112],"4,66":[74,0,0,212],"4,67":[112],"4,68":[74],"4,69":[112],"5,64":[214],"5,65":[112],"5,66":[74,0,0,84],"5,67":[112],"5,68":[74],"5,69":[112],"6,64":[112],"6,65":[112],"6,66":[74],"6,67":[112],"6,68":[74,208],"6,69":[112],"7,64":[112],"7,65":[74],"7,66":[74],"7,67":[74],"7,68":[74],"7,69":[74],"8,64":[112],"8,65":[74],"8,66":[74,0,0,144,204],"8,67":[74],"8,68":[74],"8,69":[74],"9,64":[112],"9,65":[112],"9,66":[112],"9,67":[112],"9,68":[112],"9,69":[112]},name:"Placeholder 5,66",start:"5,66"},{data:{"13,64":[74],"13,65":[74],"13,66":[74],"13,67":[112],"13,68":[112],"14,64":[74,208,0,144,205],"14,65":[74,0,0,144],"14,66":[213],"14,67":[74,141,205,84],"14,68":[112],"15,64":[74],"15,65":[74,0,0,209],"15,66":[74],"15,67":[74],"15,68":[112],"16,64":[74],"16,65":[74],"16,66":[74],"16,67":[74],"16,68":[112],"17,64":[112],"17,65":[112],"17,66":[74],"17,67":[112],"17,68":[112],"18,64":[74],"18,65":[74],"18,66":[74],"18,67":[74],"18,68":[74]},name:"Placeholder 14,67",start:"14,67"},{data:{"22,64":[112],"22,65":[112],"22,66":[112],"22,67":[112],"22,68":[74],"23,64":[74],"23,65":[74,0,0,84],"23,66":[74,208],"23,67":[74],"23,68":[74],"24,64":[112],"24,65":[112],"24,66":[74,141,204,210],"24,67":[112],"24,68":[74],"25,64":[74],"25,65":[112],"25,66":[74,141,206],"25,67":[74],"25,68":[74],"26,64":[74],"26,65":[112],"26,66":[74,0,0,144,201],"26,67":[112],"26,68":[74],"27,64":[112],"27,65":[74],"27,66":[74],"27,67":[112],"27,68":[74],"28,64":[112],"28,65":[74],"28,66":[74],"28,67":[112],"28,68":[74],"29,64":[112],"29,65":[74],"29,66":[74],"29,67":[112],"29,68":[74]},name:"Placeholder 23,65",start:"23,65"},{data:{"32,64":[74],"32,65":[112],"32,66":[74],"32,67":[74],"33,64":[74,141,205],"33,65":[74,141,206],"33,66":[74,141,204,210],"33,67":[74,0,0,84],"34,64":[213],"34,65":[213],"34,66":[213],"34,67":[74,208],"35,64":[74,141,204],"35,65":[74,141,205],"35,66":[74,141,206,144,203],"35,67":[74],"36,64":[74],"36,65":[112],"36,66":[112],"36,67":[74]},name:"Placeholder 33,67",start:"33,67"},{data:{"39,64":[112],"39,65":[112],"39,66":[112],"39,67":[112],"39,68":[112],"40,64":[74],"40,65":[74,141,206],"40,66":[74,141,205],"40,67":[74,141,204],"40,68":[74,0,0,212],"41,64":[74],"41,65":[213],"41,66":[213],"41,67":[213],"41,68":[74,0,0,144,200],"42,64":[74,208],"42,65":[74,141,205],"42,66":[74,141,204],"42,67":[74,141,206],"42,68":[74],"43,64":[112],"43,65":[213],"43,66":[213],"43,67":[213],"43,68":[74],"44,64":[74],"44,65":[74,141,205],"44,66":[74,141,206],"44,67":[74,141,204,84],"44,68":[74,0,0,210],"45,64":[112],"45,65":[112],"45,66":[112],"45,67":[112],"45,68":[112]},name:"Placeholder 44,67",start:"44,67"},{data:{"48,64":[74],"48,65":[112],"48,66":[74],"48,67":[74],"49,64":[74,141,204],"49,65":[74,141,205],"49,66":[74,141,206,144,200],"49,67":[74],"50,64":[213],"50,65":[213],"50,66":[213],"50,67":[74,208],"51,64":[74,141,202,212],"51,65":[74,141,201],"51,66":[74,141,203],"51,67":[74,0,0,84],"52,64":[74],"52,65":[112],"52,66":[112],"52,67":[74]},name:"Placeholder 51,67",start:"51,67"},{data:{"56,64":[74],"56,65":[112],"56,66":[112],"56,67":[112],"56,68":[74],"56,69":[112],"56,70":[74],"56,71":[112],"56,72":[112],"56,73":[74],"57,64":[74],"57,65":[74],"57,66":[74],"57,67":[74,0,0,210],"57,68":[74],"57,69":[112],"57,70":[74],"57,71":[112],"57,72":[112],"57,73":[74],"58,64":[74],"58,65":[112],"58,66":[112],"58,67":[112],"58,68":[112],"58,69":[74,208],"58,70":[74,0,0,211],"58,71":[112],"58,72":[112],"58,73":[112],"59,64":[74],"59,65":[74],"59,66":[74],"59,67":[74],"59,68":[74],"59,69":[74],"59,70":[74],"59,71":[74],"59,72":[74,141,206],"59,73":[112],"60,64":[112],"60,65":[112],"60,66":[112],"60,67":[112],"60,68":[112],"60,69":[112],"60,70":[74],"60,71":[213],"60,72":[213],"60,73":[112],"61,64":[74],"61,65":[74],"61,66":[74],"61,67":[74],"61,68":[74],"61,69":[112],"61,70":[74,141,205,144,200],"61,71":[213],"61,72":[74,0,0,84],"61,73":[74],"62,64":[112],"62,65":[112],"62,66":[74],"62,67":[112],"62,68":[74],"62,69":[112],"62,70":[74],"62,71":[213],"62,72":[213],"62,73":[112],"63,64":[74],"63,65":[74],"63,66":[74],"63,67":[74,0,0,212],"63,68":[74],"63,69":[74],"63,70":[74],"63,71":[74],"63,72":[74,141,204],"63,73":[74],"64,64":[112],"64,65":[74],"64,66":[74],"64,67":[112],"64,68":[74],"64,69":[112],"64,70":[74],"64,71":[112],"64,72":[112],"64,73":[112],"65,64":[112],"65,65":[74],"65,66":[74],"65,67":[74],"65,68":[74],"65,69":[112],"65,70":[74],"65,71":[112],"65,72":[112],"65,73":[112],"66,64":[74],"66,65":[74],"66,66":[112],"66,67":[112],"66,68":[112],"66,69":[112],"66,70":[74],"66,71":[74],"66,72":[112],"66,73":[74],"67,64":[74],"67,65":[74],"67,66":[74],"67,67":[74],"67,68":[74],"67,69":[74],"67,70":[74],"67,71":[74],"67,72":[112],"67,73":[74]},name:"Placeholder 61,72",start:"61,72"},{data:{"10,88":[112],"10,89":[112],"10,90":[112],"10,91":[112],"10,92":[112],"10,93":[213],"4,88":[112],"4,89":[112],"4,90":[74],"4,91":[74],"4,92":[74],"4,93":[74],"5,88":[74],"5,89":[213],"5,90":[74,141,206,144,203],"5,91":[74,0,0,183],"5,92":[74],"5,93":[74,0,0,209],"6,88":[74],"6,89":[112],"6,90":[74],"6,91":[74],"6,92":[74],"6,93":[74],"7,88":[112],"7,89":[112],"7,90":[74],"7,91":[112],"7,92":[74,0,0,84],"7,93":[74],"8,88":[112],"8,89":[74],"8,90":[74],"8,91":[112],"8,92":[112],"8,93":[112],"9,88":[74,208],"9,89":[74],"9,90":[74],"9,91":[74],"9,92":[74],"9,93":[74,141,205]},name:"Placeholder 7,92",start:"7,92"},{data:{"16,88":[112],"16,89":[112],"16,90":[112],"16,91":[74,0,0,144,202],"16,92":[112],"16,93":[112],"17,88":[112],"17,89":[74,141,204],"17,90":[74,141,205],"17,91":[74,0,0,212],"17,92":[74],"17,93":[112],"18,88":[112],"18,89":[213],"18,90":[213],"18,91":[112],"18,92":[74],"18,93":[74],"19,88":[74],"19,89":[74,0,0,186],"19,90":[74,0,0,84],"19,91":[74],"19,92":[74],"19,93":[74],"20,88":[74],"20,89":[74,208,0,183],"20,90":[74],"20,91":[74],"20,92":[74],"20,93":[74]},name:"Placeholder 19,90",start:"19,90"},{data:{"26,88":[112],"26,89":[112],"26,90":[112],"26,91":[74],"26,92":[112],"26,93":[112],"27,88":[112],"27,89":[74,141,204],"27,90":[74,141,205],"27,91":[74],"27,92":[74],"27,93":[74],"28,88":[74],"28,89":[213],"28,90":[213],"28,91":[74,0,0,144,202],"28,92":[74],"28,93":[74],"29,88":[74],"29,89":[74],"29,90":[74,0,0,84],"29,91":[112],"29,92":[112],"29,93":[74],"30,88":[74],"30,89":[74,0,0,183],"30,90":[74],"30,91":[74,0,0,185],"30,92":[74],"30,93":[74],"31,88":[74],"31,89":[74,0,0,183],"31,90":[74],"31,91":[74,0,0,212],"31,92":[74],"31,93":[74,0,0,184],"32,88":[74,208],"32,89":[74,0,0,186],"32,90":[74],"32,91":[74,0,0,212],"32,92":[74],"32,93":[74]},name:"Placeholder 29,90",start:"29,90"},{data:{"10,115":[74],"10,116":[74],"10,117":[112],"10,118":[74],"11,115":[112],"11,116":[112],"11,117":[112],"11,118":[112],"6,115":[112],"6,116":[74],"6,117":[112],"6,118":[112],"7,115":[74,208],"7,116":[74],"7,117":[112],"7,118":[112],"8,115":[112],"8,116":[74],"8,117":[112],"8,118":[74,0,0,84],"9,115":[112],"9,116":[74,0,0,179,200],"9,117":[112],"9,118":[74]},name:"Placeholder 8,118",start:"8,118"},{data:{"15,115":[112],"15,116":[74],"15,117":[74,0,0,180,200],"15,118":[112],"16,115":[112],"16,116":[74],"16,117":[74],"16,118":[112],"17,115":[112],"17,116":[74],"17,117":[74],"17,118":[74,208],"18,115":[112],"18,116":[74],"18,117":[74],"18,118":[112],"19,115":[74],"19,116":[74],"19,117":[74],"19,118":[112],"20,115":[74,0,0,84],"20,116":[74,0,0,144,200],"20,117":[74],"20,118":[112]},name:"Placeholder 20,115",start:"20,115"},{data:{"24,115":[74],"24,116":[112],"24,117":[112],"24,118":[112],"24,119":[74],"24,120":[74],"24,121":[112],"25,115":[74],"25,116":[112],"25,117":[112],"25,118":[74,208],"25,119":[74],"25,120":[74],"25,121":[112],"26,115":[74],"26,116":[112],"26,117":[112],"26,118":[112],"26,119":[74],"26,120":[74],"26,121":[112],"27,115":[74],"27,116":[112],"27,117":[112],"27,118":[74],"27,119":[74,0,0,179,206],"27,120":[74,0,0,179,200],"27,121":[112],"28,115":[74,0,0,144,200],"28,116":[74],"28,117":[112],"28,118":[112],"28,119":[74],"28,120":[74],"28,121":[74,0,0,84],"29,115":[74],"29,116":[74],"29,117":[112],"29,118":[112],"29,119":[74],"29,120":[74],"29,121":[74]},name:"Placeholder 28,121",start:"28,121"},{data:{"33,115":[112],"33,116":[112],"33,117":[112],"33,118":[112],"33,119":[112],"33,120":[112],"33,121":[112],"33,122":[112],"34,115":[112],"34,116":[74],"34,117":[74],"34,118":[74],"34,119":[74],"34,120":[74,0,0,180,202],"34,121":[74],"34,122":[74],"35,115":[112],"35,116":[74],"35,117":[74,208],"35,118":[74],"35,119":[74],"35,120":[74],"35,121":[74,0,0,177,203],"35,122":[74],"36,115":[112],"36,116":[74],"36,117":[74],"36,118":[74],"36,119":[74],"36,120":[74,0,0,179,201],"36,121":[74],"36,122":[74,0,0,84]},name:"Placeholder 36,122",start:"36,122"},{data:{"41,115":[74],"41,116":[74],"41,117":[74],"41,118":[74],"41,119":[74],"42,115":[74],"42,116":[74],"42,117":[74],"42,118":[74],"42,119":[74],"43,115":[74],"43,116":[74],"43,117":[74],"43,118":[74],"43,119":[74,0,0,178,200],"44,115":[74],"44,116":[74],"44,117":[74],"44,118":[74],"44,119":[74,0,0,84],"45,115":[112],"45,116":[112],"45,117":[74,0,0,144,200],"45,118":[112],"45,119":[112],"46,115":[74,0,0,180,200],"46,116":[74],"46,117":[74],"46,118":[112],"46,119":[74,208],"47,115":[74],"47,116":[74,0,0,178,200],"47,117":[74],"47,118":[74],"47,119":[74],"48,115":[74],"48,116":[74],"48,117":[74],"48,118":[74,0,0,180,200],"48,119":[74],"49,115":[74],"49,116":[74],"49,117":[74],"49,118":[74],"49,119":[74]},name:"Placeholder 44,119",start:"44,119"},{data:{"53,115":[74,0,0,84],"53,116":[74,0,0,184],"53,117":[74],"53,118":[74],"53,119":[74],"53,120":[74],"54,115":[74],"54,116":[74],"54,117":[74,0,0,178,200],"54,118":[74],"54,119":[74],"54,120":[74],"55,115":[74],"55,116":[112],"55,117":[112],"55,118":[74],"55,119":[112],"55,120":[74],"56,115":[74],"56,116":[112],"56,117":[112],"56,118":[74],"56,119":[112],"56,120":[112],"57,115":[112],"57,116":[112],"57,117":[112],"57,118":[74],"57,119":[74,208],"57,120":[112],"58,115":[74],"58,116":[74],"58,117":[112],"58,118":[112],"58,119":[112],"58,120":[112]},name:"Placeholder 53,115",start:"53,115"},{data:{"10,137":[112],"10,138":[112],"10,139":[74],"10,140":[74,0,0,196],"11,137":[112],"11,138":[112],"11,139":[112],"11,140":[74],"5,137":[112],"5,138":[112],"5,139":[112],"5,140":[74,0,0,84],"6,137":[74,141,200],"6,138":[112],"6,139":[112],"6,140":[74],"7,137":[112],"7,138":[112],"7,139":[74],"7,140":[74],"8,137":[74,208],"8,138":[112],"8,139":[74],"8,140":[74,0,0,144,200],"9,137":[112],"9,138":[112],"9,139":[74],"9,140":[74]},name:"Placeholder 5,140",start:"5,140"},{data:{"10,158":[74],"10,159":[112],"10,160":[74,0,0,180,205],"10,161":[74],"10,162":[74],"10,163":[74],"11,158":[74],"11,159":[112],"11,160":[74,208],"11,161":[74],"11,162":[74],"11,163":[74],"12,158":[112],"12,159":[74],"12,160":[74],"12,161":[74],"12,162":[74],"12,163":[74],"4,158":[112],"4,159":[112],"4,160":[112],"4,161":[74,0,0,84],"4,162":[112],"4,163":[112],"5,158":[74],"5,159":[74],"5,160":[74,0,0,144,203],"5,161":[74],"5,162":[74],"5,163":[74],"6,158":[74],"6,159":[74],"6,160":[74],"6,161":[74,0,0,193],"6,162":[74],"6,163":[74],"7,158":[74],"7,159":[74],"7,160":[74],"7,161":[74],"7,162":[74],"7,163":[74],"8,158":[74],"8,159":[74],"8,160":[74],"8,161":[74],"8,162":[112],"8,163":[74],"9,158":[74],"9,159":[74],"9,160":[74,0,0,178,206],"9,161":[74],"9,162":[74],"9,163":[74]},name:"Placeholder 4,161",start:"4,161"},{data:{"10,175":[112],"10,176":[74,0,0,146],"10,177":[112],"10,178":[166],"10,179":[166],"10,180":[166],"11,175":[112],"11,176":[74,0,0,84],"11,177":[112],"11,178":[166],"11,179":[166],"11,180":[166],"5,175":[112],"5,176":[112],"5,177":[112],"5,178":[112],"5,179":[112],"5,180":[166],"6,175":[112],"6,176":[74],"6,177":[74,127],"6,178":[166],"6,179":[166],"6,180":[166],"7,175":[112],"7,176":[74],"7,177":[112],"7,178":[166],"7,179":[166],"7,180":[166],"8,175":[112],"8,176":[74,141,200],"8,177":[112],"8,178":[166],"8,179":[166],"8,180":[166],"9,175":[112],"9,176":[74,0,0,144,200],"9,177":[112],"9,178":[166],"9,179":[166],"9,180":[166]},name:"Placeholder 11,176",start:"11,176"}],Ts={block_goal:"144",block_goal_ti:"153",block_laser_d:"178",block_laser_l:"179",block_laser_r:"180",block_laser_u:"177",block_mirror_bd:"211",block_mirror_bl:"210",block_mirror_br:"212",block_mirror_bu:"209",block_mirror_dl:"183",block_mirror_dr:"185",block_mirror_ul:"186",block_mirror_ul_dr:"182",block_mirror_ur:"184",block_mirror_ur_dl:"181",block_offset_x_zero:"196",block_offset_y_zero:"193",color:"199",color_b:"204",color_g:"205",color_gb:"202",color_r:"206",color_rb:"201",color_rg:"203",color_rgb:"200",controls:"114",floor:"74",floor_laser:"141",grass:"166",ice:"64",lava:"65",level_goal:"208",level_start:"84",offset_placeholder_negative:"198",offset_placeholder_positive:"197",sign_blocks:"89",sign_bridges:"137",sign_colors:"207",sign_danger:"127",sign_sliding:"92",sign_time:"130",space:"95",time_immune_area:"128",time_immune_changer:"146",unwalkable:"214",wall:"112",wall_glass:"213"},Es={height:128,width:128},js={idToName:Is,levels:Ps,nameToId:Ts,tileSize:Es},Ls={solved:{},current:0},zs=function(){function e(){Wt(this,e),this.load(),this.totalLevels=js.levels.length}return Ut(e,[{key:"load",value:function(){var e=localStorage.getItem("psLevelProgressV2")||btoa(JSON.stringify(Ls));this.store=JSON.parse(atob(e))}},{key:"save",value:function(){localStorage.setItem("psLevelProgressV2",btoa(JSON.stringify(this.store)))}},{key:"solved",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.store.current;this.store.solved[e]={dateLastSolved:new Date},this.save()}},{key:"findNext",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.store.current,t=e;t in this.store.solved&&t<this.totalLevels;)++t;return t>this.totalLevels-1?this.totalLevels-1:t}},{key:"findPrevious",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.store.current,t=e;t in this.store.solved&&t>0;)--t;return 0===t&&t in this.store.solved?this.store.current:Math.max(t,0)}},{key:"setLevel",value:function(e){this.store.current=e,this.save()}},{key:"currentLevel",get:function(){return this.store.current}},{key:"solvedLevels",get:function(){return Object.keys(this.store.solved).length}}]),e}(),Ms=function(){function e(){Wt(this,e),this.actions=[]}return Ut(e,[{key:"push",value:function(e){var t=new Cs(e);return t.execute()?(this.actions.push(t),!0):(t.rollback(),!1)}},{key:"pushToLast",value:function(e){if(this.actions.length>0){if(this.actions.top().addChild(e))return!0;this.actions.top().rollbackLast()}return!1}},{key:"pop",value:function(){if(this.actions.length>0){for(var e=!0;e&&this.actions.length>0;)e=!this.actions.top().undo(),this.actions.pop();return!0}return!1}},{key:"reset",value:function(){this.actions=[]}}]),e}(),Cs=function(){function e(t){Wt(this,e),this.children=[],this.action=t}return Ut(e,[{key:"execute",value:function(){var e=dt(this.action,"execute",this);return this.addChildren(e)}},{key:"rollback",value:function(){for(;this.children.length>0;)this.children.top().rollback(),this.children.pop();dt(this.action,"rollback",this)}},{key:"rollbackLast",value:function(){this.children.length>0&&(this.children.top().rollback(),this.children.pop())}},{key:"rollbackIfOptional",value:function(){return!!this.action.optional&&(this.rollback(),!0)}},{key:"undo",value:function(){for(var e=!1,t=this.children.length-1;t>=0;--t){this.children[t].undo()&&(e=!0)}var n=dt(this.action,"undo",this);return e||n}},{key:"addChild",value:function(t){var n=new e(t);return this.children.push(n),n.execute()}},{key:"addChildren",value:function(e){if(!1===e)return this.rollbackIfOptional();if("object"===(void 0===e?"undefined":qt(e))&&void 0===e.length&&(e=[e]),e&&e.length>0){var t=!0,n=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;if(!this.addChild(a))return this.rollbackIfOptional()}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}return!0}}]),e}(),Ds=new gn,Bs=new PIXI.Application(window.innerWidth,window.innerHeight,{backgroundColor:0}),Fs=(Bs.stage.addChild(new PIXI.Container),Bs.stage.addChild(new PIXI.Container)),Rs=Bs.stage.addChild(new PIXI.Container),Ns=new xs,Gs=new ks,qs=new ws,Ws=new Os(Ns,Bs,Fs),Us=new zs,Vs=new Ms;Ds.component("position",function(){function e(){Wt(this,e)}return Ut(e,[{key:"onCreate",value:function(e){this.entity=e;for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.set.apply(this,n)}},{key:"onRemove",value:function(){Gs.remove(this.entity)}},{key:"zeroNaN",value:function(e){return isNaN(e)?0:e}},{key:"getDiff",value:function(e,t){return{x:this.zeroNaN(e-this._x),y:this.zeroNaN(t-this._y)}}},{key:"update",value:function(e){var t=Gs.update(this.entity);this.entity.has("positionChanged")?this.entity.remove("positionChanged"):this.entity.set("positionChanged",{diff:e,wrapped:t})}},{key:"set",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this._x!==e||this._y!==t){var n=this.getDiff(e,t);this._x=e,this._y=t,this.update(n)}}},{key:"x",set:function(e){if(this._x!==e){var t=this.getDiff(e,void 0);this._x=e,this.update(t)}},get:function(){return this._x}},{key:"y",set:function(e){if(this._y!==e){var t=this.getDiff(void 0,e);this._y=e,this.update(t)}},get:function(){return this._y}}]),e}()),Ds.component("sprite",function(){function e(){Wt(this,e)}return Ut(e,[{key:"onCreate",value:function(e,t,n,r,i){this.entity=e,this.container=t,this.create(n,r,i)}},{key:"create",value:function(e,t,n){e?(e=this.getTIName(e),this.sprite=new PIXI.Sprite(PIXI.utils.TextureCache[e+".png"]),this.name=e):this.sprite=new PIXI.Sprite,this.name=this.getTIName(e),this.sprite=wt(this.name),this.sprite.anchor.set(.5),this.sprite.zIndex=t||0,n&&(this.sprite.position.x=n.x,this.sprite.position.y=n.y),this.onCreated()}},{key:"update",value:function(){this.container.toUpdate.add(this.sprite.zIndex)}},{key:"onRemove",value:function(){this.update(),this.container.removeChild(this.sprite)}},{key:"onCreated",value:function(){this.update(),this.container.addChild(this.sprite)}},{key:"set",value:function(e){return(e=this.getTIName(e))!==this.name&&(this.sprite.texture=PIXI.utils.TextureCache[e+".png"],this.name=e,this.update(),!0)}},{key:"updateTimeImmune",value:function(){this.set(this.name)}},{key:"getTIName",value:function(e){if(e){e.endsWith("_ti")&&(e=e.slice(0,-"_ti".length));var t=e+"_ti";return this.entity.has("timeImmune")&&PIXI.utils.TextureCache[t+".png"]&&(e=t),e}}},{key:"zIndex",set:function(e){this.onRemove(),this.sprite.zIndex=e,this.onCreated()},get:function(){return this.sprite.zIndex}}]),e}()),Ds.component("inputMovement",function(){function e(){Wt(this,e)}return Ut(e,[{key:"onCreate",value:function(e){this.currentDirection={x:0,y:0},this.lastDirection={x:0,y:0}}}]),e}()),Ds.component("forcedMovement",function(){function e(){Wt(this,e)}return Ut(e,[{key:"onCreate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0};this.direction=t,this.moving=!0}}]),e}()),Ds.component("cameraFollows",function(){function e(){Wt(this,e)}return Ut(e,[{key:"onCreate",value:function(e){this.update()}},{key:"update",value:function(){this.center=!0;var e=Ws.scale;this.borderSize={x:ms.gameSize.width/e*.33,y:ms.gameSize.height/e*.33},this.deadzone=new PIXI.Rectangle(this.borderSize.x,this.borderSize.y,ms.gameSize.width/e-2*this.borderSize.x,ms.gameSize.height/e-2*this.borderSize.y)}}]),e}()),Ds.component("logicAction",function(){function e(){Wt(this,e)}return Ut(e,[{key:"onCreate",value:function(e,t){this.action=t}}]),e}()),Ds.component("logic",function(){function e(){Wt(this,e)}return Ut(e,[{key:"onCreate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(var n in t)this[n]=t[n]}}]),e}()),Ds.component("partOfLayer",function(){function e(){Wt(this,e)}return Ut(e,[{key:"onCreate",value:function(e,t){this.layer=t}}]),e}()),Ds.component("levelGoal",function(){function e(){Wt(this,e)}return Ut(e,[{key:"onCreate",value:function(e,t){this.completed=t||!1}}]),e}()),Ds.component("goal",function(){function e(){Wt(this,e)}return Ut(e,[{key:"onCreate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.solved=t}}]),e}()),Ds.component("tween",function(){function e(){Wt(this,e)}return Ut(e,[{key:"onCreate",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e3;if(this.entity=e,this.target=n,this.time=r,this.total=0,t)this.start=t;else{var i=this.entity.get("sprite").sprite;this.start={x:i.x,y:i.y}}}},{key:"update",value:function(e,t){this.total+=e;var n=Math.min(1,this.total/this.time),r=vt(this.start,this.target,n),i=this.entity.get("sprite");i.sprite.x=r.x,i.sprite.y=r.y,i.container.toUpdate.add(i.sprite.zIndex),1===n&&(this.entity.remove("tween"),ft(t))}}]),e}()),Ds.component("timeImmune",function(){function e(){Wt(this,e)}return Ut(e,[{key:"onCreate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.entity=e,this.permanent=t,this.updateSprite()}},{key:"onRemove",value:function(){this.updateSprite()}},{key:"updateSprite",value:function(){var e=this.entity.get("sprite");e&&e.updateTimeImmune()}}]),e}()),Ds.component("floats",function(){function e(){Wt(this,e)}return Ut(e,[{key:"onCreate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.floating=t}}]),e}());var Xs={primary:function(e){var t=e.sprite,n=e.tint;return t.sprite.tint=n},secondary:function(e){var t=e.sprite,n=e.tint,r=!0,i=!1,o=void 0;try{for(var a,s=t.sprite.children[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){a.value.tint=n}}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}}};Ds.component("color",function(){function e(){Wt(this,e)}return Ut(e,[{key:"onCreate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.tinters=Vt({},Xs,n),this.entity=e,this.colors={};for(var r in t)this.set(r,t[r])}},{key:"toRgb",value:function(e){return At(this.get(e))}},{key:"get",value:function(e){return this.colors[e]||0}},{key:"set",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if("string"==typeof t&&(t=St(t)),this.colors[e]!==t){this.colors[e]=t;var n=this.entity.get("sprite");if(n){var r=this.toRgb(e),i=this.tinters[e];"function"==typeof i?i({entity:this.entity,sprite:n,tint:r}):(n.sprite.tint=r,console.warn("Fallback tinter triggered in color component")),n.update()}}}}]),e}()),Ds.component("receivingLaser",function(){function e(){Wt(this,e)}return Ut(e,[{key:"onCreate",value:function(){this.color3=0}},{key:"addColor3",value:function(e){this.color3|=e}}]),e}()),Ds.system(function(){function e(){Wt(this,e)}return Ut(e,[{key:"initialize",value:function(){qs.setData(js),qs.register(["level_start"],function(e){return e.destroy()}),Ss.send("loadLevel")}},{key:"pre",value:function(){Ss.process("restart",function(){Ss.send("loadLevel")}),Ss.process("nextLevel",function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=Us.store.current+1,n=e?Us.findNext(t):Math.min(t,Us.totalLevels-1);Ss.send("loadLevel",n)}),Ss.process("previousLevel",function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=Us.store.current-1,n=e?Us.findPrevious(t):Math.max(t,0);Ss.send("loadLevel",n)}),Ss.process("solveLevel",function(){Us.solved(),Ss.send("loadLevel",Us.findNext())}),Ss.clear("loaded"),Ss.process("loadLevel",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Us.store.current;console.log("Loading level "+e),qs.loadTiles(e),Us.setLevel(e),Ss.send("resetPlayer",{position:lt(qs.level.start)}),Ss.send("loaded")})}}]),e}());var Ks=r(function(e,t){!function(t){e.exports=function(){return function e(t,r,i){function o(s,u){if(!r[s]){if(!t[s]){var l="function"==typeof n&&n;if(!u&&l)return l(s,!0);if(a)return a(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var d=r[s]={exports:{}};t[s][0].call(d.exports,function(e){var n=t[s][1][e];return o(n||e)},d,d.exports,e,t,r,i)}return r[s].exports}for(var a="function"==typeof n&&n,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(e,t,n){function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(){}var o="function"!=typeof Object.create&&"~";i.prototype._events=void 0,i.prototype.listeners=function(e,t){var n=o?o+e:e,r=this._events&&this._events[n];if(t)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var i=0,a=r.length,s=new Array(a);i<a;i++)s[i]=r[i].fn;return s},i.prototype.emit=function(e,t,n,r,i,a){var s=o?o+e:e;if(!this._events||!this._events[s])return!1;var u,l,c=this._events[s],d=arguments.length;if("function"==typeof c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,r),!0;case 5:return c.fn.call(c.context,t,n,r,i),!0;case 6:return c.fn.call(c.context,t,n,r,i,a),!0}for(l=1,u=new Array(d-1);l<d;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var f,h=c.length;for(l=0;l<h;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),d){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,n);break;default:if(!u)for(f=1,u=new Array(d-1);f<d;f++)u[f-1]=arguments[f];c[l].fn.apply(c[l].context,u)}}return!0},i.prototype.on=function(e,t,n){var i=new r(t,n||this),a=o?o+e:e;return this._events||(this._events=o?{}:Object.create(null)),this._events[a]?this._events[a].fn?this._events[a]=[this._events[a],i]:this._events[a].push(i):this._events[a]=i,this},i.prototype.once=function(e,t,n){var i=new r(t,n||this,!0),a=o?o+e:e;return this._events||(this._events=o?{}:Object.create(null)),this._events[a]?this._events[a].fn?this._events[a]=[this._events[a],i]:this._events[a].push(i):this._events[a]=i,this},i.prototype.removeListener=function(e,t,n,r){var i=o?o+e:e;if(!this._events||!this._events[i])return this;var a=this._events[i],s=[];if(t)if(a.fn)(a.fn!==t||r&&!a.once||n&&a.context!==n)&&s.push(a);else for(var u=0,l=a.length;u<l;u++)(a[u].fn!==t||r&&!a[u].once||n&&a[u].context!==n)&&s.push(a[u]);return s.length?this._events[i]=1===s.length?s[0]:s:delete this._events[i],this},i.prototype.removeAllListeners=function(e){return this._events?(e?delete this._events[o?o+e:e]:this._events=o?{}:Object.create(null),this):this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prototype.setMaxListeners=function(){return this},i.prefixed=o,void 0!==t&&(t.exports=i)},{}],2:[function(e,t,n){n.__esModule=!0;var r=e("./lib/input.js"),i=function(e){return e&&e.__esModule?e:{default:e}}(r);n.default=i.default,t.exports=n.default},{"./lib/input.js":3}],3:[function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){
if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":qt(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}n.__esModule=!0;var a=e("eventemitter3"),s=r(a);e("./polyfill.js");var u=e("./touch.js"),l=r(u),c="ontouchstart"in window,d=c?{touchstart:"start",touchmove:"move",touchend:"end",touchcancel:"end"}:{mousedown:"start",mousemove:"move",mouseup:"end"},f=Object.keys(d),h=function(e){function t(){i(this,t),e.call(this),this.touches=new Set,this.actives=new Map,this.tickBound=this.tick.bind(this),this.tickInterval=0,this.pooledTouches=[]}return o(t,e),t.prototype.attach=function(){var e=this;this.attached||(this.attached=!0,this.tickInterval=window.requestAnimationFrame(this.tickBound),f.forEach(function(t){return window.addEventListener(t,e,!1)}))},t.prototype.detach=function(){var e=this;this.attached&&(this.attached=!1,window.cancelAnimationFrame(this.tickInterval),f.forEach(function(t){return window.removeEventListener(t,e,!1)}))},t.prototype.handleEvent=function(e){e.preventDefault();for(var t=d[e.type],n=c?e.changedTouches:[e],r=0,i=n.length;r<i;r++){var o=n[r];if("start"!==t){var a=o.identifier||0;if(this.actives.has(a)){var s=this.actives.get(a);"end"!==t?s.move(o):(s.end(),this.actives.delete(s.id))}}else{var u=this.pooledTouches.pop()||new l.default(this);u.fromTouch(o),this.actives.set(u.id,u),this.touches.add(u)}}},t.prototype.tick=function(){var e=this;this.tickInterval=window.requestAnimationFrame(this.tickBound),this.touches.forEach(function(t){if(t.isFinal)return t.delete(),e.touches.delete(t),void e.pooledTouches.push(t);t.tick()})},t}(s.default);n.default=new h,t.exports=n.default},{"./polyfill.js":4,"./touch.js":5,eventemitter3:1}],4:[function(e,t,n){"performance"in window||(window.performance=window.webkitPerformance||{}),"now"in performance||(performance.now=function(){return Date.now()})},{}],5:[function(e,t,n){function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":qt(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)}n.__esModule=!0;var a,s,u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("eventemitter3"),c=r(l),d=e("./vec2d.js"),f=r(d),h={BEGAN:"began",MOVED:"moved",STATIONARY:"stationary",ENDED:"ended",CANCELED:"canceled",BEGIN:"willBegin",END:"willEnd"},v=(a={},a[h.BEGIN]=h.BEGAN,a[h.BEGAN]=h.STATIONARY,a[h.END]=h.ENDED,a),p=(s={},s[h.BEGAN]="touchBegan",s[h.STATIONARY]="touchStationary",s[h.MOVED]="touchMoved",s[h.ENDED]="touchEnded",s.deleted="touchDeleted",s),_=function(e){function t(n){i(this,t),e.call(this),this.input=n,this.id=0,this.phase="",this.time=0,this.startTime=0,this.previousTime=0,this.position=f.default.create(0,0),this.startPosition=f.default.create(0,0),this.previousPosition=f.default.create(0,0),this.positions=new Set,this.didUpdate=!1,this.details=null}return o(t,e),t.prototype.fromTouch=function(e){this.id=e.identifier||0,this.startTime=performance.now(),this.time=this.startTime,this.startPosition[0]=e.pageX,this.startPosition[1]=e.pageY,this.position.set(this.startPosition),this.previousPosition.set(this.startPosition),this.phase=h.BEGIN},t.prototype.tick=function(){this.previousTime=this.time,this.time=performance.now();var e=!1;v[this.phase]?(this.phase=v[this.phase],e=!0):this.didMove&&(e=!0,this.phase!==h.MOVED&&(this.phase=h.MOVED)),e&&this.emit(this.phase),this.didUpdate=!1,this.didMove=!1},t.prototype.move=function(e){this.markUpdated(),this.didMove=!0,this.position[0]=e.pageX,this.position[1]=e.pageY,this.positions.add(f.default.create(this.position[0],this.position[1]))},t.prototype.end=function(){this.markUpdated(),this.phase=h.END},t.prototype.markUpdated=function(){this.didUpdate||(this.didUpdate=!0,f.default.freeAll(this.positions),this.previousPosition.set(this.position))},t.prototype.emit=function(t){var n={touch:this};e.prototype.emit.call(this,t,n),this.input.emit(p[t],n)},t.prototype.delete=function(){this.emit("deleted"),this.removeAllListeners(),f.default.freeAll(this.positions),this.details=null},u(t,[{key:"deltaTime",get:function(){return this.time-this.previousTime}},{key:"isFinal",get:function(){return this.phase===h.ENDED}}]),t}(c.default);n.default=_,t.exports=n.default},{"./vec2d.js":6,eventemitter3:1}],6:[function(e,t,n){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.__esModule=!0;var i=function(){function e(){r(this,e),this.pool=[]}return e.prototype.create=function(e,t){var n=this.pool.pop()||new Uint32Array(2);return n[0]=e,n[1]=t,n},e.prototype.free=function(e){this.pool.push(e)},e.prototype.freeAll=function(e){e.forEach(this.free,this),e.clear()},e}();n.default=new i,t.exports=n.default},{}]},{},[2])(2)}()}()}),Hs=function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}(Ks),$s=r(function(e,t){(function(){var e,n,r,i,o,a,s,u,l,c,d,f,h,v,p,_,y,m,g,b={}.hasOwnProperty,k=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};a={is_unordered:!1,is_counting:!1,is_exclusive:!1,is_solitary:!1,prevent_default:!1,prevent_repeat:!1,normalize_caps_lock:!1},m="meta alt option ctrl shift cmd".split(" "),_="ctrl",e={debug:!1};var w=function(e){var t,n;for(t in e)b.call(e,t)&&!1!==(n=e[t])&&(this[t]=n);this.keys=this.keys||[],this.count=this.count||0};w.prototype.allows_key_repeat=function(){return!this.prevent_repeat&&"function"==typeof this.on_keydown},w.prototype.reset=function(){return this.count=0,this.keyup_fired=null};var x=function(e,t){var n,r;"undefined"!=typeof jQuery&&null!==jQuery&&e instanceof jQuery&&(1!==e.length&&p("Warning: your jQuery selector should have exactly one object."),e=e[0]),this.should_force_event_defaults=this.should_suppress_event_defaults=!1,this.sequence_delay=800,this._registered_combos=[],this._keys_down=[],this._active_combos=[],this._sequence=[],this._sequence_timer=null,this._prevent_capture=!1,this._defaults=t||{};for(n in a)b.call(a,n)&&(r=a[n],this._defaults[n]=this._defaults[n]||r);this.element=e||document.body,n=function(e,t,n){return e.addEventListener?e.addEventListener(t,n):e.attachEvent&&e.attachEvent("on"+t,n),n};var i=this;this.keydown_event=n(this.element,"keydown",function(e){return e=e||window.event,i._receive_input(e,!0),i._bug_catcher(e)});var o=this;this.keyup_event=n(this.element,"keyup",function(e){return e=e||window.event,o._receive_input(e,!1)});var s=this;this.blur_event=n(window,"blur",function(){var e,t,n,r;for(r=s._keys_down,t=0,n=r.length;t<n;t++)e=r[t],s._key_up(e,{});return s._keys_down=[]})};x.prototype.destroy=function(){var e;return e=function(e,t,n){return null!=e.removeEventListener?e.removeEventListener(t,n):null!=e.removeEvent?e.removeEvent("on"+t,n):void 0},e(this.element,"keydown",this.keydown_event),e(this.element,"keyup",this.keyup_event),e(window,"blur",this.blur_event)},x.prototype._bug_catcher=function(e){var t,n;if("cmd"===_&&0<=k.call(this._keys_down,"cmd")&&"cmd"!==(t=i(null!=(n=e.keyCode)?n:e.key))&&"shift"!==t&&"alt"!==t&&"caps"!==t&&"tab"!==t)return this._receive_input(e,!1)},x.prototype._cmd_bug_check=function(e){return!("cmd"===_&&0<=k.call(this._keys_down,"cmd")&&0>k.call(e,"cmd"))},x.prototype._prevent_default=function(e,t){if((t||this.should_suppress_event_defaults)&&!this.should_force_event_defaults&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation))return e.stopPropagation()},x.prototype._get_active_combos=function(e){var t,n;return t=[],n=s(this._keys_down,function(t){return t!==e}),n.push(e),this._match_combo_arrays(n,function(e){return function(n){if(e._cmd_bug_check(n.keys))return t.push(n)}}(this)),this._fuzzy_match_combo_arrays(n,function(e){return function(n){if(!(0<=k.call(t,n))&&!n.is_solitary&&e._cmd_bug_check(n.keys))return t.push(n)}}(this)),t},x.prototype._get_potential_combos=function(e){var t,n,r,i,o;for(n=[],o=this._registered_combos,r=0,i=o.length;r<i;r++)t=o[r],t.is_sequence||0<=k.call(t.keys,e)&&this._cmd_bug_check(t.keys)&&n.push(t);return n},x.prototype._add_to_active_combos=function(e){var t,n,r,i,o,a,s,u,l,c,d;if(a=!1,o=!0,r=!1,0<=k.call(this._active_combos,e))return!0;if(this._active_combos.length)for(i=s=0,c=this._active_combos.length;0<=c?s<c:s>c;i=0<=c?++s:--s)if((t=this._active_combos[i])&&t.is_exclusive&&e.is_exclusive){if(t=t.keys,!a)for(u=0,l=t.length;u<l;u++)if(n=t[u],a=!0,0>k.call(e.keys,n)){a=!1;break}if(o&&!a)for(d=e.keys,u=0,l=d.length;u<l;u++)if(n=d[u],o=!1,0>k.call(t,n)){o=!0;break}a&&(r?null!=(t=this._active_combos.splice(i,1)[0])&&t.reset():(t=this._active_combos.splice(i,1,e)[0],null!=t&&t.reset(),r=!0),o=!1)}return o&&this._active_combos.unshift(e),a||o},x.prototype._remove_from_active_combos=function(e){var t,n,r;for(t=n=0,r=this._active_combos.length;0<=r?n<r:n>r;t=0<=r?++n:--n)if(this._active_combos[t]===e){e=this._active_combos.splice(t,1)[0],e.reset();break}},x.prototype._get_possible_sequences=function(){var e,t,n,r,i,o,a,u,l,c,d,f;for(r=[],c=this._registered_combos,o=0,l=c.length;o<l;o++)for(e=c[o],t=a=1,d=this._sequence.length;1<=d?a<=d:a>=d;t=1<=d?++a:--a)if(i=this._sequence.slice(-t),e.is_sequence){if(0>k.call(e.keys,"shift")&&(i=s(i,function(e){return"shift"!==e}),!i.length))continue;for(t=u=0,f=i.length;0<=f?u<f:u>f;t=0<=f?++u:--u){if(e.keys[t]!==i[t]){n=!1;break}n=!0}n&&r.push(e)}return r},x.prototype._add_key_to_sequence=function(e,t){var n,r,i,o;if(this._sequence.push(e),r=this._get_possible_sequences(),r.length){for(i=0,o=r.length;i<o;i++)n=r[i],this._prevent_default(t,n.prevent_default);if(this._sequence_timer&&clearTimeout(this._sequence_timer),-1<this.sequence_delay){var a=this;this._sequence_timer=setTimeout(function(){return a._sequence=[]},this.sequence_delay)}}else this._sequence=[]},x.prototype._get_sequence=function(e){var t,n,r,i,o,a,u,l,c,d,f,h;for(d=this._registered_combos,a=0,c=d.length;a<c;a++)if(t=d[a],t.is_sequence){for(n=u=1,f=this._sequence.length;1<=f?u<=f:u>=f;n=1<=f?++u:--u)if(o=s(this._sequence,function(e){return 0<=k.call(t.keys,"shift")||"shift"!==e}).slice(-n),t.keys.length===o.length)for(n=l=0,h=o.length;0<=h?l<h:l>h;n=0<=h?++l:--l)if(i=o[n],!(0>k.call(t.keys,"shift")&&"shift"===i||"shift"===e&&0>k.call(t.keys,"shift"))){if(t.keys[n]!==i){r=!1;break}r=!0}if(r)return t.is_exclusive&&(this._sequence=[]),t}return!1},x.prototype._receive_input=function(e,t){var n,r;if(this._prevent_capture)this._keys_down.length&&(this._keys_down=[]);else if(n=i(null!=(r=e.keyCode)?r:e.key),(t||this._keys_down.length||!("alt"===n||n===_))&&n)return t?this._key_down(n,e):this._key_up(n,e)},x.prototype._fire=function(e,t,n,r){if("function"==typeof t["on_"+e]&&this._prevent_default(n,!0!==t["on_"+e].call(t.this,n,t.count,r)),"release"===e&&(t.count=0),"keyup"===e)return t.keyup_fired=!0},x.prototype._match_combo_arrays=function(e,t){var i,o,a,s,u;for(u=this._registered_combos,a=0,s=u.length;a<s;a++)o=u[a],i=e.slice(0),o.normalize_caps_lock&&0<=k.call(i,"caps")&&i.splice(i.indexOf("caps"),1),(!o.is_unordered&&r(i,o.keys)||o.is_unordered&&n(i,o.keys))&&t(o)},x.prototype._fuzzy_match_combo_arrays=function(e,t){var n,r,i,o;for(o=this._registered_combos,r=0,i=o.length;r<i;r++)n=o[r],(!n.is_unordered&&c(n.keys,e)||n.is_unordered&&l(n.keys,e))&&t(n)},x.prototype._keys_remain=function(e){var t,n,r,i;for(i=e.keys,n=0,r=i.length;n<r;n++)if(e=i[n],0<=k.call(this._keys_down,e)){t=!0;break}return t},x.prototype._key_down=function(e,t){var n,r,i,a,s;(n=o(e,t))&&(e=n),this._add_key_to_sequence(e,t),(n=this._get_sequence(e))&&this._fire("keydown",n,t);for(i in y)n=y[i],t[n]&&(i===e||0<=k.call(this._keys_down,i)||this._keys_down.push(i));for(i in y)if(n=y[i],i!==e&&0<=k.call(this._keys_down,i)&&!t[n]&&!("cmd"===i&&"cmd"!==_))for(n=r=0,a=this._keys_down.length;0<=a?r<a:r>a;n=0<=a?++r:--r)this._keys_down[n]===i&&this._keys_down.splice(n,1);for(r=this._get_active_combos(e),i=this._get_potential_combos(e),a=0,s=r.length;a<s;a++)n=r[a],this._handle_combo_down(n,i,e,t);if(i.length)for(r=0,a=i.length;r<a;r++)n=i[r],this._prevent_default(t,n.prevent_default);0>k.call(this._keys_down,e)&&this._keys_down.push(e)},x.prototype._handle_combo_down=function(e,t,n,r){var i,o,a,s,u;if(0>k.call(e.keys,n))return!1;if(this._prevent_default(r,e&&e.prevent_default),i=!1,0<=k.call(this._keys_down,n)&&(i=!0,!e.allows_key_repeat()))return!1;if(a=this._add_to_active_combos(e,n),n=e.keyup_fired=!1,e.is_exclusive)for(s=0,u=t.length;s<u;s++)if(o=t[s],o.is_exclusive&&o.keys.length>e.keys.length){n=!0;break}return!n&&(e.is_counting&&"function"==typeof e.on_keydown&&(e.count+=1),a)?this._fire("keydown",e,r,i):void 0},x.prototype._key_up=function(e,t){var n,r,i,a,s,u;if(n=e,(i=o(e,t))&&(e=i),i=v[n],t.shiftKey?i&&0<=k.call(this._keys_down,i)||(e=n):n&&0<=k.call(this._keys_down,n)||(e=i),(a=this._get_sequence(e))&&this._fire("keyup",a,t),0>k.call(this._keys_down,e))return!1;for(a=s=0,u=this._keys_down.length;0<=u?s<u:s>u;a=0<=u?++s:--s)if((r=this._keys_down[a])===e||r===i||r===n){this._keys_down.splice(a,1);break}for(r=this._active_combos.length,i=[],u=this._active_combos,a=0,s=u.length;a<s;a++)n=u[a],0<=k.call(n.keys,e)&&i.push(n);for(a=0,s=i.length;a<s;a++)n=i[a],this._handle_combo_up(n,t,e);if(1<r)for(s=this._active_combos,r=0,a=s.length;r<a;r++)void 0===(n=s[r])||0<=k.call(i,n)||this._keys_remain(n)||this._remove_from_active_combos(n)},x.prototype._handle_combo_up=function(e,t,r){var i,o;this._prevent_default(t,e&&e.prevent_default),o=this._keys_remain(e),e.keyup_fired||(i=this._keys_down.slice(),i.push(r),e.is_solitary&&!n(i,e.keys))||(this._fire("keyup",e,t),e.is_counting&&"function"==typeof e.on_keyup&&"function"!=typeof e.on_keydown&&(e.count+=1)),o||(this._fire("release",e,t),this._remove_from_active_combos(e))},x.prototype.simple_combo=function(e,t){return this.register_combo({keys:e,on_keydown:t})},x.prototype.counting_combo=function(e,t){return this.register_combo({keys:e,is_counting:!0,is_unordered:!1,on_keydown:t})},x.prototype.sequence_combo=function(e,t){return this.register_combo({keys:e,on_keydown:t,is_sequence:!0,is_exclusive:!0})},x.prototype.register_combo=function(e){var t,n,r;"string"==typeof e.keys&&(e.keys=e.keys.split(" ")),r=this._defaults;for(t in r)b.call(r,t)&&(n=r[t],void 0===e[t]&&(e[t]=n));if(e=new w(e),g(e))return this._registered_combos.push(e),e},x.prototype.register_many=function(e){var t,n,r,i;for(i=[],n=0,r=e.length;n<r;n++)t=e[n],i.push(this.register_combo(t));return i},x.prototype.unregister_combo=function(e){var t,i,o,a,s,u;if(!e)return!1;var l=this;if(i=function(e){var t,n,r,i;for(i=[],t=n=0,r=l._registered_combos.length;0<=r?n<r:n>r;t=0<=r?++n:--n){if(e===l._registered_combos[t]){l._registered_combos.splice(t,1);break}i.push(void 0)}return i},e instanceof w)return i(e);for("string"==typeof e&&(e=e.split(" ")),s=this._registered_combos,u=[],o=0,a=s.length;o<a;o++)null!=(t=s[o])&&(t.is_unordered&&n(e,t.keys)||!t.is_unordered&&r(e,t.keys)?u.push(i(t)):u.push(void 0));return u},x.prototype.unregister_many=function(e){var t,n,r,i;for(i=[],n=0,r=e.length;n<r;n++)t=e[n],i.push(this.unregister_combo(t));return i},x.prototype.get_registered_combos=function(){return this._registered_combos},x.prototype.reset=function(){return this._registered_combos=[]},x.prototype.listen=function(){return this._prevent_capture=!1},x.prototype.stop_listening=function(){return this._prevent_capture=!0},x.prototype.get_meta_key=function(){return _},e.Listener=x,i=function(e){return h[e]},s=function(e,t){var n;if(e.filter)return e.filter(t);var r,i,o;for(o=[],r=0,i=e.length;r<i;r++)n=e[r],t(n)&&o.push(n);return o},n=function(e,t){var n,r,i;if(e.length!==t.length)return!1;for(r=0,i=e.length;r<i;r++)if(n=e[r],!(0<=k.call(t,n)))return!1;return!0},r=function(e,t){var n,r,i;if(e.length!==t.length)return!1;for(n=r=0,i=e.length;0<=i?r<i:r>i;n=0<=i?++r:--r)if(e[n]!==t[n])return!1;return!0},l=function(e,t){var n,r,i;for(r=0,i=e.length;r<i;r++)if(n=e[r],0>k.call(t,n))return!1;return!0},u=Array.prototype.indexOf||function(e,t){var n,r,i;for(n=r=0,i=e.length;0<=i?r<=i:r>=i;n=0<=i?++r:--r)if(e[n]===t)return n;return-1},c=function(e,t){var n,r,i,o;for(i=r=0,o=e.length;i<o;i++){if(n=e[i],!((n=u.call(t,n))>=r))return!1;r=n}return!0},p=function(){if(e.debug)return console.log.apply(console,arguments)},d=function(e){var t,n,r;t=!1;for(r in h)if(n=h[r],e===n){t=!0;break}if(!t)for(r in v)if(n=v[r],e===n){t=!0;break}return t},g=function(e){var t,n,r,i,o,s,l;for(o=!0,e.keys.length||p("You're trying to bind a combo with no keys:",e),n=s=0,l=e.keys.length;0<=l?s<l:s>l;n=0<=l?++s:--s)r=e.keys[n],(t=f[r])&&(r=e.keys[n]=t),"meta"===r&&e.keys.splice(n,1,_),"cmd"===r&&p('Warning: use the "meta" key rather than "cmd" for Windows compatibility');for(l=e.keys,t=0,s=l.length;t<s;t++)r=l[t],d(r)||(p('Do not recognize the key "'+r+'"'),o=!1);if(0<=k.call(e.keys,"meta")||0<=k.call(e.keys,"cmd")){for(t=e.keys.slice(),s=0,l=m.length;s<l;s++)r=m[s],-1<(n=u.call(t,r))&&t.splice(n,1);1<t.length&&(p("META and CMD key combos cannot have more than 1 non-modifier keys",e,t),o=!1)}for(i in e)"undefined"===a[i]&&p("The property "+i+" is not a valid combo property. Your combo has still been registered.");return o},o=function(e,t){var n;return!!t.shiftKey&&(null!=(n=v[e])&&n)},y={cmd:"metaKey",ctrl:"ctrlKey",shift:"shiftKey",alt:"altKey"},f={escape:"esc",control:"ctrl",command:"cmd",break:"pause",windows:"cmd",option:"alt",caps_lock:"caps",apostrophe:"'",semicolon:";",tilde:"~",accent:"`",scroll_lock:"scroll",num_lock:"num"},v={"/":"?",".":">",",":"<","'":'"',";":":","[":"{","]":"}","\\":"|","`":"~","=":"+","-":"_",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")"},h={0:"\\",8:"backspace",9:"tab",12:"num",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"caps",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",44:"print",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"cmd",92:"cmd",93:"cmd",96:"num_0",97:"num_1",98:"num_2",99:"num_3",100:"num_4",101:"num_5",102:"num_6",103:"num_7",104:"num_8",105:"num_9",106:"num_multiply",107:"num_add",108:"num_enter",109:"num_subtract",110:"num_decimal",111:"num_divide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",124:"print",144:"num",145:"scroll",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",223:"`",224:"cmd",225:"alt",57392:"ctrl",63289:"num",59:";",61:"=",173:"-"},e._keycode_dictionary=h,e._is_array_in_array_sorted=c,-1!==navigator.userAgent.indexOf("Mac OS X")&&(_="cmd"),-1!==navigator.userAgent.indexOf("Opera")&&(h[17]="cmd"),null!==t?t.keypress=e:window.keypress=e}).call(this)}),Ys=function(){function e(t,n){var r=this;Wt(this,e),this.keys={},n.forEach(function(e){r.keys[e]=!1,t.register_combo({keys:e,on_keydown:function(){r.keys[e]=!0},on_keyup:function(){r.keys[e]=!1},prevent_repeat:!0})})}return Ut(e,[{key:"pressed",value:function(e){return e in this.keys&&this.keys[e]}}]),e}(),Js=function(){function e(t,n,r){Wt(this,e),this.keys=t,this.delays=[0,n,r],this.timers={}}return Ut(e,[{key:"setInitialDelay",value:function(e){this.delays[1]=e}},{key:"setDelay",value:function(e){this.delays[2]=e}},{key:"update",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;this.keys.forEach(function(i){i in t.timers||(t.timers[i]={state:0,time:0});var o=t.timers[i];if(i in n&&n[i]){var a=t.delays[o.state];o.time+=1e3*e,o.time>=a&&(o.time-=a,o.state>=1&&o.time>a&&(o.time=0),o.state=Math.min(2,o.state+1),"function"==typeof r&&r(i))}else o.state=0,o.time=0})}}]),e}(),Qs=60,Zs=250,eu=.5,tu=new $s.keypress.Listener,nu=function(){return!1},ru=!1;Ds.system(function(){function e(){var t=this;Wt(this,e),this.buttons={},this.keys=new Ys(tu,["z"]),this.undoTimer=new Js(["z"],Zs,Qs),tu.simple_combo("t",function(){Ss.send("previousLevel")}),tu.simple_combo("g",function(){Ss.send("previousLevel",!1)}),tu.simple_combo("y",function(){Ss.send("nextLevel")}),tu.simple_combo("h",function(){Ss.send("nextLevel",!1)}),tu.simple_combo("r",function(){Ss.send("restart")}),nu=function(){return t.keys.pressed("z")||t.buttons.ui_rewind.down}}return Ut(e,[{key:"getTexture",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return PIXI.utils.TextureCache[e+(t?"_down":"")+".png"]}},{key:"createButton",value:function(e,t){var n=this,r=new PIXI.Sprite(this.getTexture(e));this.buttons[e]={sprite:r,down:!1},r.buttonMode=!0,r.interactive=!0,r.anchor.set(.5),r.x=80,r.y=80;var i=function(i){return function(){n.buttons[e].down=i,r.texture=n.getTexture(e,i),i&&"function"==typeof t&&t(),ru=i}};r.on("pointerdown",i(!0)),r.on("pointerup",i(!1)),r.on("pointerupoutside",i(!1)),Rs.addChild(r)}},{key:"initialize",value:function(){this.createButton("ui_rewind"),this.createButton("ui_previous",function(){return Ss.send("previousLevel")}),this.createButton("ui_restart",function(){return Ss.send("restart")}),this.createButton("ui_next",function(){return Ss.send("nextLevel")}),this.windowResized();var e=new PIXI.Text("DEMO version from ayebear.com",{fontFamily:"Arial",fontSize:32,fill:16777215,align:"center"});e.alpha=.75,Rs.addChild(e)}},{key:"windowResized",value:function(){this.buttons.ui_previous.sprite.x=Bs.renderer.width-416,this.buttons.ui_restart.sprite.x=Bs.renderer.width-256,this.buttons.ui_next.sprite.x=Bs.renderer.width-96}},{key:"pre",value:function(e){this.undoTimer.update(e,{z:nu()},function(e){Ss.send("undo"),Ss.replace("animationTime",Qs)}),Ss.exists("windowResized")&&this.windowResized()}}]),e}()),Ds.system(function(){function e(){Wt(this,e),this.keys=new Ys(tu,["i","o"]),tu.simple_combo("u",function(){Ws.scale=eu}),tu.simple_combo("p",function(){Ws.scale=1})}return Ut(e,[{key:"initialize",value:function(){Ws.scale=eu}},{key:"pre",value:function(e){this.keys.pressed("i")&&(Ws.scale*=1+1*e),this.keys.pressed("o")&&(Ws.scale*=1-1*e)}}]),e}()),Ds.system(["inputMovement"],function(){function e(){Wt(this,e),this.currentKey=void 0,this.moveDelta={x:0,y:0},this.lastMoveDelta={x:0,y:0},this.keys={},this.touching=!1,this.id=0,this.initKeyboardInput(),this.initTouchInput()}return Ut(e,[{key:"pre",value:function(){var e=this;if(Ss.process("resetKeys",function(){e.resetKeys()}),!this.touching){var t=0;if(this.moveDelta={x:0,y:0},this.currentKey=void 0,!nu())for(var n in this.keys){var r=this.keys[n];r.down&&r.lastId>t&&(this.moveDelta.x=r.delta.x,this.moveDelta.y=r.delta.y,this.currentKey=n,t=r.lastId)}0==t&&(this.id=0)}0===this.moveDelta.x&&0===this.moveDelta.y||(this.lastMoveDelta.x=this.moveDelta.x,this.lastMoveDelta.y=this.moveDelta.y)}},{key:"every",value:function(e,t,n){var r=this;e.currentDirection.x=0,e.currentDirection.y=0;var i={};this.currentKey&&(i[this.currentKey]=!0),this.moveTimer.update(n,i,function(n){e.currentDirection.x=r.moveDelta.x,e.currentDirection.y=r.moveDelta.y,Ss.replace("animationTime",r.moveTimer.delays[2]),t.set("direction",{x:r.moveDelta.x,y:r.moveDelta.y})}),e.lastDirection.x=this.lastMoveDelta.x,e.lastDirection.y=this.lastMoveDelta.y}},{key:"makeKey",value:function(e,t){return{delta:{x:e,y:t},down:!1,lastId:0}}},{key:"resetKeys",value:function(){for(var e in this.keys)this.keys[e].down=!1}},{key:"bindKey",value:function(e){var t=this;tu.register_combo({keys:e,on_keydown:function(){t.keys[e].down=!0,t.keys[e].lastId=++t.id},on_keyup:function(){t.keys[e].down=!1},prevent_repeat:!0})}},{key:"initKeyboardInput",value:function(){var e=this;this.keys={w:this.makeKey(0,-1),a:this.makeKey(-1,0),s:this.makeKey(0,1),d:this.makeKey(1,0),up:this.makeKey(0,-1),left:this.makeKey(-1,0),down:this.makeKey(0,1),right:this.makeKey(1,0)};for(var t in this.keys)this.bindKey(t);this.moveTimer=new Js(Object.keys(this.keys),Zs,150,function(t){return e.handleMove(t)}),tu.register_combo({keys:"shift",on_keydown:function(){e.moveTimer.setDelay(Qs),Ss.replace("animationTime",Qs)},on_keyup:function(){e.moveTimer.setDelay(150),Ss.replace("animationTime",150)},prevent_repeat:!0})}},{key:"initTouchInput",value:function(){var e=this,t=[{key:"right",x:1,y:0},{key:"down",x:0,y:1},{key:"left",x:-1,y:0},{key:"up",x:0,y:-1}],n=function(n){if(!ru){var r={x:ms.gameSize.width/2,y:ms.gameSize.height/2},i=180*Math.atan2(n[1]-r.y,n[0]-r.x)/Math.PI,o=t[ht(Math.round(ht(i/90,4)),4)];e.touching=!0,e.moveDelta={x:o.x,y:o.y},e.currentKey=o.key}};Hs.attach(),Hs.on("touchBegan",function(t){n(t.touch.position),t.touch.on("moved",function(e){n(e.touch.position)}),t.touch.on("ended",function(){e.touching=!1})})}}]),e}());var iu=["data/audio.ogg","data/audio.m4a"],ou={block_activated_reversed:[0,730.8163265306123],block_activated:[2e3,730.8163265306123],block_deactivated_reversed:[4e3,901.6099773242629],block_deactivated:[6e3,901.6099773242629],block_slide_reversed:[8e3,243.80952380952436],block_slide:[1e4,243.80952380952436],build_bridge_reversed:[12e3,458.8888888888896],build_bridge:[14e3,458.8888888888896],"player_walk_floor.0":[16e3,201.72335600906877],"player_walk_floor.1":[18e3,174.14965986394648],"player_walk_floor.2":[2e4,204.62585034013614],"player_walk_floor.3":[22e3,193.01587301587375],"player_walk_floor.4":[24e3,184.30839002267518],"player_walk_floor.5":[26e3,206.07709750566983],"player_walk_floor.6":[28e3,184.30839002267518],"player_walk_floor.7":[3e4,142.94784580498998],"player_walk_floor_reversed.0":[32e3,201.72335600906877],"player_walk_floor_reversed.1":[34e3,174.14965986394293],"player_walk_floor_reversed.2":[36e3,204.62585034013614],"player_walk_floor_reversed.3":[38e3,193.01587301587375],"player_walk_floor_reversed.4":[4e4,184.30839002267874],"player_walk_floor_reversed.5":[42e3,206.07709750566983],"player_walk_floor_reversed.6":[44e3,184.30839002267874],"player_walk_floor_reversed.7":[46e3,142.94784580498998],"player_walk_grass.0":[48e3,247.43764172335858],"player_walk_grass.1":[5e4,246.71201814059174],"player_walk_grass.2":[52e3,208.9795918367372],"player_walk_grass.3":[54e3,240.18140589569015],"player_walk_grass.4":[56e3,235.8276643990962],"player_walk_grass.5":[58e3,219.86394557823274],"player_walk_grass.6":[6e4,240.18140589569015],"player_walk_grass.7":[62e3,224.94331065759354],"player_walk_grass_reversed.0":[64e3,247.43764172335148],"player_walk_grass_reversed.1":[66e3,246.71201814058463],"player_walk_grass_reversed.2":[68e3,208.9795918367372],"player_walk_grass_reversed.3":[7e4,240.18140589569725],"player_walk_grass_reversed.4":[72e3,235.8276643990962],"player_walk_grass_reversed.5":[74e3,219.86394557822564],"player_walk_grass_reversed.6":[76e3,240.18140589569725],"player_walk_grass_reversed.7":[78e3,224.94331065759354],"player_walk_water.0":[8e4,175.60090702947662],"player_walk_water.1":[82e3,238.00453514739672],"player_walk_water.2":[84e3,233.65079365079566],"player_walk_water.3":[86e3,354.1043083900206],"player_walk_water.4":[88e3,171.24716553287556],"player_walk_water.5":[9e4,127.34693877551706],"player_walk_water.6":[92e3,130.61224489796075],"player_walk_water.7":[94e3,157.46031746031974],"player_walk_water_reversed.0":[96e3,175.60090702947662],"player_walk_water_reversed.1":[98e3,238.00453514739672],"player_walk_water_reversed.2":[1e5,233.65079365079566],"player_walk_water_reversed.3":[102e3,354.1043083900206],"player_walk_water_reversed.4":[104e3,171.24716553287556],"player_walk_water_reversed.5":[106e3,127.34693877551706],"player_walk_water_reversed.6":[108e3,130.61224489796075],"player_walk_water_reversed.7":[11e4,157.46031746031974],portal_active_reversed:[112e3,4736.870748299324],portal_active:[118e3,4736.870748299324]},au={src:iu,sprite:ou},su=r(function(e,t){!function(){var e=function(){this.init()};e.prototype={init:function(){var e=this||n;return e._counter=1e3,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.mobileAutoEnable=!0,e._setup(),e},volume:function(e){var t=this||n;if(e=parseFloat(e),t.ctx||c(),void 0!==e&&e>=0&&e<=1){if(t._volume=e,t._muted)return t;t.usingWebAudio&&(t.masterGain.gain.value=e);for(var r=0;r<t._howls.length;r++)if(!t._howls[r]._webAudio)for(var i=t._howls[r]._getSoundIds(),o=0;o<i.length;o++){var a=t._howls[r]._soundById(i[o]);a&&a._node&&(a._node.volume=a._volume*e)}return t}return t._volume},mute:function(e){var t=this||n;t.ctx||c(),t._muted=e,t.usingWebAudio&&(t.masterGain.gain.value=e?0:t._volume);for(var r=0;r<t._howls.length;r++)if(!t._howls[r]._webAudio)for(var i=t._howls[r]._getSoundIds(),o=0;o<i.length;o++){var a=t._howls[r]._soundById(i[o]);a&&a._node&&(a._node.muted=!!e||a._muted)}return t},unload:function(){for(var e=this||n,t=e._howls.length-1;t>=0;t--)e._howls[t].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,c()),e},codecs:function(e){return(this||n)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||n;if(e.state=e.ctx?e.ctx.state||"running":"running",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{var t=new Audio;void 0===t.oncanplaythrough&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{var t=new Audio;t.muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||n,t=null;try{t="undefined"!=typeof Audio?new Audio:null}catch(t){return e}if(!t||"function"!=typeof t.canPlayType)return e;var r=t.canPlayType("audio/mpeg;").replace(/^no$/,""),i=e._navigator&&e._navigator.userAgent.match(/OPR\/([0-6].)/g),o=i&&parseInt(i[0].split("/")[1],10)<33;return e._codecs={mp3:!(o||!r&&!t.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!r,opus:!!t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!t.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!t.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!t.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),dolby:!!t.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(t.canPlayType("audio/x-flac;")||t.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_enableMobileAudio:function(){var e=this||n,t=/iPhone|iPad|iPod|Android|BlackBerry|BB10|Silk|Mobi/i.test(e._navigator&&e._navigator.userAgent),r=!!("ontouchend"in window||e._navigator&&e._navigator.maxTouchPoints>0||e._navigator&&e._navigator.msMaxTouchPoints>0);if(!e._mobileEnabled&&e.ctx&&(t||r)){e._mobileEnabled=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var i=function t(){n._autoResume();var r=e.ctx.createBufferSource();r.buffer=e._scratchBuffer,r.connect(e.ctx.destination),
void 0===r.start?r.noteOn(0):r.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),r.onended=function(){r.disconnect(0),e._mobileEnabled=!0,e.mobileAutoEnable=!1,document.removeEventListener("touchstart",t,!0),document.removeEventListener("touchend",t,!0)}};return document.addEventListener("touchstart",i,!0),document.addEventListener("touchend",i,!0),e}},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&n.usingWebAudio){for(var t=0;t<e._howls.length;t++)if(e._howls[t]._webAudio)for(var r=0;r<e._howls[t]._sounds.length;r++)if(!e._howls[t]._sounds[r]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout(function(){e.autoSuspend&&(e._suspendTimer=null,e.state="suspending",e.ctx.suspend().then(function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())}))},3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&n.usingWebAudio)return"running"===e.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state?(e.ctx.resume().then(function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")}),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var n=new e,r=function(e){var t=this;if(!e.src||0===e.src.length)return void console.error("An array of source files must be passed with any new Howl.");t.init(e)};r.prototype={init:function(e){var t=this;return n.ctx||c(),t._autoplay=e.autoplay||!1,t._format="string"!=typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!=typeof e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!=typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._xhrWithCredentials=e.xhrWithCredentials||!1,t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._onresume=[],t._webAudio=n.usingWebAudio&&!t._html5,void 0!==n.ctx&&n.ctx&&n.mobileAutoEnable&&n._enableMobileAudio(),n._howls.push(t),t._autoplay&&t._queue.push({event:"play",action:function(){t.play()}}),t._preload&&t.load(),t},load:function(){var e=this,t=null;if(n.noAudio)return void e._emit("loaderror",null,"No audio support.");"string"==typeof e._src&&(e._src=[e._src]);for(var r=0;r<e._src.length;r++){var o,s;if(e._format&&e._format[r])o=e._format[r];else{if("string"!=typeof(s=e._src[r])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}o=/^data:audio\/([^;,]+);/i.exec(s),o||(o=/\.([^.]+)$/.exec(s.split("?",1)[0])),o&&(o=o[1].toLowerCase())}if(o||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),o&&n.codecs(o)){t=e._src[r];break}}return t?(e._src=t,e._state="loading","https:"===window.location.protocol&&"http:"===t.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new i(e),e._webAudio&&a(e),e):void e._emit("loaderror",null,"No codec support for selected audio sources.")},play:function(e,t){var r=this,i=null;if("number"==typeof e)i=e,e=null;else{if("string"==typeof e&&"loaded"===r._state&&!r._sprite[e])return null;if(void 0===e){e="__default";for(var o=0,a=0;a<r._sounds.length;a++)r._sounds[a]._paused&&!r._sounds[a]._ended&&(o++,i=r._sounds[a]._id);1===o?e=null:i=null}}var s=i?r._soundById(i):r._inactiveSound();if(!s)return null;if(i&&!e&&(e=s._sprite||"__default"),"loaded"!==r._state){s._sprite=e,s._ended=!1;var u=s._id;return r._queue.push({event:"play",action:function(){r.play(u)}}),u}if(i&&!s._paused)return t||setTimeout(function(){r._emit("play",s._id)},0),s._id;r._webAudio&&n._autoResume();var l=Math.max(0,s._seek>0?s._seek:r._sprite[e][0]/1e3),c=Math.max(0,(r._sprite[e][0]+r._sprite[e][1])/1e3-l),d=1e3*c/Math.abs(s._rate);s._paused=!1,s._ended=!1,s._sprite=e,s._seek=l,s._start=r._sprite[e][0]/1e3,s._stop=(r._sprite[e][0]+r._sprite[e][1])/1e3,s._loop=!(!s._loop&&!r._sprite[e][2]);var f=s._node;if(r._webAudio){var h=function(){r._refreshBuffer(s);var e=s._muted||r._muted?0:s._volume;f.gain.setValueAtTime(e,n.ctx.currentTime),s._playStart=n.ctx.currentTime,void 0===f.bufferSource.start?s._loop?f.bufferSource.noteGrainOn(0,l,86400):f.bufferSource.noteGrainOn(0,l,c):s._loop?f.bufferSource.start(0,l,86400):f.bufferSource.start(0,l,c),d!==1/0&&(r._endTimers[s._id]=setTimeout(r._ended.bind(r,s),d)),t||setTimeout(function(){r._emit("play",s._id)},0)};"running"===n.state?h():(r.once("resume",h),r._clearTimer(s._id))}else{var v=function(){f.currentTime=l,f.muted=s._muted||r._muted||n._muted||f.muted,f.volume=s._volume*n.volume(),f.playbackRate=s._rate;try{if(f.play(),f.paused)return void r._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices where playback was not within a user interaction.");d!==1/0&&(r._endTimers[s._id]=setTimeout(r._ended.bind(r,s),d)),t||r._emit("play",s._id)}catch(e){r._emit("playerror",s._id,e)}},p=window&&window.ejecta||!f.readyState&&n._navigator.isCocoonJS;if(4===f.readyState||p)v();else{var _=function e(){v(),f.removeEventListener(n._canPlayEvent,e,!1)};f.addEventListener(n._canPlayEvent,_,!1),r._clearTimer(s._id)}}return s._id},pause:function(e){var t=this;if("loaded"!==t._state)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var n=t._getSoundIds(e),r=0;r<n.length;r++){t._clearTimer(n[r]);var i=t._soundById(n[r]);if(i&&!i._paused&&(i._seek=t.seek(n[r]),i._rateSeek=0,i._paused=!0,t._stopFade(n[r]),i._node))if(t._webAudio){if(!i._node.bufferSource)continue;void 0===i._node.bufferSource.stop?i._node.bufferSource.noteOff(0):i._node.bufferSource.stop(0),t._cleanBuffer(i._node)}else isNaN(i._node.duration)&&i._node.duration!==1/0||i._node.pause();arguments[1]||t._emit("pause",i?i._id:null)}return t},stop:function(e,t){var n=this;if("loaded"!==n._state)return n._queue.push({event:"stop",action:function(){n.stop(e)}}),n;for(var r=n._getSoundIds(e),i=0;i<r.length;i++){n._clearTimer(r[i]);var o=n._soundById(r[i]);o&&(o._seek=o._start||0,o._rateSeek=0,o._paused=!0,o._ended=!0,n._stopFade(r[i]),o._node&&(n._webAudio?o._node.bufferSource&&(void 0===o._node.bufferSource.stop?o._node.bufferSource.noteOff(0):o._node.bufferSource.stop(0),n._cleanBuffer(o._node)):isNaN(o._node.duration)&&o._node.duration!==1/0||(o._node.currentTime=o._start||0,o._node.pause())),t||n._emit("stop",o._id))}return n},mute:function(e,t){var r=this;if("loaded"!==r._state)return r._queue.push({event:"mute",action:function(){r.mute(e,t)}}),r;if(void 0===t){if("boolean"!=typeof e)return r._muted;r._muted=e}for(var i=r._getSoundIds(t),o=0;o<i.length;o++){var a=r._soundById(i[o]);a&&(a._muted=e,r._webAudio&&a._node?a._node.gain.setValueAtTime(e?0:a._volume,n.ctx.currentTime):a._node&&(a._node.muted=!!n._muted||e),r._emit("mute",a._id))}return r},volume:function(){var e,t,r=this,i=arguments;if(0===i.length)return r._volume;if(1===i.length||2===i.length&&void 0===i[1]){r._getSoundIds().indexOf(i[0])>=0?t=parseInt(i[0],10):e=parseFloat(i[0])}else i.length>=2&&(e=parseFloat(i[0]),t=parseInt(i[1],10));var o;if(!(void 0!==e&&e>=0&&e<=1))return o=t?r._soundById(t):r._sounds[0],o?o._volume:0;if("loaded"!==r._state)return r._queue.push({event:"volume",action:function(){r.volume.apply(r,i)}}),r;void 0===t&&(r._volume=e),t=r._getSoundIds(t);for(var a=0;a<t.length;a++)(o=r._soundById(t[a]))&&(o._volume=e,i[2]||r._stopFade(t[a]),r._webAudio&&o._node&&!o._muted?o._node.gain.setValueAtTime(e,n.ctx.currentTime):o._node&&!o._muted&&(o._node.volume=e*n.volume()),r._emit("volume",o._id));return r},fade:function(e,t,r,i){var o=this;if("loaded"!==o._state)return o._queue.push({event:"fade",action:function(){o.fade(e,t,r,i)}}),o;o.volume(e,i);for(var a=o._getSoundIds(i),s=0;s<a.length;s++){var u=o._soundById(a[s]);if(u){if(i||o._stopFade(a[s]),o._webAudio&&!u._muted){var l=n.ctx.currentTime,c=l+r/1e3;u._volume=e,u._node.gain.setValueAtTime(e,l),u._node.gain.linearRampToValueAtTime(t,c)}o._startFadeInterval(u,e,t,r,a[s])}}return o},_startFadeInterval:function(e,t,n,r,i){var o=this,a=t,s=t>n?"out":"in",u=Math.abs(t-n),l=u/.01,c=l>0?r/l:r;c<4&&(l=Math.ceil(l/(4/c)),c=4),e._interval=setInterval(function(){l>0&&(a+="in"===s?.01:-.01),a=Math.max(0,a),a=Math.min(1,a),a=Math.round(100*a)/100,o._webAudio?(void 0===i&&(o._volume=a),e._volume=a):o.volume(a,e._id,!0),(n<t&&a<=n||n>t&&a>=n)&&(clearInterval(e._interval),e._interval=null,o.volume(n,e._id),o._emit("fade",e._id))},c)},_stopFade:function(e){var t=this,r=t._soundById(e);return r&&r._interval&&(t._webAudio&&r._node.gain.cancelScheduledValues(n.ctx.currentTime),clearInterval(r._interval),r._interval=null,t._emit("fade",e)),t},loop:function(){var e,t,n,r=this,i=arguments;if(0===i.length)return r._loop;if(1===i.length){if("boolean"!=typeof i[0])return!!(n=r._soundById(parseInt(i[0],10)))&&n._loop;e=i[0],r._loop=e}else 2===i.length&&(e=i[0],t=parseInt(i[1],10));for(var o=r._getSoundIds(t),a=0;a<o.length;a++)(n=r._soundById(o[a]))&&(n._loop=e,r._webAudio&&n._node&&n._node.bufferSource&&(n._node.bufferSource.loop=e,e&&(n._node.bufferSource.loopStart=n._start||0,n._node.bufferSource.loopEnd=n._stop)));return r},rate:function(){var e,t,r=this,i=arguments;if(0===i.length)t=r._sounds[0]._id;else if(1===i.length){var o=r._getSoundIds(),a=o.indexOf(i[0]);a>=0?t=parseInt(i[0],10):e=parseFloat(i[0])}else 2===i.length&&(e=parseFloat(i[0]),t=parseInt(i[1],10));var s;if("number"!=typeof e)return s=r._soundById(t),s?s._rate:r._rate;if("loaded"!==r._state)return r._queue.push({event:"rate",action:function(){r.rate.apply(r,i)}}),r;void 0===t&&(r._rate=e),t=r._getSoundIds(t);for(var u=0;u<t.length;u++)if(s=r._soundById(t[u])){s._rateSeek=r.seek(t[u]),s._playStart=r._webAudio?n.ctx.currentTime:s._playStart,s._rate=e,r._webAudio&&s._node&&s._node.bufferSource?s._node.bufferSource.playbackRate.value=e:s._node&&(s._node.playbackRate=e);var l=r.seek(t[u]),c=(r._sprite[s._sprite][0]+r._sprite[s._sprite][1])/1e3-l,d=1e3*c/Math.abs(s._rate);!r._endTimers[t[u]]&&s._paused||(r._clearTimer(t[u]),r._endTimers[t[u]]=setTimeout(r._ended.bind(r,s),d)),r._emit("rate",s._id)}return r},seek:function(){var e,t,r=this,i=arguments;if(0===i.length)t=r._sounds[0]._id;else if(1===i.length){var o=r._getSoundIds(),a=o.indexOf(i[0]);a>=0?t=parseInt(i[0],10):r._sounds.length&&(t=r._sounds[0]._id,e=parseFloat(i[0]))}else 2===i.length&&(e=parseFloat(i[0]),t=parseInt(i[1],10));if(void 0===t)return r;if("loaded"!==r._state)return r._queue.push({event:"seek",action:function(){r.seek.apply(r,i)}}),r;var s=r._soundById(t);if(s){if(!("number"==typeof e&&e>=0)){if(r._webAudio){var u=r.playing(t)?n.ctx.currentTime-s._playStart:0,l=s._rateSeek?s._rateSeek-s._seek:0;return s._seek+(l+u*Math.abs(s._rate))}return s._node.currentTime}var c=r.playing(t);c&&r.pause(t,!0),s._seek=e,s._ended=!1,r._clearTimer(t),c&&r.play(t,!0),!r._webAudio&&s._node&&(s._node.currentTime=e),r._emit("seek",t)}return r},playing:function(e){var t=this;if("number"==typeof e){var n=t._soundById(e);return!!n&&!n._paused}for(var r=0;r<t._sounds.length;r++)if(!t._sounds[r]._paused)return!0;return!1},duration:function(e){var t=this,n=t._duration,r=t._soundById(e);return r&&(n=t._sprite[r._sprite][1]/1e3),n},state:function(){return this._state},unload:function(){for(var e=this,t=e._sounds,r=0;r<t.length;r++){if(t[r]._paused||e.stop(t[r]._id),!e._webAudio){/MSIE |Trident\//.test(n._navigator&&n._navigator.userAgent)||(t[r]._node.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"),t[r]._node.removeEventListener("error",t[r]._errorFn,!1),t[r]._node.removeEventListener(n._canPlayEvent,t[r]._loadFn,!1)}delete t[r]._node,e._clearTimer(t[r]._id);var i=n._howls.indexOf(e);i>=0&&n._howls.splice(i,1)}var a=!0;for(r=0;r<n._howls.length;r++)if(n._howls[r]._src===e._src){a=!1;break}return o&&a&&delete o[e._src],n.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,n,r){var i=this,o=i["_on"+e];return"function"==typeof t&&o.push(r?{id:n,fn:t,once:r}:{id:n,fn:t}),i},off:function(e,t,n){var r=this,i=r["_on"+e],o=0;if("number"==typeof t&&(n=t,t=null),t||n)for(o=0;o<i.length;o++){var a=n===i[o].id;if(t===i[o].fn&&a||!t&&a){i.splice(o,1);break}}else if(e)r["_on"+e]=[];else{var s=Object.keys(r);for(o=0;o<s.length;o++)0===s[o].indexOf("_on")&&Array.isArray(r[s[o]])&&(r[s[o]]=[])}return r},once:function(e,t,n){var r=this;return r.on(e,t,n,1),r},_emit:function(e,t,n){for(var r=this,i=r["_on"+e],o=i.length-1;o>=0;o--)i[o].id&&i[o].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,n)}.bind(r,i[o].fn),0),i[o].once&&r.off(e,i[o].fn,i[o].id));return r},_loadQueue:function(){var e=this;if(e._queue.length>0){var t=e._queue[0];e.once(t.event,function(){e._queue.shift(),e._loadQueue()}),t.action()}return e},_ended:function(e){var t=this,r=e._sprite;if(!t._webAudio&&e._node&&!e._node.paused)return setTimeout(t._ended.bind(t,e),100),t;var i=!(!e._loop&&!t._sprite[r][2]);if(t._emit("end",e._id),!t._webAudio&&i&&t.stop(e._id,!0).play(e._id),t._webAudio&&i){t._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=n.ctx.currentTime;var o=1e3*(e._stop-e._start)/Math.abs(e._rate);t._endTimers[e._id]=setTimeout(t._ended.bind(t,e),o)}return t._webAudio&&!i&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,t._clearTimer(e._id),t._cleanBuffer(e._node),n._autoSuspend()),t._webAudio||i||t.stop(e._id),t},_clearTimer:function(e){var t=this;return t._endTimers[e]&&(clearTimeout(t._endTimers[e]),delete t._endTimers[e]),t},_soundById:function(e){for(var t=this,n=0;n<t._sounds.length;n++)if(e===t._sounds[n]._id)return t._sounds[n];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new i(e)},_drain:function(){var e=this,t=e._pool,n=0,r=0;if(!(e._sounds.length<t)){for(r=0;r<e._sounds.length;r++)e._sounds[r]._ended&&n++;for(r=e._sounds.length-1;r>=0;r--){if(n<=t)return;e._sounds[r]._ended&&(e._webAudio&&e._sounds[r]._node&&e._sounds[r]._node.disconnect(0),e._sounds.splice(r,1),n--)}}},_getSoundIds:function(e){var t=this;if(void 0===e){for(var n=[],r=0;r<t._sounds.length;r++)n.push(t._sounds[r]._id);return n}return[e]},_refreshBuffer:function(e){var t=this;return e._node.bufferSource=n.ctx.createBufferSource(),e._node.bufferSource.buffer=o[t._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop),e._node.bufferSource.playbackRate.value=e._rate,t},_cleanBuffer:function(e){var t=this;if(t._scratchBuffer){e.bufferSource.onended=null,e.bufferSource.disconnect(0);try{e.bufferSource.buffer=t._scratchBuffer}catch(e){}}return e.bufferSource=null,t}};var i=function(e){this._parent=e,this.init()};i.prototype={init:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++n._counter,t._sounds.push(e),e.create(),e},create:function(){var e=this,t=e._parent,r=n._muted||e._muted||e._parent._muted?0:e._volume;return t._webAudio?(e._node=void 0===n.ctx.createGain?n.ctx.createGainNode():n.ctx.createGain(),e._node.gain.setValueAtTime(r,n.ctx.currentTime),e._node.paused=!0,e._node.connect(n.masterGain)):(e._node=new Audio,e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(n._canPlayEvent,e._loadFn,!1),e._node.src=t._src,e._node.preload="auto",e._node.volume=r*n.volume(),e._node.load()),e},reset:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++n._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,t=e._parent;t._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue()),e._node.removeEventListener(n._canPlayEvent,e._loadFn,!1)}};var o={},a=function(e){var t=e._src;if(o[t])return e._duration=o[t].duration,void l(e);if(/^data:[^;]+;base64,/.test(t)){for(var n=atob(t.split(",")[1]),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);u(r.buffer,e)}else{var a=new XMLHttpRequest;a.open("GET",t,!0),a.withCredentials=e._xhrWithCredentials,a.responseType="arraybuffer",a.onload=function(){var t=(a.status+"")[0];if("0"!==t&&"2"!==t&&"3"!==t)return void e._emit("loaderror",null,"Failed loading audio file with status: "+a.status+".");u(a.response,e)},a.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete o[t],e.load())},s(a)}},s=function(e){try{e.send()}catch(t){e.onerror()}},u=function(e,t){n.ctx.decodeAudioData(e,function(e){e&&t._sounds.length>0&&(o[t._src]=e,l(t,e))},function(){t._emit("loaderror",null,"Decoding audio data failed.")})},l=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},c=function(){try{"undefined"!=typeof AudioContext?n.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?n.ctx=new webkitAudioContext:n.usingWebAudio=!1}catch(e){n.usingWebAudio=!1}var e=/iP(hone|od|ad)/.test(n._navigator&&n._navigator.platform),t=n._navigator&&n._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),r=t?parseInt(t[1],10):null;if(e&&r&&r<9){var i=/safari/.test(n._navigator&&n._navigator.userAgent.toLowerCase());(n._navigator&&n._navigator.standalone&&!i||n._navigator&&!n._navigator.standalone&&!i)&&(n.usingWebAudio=!1)}n.usingWebAudio&&(n.masterGain=void 0===n.ctx.createGain?n.ctx.createGainNode():n.ctx.createGain(),n.masterGain.gain.value=n._muted?0:1,n.masterGain.connect(n.ctx.destination)),n._setup()};t.Howler=n,t.Howl=r,"undefined"!=typeof window?(window.HowlerGlobal=e,window.Howler=n,window.Howl=r,window.Sound=i):"undefined"!=typeof global&&(global.HowlerGlobal=e,global.Howler=n,global.Howl=r,global.Sound=i)}(),function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var t=this;if(!t.ctx||!t.ctx.listener)return t;for(var n=t._howls.length-1;n>=0;n--)t._howls[n].stereo(e);return t},HowlerGlobal.prototype.pos=function(e,t,n){var r=this;return r.ctx&&r.ctx.listener?(t="number"!=typeof t?r._pos[1]:t,n="number"!=typeof n?r._pos[2]:n,"number"!=typeof e?r._pos:(r._pos=[e,t,n],r.ctx.listener.setPosition(r._pos[0],r._pos[1],r._pos[2]),r)):r},HowlerGlobal.prototype.orientation=function(e,t,n,r,i,o){var a=this;if(!a.ctx||!a.ctx.listener)return a;var s=a._orientation;return t="number"!=typeof t?s[1]:t,n="number"!=typeof n?s[2]:n,r="number"!=typeof r?s[3]:r,i="number"!=typeof i?s[4]:i,o="number"!=typeof o?s[5]:o,"number"!=typeof e?s:(a._orientation=[e,t,n,r,i,o],a.ctx.listener.setOrientation(e,t,n,r,i,o),a)},Howl.prototype.init=function(e){return function(t){var n=this;return n._orientation=t.orientation||[1,0,0],n._stereo=t.stereo||null,n._pos=t.pos||null,n._pannerAttr={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:360,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:360,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:0,distanceModel:void 0!==t.distanceModel?t.distanceModel:"inverse",maxDistance:void 0!==t.maxDistance?t.maxDistance:1e4,panningModel:void 0!==t.panningModel?t.panningModel:"HRTF",refDistance:void 0!==t.refDistance?t.refDistance:1,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:1},n._onstereo=t.onstereo?[{fn:t.onstereo}]:[],n._onpos=t.onpos?[{fn:t.onpos}]:[],n._onorientation=t.onorientation?[{fn:t.onorientation}]:[],e.call(this,t)}}(Howl.prototype.init),Howl.prototype.stereo=function(t,n){var r=this;if(!r._webAudio)return r;if("loaded"!==r._state)return r._queue.push({event:"stereo",action:function(){r.stereo(t,n)}}),r;var i=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===n){if("number"!=typeof t)return r._stereo;r._stereo=t,r._pos=[t,0,0]}for(var o=r._getSoundIds(n),a=0;a<o.length;a++){var s=r._soundById(o[a]);if(s){if("number"!=typeof t)return s._stereo;s._stereo=t,s._pos=[t,0,0],s._node&&(s._pannerAttr.panningModel="equalpower",s._panner&&s._panner.pan||e(s,i),"spatial"===i?s._panner.setPosition(t,0,0):s._panner.pan.value=t),r._emit("stereo",s._id)}}return r},Howl.prototype.pos=function(t,n,r,i){var o=this;if(!o._webAudio)return o;if("loaded"!==o._state)return o._queue.push({event:"pos",action:function(){o.pos(t,n,r,i)}}),o;if(n="number"!=typeof n?0:n,r="number"!=typeof r?-.5:r,void 0===i){if("number"!=typeof t)return o._pos;o._pos=[t,n,r]}for(var a=o._getSoundIds(i),s=0;s<a.length;s++){var u=o._soundById(a[s]);if(u){if("number"!=typeof t)return u._pos;u._pos=[t,n,r],u._node&&(u._panner&&!u._panner.pan||e(u,"spatial"),u._panner.setPosition(t,n,r)),o._emit("pos",u._id)}}return o},Howl.prototype.orientation=function(t,n,r,i){var o=this;if(!o._webAudio)return o;if("loaded"!==o._state)return o._queue.push({event:"orientation",action:function(){o.orientation(t,n,r,i)}}),o;if(n="number"!=typeof n?o._orientation[1]:n,r="number"!=typeof r?o._orientation[2]:r,void 0===i){if("number"!=typeof t)return o._orientation;o._orientation=[t,n,r]}for(var a=o._getSoundIds(i),s=0;s<a.length;s++){var u=o._soundById(a[s]);if(u){if("number"!=typeof t)return u._orientation;u._orientation=[t,n,r],u._node&&(u._panner||(u._pos||(u._pos=o._pos||[0,0,-.5]),e(u,"spatial")),u._panner.setOrientation(t,n,r)),o._emit("orientation",u._id)}}return o},Howl.prototype.pannerAttr=function(){var t,n,r,i=this,o=arguments;if(!i._webAudio)return i;if(0===o.length)return i._pannerAttr;if(1===o.length){if("object"!==qt(o[0]))return r=i._soundById(parseInt(o[0],10)),r?r._pannerAttr:i._pannerAttr;t=o[0],void 0===n&&(t.pannerAttr||(t.pannerAttr={coneInnerAngle:t.coneInnerAngle,coneOuterAngle:t.coneOuterAngle,coneOuterGain:t.coneOuterGain,distanceModel:t.distanceModel,maxDistance:t.maxDistance,refDistance:t.refDistance,rolloffFactor:t.rolloffFactor,panningModel:t.panningModel}),i._pannerAttr={coneInnerAngle:void 0!==t.pannerAttr.coneInnerAngle?t.pannerAttr.coneInnerAngle:i._coneInnerAngle,coneOuterAngle:void 0!==t.pannerAttr.coneOuterAngle?t.pannerAttr.coneOuterAngle:i._coneOuterAngle,coneOuterGain:void 0!==t.pannerAttr.coneOuterGain?t.pannerAttr.coneOuterGain:i._coneOuterGain,distanceModel:void 0!==t.pannerAttr.distanceModel?t.pannerAttr.distanceModel:i._distanceModel,maxDistance:void 0!==t.pannerAttr.maxDistance?t.pannerAttr.maxDistance:i._maxDistance,refDistance:void 0!==t.pannerAttr.refDistance?t.pannerAttr.refDistance:i._refDistance,rolloffFactor:void 0!==t.pannerAttr.rolloffFactor?t.pannerAttr.rolloffFactor:i._rolloffFactor,panningModel:void 0!==t.pannerAttr.panningModel?t.pannerAttr.panningModel:i._panningModel})}else 2===o.length&&(t=o[0],n=parseInt(o[1],10));for(var a=i._getSoundIds(n),s=0;s<a.length;s++)if(r=i._soundById(a[s])){var u=r._pannerAttr;u={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:u.coneInnerAngle,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:u.coneOuterAngle,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:u.coneOuterGain,distanceModel:void 0!==t.distanceModel?t.distanceModel:u.distanceModel,maxDistance:void 0!==t.maxDistance?t.maxDistance:u.maxDistance,refDistance:void 0!==t.refDistance?t.refDistance:u.refDistance,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:u.rolloffFactor,panningModel:void 0!==t.panningModel?t.panningModel:u.panningModel};var l=r._panner;l?(l.coneInnerAngle=u.coneInnerAngle,l.coneOuterAngle=u.coneOuterAngle,l.coneOuterGain=u.coneOuterGain,l.distanceModel=u.distanceModel,l.maxDistance=u.maxDistance,l.refDistance=u.refDistance,l.rolloffFactor=u.rolloffFactor,l.panningModel=u.panningModel):(r._pos||(r._pos=i._pos||[0,0,-.5]),e(r,"spatial"))}return i},Sound.prototype.init=function(e){return function(){var t=this,n=t._parent;t._orientation=n._orientation,t._stereo=n._stereo,t._pos=n._pos,t._pannerAttr=n._pannerAttr,e.call(this),t._stereo?n.stereo(t._stereo):t._pos&&n.pos(t._pos[0],t._pos[1],t._pos[2],t._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var t=this,n=t._parent;return t._orientation=n._orientation,t._pos=n._pos,t._pannerAttr=n._pannerAttr,e.call(this)}}(Sound.prototype.reset);var e=function(e,t){t=t||"spatial","spatial"===t?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.value=e._stereo),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id)}}()}),uu=function(){function e(){Wt(this,e),this.variations=this.findVariations(au)}return Ut(e,[{key:"findVariations",value:function(){var e={};for(var t in au.sprite){var n=t.split(".");if(n.length>=2){var r=n.pop(),i=n.join(".");e[i]?e[i].push(r):e[i]=[r]}else e[t]=[]}return e}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.variations[e+(t?"_reversed":"")];if(n&&n.length>0)return mt(n)}},{key:"name",value:function(e,t){return e+(arguments.length>2&&void 0!==arguments[2]&&arguments[2]?"_reversed":"")+(t?"."+t:"")}}]),e}(),lu=function(){function e(){Wt(this,e),this.variations=new uu,this.howler=new su.Howl(au),this.queue=[],this.frameId=0}return Ut(e,[{key:"play",value:function(){++this.frameId;var e=!0,t=!1,n=void 0;try{for(var r,i=this.queue[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;o&&this.howler.play(o)}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}this.queue=[]}},{key:"add",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t=t||this.variations.get(e,n),this.queue.push(this.variations.name(e,t,n)),!n)return this.createReversedSoundCallback(e,t,this.frameId,this.queue.length-1)}},{key:"createReversedSoundCallback",value:function(e,t,n,r){var i=this;return function(){i.frameId===n?delete i.queue[r]:i.add(e,t,!0)}}}]),e}(),cu=new lu,du=function(){function e(t,n){Wt(this,e),this.entity=t,this.timeEntity=n||t,this.timeImmune=Pt(this.timeEntity)}return Ut(e,[{key:"undo",value:function(){return!this.timeImmune&&!Pt(this.timeEntity)&&!!dt(this,"rollback")}},{key:"redo",value:function(){this.timeImmune||Pt(this.timeEntity)||dt(this,"execute")}}]),e}(),fu=function(e){function t(e){Wt(this,t);var n=Kt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.entity));return n.event=e,n}return Xt(t,e),Ut(t,[{key:"invokeLogicType",value:function(e,t,n,r,i){var o=Object.assign({},this.event,{baseEntity:r}),a=new e(o);if(i)return!!t.addChild(a)||(t.rollbackLast(),!1);n.push(a)}},{key:"invokeLogicComponent",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!r||n.id!==r.id){var o=n.get("logic");if(o&&this.event.type in o){var a=o[this.event.type];if("function"==typeof a)return this.invokeLogicType(a,e,t,n,i);if(Array.isArray(a)){var s=!0,u=!1,l=void 0;try{for(var c,d=a[Symbol.iterator]();!(s=(c=d.next()).done);s=!0){var f=c.value;if(!1===this.invokeLogicType(f,e,t,n,i))return!1}}catch(e){u=!0,l=e}finally{try{!s&&d.return&&d.return()}finally{if(u)throw l}}}}}return!0}},{key:"execute",value:function(e){var t=[],n=this.event.entity;if(this.event.position){var r=Gs.getSorted(this.event.position),i=!0,o=!1,a=void 0;try{for(var s,u=r[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;this.invokeLogicComponent(e,t,l,n)}}catch(e){o=!0,a=e}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}}else this.invokeLogicComponent(e,t,this.event.entity,void 0);return t}}]),t}(du),hu=function(e){function t(e){Wt(this,t);var n=Kt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.entity));return n.event=e,n.entity=e.entity,n.direction=e.direction,n}return Xt(t,e),Ut(t,[{key:"execute",value:function(){var e=this.entity.get("position"),t=this.entity.get("direction");return this.oldPosition={x:e.x,y:e.y},t&&(this.oldDirection={x:t.x,y:t.y}),e.set(e.x+this.direction.x,e.y+this.direction.y),t&&(t.x=this.direction.x,t.y=this.direction.y,this.entity.set("toRender")),!(Gs.get(e).size<=1)&&(this.event.suppressEvents||this.event.entity.has("suppressEvents")?void 0:[new fu({type:"exit",position:this.oldPosition,newPosition:{x:e.x,y:e.y},direction:this.direction,entity:this.entity}),new fu({type:"moved",from:this.oldPosition,to:{x:e.x,y:e.y},direction:this.direction,entity:this.entity,movedBy:this.event.movedBy}),new fu({type:"enter",position:{x:e.x,y:e.y},oldPosition:this.oldPosition,direction:this.direction,entity:this.entity})])}},{key:"rollback",value:function(){var e=this.entity.get("position"),t=this.entity.get("direction");return e&&e.set(e.x-this.direction.x,e.y-this.direction.y),t&&(t.x=this.oldDirection.x,t.y=this.oldDirection.y,this.entity.set("toRender")),!0}}]),t}(du),vu=function(e){function t(e){Wt(this,t);var n=Kt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.entity=e,n}return Xt(t,e),Ut(t,[{key:"execute",value:function(){Gs.remove(this.entity),this.entity.has("sprite")&&this.entity.get("sprite").onRemove(),this.entity.detach()}},{key:"rollback",value:function(){return this.entity.attach(Ds),this.entity.has("sprite")&&this.entity.get("sprite").onCreated(),Gs.update(this.entity),!0}}]),t}(du),pu=(function(e){function t(e){Wt(this,t);var n=Kt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,void 0));return n.event=e,n}Xt(t,e),Ut(t,[{key:"execute",value:function(){var e={name:this.event.create,position:{x:this.event.at.x,y:this.event.at.y},spritePosition:qs.getVisualPosition(this.event.at),layer:5};this.entity=qs.createEntity(e,this.event.zIndex||10),Ht(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"entity",this.entity,this),dt(this.event,"thenCall",this.entity)}},{key:"rollback",value:function(){return this.entity.destroy(),!0}}])}(du),function(){function e(t){Wt(this,e),this.event=t}Ut(e,[{key:"execute",value:function(){var e=[],t=Gs.find.apply(Gs,[this.event.position,void 0].concat(Yt(this.event.has)));return t&&e.push(new vu(t)),e}}])}(),function(e){function t(e){Wt(this,t);var n=Kt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.baseEntity));return n.event=e,n}return Xt(t,e),Ut(t,[{key:"move",value:function(e){var t=new hu({entity:this.event.baseEntity,direction:this.event.direction,movedBy:this.event.entity});return t.optional=e,t}},{key:"getFutureBlockPosition",value:function(){return Gs.getWrapped({x:this.event.position.x+this.event.direction.x,y:this.event.position.y+this.event.direction.y})}},{key:"execute",value:function(){
var e=this.event.baseEntity.get("axis");if(e&&0===this.event.direction[e])return!1;var t=Gs.find(this.event.oldPosition,void 0,"terrain");if(this.event.baseEntity.has("floats")&&this.event.baseEntity.get("floats").floating){if(t&&"space"===t.get("terrain")&&!t.has("bridged")){var n=Gs.find(this.event.position,void 0,"terrain"),r=Gs.find(this.getFutureBlockPosition(),void 0,"terrain");return!(!r||"space"!==r.get("terrain")||!this.event.entity.has("pushes"))&&[new ku(n,"bridged",this.event.baseEntity)].concat(Yt(this.move()))}return!0}return!!this.event.entity.has("pushes")&&this.move(this.event.baseEntity.has("enterable"))}}]),t}(du)),_u=function(e){function t(e){Wt(this,t);var n=Kt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.baseEntity));return n.event=e,n}return Xt(t,e),Ut(t,[{key:"execute",value:function(){return new gu("block_slide",this.event.baseEntity)}}]),t}(du),yu=function(e){function t(e){Wt(this,t);var n=Kt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.baseEntity));return n.event=e,n}return Xt(t,e),Ut(t,[{key:"execute",value:function(){return this.event.baseEntity.has("floats")&&this.event.baseEntity.get("floats").floating}}]),t}(du),mu=function(e){function t(e,n,r,i,o){Wt(this,t);var a=Kt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o));return a.component=n,a.property=r,a.value=i,a.previous=r?e.get(n)[r]:e.get(n),a}return Xt(t,e),Ut(t,[{key:"execute",value:function(){this.property?this.entity.get(this.component)[this.property]=this.value:this.entity.set(this.component,this.value),Tt(this.entity)}},{key:"rollback",value:function(){return this.property?this.entity.get(this.component)[this.property]=this.previous:this.previous?this.entity.set(this.component,this.previous):this.entity.remove(this.component),Tt(this.entity),!0}}]),t}(du),gu=(function(e){function t(e,n,r){Wt(this,t);var i=Kt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));i.name=n;var o=e.get("sprite");return o&&(i.previous=o.name),i}Xt(t,e),Ut(t,[{key:"callOrGet",value:function(e){return"function"==typeof e?e(this.entity):e}},{key:"execute",value:function(){var e=this.entity.get("sprite");e&&e.set(this.callOrGet(this.name))}},{key:"rollback",value:function(){var e=this.entity.get("sprite");if(e)return e.set(this.previous)}}])}(du),function(e){function t(e){var n;Wt(this,t);for(var r=arguments.length,i=Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];var a=Kt(this,(n=t.__proto__||Object.getPrototypeOf(t)).call.apply(n,[this].concat(i)));return a.sound=e,a}return Xt(t,e),Ut(t,[{key:"execute",value:function(){this.playReversed=cu.add(this.sound)}},{key:"rollback",value:function(){return this.playReversed(),!0}}]),t}(du)),bu=function(e){function t(e,n){Wt(this,t);var r=Kt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));r.entity=e,r.component=n;for(var i=arguments.length,o=Array(i>2?i-2:0),a=2;a<i;a++)o[a-2]=arguments[a];return r.args=o,r}return Xt(t,e),Ut(t,[{key:"execute",value:function(){if(this.entity&&this.component){var e;(e=this.entity).set.apply(e,[this.component].concat(Yt(this.args))),Tt(this.entity)}}},{key:"rollback",value:function(){if(this.entity&&this.component)return this.entity.remove(this.component),Tt(this.entity),!0}}]),t}(du),ku=function(e){function t(e,n){var r;Wt(this,t);for(var i=arguments.length,o=Array(i>2?i-2:0),a=2;a<i;a++)o[a-2]=arguments[a];var s=Kt(this,(r=t.__proto__||Object.getPrototypeOf(t)).call.apply(r,[this].concat(o)));return s.entity=e,s.component=n,s}return Xt(t,e),Ut(t,[{key:"execute",value:function(){this.entity&&(this.previous=this.entity.get(this.component),this.entity.remove(this.component),Tt(this.entity))}},{key:"rollback",value:function(){if(this.entity)return this.entity.set(this.component,this.previous),Tt(this.entity),!0}}]),t}(du),wu=function(e){function t(e){return Wt(this,t),Kt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.baseEntity))}return Xt(t,e),Ut(t,[{key:"execute",value:function(){return!1}}]),t}(du);Ds.system(function(){function e(){Wt(this,e)}return Ut(e,[{key:"move",value:function(e,t,n){var r=void 0;return 0===t.x&&0===t.y||(r=Vs[n](new hu({entity:e,direction:{x:t.x,y:t.y}}))),r&&Ss.send("stateChanged",!0),r}},{key:"handleMovement",value:function(e){var t=e.get("forcedMovement"),n=e.get("inputMovement");t?e.has("tween")||(t.moving=this.move(e,t.direction,"pushToLast"),console.log("forcedMovement.moving: "+t.moving),t.moving||Vs.pushToLast(new ku(e,"forcedMovement"))):n&&this.move(e,n.currentDirection,"push")}},{key:"pre",value:function(){Ss.clear("stateChanged"),Ss.loop("loaded",function(e){Vs.reset(),Ss.send("stateChanged",!1)});var e=Ss.exists("undo");if(Ss.process("undo",function(){Vs.pop()&&Ss.send("stateChanged",!1)}),!e){var t=Ds.get("position","forcedMovement").map(function(e){return e.id}),n=Ds.get("position","inputMovement").map(function(e){return e.id}),r=new Set([].concat(Yt(t),Yt(n))),i=!0,o=!1,a=void 0;try{for(var s,u=r[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value,c=Ds.entities.get(l);c&&c.valid()&&this.handleMovement(c)}}catch(e){o=!0,a=e}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}}}}]),e}()),Ds.system(function(){function e(){Wt(this,e)}return Ut(e,[{key:"initialize",value:function(){this.indicator=new PIXI.Text(this.getText(),{fontFamily:"Arial",fontSize:64,fill:16777215}),this.indicator.alpha=.9,this.indicator.x=160,this.indicator.y=48,Rs.addChild(this.indicator)}},{key:"getText",value:function(){return"#"+(Us.currentLevel+1)+" - "+Us.solvedLevels+"/"+Us.totalLevels}},{key:"updateText",value:function(){this.indicator.text=this.getText()}},{key:"pre",value:function(){Ss.exists("loaded")&&this.updateText()}}]),e}());var xu={default:"down","0,1":"down","1,0":"right","0,-1":"up","-1,0":"left"},Au=function(e){function t(e){Wt(this,t);var n=Kt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.baseEntity));return n.event=e,n}return Xt(t,e),Ut(t,[{key:"execute",value:function(){var e=gt(Gs,this.event.to);return"stone"===e&&(e="floor"),new gu("player_walk_"+e,this.event.baseEntity)}}]),t}(du);Ds.system(function(){function e(){Wt(this,e)}return Ut(e,[{key:"initialize",value:function(){}},{key:"pre",value:function(){var e=this;Ss.process("resetPlayer",function(t){e.player&&e.player.destroy(),e.player=e.createPlayer(t.position)})}},{key:"createPlayer",value:function(e){var t=qs.getVisualPosition(e),n=Ds.entity();return n.set("player").set("inputMovement").set("position",e.x,e.y).set("sprite",Ns,"player_down",30,t).set("cameraFollows").set("pushes").set("presses").set("diesFromLasers").set("solvesLevels").set("direction",{x:0,y:1}).set("logic",{moved:Au}).set("render",Et),n}}]),e}()),Ds.system(function(){function e(){Wt(this,e)}return Ut(e,[{key:"initialize",value:function(){qs.middleware(function(e){var t=e.entity,n=e.tile;if(n.name.startsWith("color")){var r=t.get("sprite").zIndex;t.remove("sprite");var i=St(n.name.split("_")[1]);i&&t.set("applyColor",{color3:i,zIndex:r-1})}})}},{key:"pre",value:function(){Ss.exists("loaded")&&Ds.every(["position","applyColor"],function(e,t,n){var r=0;Gs.every(e,["colorable"],function(e,n){if(t.zIndex===bt(n)){n.access("color").set(e||"primary",t.color3),++r}}),1!==r&&console.warn("Applied "+r+" color changes from entity "+n.id+" at zIndex "+t.zIndex+"."),n.destroy()})}}]),e}()),Ds.system(["computeWallShape"],function(){function e(){Wt(this,e)}return Ut(e,[{key:"initialize",value:function(){var e=this;qs.register(["wall","wall_glass"],function(t,n){e.createWallEntity(t,n.name)})}},{key:"createWallEntity",value:function(e,t){e.set("wall").set("computeWallShape").set("logic",{enter:wu}),"wall"===t&&e.set("blocksLaser")}},{key:"every",value:function(e,t){var n=jt(t,"wall",[0,-1],[1,0],[0,1],[-1,0]),r=n.map(function(e,t){return e?"trbl"[t]:null}).filter(function(e){return e}).join(""),i="wall_"+(t.has("blocksLaser")?"":"glass_")+(r||"none");t.get("sprite").set(i),t.remove("computeWallShape")}}]),e}());var Su=function(e){function t(e){Wt(this,t);var n=Kt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.baseEntity));return n.event=e,n}return Xt(t,e),Ut(t,[{key:"execute",value:function(){if(this.event.entity.has("floats")&&!this.event.baseEntity.has("bridged"))return[new mu(this.event.entity,"floats","floating",!0),new mu(this.event.entity,"sprite","zIndex",18),new mu(this.event.baseEntity,"bridged",void 0,void 0,this.event.entity),new gu("build_bridge",this.event.entity)];var e=Gs.find(this.event.oldPosition,void 0,"terrain"),t=e?e.get("terrain"):"floor";return!(!this.event.baseEntity.has("bridged")||"space"===t&&!e.has("bridged"))||("space"===t&&!e.has("bridged")||this.event.entity.has("vehicle"))}}]),t}(du),Ou=function(e){function t(e){Wt(this,t);var n=Kt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.baseEntity));return n.event=e,n}return Xt(t,e),Ut(t,[{key:"execute",value:function(){return!!this.event.baseEntity.has("bridged")||"space"===gt(Gs,this.event.newPosition)}}]),t}(du),Iu=function(e){function t(e){Wt(this,t);var n=Kt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.baseEntity));return n.event=e,n}return Xt(t,e),Ut(t,[{key:"execute",value:function(){return!this.event.entity.has("player")&&(this.event.entity.has("platform")?void 0:new vu(this.event.entity))}}]),t}(du),Pu=function(e){function t(e){Wt(this,t);var n=Kt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.baseEntity));return n.event=e,n}return Xt(t,e),Ut(t,[{key:"execute",value:function(){this.event.entity.set("forcedMovement",this.event.direction)}},{key:"rollback",value:function(){return this.event.entity.remove("forcedMovement"),!0}}]),t}(du),Tu=function(e){function t(e){Wt(this,t);var n=Kt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.baseEntity));return n.event=e,n.direction=void 0,n}return Xt(t,e),Ut(t,[{key:"execute",value:function(){var e=this.event.entity.get("forcedMovement");e&&(this.direction=e.direction,this.event.entity.remove("forcedMovement"))}},{key:"rollback",value:function(){if(this.direction)return this.event.entity.set("forcedMovement",this.direction),!0}}]),t}(du);Ds.system(function(){function e(){Wt(this,e)}return Ut(e,[{key:"initialize",value:function(){qs.register(["floor"],function(e){e.set("terrain","floor")}),qs.register(["space"],function(e){e.set("terrain","space"),e.set("logic",{enter:Su,exit:Ou})}),qs.register(["lava"],function(e){e.set("terrain","lava"),e.set("logic",{enter:Iu})}),qs.register(["ice"],function(e){e.set("terrain","ice"),e.set("logic",{exit:Tu,enter:Pu})}),qs.register(["grass"],function(e){e.set("terrain","grass")})}}]),e}());var Eu=function(){function e(t){Wt(this,e),this.event=t}return Ut(e,[{key:"execute",value:function(){return!this.event.entity.has("timeImmune")&&(this.event.entity.set("timeImmune"),this.event.baseEntity.destroy(),!0)}}]),e}();Ds.system(function(){function e(){Wt(this,e)}return Ut(e,[{key:"initialize",value:function(){qs.middleware(function(e){var t=e.entity,n=e.tile;n.name.endsWith("_ti")&&(t.set("timeImmune",!0),n.name=n.name.slice(0,-"_ti".length))}),qs.register(["time_immune_changer"],function(e,t){e.set("timeImmuneChanger"),e.set("logic",{enter:Eu})})}}]),e}());var ju=["d","r","b","l","u"],Lu={d:{x:0,y:1},r:{x:1,y:0},u:{x:0,y:-1},l:{x:-1,y:0},b:{x:0,y:0}};Ds.system(function(){function e(){Wt(this,e)}return Ut(e,[{key:"initialize",value:function(){qs.register(["floor_laser"],function(e,t){e.set("floorLaser"),e.set("colorable","primary"),e.set("emitsLaser",Lu.b),e.set("color",{primary:0})}),qs.middleware(function(e){var t=e.entity,n=e.tile;if(n.name.startsWith("block_mirror_")){var r={},i=n.name.split("_").slice(2),o="b"===i[0][0];i.forEach(function(e){r[e[0]]=e[1],o||(r[e[1]]=e[0])}),t.set("block"),t.set("redirectsLaser",r),t.set("logic",{enter:pu,exit:yu}),o&&(xt(t,"block_mirror_"+i.join("_")+"_overlay"),t.set("color",{secondary:0}),t.set("absorbsLaser",{blocks:!1,direction:Lu.b}))}}),qs.register(["laser_beam_mask","laser_beam_mask_inner","laser_beam_mask_outer"],function(e,t){var n=t.name.split("_")[3];e.set("laser"),xt(e,"laser_beam_overlay"+(n?"_"+n:""))}),qs.middleware(function(e){var t=e.entity,n=e.tile;if(n.name.startsWith("block_laser_")){t.set("block"),t.set("blocksLaser"),t.set("logic",{enter:pu,exit:yu}),t.set("colorable","secondary");var r=n.name.split("_"),i=r[2];t.set("emitsLaser",Lu[i]),t.get("sprite").set("block_laser"),xt(t,n.name+"_mask"),t.set("color",{secondary:0})}})}}]),e}()),Ds.system(["block","redirectsLaser","receivingLaser","color"],function(){function e(){Wt(this,e),this.pipeline=[this.handleReceive,this.handleRedirection,this.handleDeath,this.createLaser,this.getNextPosition]}return Ut(e,[{key:"pre",value:function(){var e=this;Ss.exists("stateChanged")&&(Ds.every(["laser"],function(e,t){return t.destroy()}),Ds.every(["receivingLaser"],function(e,t){return t.set("receivingLaser")}),Ds.every(["emitsLaser","position","color"],function(t,n,r,i){var o=r.get("primary")||r.get("secondary");o&&e.emit(t,n,o,i.id)}))}},{key:"every",value:function(e,t,n,r,i){r.set("secondary",n.color3)}},{key:"emit",value:function(e,t,n,r){for(var i={x:e.x,y:e.y},o=Gs.getWrapped({x:t.x+i.x,y:t.y+i.y}),a={};o&&!0!==a.blocked&&!this.blocksLaser(o);){a={};var s=!0,u=!1,l=void 0;try{for(var c,d=this.pipeline[Symbol.iterator]();!(s=(c=d.next()).done);s=!0){if(a=(0,c.value)({position:o,direction:i,color:n,source:r,previous:a})||{},!0===a.blocked)break}}catch(e){u=!0,l=e}finally{try{!s&&d.return&&d.return()}finally{if(u)throw l}}}}},{key:"blocksLaser",value:function(e){return Gs.has(e,"blocksLaser")}},{key:"handleReceive",value:function(e){var t=e.position,n=e.color,r=e.direction,i=Gs.find(t,void 0,"absorbsLaser");if(i){var o=i.get("absorbsLaser");return(!o.direction||o.direction.x===r.x&&o.direction.y===r.y)&&i.access("receivingLaser").addColor3(n),{blocked:o.blocks}}}},{key:"handleRedirection",value:function(e){var t=e.position,n=e.direction,r={},i=Gs.find(t,void 0,"redirectsLaser");if(i){var o=i.get("redirectsLaser"),a=Lt(n),s=o[a];if(s){var u=Lu[s];n.x=u.x,n.y=u.y,r.redirected={symbol:a,redirectedSymbol:s}}else r.blocked=!0}return r}},{key:"handleDeath",value:function(e){var t=e.position,n=e.previous,r=e.direction;if(0===r.x&&0===r.y)return{blocked:!0};var i=Gs.find(t,void 0,"diesFromLasers");return i&&(Vs.pushToLast(new mu(i,"dead")),Vs.pushToLast(new ku(i,"inputMovement"))),n}},{key:"createLaser",value:function(e){var t=e.position,n=e.source,r=e.direction,i=e.color,o=e.previous,a="";if(o.redirected){var s=Lu[o.redirected.symbol];if(0===s.x&&0===s.y)return;a=Ot(s,r)?"_inner":"_outer"}var u={name:"laser_beam_mask"+a,position:t,spritePosition:qs.getVisualPosition(t),layer:5};qs.loadTile(u,50).set("laserSource",n).set("color",{primary:i}).get("sprite").sprite.rotation=Math.atan2(r.y,r.x)}},{key:"getNextPosition",value:function(e){var t=e.position,n=e.direction,r=Gs.getWrapped({x:t.x+n.x,y:t.y+n.y});if(!r)return{blocked:!0};t.x=r.x,t.y=r.y}}]),e}()),Ds.system(["receivingLaser","block","goal","color"],function(){function e(){Wt(this,e)}return Ut(e,[{key:"initialize",value:function(){qs.register(["block_goal"],function(e,t){e.set("block").set("floats").set("goal").set("colorable","primary").set("absorbsLaser",{blocks:!0}).set("logic",{enter:pu,moved:_u,exit:yu}),xt(e,"block_goal_mask"),e.set("color",{primary:0,secondary:0})})}},{key:"pre",value:function(){var e=this;Ss.exists("loaded")&&Ds.every(["block","goal","color"],function(e,t,n){t.solved=zt(n)}),this.forward=!1,Ss.loop("stateChanged",function(t){return e.forward=t})}},{key:"every",value:function(e,t,n,r,i){if(r.get("secondary")!==e.color3){var o=zt(r);r.set("secondary",e.color3),n.solved=zt(r),this.forward&&o!==n.solved&&Vs.pushToLast(new gu(n.solved?"block_activated":"block_deactivated",i))}}}]),e}());var zu=function(e){function t(e){Wt(this,t);var n=Kt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.event=e,n}return Xt(t,e),Ut(t,[{key:"adjustOffset",value:function(e){var t=this.event.baseEntity.get("axis");if(t){var n={x:this.event.direction.x,y:-this.event.direction.y};bs["offset"+t.toUpperCase()]+=e*n[t]}}},{key:"execute",value:function(){this.adjustOffset(1)}},{key:"rollback",value:function(){this.adjustOffset(-1)}}]),t}(_u);Ds.system(function(){function e(){Wt(this,e)}return Ut(e,[{key:"initialize",value:function(){var e=this;qs.middleware(function(t){var n=t.entity,r=t.tile;if(r.name.startsWith("block_offset_")){e.createOffsetBlockEntity(n);var i=r.name.split("_").slice(2),o=$t(i,1),a=o[0];n.set("axis",a)}}),this.offsetEntity=null,this.multiplier=1,qs.register(["offset_placeholder_positive","offset_placeholder_negative"],function(t,n){t.remove("sprite"),e.offsetEntity=t,e.multiplier="offset_placeholder_negative"===n.name?-1:1})}},{key:"getInitialOffset",value:function(){if(!this.offsetEntity)return{x:0,y:0};var e=ms.getZeroPosition(this.offsetEntity.get("position")),t={x:e.x*this.multiplier,y:-e.y*this.multiplier};return this.offsetEntity.destroy(),this.offsetEntity=null,t}},{key:"pre",value:function(){Ss.exists("loaded")&&(bs.offset=this.getInitialOffset())}},{key:"createOffsetBlockEntity",value:function(e){e.set("block").set("floats").set("blocksLaser").set("offsetBlock").set("toRender"),e.set("logic",{enter:pu,moved:[_u,zu],exit:yu}),e.set("render",Ct)}}]),e}());var Mu=function(e){function t(e){Wt(this,t);var n=Kt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.baseEntity));return n.event=e,n}return Xt(t,e),Ut(t,[{key:"execute",value:function(){if(this.event.entity.has("solvesLevels"))return new bu(this.event.baseEntity,"attemptSolve",this.event.entity)}}]),t}(du);Ds.system(["levelGoal"],function(){function e(){Wt(this,e)}return Ut(e,[{key:"initialize",value:function(){var e=this;this.solved=!0,qs.register(["level_goal","level_goal_solved"],function(t,n){t.set("levelGoal",e.solved).set("render",Dt).set("toRender").set("logic",{enter:Mu})})}},{key:"pre",value:function(){var e=this;this.solved=!0,Ds.every(["goal"],function(t){t.solved||(e.solved=!1)})}},{key:"every",value:function(e,t){e.completed!==this.solved&&(e.completed=this.solved,t.set("toRender"))}},{key:"post",value:function(){var e=this;Ds.every(["levelGoal","attemptSolve"],function(t,n,r){var i=!n.has("dead");if(r.remove("attemptSolve"),e.solved&&i)return setTimeout(function(){e.solved&&n&&!n.has("dead")&&Ss.send("solveLevel")},200),!1})}}]),e}()),Ds.system(function(){function e(){Wt(this,e)}return Ut(e,[{key:"pre",value:function(){cu.play()}}]),e}()),Ds.system(["sprite","position","positionChanged"],function(){function e(){Wt(this,e)}return Ut(e,[{key:"calculateStartPosition",value:function(e,t){var n=t.diff;if(t.wrapped&&(0!==n.x||0!==n.y))return qs.getVisualPosition({x:e.x-n.x,y:e.y-n.y})}},{key:"every",value:function(e,t,n,r){var i=qs.getVisualPosition(t),o=this.calculateStartPosition(t,n);r.set("tween",o,i,Ss.first("animationTime",150)),r.remove("positionChanged")}}]),e}()),Ds.system(["tween"],function(){function e(){Wt(this,e)}return Ut(e,[{key:"every",value:function(e,t,n){e.update(1e3*n)}}]),e}());Ds.system(function(){function e(){Wt(this,e)}return Ut(e,[{key:"initialize",value:function(){window.onresize=function(e){ms.bounds&&Ss.send("resizeWindow")}}},{key:"pre",value:function(){Ss.exists("loaded")&&this.scaleLevel(),Ss.clear("windowResized"),Ss.exists("resizeWindow")&&(Ss.clear("resizeWindow"),this.handleResize())}},{key:"handleResize",value:function(){ms.update(),Bs.renderer.resize(ms.gameSize.width,ms.gameSize.height),this.scaleLevel(),Ss.send("updateCamera"),Ss.send("windowResized")}},{key:"scaleLevel",value:function(){ms.update();var e=ms.levelSize,t=ms.gameSize,n=t.width/t.height,r=e.width/e.height;Ws.scale=n<r?t.width/e.width*.75:t.height/e.height*.75}}]),e}()),Ds.system(["toRender","render"],function(){function e(){Wt(this,e)}return Ut(e,[{key:"every",value:function(e,t,n){var r=t(n);if(r&&"string"==typeof r){var i=n.get("sprite");i&&i.set(r)}n.remove("toRender")}}]),e}()),Ds.system(function(){function e(){Wt(this,e)}return Ut(e,[{key:"pre",value:function(){!Ss.exists("loaded")&&this.bounds||(this.bounds=Ns.getBucket(1).getBounds()),Ss.exists("loaded")&&(Ws.fullUpdate=!0),Ws.update(this.bounds)}}]),e}()),Ds.system(["cameraFollows","sprite"],function(){function e(){Wt(this,e)}return Ut(e,[{key:"every",value:function(e,t,n){var r=t.sprite.position;Ss.exists("updateCamera")&&(e.update(),Ss.clear("updateCamera")),this.centerCamera(r,e),e.center=!1,r.x>e.deadzone.x+e.deadzone.width&&(e.deadzone.x=r.x-e.deadzone.width),r.x<e.deadzone.x&&(e.deadzone.x=r.x),r.y>e.deadzone.y+e.deadzone.height&&(e.deadzone.y=r.y-e.deadzone.height),r.y<e.deadzone.y&&(e.deadzone.y=r.y),Ws.bounds&&(Fs.x=(-e.deadzone.x+e.borderSize.x+Ws.bounds.x)*Fs.scale.x,Fs.y=(-e.deadzone.y+e.borderSize.y+Ws.bounds.y)*Fs.scale.y)}},{key:"centerCamera",value:function(e,t){t.deadzone.x=e.x-t.deadzone.width/2,t.deadzone.y=e.y-t.deadzone.height/2}}]),e}()),window.onload=Bt}();

!function(){"use strict";function t(t){return"function"==typeof t}function e(t){return(t.x||0)+","+(t.y||0)}function n(t){var e=t.split(",");return e.length=2,{x:parseInt(e[0])||0,y:parseInt(e[1])||0}}function i(){for(var t={},e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=!0,o=!1,s=void 0;try{for(var a,u=n[Symbol.iterator]();!(r=(a=u.next()).done);r=!0){var l=a.value;t=Object.assign(t,l)}}catch(t){o=!0,s=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw s}}return t}function r(t){t.children.sort(function(t,e){return t.zIndex=t.zIndex||0,e.zIndex=e.zIndex||0,t.zIndex-e.zIndex})}function o(t,e){if(t&&"debug"in t&&console.log("invoke("+e+"): "+t.debug),t&&"function"==typeof t[e]){for(var n,i=arguments.length,r=Array(i>2?i-2:0),o=2;o<i;o++)r[o-2]=arguments[o];return(n=t[e]).call.apply(n,[t].concat(r))}}function s(t,e){return e={exports:{}},t(e,e.exports),e.exports}function a(t){return!!(t&&t.valid()&&t.has("timeImmune"))}function u(t){return t.has("timeImmune")&&t.get("timeImmune").permanent}function l(t,e){var n=X.getVisualPosition(e);if(n.x!==t.x||n.y!==t.y)return n}function c(){var t=PIXI.loader;t.add("textures","data/textures-1.json"),t.load(h)}function h(){A.initialize(),requestAnimationFrame(f)}function f(t){D.val=(t-It)/1e3,It=t,D.total=t,A.run();var e=!1;if(Y.process("redirect",function(t){window.location=t,e=!0}),e)return!1;requestAnimationFrame(f)}var p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},d=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),y=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},m=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},g=function t(e,n,i,r){var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var s=Object.getPrototypeOf(e);null!==s&&t(s,n,i,r)}else if("value"in o&&o.writable)o.value=i;else{var a=o.set;void 0!==a&&a.call(r,i)}return i},_=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},k=function(){function t(e,n){v(this,t),this.world=e,this.id=n,this.data={},this.valid()&&this.world.index.add(this)}return d(t,[{key:"has",value:function(){for(var t=this,e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];return[].concat(n).every(function(e){return e in t.data})}},{key:"get",value:function(t){if(this.has(t))return this.data[t]}},{key:"access",value:function(t){return this.has(t)||this.set(t),this.data[t]}},{key:"set",value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return this.valid()&&t in this.world.components?this.data[t]=new(Function.prototype.bind.apply(this.world.components[t],[null].concat(n))):n.length>0?this.data[t]=n[0]:this.data[t]={},this.valid()&&this.world.index.add(this,t),this}},{key:"update",value:function(t,e){var n=this.access(t);for(var i in e)n[i]=e[i];return this}},{key:"remove",value:function(t){if(t in this.data){this.valid()&&this.world.index.remove(this,t);var e=this.data[t];"function"==typeof e.onRemove&&e.onRemove(),delete this.data[t]}return this}},{key:"removeAll",value:function(){for(var t in this.data)this.remove(t);this.data={}}},{key:"destroy",value:function(){this.removeAll(),this.valid()&&(this.world.index.remove(this),delete this.world.entities[this.id],this.id=void 0)}},{key:"valid",value:function(){return this.world&&void 0!==this.id}},{key:"toString",value:function(){return String(this.id)}},{key:"toJSON",value:function(){return JSON.stringify(this.data)}},{key:"fromJSON",value:function(t){var e=JSON.parse(t);for(var n in e){var i=this.access(n);"function"==typeof i.fromJSON?i.fromJSON(e[n]):this.update(n,e[n])}return this}},{key:"attach",value:function(t){t&&!this.valid()&&(this.world=t,this.id=this.world.idCounter++,this.world.entities[this.id]=this,this.world.index.addEntity(this))}},{key:"detach",value:function(){this.valid()&&(this.world.index.removeEntity(this),delete this.world.entities[this.id],this.id=void 0,this.world=void 0)}}]),t}(),b=k,w={Entity:b},x=function(){function t(e){v(this,t),this.clear(e)}return d(t,[{key:"clear",value:function(t){this.entities=t,this.index={}}},{key:"query",value:function(t){var e=this.hashComponents(t);return e in this.index?this.index[e].entities:this.build(e,t).entities}},{key:"hashComponents",value:function(t){return t.concat().sort().join(":")}},{key:"build",value:function(t,e){var n=new Map;for(var i in this.entities){var r=this.entities[i];r.has.apply(r,_(e))&&n.set(r.toString(),r)}return this.index[t]={components:new Set(e),entities:n}}},{key:"apply",value:function(t,e){var n=this,i=function(i){var r=n.index[i],o=t.some(function(t){return r.components.has(t)}),s=(void 0==t||0===t.length)&&0==r.components.size;(o||s)&&e(r.entities)};for(var r in this.index)i(r)}},{key:"add",value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];this.apply(n,function(e){e.set(t.toString(),t)})}},{key:"remove",value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];this.apply(n,function(e){e.delete(t.toString())})}},{key:"addEntity",value:function(t){this.add.apply(this,[t].concat(_(Object.keys(t.data))))}},{key:"removeEntity",value:function(t){this.remove.apply(this,[t].concat(_(Object.keys(t.data))))}}]),t}(),z=x,T={Index:z},I=w.Entity,E=T.Index,P=function(){function e(){v(this,e),this.systems=[],this.entities={},this.components={},this.entityTemplates={},this.idCounter=1,this.index=new E(this.entities)}return d(e,[{key:"clear",value:function(){for(var t in this.entities){var e=this.entities[t];for(var n in e.data){var i=e.data[n];"function"==typeof i.onRemove&&i.onRemove()}}this.entities={},this.index.clear(this.entities)}},{key:"component",value:function(t,e){if("function"==typeof e)return this.components[t]=e,t}},{key:"entity",value:function(t){var e=this.idCounter++,n=new I(this,e);if(t&&t in this.entityTemplates){var i=this.entityTemplates[t];for(var r in i){var o=JSON.parse(i[r]);n.update(r,o)}}return this.entities[e]=n,n}},{key:"system",value:function(e,n){if(t(n)){for(var i=arguments.length,r=Array(i>2?i-2:0),o=2;o<i;o++)r[o-2]=arguments[o];var s=new(Function.prototype.bind.apply(n,[null].concat(r)));return s.components=e,this.systems.push(s),this.systems.length-1}}},{key:"initialize",value:function(){var e=!0,n=!1,i=void 0;try{for(var r,o=this.systems[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;t(s.initialize)&&s.initialize.call(s)}}catch(t){n=!0,i=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw i}}}},{key:"run",value:function(){var e=!0,n=!1,i=void 0;try{for(var r,o=this.systems[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;t(s.pre)&&s.pre.call(s),t(s.every)&&this.every(s.components,s.every,s),t(s.post)&&s.post.call(s)}}catch(t){n=!0,i=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw i}}}},{key:"every",value:function(e,n,i){var r=this.index.query(e);if(t(n)){var o=!0,s=!1,a=void 0;try{for(var u,l=function(){var t=u.value;if(t.has.apply(t,_(e))){var r=e.map(function(e){return t.get(e)});r.push(t),void 0===i?n.apply(void 0,_(r)):n.call.apply(n,[i].concat(_(r)))}},c=r.values()[Symbol.iterator]();!(o=(u=c.next()).done);o=!0)l()}catch(t){s=!0,a=t}finally{try{!o&&c.return&&c.return()}finally{if(s)throw a}}}return r.values()}},{key:"prototype",value:function(t){var e=0;if("string"==typeof t&&(t=JSON.parse(t)),"object"===(void 0===t?"undefined":p(t)))for(var n in t){var i=t[n],r={};for(var o in i)r[o]=JSON.stringify(i[o]);this.entityTemplates[n]=r,++e}return e}}]),e}(),S=P;Math.toRadians=function(t){return t*Math.PI/180},Math.toDegrees=function(t){return 180*t/Math.PI},Array.prototype.top=function(){if(this.length>=1)return this[this.length-1]};var O=function(){function t(){v(this,t),this.clear()}return d(t,[{key:"clear",value:function(){this.index={},this.previous={}}},{key:"update",value:function(t){var n=t.get("position");if(n&&t.valid()){var i=e(n);i in this.index||(this.index[i]=new Map),this.index[i].has(t.toString())||(this.index[i].set(t.toString(),t),t.toString()in this.previous&&this.index[this.previous[t.toString()]].delete(t.toString()),this.previous[t.toString()]=i,t.set("positionChanged"))}}},{key:"get",value:function(t){var n=this.index[e(t)];return n?n:new Map}},{key:"remove",value:function(t){var n=t.get("position");if(n){var i=e(n);i in this.index&&this.index[i].delete(t.toString()),delete this.previous[t.toString()]}}},{key:"has",value:function(t){for(var e=this.get(t.get("position")),n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];var o=!0,s=!1,a=void 0;try{for(var u,l=e.values()[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var c=u.value;if(c.has.apply(c,i))return!0}}catch(t){s=!0,a=t}finally{try{!o&&l.return&&l.return()}finally{if(s)throw a}}return!1}},{key:"find",value:function(t,e){for(var n=this.get(t),i=arguments.length,r=Array(i>2?i-2:0),o=2;o<i;o++)r[o-2]=arguments[o];var s=!0,a=!1,u=void 0;try{for(var l,c=n.values()[Symbol.iterator]();!(s=(l=c.next()).done);s=!0){var h=l.value;if(h.has.apply(h,r)&&(!e||e.toString()!==h.toString()))return h}}catch(t){a=!0,u=t}finally{try{!s&&c.return&&c.return()}finally{if(a)throw u}}}}]),t}(),C=function(){function t(){v(this,t),this.loaders={}}return d(t,[{key:"setData",value:function(t){this.fullMapData=t.layers,this.options={tileSize:t.tileSize,idToName:t.idToName,nameToId:t.nameToId}}},{key:"register",value:function(t,e){var n=!0,i=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var a=o.value;a in this.loaders?this.loaders[a].push(e):this.loaders[a]=[e]}}catch(t){i=!0,r=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw r}}}},{key:"loadTiles",value:function(t){var e=this;t.puzzle||(t.puzzle={}),t.puzzle.position||(t.puzzle.position={x:128,y:128}),this.clearEntities();var n={};this.forEachTile(t.layer,function(i){var r=t.animate===!1?void 0:t.puzzle.position,o=e.createEntity(i,void 0,r);if(i.name in e.loaders){var s=!0,a=!1,u=void 0;try{for(var l,c=e.loaders[i.name][Symbol.iterator]();!(s=(l=c.next()).done);s=!0){(0,l.value)(o,i)}}catch(t){a=!0,u=t}finally{try{!s&&c.return&&c.return()}finally{if(a)throw u}}}else i.name in n?n[i.name]++:n[i.name]=1}),console.log("Tile types without registered loaders:"),console.log(n)}},{key:"forEachTile",value:function(t,e){for(var i in this.fullMapData[t]){var r=this.fullMapData[t][i],o=0,s=!0,a=!1,u=void 0;try{for(var l,c=r[Symbol.iterator]();!(s=(l=c.next()).done);s=!0){var h=l.value;e({id:i,name:this.options.idToName[h],position:n(i),spritePosition:this.getVisualPosition(n(i)),layer:t,layerLevel:o}),++o}}catch(t){a=!0,u=t}finally{try{!s&&c.return&&c.return()}finally{if(a)throw u}}}}},{key:"getVisualPosition",value:function(t){return{x:t.x*this.options.tileSize.width,y:t.y*this.options.tileSize.height}}},{key:"createEntity",value:function(t,e,n){e=e||t.layerLevel+1;var i=n?this.getVisualPosition(n):t.spritePosition,r=A.entity().set("position",t.position.x,t.position.y).set("sprite",j,t.name,e,i).set("partOfLayer",t.layer);return n&&r.set("loadAnimation"),F.update(r),r}},{key:"clearEntities",value:function(){A.every(["partOfLayer"],function(t,e){F.remove(e),e.destroy()})}}]),t}(),M=s(function(t,e){var n=n||function(){var t=[];return{getAll:function(){return t},removeAll:function(){t=[]},add:function(e){t.push(e)},remove:function(e){var n=t.indexOf(e);n!==-1&&t.splice(n,1)},update:function(e,i){if(0===t.length)return!1;var r=0;for(e=void 0!==e?e:n.now();r<t.length;)t[r].update(e)||i?r++:t.splice(r,1);return!0}}}();"undefined"==typeof window&&"undefined"!=typeof process?n.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?n.now=window.performance.now.bind(window.performance):void 0!==Date.now?n.now=Date.now:n.now=function(){return(new Date).getTime()},n.Tween=function(t){var e,i=t,r={},o={},s={},a=1e3,u=0,l=!1,c=!1,h=!1,f=0,p=null,v=n.Easing.Linear.None,d=n.Interpolation.Linear,y=[],m=null,g=!1,_=null,k=null,b=null;this.to=function(t,e){return o=t,void 0!==e&&(a=e),this},this.start=function(t){n.add(this),c=!0,g=!1,p=void 0!==t?t:n.now(),p+=f;for(var e in o){if(o[e]instanceof Array){if(0===o[e].length)continue;o[e]=[i[e]].concat(o[e])}void 0!==i[e]&&(r[e]=i[e],r[e]instanceof Array==!1&&(r[e]*=1),s[e]=r[e]||0)}return this},this.stop=function(){return c?(n.remove(this),c=!1,null!==b&&b.call(i,i),this.stopChainedTweens(),this):this},this.end=function(){return this.update(p+a),this},this.stopChainedTweens=function(){for(var t=0,e=y.length;t<e;t++)y[t].stop()},this.delay=function(t){return f=t,this},this.repeat=function(t){return u=t,this},this.repeatDelay=function(t){return e=t,this},this.yoyo=function(t){return l=t,this},this.easing=function(t){return v=t,this},this.interpolation=function(t){return d=t,this},this.chain=function(){return y=arguments,this},this.onStart=function(t){return m=t,this},this.onUpdate=function(t){return _=t,this},this.onComplete=function(t){return k=t,this},this.onStop=function(t){return b=t,this},this.update=function(t){var n,c,b;if(t<p)return!0;g===!1&&(null!==m&&m.call(i,i),g=!0),c=(t-p)/a,c=c>1?1:c,b=v(c);for(n in o)if(void 0!==r[n]){var w=r[n]||0,x=o[n];x instanceof Array?i[n]=d(x,b):("string"==typeof x&&(x="+"===x.charAt(0)||"-"===x.charAt(0)?w+parseFloat(x):parseFloat(x)),"number"==typeof x&&(i[n]=w+(x-w)*b))}if(null!==_&&_.call(i,b),1===c){if(u>0){isFinite(u)&&u--;for(n in s){if("string"==typeof o[n]&&(s[n]=s[n]+parseFloat(o[n])),l){var z=s[n];s[n]=o[n],o[n]=z}r[n]=s[n]}return l&&(h=!h),p=void 0!==e?t+e:t+f,!0}null!==k&&k.call(i,i);for(var T=0,I=y.length;T<I;T++)y[T].start(p+a);return!1}return!0}},n.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2,t<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1)}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-n.Easing.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*n.Easing.Bounce.In(2*t):.5*n.Easing.Bounce.Out(2*t-1)+.5}}},n.Interpolation={Linear:function(t,e){var i=t.length-1,r=i*e,o=Math.floor(r),s=n.Interpolation.Utils.Linear;return e<0?s(t[0],t[1],r):e>1?s(t[i],t[i-1],i-r):s(t[o],t[o+1>i?i:o+1],r-o)},Bezier:function(t,e){for(var i=0,r=t.length-1,o=Math.pow,s=n.Interpolation.Utils.Bernstein,a=0;a<=r;a++)i+=o(1-e,r-a)*o(e,a)*t[a]*s(r,a);return i},CatmullRom:function(t,e){var i=t.length-1,r=i*e,o=Math.floor(r),s=n.Interpolation.Utils.CatmullRom;return t[0]===t[i]?(e<0&&(o=Math.floor(r=i*(1+e))),s(t[(o-1+i)%i],t[o],t[(o+1)%i],t[(o+2)%i],r-o)):e<0?t[0]-(s(t[0],t[0],t[1],t[1],-r)-t[0]):e>1?t[i]-(s(t[i],t[i],t[i-1],t[i-1],r-i)-t[i]):s(t[o?o-1:0],t[o],t[i<o+1?i:o+1],t[i<o+2?i:o+2],r-o)},Utils:{Linear:function(t,e,n){return(e-t)*n+t},Bernstein:function(t,e){var i=n.Interpolation.Utils.Factorial;return i(t)/i(e)/i(t-e)},Factorial:function(){var t=[1];return function(e){var n=1;if(t[e])return t[e];for(var i=e;i>1;i--)n*=i;return t[e]=n,n}}(),CatmullRom:function(t,e,n,i,r){var o=.5*(n-t),s=.5*(i-e),a=r*r;return(2*e-2*n+o+s)*(r*a)+(-3*e+3*n-2*o-s)*a+o*r+e}}},function(e){t.exports=n}(this)}),A=new S,D={val:0,total:0},L={width:window.innerWidth-4,height:window.innerHeight-4},q=new PIXI.Container,R=new PIXI.Container,j=new PIXI.Container,N=new PIXI.Container;q.addChild(R),q.addChild(j),q.addChild(N);var F=new O,X=new C,K=function(){function t(){v(this,t),this.data={}}return d(t,[{key:"exists",value:function(t){return t in this.data}},{key:"count",value:function(t){return t in this.data?this.data[t].length:0}},{key:"send",value:function(t,e){t in this.data||(this.data[t]=[]),this.data[t].push(e)}},{key:"loop",value:function(t,e){if(t in this.data){var n=this.data[t],i=!0,r=!1,o=void 0;try{for(var s,a=n[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){e(s.value)}}catch(t){r=!0,o=t}finally{try{!i&&a.return&&a.return()}finally{if(r)throw o}}}}},{key:"process",value:function(t,e){this.loop(t,e),this.clear(t)}},{key:"clear",value:function(t){delete this.data[t]}},{key:"clearAll",value:function(){this.data={}}}]),t}(),Y=new K;A.component("position",function(){function t(e,n){v(this,t),this.set(e,n)}return d(t,[{key:"set",value:function(t,e){this.x=t||0,this.y=e||0}}]),t}()),A.component("sprite",function(){function t(e,n,i,r){v(this,t),this.container=e,this.create(e,n,i,r)}return d(t,[{key:"create",value:function(t,e,n,i){this.sprite=e?new PIXI.Sprite(PIXI.utils.TextureCache[e+".png"]):new PIXI.Sprite,this.sprite.anchor.x=.5,this.sprite.anchor.y=.5,this.sprite.zIndex=n||0,i&&(this.sprite.position.x=i.x,this.sprite.position.y=i.y),this.onCreate(),r(t)}},{key:"onRemove",value:function(){this.container.removeChild(this.sprite)}},{key:"onCreate",value:function(){this.container.addChild(this.sprite)}},{key:"set",value:function(t){this.sprite.texture=PIXI.utils.TextureCache[t+".png"]}},{key:"setZIndex",value:function(t){this.sprite.zIndex=t||0,r(this.container)}}]),t}()),A.component("inputMovement",function(){function t(){v(this,t),this.currentDirection={x:0,y:0},this.lastDirection={x:0,y:0}}return t}()),A.component("forcedMovement",function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0};v(this,t),this.direction=e}return t}()),A.component("pixiStage",function(){function t(e){v(this,t),this.root=e}return t}()),A.component("cameraFollows",function(){function t(){v(this,t),this.update()}return d(t,[{key:"update",value:function(){this.center=!0;var t=q.scale.x;this.borderSize={x:L.width/t*.33,y:L.height/t*.33},this.deadzone=new PIXI.Rectangle(this.borderSize.x,this.borderSize.y,L.width/t-2*this.borderSize.x,L.height/t-2*this.borderSize.y)}}]),t}()),A.component("logicAction",function(){function t(e){v(this,t),this.action=e}return t}()),A.component("logic",function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};v(this,t);for(var n in e)this[n]=e[n]}return t}()),A.component("partOfLayer",function(){function t(e){v(this,t),this.layer=e}return t}()),A.component("puzzlePortal",function(){function t(e){v(this,t),this.puzzle=e}return t}()),A.component("puzzleGoal",function(){function t(e){v(this,t),this.completed=e||!1}return t}()),A.component("pollutionImmune",function(){function t(e){v(this,t),this.count=e||0}return t}()),A.component("hasPackage",function(){function t(e){v(this,t),this.name=e||"package"}return t}()),A.component("package",function(){function t(e){v(this,t),this.name=e||"package"}return t}()),A.component("goal",function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];v(this,t),this.solved=e}return t}()),A.component("tween",function(){function t(e,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e3;v(this,t),this.time=r,this.oldPosition=i,this.tween=new M.Tween(n).to(i,this.time).onComplete(function(){e.remove("tween")}).start()}return d(t,[{key:"update",value:function(t){t.x===this.oldPosition.x&&t.y===this.oldPosition.y||(this.oldPosition=t,this.tween.stop(),this.tween.to(t,this.time).start())}}]),t}()),A.component("attachable",function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;v(this,t),this.attached=e}return t}()),A.component("platform",function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;v(this,t),this.holding=e}return t}()),A.component("timeImmune",function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];v(this,t),this.permanent=e}return t}());var H={world:{"115,69":[83],"116,69":[97],"117,69":[97],"118,69":[97],"116,70":[97],"117,70":[97],"118,70":[97],"119,70":[83],"116,71":[97],"117,71":[97],"118,71":[97],"116,72":[97],"117,72":[97],"118,72":[97],"116,73":[97],"117,73":[97],"118,73":[97],"116,74":[97],"117,74":[97],"118,74":[97],"116,75":[97],"117,75":[97],"118,75":[97],"115,76":[83],"116,76":[97],"117,76":[97],"118,76":[97],"116,77":[97],"117,77":[97],"118,77":[97],"119,77":[83],"112,78":[91],"116,78":[97],"117,78":[97],"118,78":[97],"124,78":[88],"125,78":[125],"116,79":[129],"117,79":[97],"118,79":[129],"98,80":[111],"99,80":[63],"100,80":[63],"101,80":[63],"102,80":[63],"103,80":[63],"104,80":[63],"105,80":[63],"106,80":[63],"107,80":[63],"108,80":[63],"109,80":[63],"110,80":[63],"111,80":[63],"112,80":[63],"113,80":[63],"114,80":[63],"115,80":[63],"116,80":[73],"117,80":[73],"118,80":[73],"119,80":[94],"120,80":[94],"121,80":[94],"122,80":[94],"123,80":[94],"124,80":[94],"125,80":[94],"126,80":[94],"127,80":[94],"128,80":[94],"129,80":[94],"130,80":[94],"131,80":[94],"132,80":[94],"133,80":[94],"134,80":[94],"135,80":[94],"136,80":[94],"137,80":[94],"138,80":[94],"139,80":[94],"98,81":[111],"99,81":[63],"100,81":[63],"101,81":[63],"102,81":[63],"103,81":[63],"104,81":[111],"105,81":[63],"106,81":[63],"107,81":[63],"108,81":[63],"109,81":[63],"110,81":[63],"111,81":[63],"112,81":[63],"113,81":[63],"114,81":[63],"115,81":[63],"116,81":[73],"117,81":[73],"118,81":[73],"119,81":[73],"120,81":[73],"121,81":[73],"122,81":[73],"123,81":[73],"124,81":[73],"125,81":[73],"126,81":[73],"127,81":[73],"128,81":[73],"129,81":[73],"130,81":[73],"131,81":[73],"132,81":[73],"133,81":[73],"134,81":[73],"135,81":[73],"136,81":[73],"137,81":[73],"138,81":[73],"139,81":[73],"98,82":[111],"99,82":[63],"100,82":[63],"101,82":[63],"102,82":[63],"103,82":[63],"104,82":[111],"105,82":[63],"106,82":[63],"107,82":[63],"108,82":[63],"109,82":[63],"110,82":[111],"111,82":[63],"112,82":[63],"113,82":[63],"114,82":[63],"115,82":[63],"116,82":[73],"117,82":[73],"118,82":[73],"119,82":[94],"120,82":[94],"121,82":[94],"122,82":[94],"123,82":[73],"124,82":[94],"125,82":[94],"126,82":[94],"127,82":[94],"128,82":[94],"129,82":[94],"130,82":[94],"131,82":[94],"132,82":[94],"133,82":[94],"134,82":[94],"135,82":[94],"136,82":[94],"137,82":[73],"138,82":[73],"139,82":[73],"99,83":[83],"105,83":[83],"111,83":[83],"116,83":[73],"117,83":[73],"118,83":[73],"123,83":[83],"137,83":[73],"138,83":[73],"139,83":[73],"99,84":[126],"105,84":[126],"116,84":[73],"117,84":[73],"118,84":[73],"137,84":[73],"138,84":[73],"139,84":[73],"116,85":[73],"117,85":[73],"118,85":[73],"137,85":[73],"138,85":[73],"139,85":[73],"116,86":[73],"117,86":[73],"118,86":[73],"137,86":[73],"138,86":[73],"139,86":[73],"116,87":[73],"117,87":[73],"118,87":[73],"137,87":[73],"138,87":[73],"139,87":[73],"116,88":[73],"117,88":[73],"118,88":[73],"137,88":[73],"138,88":[73],"139,88":[73],"116,89":[73],"117,89":[73],"118,89":[73],"137,89":[73],"138,89":[73],"139,89":[73],"116,90":[73],"117,90":[73],"118,90":[73],"137,90":[73],"138,90":[73],"139,90":[73],"116,91":[73],"117,91":[73],"118,91":[73],"137,91":[73],"138,91":[73],"139,91":[73],"116,92":[73],"117,92":[73],"118,92":[73],"137,92":[73],"138,92":[73],"139,92":[73],"116,93":[73],"117,93":[73],"118,93":[73],"137,93":[73],"138,93":[73],"139,93":[73],"116,94":[73],"117,94":[73],"118,94":[73],"137,94":[73],"138,94":[73],"139,94":[73],"116,95":[73],"117,95":[73],"118,95":[73],"137,95":[73],"138,95":[73],"139,95":[73],"116,96":[73],"117,96":[73],"118,96":[73],"137,96":[73],"138,96":[73],"139,96":[73],"116,97":[73],"117,97":[73],"118,97":[73],"137,97":[73],"138,97":[73],"139,97":[73],"116,98":[73],"117,98":[73],"118,98":[73],"137,98":[73],"138,98":[73],"139,98":[73],"116,99":[73],"117,99":[73],"118,99":[73],"137,99":[73],"138,99":[73],"139,99":[73],"116,100":[73],"117,100":[73],"118,100":[73],"137,100":[73],"138,100":[73],"139,100":[73],"116,101":[73],"117,101":[73],"118,101":[73],"137,101":[73],"138,101":[73],"139,101":[73],"116,102":[73],"117,102":[73],"118,102":[73],"137,102":[73],"138,102":[73],"139,102":[73],"116,103":[73],"117,103":[73],"118,103":[73],"119,103":[83],"137,103":[73],"138,103":[73],"139,103":[73],"116,104":[73],"117,104":[73],"118,104":[73],"137,104":[73],"138,104":[73],"139,104":[73],"116,105":[73],"117,105":[73],"118,105":[73],"137,105":[73],"138,105":[73],"139,105":[73],"116,106":[73],"117,106":[73],"118,106":[73],"137,106":[73],"138,106":[73],"139,106":[73],"116,107":[73],"117,107":[73],"118,107":[73],"137,107":[73],"138,107":[73],"139,107":[73],"116,108":[73],"117,108":[73],"118,108":[73],"137,108":[73],"138,108":[73],"139,108":[73],"116,109":[73],"117,109":[73],"118,109":[73],"137,109":[73],"138,109":[73],"139,109":[73],"115,110":[83],"116,110":[73],"117,110":[73],"118,110":[73],"137,110":[73],"138,110":[73],"139,110":[73],"116,111":[73],"117,111":[73],"118,111":[73],"137,111":[73],"138,111":[73],"139,111":[73],"116,112":[73],"117,112":[73],"118,112":[73],"119,112":[83],"137,112":[73],"138,112":[73],"139,112":[73],"116,113":[73],"117,113":[73],"118,113":[73],"137,113":[73],"138,113":[73],"139,113":[73],"116,114":[73],"117,114":[73],"118,114":[73],"137,114":[73],"138,114":[73],"139,114":[73],"115,115":[83],"116,115":[73],"117,115":[73],"118,115":[73],"137,115":[73],"138,115":[73],"139,115":[73],"116,116":[125],"117,116":[125],"118,116":[125],"120,116":[88],"121,116":[88],"122,116":[88],"137,116":[73],"138,116":[73],"139,116":[73],"116,117":[73],"117,117":[73],"118,117":[73],"120,117":[88],"121,117":[88],"122,117":[88],"137,117":[73],"138,117":[73],"139,117":[73],"116,118":[73],"117,118":[73],"118,118":[73],"123,118":[83],"137,118":[73],"138,118":[73],"139,118":[73],"116,119":[73],"117,119":[73],"118,119":[73],"119,119":[73],"120,119":[73],"121,119":[73],"122,119":[73],"123,119":[73],"137,119":[73],"138,119":[73],"139,119":[73],"116,120":[73],"117,120":[73],"118,120":[73],"137,120":[73],"138,120":[73],"139,120":[73],"116,121":[73],"117,121":[73],"118,121":[73],"137,121":[73],"138,121":[73],"139,121":[73],"115,122":[83],"116,122":[73],"117,122":[73],"118,122":[73],"137,122":[73],"138,122":[73],"139,122":[73],"116,123":[73],"117,123":[73],"118,123":[73],"137,123":[73],"138,123":[73],"139,123":[73],"116,124":[73],"117,124":[73],"118,124":[73],"127,124":[88],"137,124":[73],"138,124":[73],"139,124":[73],"116,125":[73],"117,125":[73],"118,125":[73],"123,125":[83],"129,125":[83],"137,125":[73],"138,125":[73],"139,125":[73],"116,126":[73],"117,126":[73],"118,126":[73],"119,126":[73],"120,126":[73],"121,126":[73],"122,126":[73],"123,126":[73],"124,126":[73],"125,126":[73],"126,126":[73],"127,126":[73],"128,126":[73],"129,126":[73],"130,126":[73],"131,126":[73],"134,126":[73],"135,126":[73],"136,126":[73],"137,126":[73],"138,126":[73],"139,126":[73],"115,127":[83],"116,127":[73],"117,127":[73],"118,127":[73],"119,127":[73],"120,127":[73],"121,127":[73],"122,127":[73],"123,127":[73],"124,127":[73],"125,127":[73],"126,127":[73],"127,127":[73],"128,127":[73],"129,127":[73],"130,127":[73],"131,127":[73],"134,127":[73],"135,127":[61],"136,127":[73],"137,127":[73],"138,127":[73],"139,127":[73],"116,128":[73],"117,128":[73],"118,128":[73],"119,128":[73],"120,128":[73],"121,128":[73],"122,128":[73],"123,128":[73],"124,128":[73],"125,128":[73],"126,128":[73],"127,128":[73],"128,128":[73],"129,128":[73],"130,128":[73],"131,128":[73],"134,128":[73],"135,128":[73],"136,128":[73],"137,128":[73],"138,128":[73],"139,128":[73],"121,129":[83],"125,129":[95],"131,129":[95],"135,129":[73],"117,130":[88],"118,130":[88],"125,130":[95],"128,130":[113],"131,130":[95],"135,130":[73],"125,131":[95],"131,131":[95],"135,131":[83],"125,132":[95],"126,132":[95],"127,132":[95],"128,132":[95],"129,132":[95],"130,132":[95],"131,132":[95]},"lvl-115,69":{"116,69":[111],"115,68":[111],"114,69":[73],"115,70":[111],"116,70":[111],"115,69":[73,87],"114,70":[111],"113,70":[73,127],"114,71":[111],"113,71":[73,120],"114,72":[111],"113,72":[111],"112,72":[111],"112,71":[111],"111,72":[111],"111,71":[111],"110,72":[111],"110,71":[73,127],"109,72":[111],"109,71":[73,85],"108,72":[111],"108,71":[111],"108,70":[111],"109,70":[73],"108,69":[111],"109,69":[111],"110,69":[111],"111,69":[111],"110,70":[73],"111,70":[73,117],"112,70":[73],"112,69":[111],"113,69":[73],"112,68":[111],"113,68":[111],"114,68":[111],"116,68":[111]},"lvl-119,70":{"120,70":[73,117],"119,69":[111],"118,70":[111],"119,71":[73,85],"120,71":[111],"119,70":[73,87],"118,71":[111],"119,72":[111],"120,72":[111],"118,72":[111],"121,71":[111],"122,71":[111],"121,70":[73],"122,70":[73],"121,69":[111],"122,69":[111],"120,69":[111],"123,69":[73,127],"122,68":[111],"123,68":[111],"124,68":[111],"124,69":[111],"125,69":[111],"124,70":[73],"125,70":[111],"123,70":[73],"124,71":[111],"125,71":[111],"123,71":[73,120],"124,72":[111],"123,72":[111],"122,72":[111],"118,69":[111]},"lvl-115,76":{"116,76":[111],"115,75":[111],"114,76":[73,117],"115,77":[73],"116,77":[111],"115,76":[73,87],"114,77":[73],"115,78":[73,85],"116,78":[111],"114,78":[73],"115,79":[111],"116,79":[111],"114,79":[111],"113,79":[111],"113,78":[73],"112,79":[111],"112,78":[73],"111,79":[111],"111,78":[73],"110,79":[111],"110,78":[73,120],"109,79":[111],"109,78":[111],"109,77":[111],"110,77":[73],"109,76":[111],"110,76":[73,120],"109,75":[111],"110,75":[111],"111,75":[111],"112,75":[111],"111,76":[73],"112,76":[73],"111,77":[111],"112,77":[111],"113,77":[111],"113,76":[73,117,128],"113,75":[73],"114,75":[73],"113,74":[111],"114,74":[111],"112,74":[111],"115,74":[111],"116,75":[111]},"lvl-119,77":{"120,77":[73],"119,76":[73],"118,77":[111],"119,78":[111],"120,78":[111],"119,77":[73,87],"118,78":[111],"121,78":[111],"122,78":[111],"121,77":[73],"122,77":[73,120,128],"121,76":[73],"122,76":[73],"121,75":[111],"120,76":[73,117],"120,75":[73],"120,74":[111],"119,75":[73,120],"119,74":[111],"118,75":[111],"118,74":[111],"118,76":[111],"121,74":[111],"122,74":[111],"123,74":[111],"122,75":[73,85],"123,75":[111],"123,76":[111],"123,77":[111],"123,78":[111]},"lvl-99,83":{
"100,83":[63],"98,83":[63],"99,84":[63],"100,84":[63],"99,83":[63,87],"98,84":[63]},"lvl-105,83":{"106,83":[63],"104,83":[63],"105,84":[63],"106,84":[63],"105,83":[63,87],"104,84":[63]},"lvl-111,83":{"112,83":[111],"111,82":[111],"110,83":[111],"111,84":[63],"112,84":[63],"111,83":[63,87],"110,84":[63],"111,85":[63],"112,85":[63],"110,85":[63],"111,86":[63],"112,86":[63],"110,86":[63],"111,87":[111],"112,87":[63],"110,87":[63,85],"111,88":[111],"112,88":[111],"110,88":[111],"109,88":[111],"109,87":[111],"109,86":[111],"109,85":[111],"109,84":[111],"109,83":[111],"109,82":[111],"110,82":[111],"113,88":[111],"114,88":[111],"113,87":[63,120],"114,87":[63],"113,86":[63],"114,86":[63],"113,85":[63],"114,85":[63],"113,84":[63,117],"114,84":[63],"113,83":[63],"114,83":[63],"113,82":[111],"114,82":[111],"112,82":[111],"115,82":[111],"115,83":[111],"115,84":[111],"115,85":[111],"115,86":[111],"115,87":[111],"115,88":[111]},"lvl-123,83":{"124,83":[97],"123,82":[111],"122,83":[111],"123,84":[97],"124,84":[97,118],"123,83":[97,87],"122,84":[111],"123,85":[97,117],"124,85":[111],"122,85":[97],"123,86":[97],"124,86":[97,118],"122,86":[97],"123,87":[111],"124,87":[94],"122,87":[94],"123,88":[94],"124,88":[94],"122,88":[94],"123,89":[111],"124,89":[111],"122,89":[94,120],"123,90":[111],"122,90":[111],"121,90":[111],"121,89":[111],"121,88":[111],"121,87":[111],"121,86":[111],"121,85":[111],"121,84":[111],"125,89":[111],"125,88":[111],"125,87":[111],"126,87":[111],"125,86":[97],"126,86":[111],"125,85":[97],"126,85":[111],"125,84":[97],"126,84":[111],"125,83":[97,85],"126,83":[111],"125,82":[111],"126,82":[111],"124,82":[111],"122,82":[111]},"lvl-119,103":{"120,103":[73,117],"119,102":[73],"118,103":[111],"119,104":[73],"120,104":[73],"119,103":[73,87],"118,104":[111],"119,105":[94,85],"120,105":[94],"118,105":[111],"119,106":[111],"120,106":[111],"118,106":[111],"121,106":[111],"122,106":[111],"121,105":[94],"122,105":[94],"121,104":[97],"122,104":[97],"121,103":[97,118],"122,103":[97],"121,102":[97,118],"122,102":[97],"121,101":[73],"120,102":[73],"120,101":[73],"120,100":[111],"119,101":[73],"119,100":[111],"118,101":[111],"118,100":[111],"118,102":[111],"121,100":[111],"122,100":[111],"123,100":[111],"122,101":[73],"123,101":[111],"124,101":[111],"123,102":[94],"124,102":[94],"123,103":[94],"124,103":[94,120],"123,104":[94],"124,104":[94],"123,105":[94],"124,105":[94],"123,106":[111],"124,106":[111],"125,106":[111],"126,106":[111],"125,105":[94],"126,105":[111],"125,104":[94],"126,104":[111],"125,103":[94],"126,103":[111],"125,102":[94],"126,102":[111],"125,101":[111],"126,101":[111]},"lvl-115,110":{"116,110":[111],"115,109":[111],"114,110":[94,118],"115,111":[111],"116,111":[111],"115,110":[73,87],"114,111":[111],"113,111":[111],"113,110":[73],"112,111":[111],"112,110":[94,85],"111,111":[111],"111,110":[73,120],"110,111":[111],"110,110":[111],"110,109":[111],"111,109":[94],"110,108":[111],"111,108":[94],"110,107":[111],"111,107":[94],"110,106":[111],"111,106":[94],"110,105":[111],"111,105":[111],"112,105":[111],"113,105":[111],"112,106":[94],"113,106":[111],"112,107":[94],"113,107":[94,118],"112,108":[111],"113,108":[97,117],"112,109":[94],"113,109":[94],"114,109":[94],"114,108":[94],"115,108":[111],"114,107":[94],"115,107":[111],"114,106":[111],"115,106":[111],"116,109":[111]},"lvl-119,112":{"120,112":[97],"119,111":[97],"118,112":[111],"119,113":[111],"120,113":[111],"119,112":[97,87],"118,113":[111],"121,113":[111],"122,113":[111],"121,112":[97],"122,112":[97],"121,111":[97],"122,111":[97,118],"121,110":[97],"120,111":[97,117],"120,110":[111],"120,109":[111],"119,110":[111],"118,110":[111],"118,111":[111],"121,109":[111],"122,109":[111],"123,109":[94,120],"122,108":[111],"122,110":[97],"123,110":[97],"124,110":[97],"123,111":[97],"124,111":[94],"123,112":[97],"124,112":[97,85],"123,113":[111],"124,113":[111],"125,113":[111],"125,112":[111],"125,111":[111],"125,110":[111],"125,109":[111],"124,109":[111],"124,108":[111],"123,108":[111]},"lvl-115,115":{"116,115":[111],"115,114":[97],"114,115":[97,118],"115,116":[97],"116,116":[111],"115,115":[97,87],"114,116":[97],"115,117":[111],"116,117":[111],"114,117":[111],"113,117":[111],"113,116":[97],"112,117":[111],"112,116":[94],"111,117":[111],"111,116":[94],"110,117":[111],"110,116":[111],"110,115":[111],"111,115":[94],"110,114":[111],"111,114":[97,85],"110,113":[111],"111,113":[111],"112,113":[111],"113,113":[111],"112,114":[111],"113,114":[97],"112,115":[94],"113,115":[97],"114,114":[97],"114,113":[111],"115,113":[111],"116,113":[111],"116,114":[111]},"lvl-123,118":{"124,118":[73],"123,117":[73],"122,118":[111],"123,119":[111],"124,119":[111],"123,118":[73,87],"122,119":[111],"125,119":[111],"126,119":[111],"125,118":[73,117],"126,118":[73,117],"125,117":[73,117],"126,117":[73,117],"125,116":[111],"124,117":[73],"124,116":[73],"124,115":[111],"123,116":[73],"123,115":[111],"122,116":[111],"122,115":[111],"122,117":[111],"125,115":[111],"126,116":[111],"127,116":[111],"128,116":[111],"127,117":[73,117],"128,117":[73],"127,118":[73,117],"128,118":[73,120],"127,119":[111],"128,119":[111],"129,119":[111],"130,119":[111],"129,118":[73,85],"130,118":[111],"129,117":[111],"130,117":[111],"129,116":[111]},"lvl-115,122":{"116,122":[111],"115,121":[73,85],"114,122":[73,117],"115,123":[111],"116,123":[111],"115,122":[73,87],"114,123":[111],"113,123":[111],"113,122":[73],"112,123":[73],"113,124":[111],"112,124":[111],"111,124":[111],"111,123":[73],"110,124":[111],"110,123":[111],"110,122":[111],"111,122":[73],"110,121":[111],"111,121":[73,120],"110,120":[111],"111,120":[111],"112,120":[73],"111,119":[111],"112,119":[111],"113,119":[111],"114,119":[111],"113,120":[73],"114,120":[73],"113,121":[73,117],"114,121":[111],"112,121":[73,117],"112,122":[73],"115,120":[73],"116,120":[111],"115,119":[111],"116,119":[111],"116,121":[111]},"lvl-123,125":{"124,125":[73],"123,124":[73],"122,125":[73,120],"123,126":[111],"124,126":[111],"123,125":[73,87],"122,126":[111],"121,126":[111],"121,125":[111],"121,124":[111],"122,124":[111],"122,123":[111],"123,123":[73],"122,122":[111],"123,122":[73,85],"122,121":[111],"123,121":[111],"124,121":[111],"125,121":[111],"124,122":[73],"125,122":[73],"124,123":[111],"125,123":[73],"124,124":[73,117],"125,124":[73],"126,124":[111],"125,125":[73],"126,125":[111],"125,126":[111],"126,126":[111],"126,123":[111],"126,122":[111],"126,121":[111]},"lvl-129,125":{"130,125":[73],"129,124":[111],"128,125":[111],"129,126":[111],"130,126":[111],"129,125":[73,87],"128,126":[111],"131,126":[111],"132,126":[111],"131,125":[73],"132,125":[73,85],"131,124":[111],"132,124":[111],"131,123":[73,117],"130,124":[73],"130,123":[73,120],"130,122":[73],"129,123":[111],"129,122":[111],"129,121":[111],"130,121":[111],"131,121":[111],"132,121":[111],"131,122":[73],"132,122":[73],"133,122":[111],"132,123":[73],"133,123":[111],"133,124":[111],"133,125":[111],"133,126":[111],"133,121":[111],"128,124":[111]},"lvl-115,127":{"116,127":[111],"115,126":[111],"114,127":[73,85],"115,128":[111],"116,128":[111],"115,127":[73,87],"114,128":[73,117],"115,129":[111],"116,129":[111],"114,129":[73,120],"115,130":[73],"116,130":[111],"114,130":[73,117],"115,131":[73],"116,131":[111],"114,131":[73],"115,132":[73],"116,132":[111],"114,132":[73],"115,133":[111],"116,133":[111],"114,133":[111],"113,133":[111],"113,132":[111],"113,131":[111],"113,130":[111],"113,129":[111],"113,128":[111],"113,127":[111],"113,126":[111],"114,126":[111],"116,126":[111]},"lvl-121,129":{"122,129":[111],"121,128":[111],"120,129":[111],"121,130":[73],"122,130":[73],"121,129":[73,87],"120,130":[111],"121,131":[73],"122,131":[73,117],"120,131":[111],"121,132":[73,85],"122,132":[73],"120,132":[111],"121,133":[111],"122,133":[111],"120,133":[111],"123,133":[111],"124,133":[111],"123,132":[111],"124,132":[73],"123,131":[111],"124,131":[73],"123,130":[73,120],"124,130":[73],"123,129":[111],"124,129":[111],"125,129":[111],"126,129":[73,120],"125,128":[111],"125,130":[73],"126,130":[73],"125,131":[73,117],"126,131":[73],"125,132":[73],"126,132":[111],"125,133":[111],"126,133":[111],"127,132":[111],"127,131":[111],"127,130":[111],"127,129":[111],"127,128":[111],"126,128":[111],"120,128":[111],"122,128":[111]},"lvl-135,131":{"136,131":[73],"135,130":[111],"134,131":[73],"135,132":[73],"136,132":[97,118],"135,131":[73,87],"134,132":[73,117],"135,133":[73],"136,133":[97,118],"134,133":[73,117],"135,134":[97],"136,134":[97,118],"134,134":[97],"135,135":[97],"136,135":[97],"134,135":[97],"135,136":[97],"136,136":[97,118],"134,136":[97],"135,137":[97],"136,137":[97],"134,137":[97],"135,138":[73],"136,138":[97],"134,138":[97],"135,139":[97],"136,139":[97],"134,139":[97],"135,140":[97],"136,140":[97],"134,140":[97],"135,141":[111],"136,141":[111],"134,141":[111],"133,141":[111],"133,140":[64],"132,141":[111],"132,140":[111],"132,139":[111],"133,139":[97],"132,138":[97,118],"131,139":[111],"131,138":[97],"130,139":[111],"130,138":[97,120],"129,139":[111],"129,138":[111],"129,137":[111],"130,137":[97],"129,136":[111],"130,136":[97],"129,135":[111],"130,135":[97],"129,134":[111],"130,134":[97],"129,133":[111],"130,133":[97],"129,132":[111],"130,132":[97],"129,131":[111],"130,131":[97,85],"129,130":[111],"130,130":[111],"131,130":[111],"132,130":[111],"131,131":[97],"132,131":[97],"131,132":[97],"132,132":[97],"131,133":[97],"132,133":[97,117],"131,134":[97],"132,134":[97,117],"131,135":[97,117],"132,135":[97,117],"131,136":[97],"132,136":[97,118],"131,137":[97],"132,137":[97,118],"133,137":[97],"133,136":[97],"133,138":[97],"133,135":[97,117],"133,134":[97],"133,133":[97],"133,132":[97],"133,131":[97],"133,130":[111],"134,130":[111],"137,141":[111],"138,141":[111],"137,140":[63],"138,140":[111],"137,139":[63],"138,139":[63],"137,138":[63],"138,138":[63],"137,137":[97],"138,137":[97],"137,136":[94],"138,136":[94],"137,135":[94],"138,135":[94],"137,134":[94],"138,134":[94],"137,133":[94],"138,133":[73],"137,132":[94],"138,132":[73],"137,131":[73],"138,131":[73],"137,130":[73],"138,130":[73],"137,129":[111],"136,130":[73],"136,129":[111],"135,129":[111],"138,129":[111],"139,129":[111],"140,129":[111],"139,130":[73],"140,130":[73],"139,131":[73],"140,131":[73],"139,132":[73],"140,132":[111],"139,133":[94],"140,133":[111],"139,134":[94],"140,134":[111],"139,135":[94],"140,135":[73],"139,136":[94],"140,136":[111],"139,137":[97],"140,137":[111],"139,138":[63],"140,138":[63],"139,139":[63],"140,139":[63],"139,140":[63],"140,140":[63],"139,141":[111],"140,141":[111],"141,141":[111],"142,141":[111],"141,140":[63],"142,140":[111],"141,139":[63],"142,139":[111],"141,138":[63],"142,138":[111],"141,137":[111],"142,137":[111],"141,136":[73],"142,136":[73],"141,135":[73],"142,135":[73],"141,134":[73],"142,134":[73],"141,133":[111],"142,133":[73],"141,132":[111],"142,132":[73],"141,131":[73],"142,131":[73],"141,130":[111],"142,130":[111],"141,129":[111],"143,130":[111],"143,131":[111],"143,132":[111],"143,133":[111],"144,133":[111],"143,134":[73],"144,134":[111],"143,135":[73],"144,135":[111],"143,136":[73],"144,136":[111],"143,137":[111],"144,137":[111]}},U={width:256,height:256},W={61:"exit",63:"ice",64:"lava",73:"normal",82:"portal_solved",83:"portal_unexplored",84:"portal_unsolved",85:"puzzle_end",86:"puzzle_end_done",87:"puzzle_start",88:"sign_blocks",89:"sign_colors",90:"sign_mirrors",91:"sign_sliding",92:"switch",94:"water",95:"normal_advanced",96:"normal_cloning",97:"normal_blocks",98:"normal_colors",111:"wall",112:"sign_cloning",113:"controls",114:"button_goal",115:"parking",117:"package",118:"vehicle",119:"pollution",120:"destination_unsolved",121:"destination_solved",125:"sign_transport",126:"sign_danger",127:"time_immune_area",128:"time_immune",129:"sign_time"},V={wall:"111",sign_cloning:"112",controls:"113",button_goal:"114",parking:"115",package:"117",vehicle:"118",pollution:"119",destination_unsolved:"120",destination_solved:"121",sign_transport:"125",sign_danger:"126",time_immune_area:"127",time_immune:"128",sign_time:"129",exit:"61",ice:"63",lava:"64",normal:"73",portal_solved:"82",portal_unexplored:"83",portal_unsolved:"84",puzzle_end:"85",puzzle_end_done:"86",puzzle_start:"87",sign_blocks:"88",sign_colors:"89",sign_mirrors:"90",sign_sliding:"91",switch:"92",water:"94",normal_advanced:"95",normal_cloning:"96",normal_blocks:"97",normal_colors:"98"},B={layers:H,tileSize:U,idToName:W,nameToId:V};A.system([],function(){function t(){v(this,t)}return d(t,[{key:"initialize",value:function(){X.setData(B),Y.send("loadTiles",{layer:"world"})}},{key:"pre",value:function(){Y.clear("loaded"),Y.process("loadTiles",function(t){X.loadTiles(t),Y.send("loaded",t)})}}]),t}());var G=s(function(t){!function(e,n,i,r){function o(t,e,n){return setTimeout(c(t,n),e)}function s(t,e,n){return!!Array.isArray(t)&&(a(t,n[e],n),!0)}function a(t,e,n){var i;if(t)if(t.forEach)t.forEach(e,n);else if(t.length!==r)for(i=0;i<t.length;)e.call(n,t[i],i,t),i++;else for(i in t)t.hasOwnProperty(i)&&e.call(n,t[i],i,t)}function u(t,n,i){var r="DEPRECATED METHOD: "+n+"\n"+i+" AT \n";return function(){var n=new Error("get-stack-trace"),i=n&&n.stack?n.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=e.console&&(e.console.warn||e.console.log);return o&&o.call(e.console,r,i),t.apply(this,arguments)}}function l(t,e,n){var i,r=e.prototype;i=t.prototype=Object.create(r),i.constructor=t,i._super=r,n&&pt(i,n)}function c(t,e){return function(){return t.apply(e,arguments)}}function h(t,e){return"function"==(void 0===t?"undefined":p(t))?t.apply(e?e[0]||r:r,e):t}function f(t,e){return t===r?e:t}function v(t,e,n){a(g(e),function(e){t.addEventListener(e,n,!1)})}function d(t,e,n){a(g(e),function(e){t.removeEventListener(e,n,!1)})}function y(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function m(t,e){return t.indexOf(e)>-1}function g(t){return t.trim().split(/\s+/g)}function _(t,e,n){if(t.indexOf&&!n)return t.indexOf(e);for(var i=0;i<t.length;){if(n&&t[i][n]==e||!n&&t[i]===e)return i;i++}return-1}function k(t){return Array.prototype.slice.call(t,0)}function b(t,e,n){for(var i=[],r=[],o=0;o<t.length;){var s=e?t[o][e]:t[o];_(r,s)<0&&i.push(t[o]),r[o]=s,o++}return n&&(i=e?i.sort(function(t,n){return t[e]>n[e]}):i.sort()),i}function w(t,e){for(var n,i,o=e[0].toUpperCase()+e.slice(1),s=0;s<vt.length;){if(n=vt[s],(i=n?n+o:e)in t)return i;s++}return r}function x(){return bt++}function z(t){var n=t.ownerDocument||t;return n.defaultView||n.parentWindow||e}function T(t,e){var n=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){h(t.options.enable,[t])&&n.handler(e)},this.init()}function I(t){var e=t.options.inputClass;return new(e?e:zt?F:Tt?Y:xt?U:N)(t,E)}function E(t,e,n){var i=n.pointers.length,r=n.changedPointers.length,o=1&e&&i-r==0,s=12&e&&i-r==0;n.isFirst=!!o,n.isFinal=!!s,o&&(t.session={}),n.eventType=e,P(t,n),t.emit("hammer.input",n),t.recognize(n),t.session.prevInput=n}function P(t,e){var n=t.session,i=e.pointers,r=i.length;n.firstInput||(n.firstInput=C(e)),r>1&&!n.firstMultiple?n.firstMultiple=C(e):1===r&&(n.firstMultiple=!1);var o=n.firstInput,s=n.firstMultiple,a=s?s.center:o.center,u=e.center=M(i);e.timeStamp=gt(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=q(a,u),e.distance=L(a,u),S(n,e),e.offsetDirection=D(e.deltaX,e.deltaY);var l=A(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=l.x,e.overallVelocityY=l.y,e.overallVelocity=mt(l.x)>mt(l.y)?l.x:l.y,e.scale=s?j(s.pointers,i):1,e.rotation=s?R(s.pointers,i):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length,O(n,e);var c=t.element;y(e.srcEvent.target,c)&&(c=e.srcEvent.target),e.target=c}function S(t,e){var n=e.center,i=t.offsetDelta||{},r=t.prevDelta||{},o=t.prevInput||{};1!==e.eventType&&4!==o.eventType||(r=t.prevDelta={x:o.deltaX||0,y:o.deltaY||0},i=t.offsetDelta={x:n.x,y:n.y}),e.deltaX=r.x+(n.x-i.x),e.deltaY=r.y+(n.y-i.y)}function O(t,e){var n,i,o,s,a=t.lastInterval||e,u=e.timeStamp-a.timeStamp;if(8!=e.eventType&&(u>25||a.velocity===r)){var l=e.deltaX-a.deltaX,c=e.deltaY-a.deltaY,h=A(u,l,c);i=h.x,o=h.y,n=mt(h.x)>mt(h.y)?h.x:h.y,s=D(l,c),t.lastInterval=e}else n=a.velocity,i=a.velocityX,o=a.velocityY,s=a.direction;e.velocity=n,e.velocityX=i,e.velocityY=o,e.direction=s}function C(t){for(var e=[],n=0;n<t.pointers.length;)e[n]={clientX:yt(t.pointers[n].clientX),clientY:yt(t.pointers[n].clientY)},n++;return{timeStamp:gt(),pointers:e,center:M(e),deltaX:t.deltaX,deltaY:t.deltaY}}function M(t){var e=t.length;if(1===e)return{x:yt(t[0].clientX),y:yt(t[0].clientY)};for(var n=0,i=0,r=0;r<e;)n+=t[r].clientX,i+=t[r].clientY,r++;return{x:yt(n/e),y:yt(i/e)}}function A(t,e,n){return{x:e/t||0,y:n/t||0}}function D(t,e){return t===e?1:mt(t)>=mt(e)?t<0?2:4:e<0?8:16}function L(t,e,n){n||(n=It);var i=e[n[0]]-t[n[0]],r=e[n[1]]-t[n[1]];return Math.sqrt(i*i+r*r)}function q(t,e,n){n||(n=It);var i=e[n[0]]-t[n[0]],r=e[n[1]]-t[n[1]];return 180*Math.atan2(r,i)/Math.PI}function R(t,e){return q(e[1],e[0],Et)+q(t[1],t[0],Et)}function j(t,e){return L(e[0],e[1],Et)/L(t[0],t[1],Et)}function N(){this.evEl="mousedown",this.evWin="mousemove mouseup",this.pressed=!1,T.apply(this,arguments)}function F(){this.evEl=Ct,this.evWin=Mt,T.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function X(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,T.apply(this,arguments)}function K(t,e){var n=k(t.touches),i=k(t.changedTouches);return 12&e&&(n=b(n.concat(i),"identifier",!0)),[n,i]}function Y(){this.evTarget="touchstart touchmove touchend touchcancel",this.targetIds={},T.apply(this,arguments)}function H(t,e){var n=k(t.touches),i=this.targetIds;if(3&e&&1===n.length)return i[n[0].identifier]=!0,[n,n];var r,o,s=k(t.changedTouches),a=[],u=this.target;if(o=n.filter(function(t){return y(t.target,u)}),1===e)for(r=0;r<o.length;)i[o[r].identifier]=!0,r++;for(r=0;r<s.length;)i[s[r].identifier]&&a.push(s[r]),12&e&&delete i[s[r].identifier],r++;return a.length?[b(o.concat(a),"identifier",!0),a]:void 0}function U(){T.apply(this,arguments);var t=c(this.handler,this);this.touch=new Y(this.manager,t),this.mouse=new N(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function W(t,e){1&t?(this.primaryTouch=e.changedPointers[0].identifier,V.call(this,e)):12&t&&V.call(this,e)}function V(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var n={x:e.clientX,y:e.clientY};this.lastTouches.push(n);var i=this.lastTouches,r=function(){var t=i.indexOf(n);t>-1&&i.splice(t,1)};setTimeout(r,2500)}}function B(t){for(var e=t.srcEvent.clientX,n=t.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var r=this.lastTouches[i],o=Math.abs(e-r.x),s=Math.abs(n-r.y);if(o<=25&&s<=25)return!0}return!1}function G(t,e){this.manager=t,this.set(e)}function J(t){if(m(t,"none"))return"none";var e=m(t,"pan-x"),n=m(t,"pan-y");return e&&n?"none":e||n?e?"pan-x":"pan-y":m(t,"manipulation")?"manipulation":"auto"}function Q(){if(!qt)return!1;var t={},n=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(i){t[i]=!n||e.CSS.supports("touch-action",i)}),t}function Z(t){this.options=pt({},this.defaults,t||{}),this.id=x(),this.manager=null,this.options.enable=f(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function $(t){return 16&t?"cancel":8&t?"end":4&t?"move":2&t?"start":""}function tt(t){return 16==t?"down":8==t?"up":2==t?"left":4==t?"right":""}function et(t,e){var n=e.manager;return n?n.get(t):t}function nt(){Z.apply(this,arguments)}function it(){nt.apply(this,arguments),this.pX=null,this.pY=null}function rt(){nt.apply(this,arguments)}function ot(){Z.apply(this,arguments),this._timer=null,this._input=null}function st(){nt.apply(this,arguments)}function at(){nt.apply(this,arguments)}function ut(){Z.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function lt(t,e){return e=e||{},e.recognizers=f(e.recognizers,lt.defaults.preset),new ct(t,e)}function ct(t,e){this.options=pt({},lt.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=I(this),this.touchAction=new G(this,this.options.touchAction),ht(this,!0),a(this.options.recognizers,function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}function ht(t,e){var n=t.element;if(n.style){var i;a(t.options.cssProps,function(r,o){i=w(n.style,o),e?(t.oldCssProps[i]=n.style[i],n.style[i]=r):n.style[i]=t.oldCssProps[i]||""}),e||(t.oldCssProps={})}}function ft(t,e){var i=n.createEvent("Event");i.initEvent(t,!0,!0),i.gesture=e,e.target.dispatchEvent(i)}var pt,vt=["","webkit","Moz","MS","ms","o"],dt=n.createElement("div"),yt=Math.round,mt=Math.abs,gt=Date.now;pt="function"!=typeof Object.assign?function(t){if(t===r||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var i=arguments[n];if(i!==r&&null!==i)for(var o in i)i.hasOwnProperty(o)&&(e[o]=i[o])}return e}:Object.assign;var _t=u(function(t,e,n){for(var i=Object.keys(e),o=0;o<i.length;)(!n||n&&t[i[o]]===r)&&(t[i[o]]=e[i[o]]),o++;return t},"extend","Use `assign`."),kt=u(function(t,e){return _t(t,e,!0)},"merge","Use `assign`."),bt=1,wt=/mobile|tablet|ip(ad|hone|od)|android/i,xt="ontouchstart"in e,zt=w(e,"PointerEvent")!==r,Tt=xt&&wt.test(navigator.userAgent),It=["x","y"],Et=["clientX","clientY"];T.prototype={handler:function(){},init:function(){this.evEl&&v(this.element,this.evEl,this.domHandler),this.evTarget&&v(this.target,this.evTarget,this.domHandler),this.evWin&&v(z(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&d(this.element,this.evEl,this.domHandler),this.evTarget&&d(this.target,this.evTarget,this.domHandler),this.evWin&&d(z(this.element),this.evWin,this.domHandler)}};var Pt={mousedown:1,mousemove:2,mouseup:4};l(N,T,{handler:function(t){var e=Pt[t.type];1&e&&0===t.button&&(this.pressed=!0),2&e&&1!==t.which&&(e=4),this.pressed&&(4&e&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}});var St={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},Ot={2:"touch",3:"pen",4:"mouse",5:"kinect"},Ct="pointerdown",Mt="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Ct="MSPointerDown",Mt="MSPointerMove MSPointerUp MSPointerCancel"),l(F,T,{handler:function(t){var e=this.store,n=!1,i=t.type.toLowerCase().replace("ms",""),r=St[i],o=Ot[t.pointerType]||t.pointerType,s="touch"==o,a=_(e,t.pointerId,"pointerId");1&r&&(0===t.button||s)?a<0&&(e.push(t),a=e.length-1):12&r&&(n=!0),a<0||(e[a]=t,this.callback(this.manager,r,{pointers:e,changedPointers:[t],pointerType:o,srcEvent:t}),n&&e.splice(a,1))}});var At={touchstart:1,touchmove:2,touchend:4,touchcancel:8};l(X,T,{handler:function(t){var e=At[t.type];if(1===e&&(this.started=!0),this.started){var n=K.call(this,t,e);12&e&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:t})}}});var Dt={touchstart:1,touchmove:2,touchend:4,touchcancel:8};l(Y,T,{handler:function(t){var e=Dt[t.type],n=H.call(this,t,e);n&&this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:t})}});l(U,T,{handler:function(t,e,n){var i="touch"==n.pointerType,r="mouse"==n.pointerType;if(!(r&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(i)W.call(this,e,n);else if(r&&B.call(this,n))return;this.callback(t,e,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Lt=w(dt.style,"touchAction"),qt=Lt!==r,Rt=Q();G.prototype={set:function(t){"compute"==t&&(t=this.compute()),qt&&this.manager.element.style&&Rt[t]&&(this.manager.element.style[Lt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return a(this.manager.recognizers,function(e){h(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),J(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,n=t.offsetDirection;if(this.manager.session.prevented)return void e.preventDefault();var i=this.actions,r=m(i,"none")&&!Rt.none,o=m(i,"pan-y")&&!Rt["pan-y"],s=m(i,"pan-x")&&!Rt["pan-x"];if(r){var a=1===t.pointers.length,u=t.distance<2,l=t.deltaTime<250;if(a&&u&&l)return}return s&&o?void 0:r||o&&6&n||s&&24&n?this.preventSrc(e):void 0},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};Z.prototype={defaults:{},set:function(t){return pt(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(s(t,"recognizeWith",this))return this;var e=this.simultaneous;return t=et(t,this),e[t.id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return s(t,"dropRecognizeWith",this)?this:(t=et(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(s(t,"requireFailure",this))return this;var e=this.requireFail;return t=et(t,this),_(e,t)===-1&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(s(t,"dropRequireFailure",this))return this;t=et(t,this);var e=_(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function t(e){function t(t){n.manager.emit(t,e)}var n=this,i=this.state;i<8&&t(n.options.event+$(i)),t(n.options.event),e.additionalEvent&&t(e.additionalEvent),i>=8&&t(n.options.event+$(i))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=32},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(33&this.requireFail[t].state))return!1;t++}return!0},recognize:function(t){var e=pt({},t);if(!h(this.options.enable,[this,e]))return this.reset(),void(this.state=32);56&this.state&&(this.state=1),this.state=this.process(e),30&this.state&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},l(nt,Z,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,n=t.eventType,i=6&e,r=this.attrTest(t);return i&&(8&n||!r)?16|e:i||r?4&n?8|e:2&e?4|e:2:32}}),l(it,nt,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var t=this.options.direction,e=[];return 6&t&&e.push("pan-y"),24&t&&e.push("pan-x"),e},directionTest:function(t){var e=this.options,n=!0,i=t.distance,r=t.direction,o=t.deltaX,s=t.deltaY;return r&e.direction||(6&e.direction?(r=0===o?1:o<0?2:4,n=o!=this.pX,i=Math.abs(t.deltaX)):(r=0===s?1:s<0?8:16,n=s!=this.pY,i=Math.abs(t.deltaY))),t.direction=r,n&&i>e.threshold&&r&e.direction},attrTest:function(t){return nt.prototype.attrTest.call(this,t)&&(2&this.state||!(2&this.state)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=tt(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),l(rt,nt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||2&this.state)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),l(ot,Z,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return["auto"]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,i=t.distance<e.threshold,r=t.deltaTime>e.time;if(this._input=t,!i||!n||12&t.eventType&&!r)this.reset();else if(1&t.eventType)this.reset(),this._timer=o(function(){this.state=8,this.tryEmit()},e.time,this);else if(4&t.eventType)return 8;return 32},reset:function(){clearTimeout(this._timer)},emit:function(t){8===this.state&&(t&&4&t.eventType?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=gt(),this.manager.emit(this.options.event,this._input)))}}),l(st,nt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||2&this.state)}}),l(at,nt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return it.prototype.getTouchAction.call(this)},attrTest:function(t){var e,n=this.options.direction;return 30&n?e=t.overallVelocity:6&n?e=t.overallVelocityX:24&n&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&n&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&mt(e)>this.options.velocity&&4&t.eventType},emit:function(t){var e=tt(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),l(ut,Z,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return["manipulation"]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,i=t.distance<e.threshold,r=t.deltaTime<e.time;if(this.reset(),1&t.eventType&&0===this.count)return this.failTimeout();if(i&&r&&n){if(4!=t.eventType)return this.failTimeout();var s=!this.pTime||t.timeStamp-this.pTime<e.interval,a=!this.pCenter||L(this.pCenter,t.center)<e.posThreshold;this.pTime=t.timeStamp,this.pCenter=t.center,a&&s?this.count+=1:this.count=1,this._input=t;if(0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=o(function(){this.state=8,this.tryEmit()},e.interval,this),2):8}return 32},failTimeout:function(){return this._timer=o(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),lt.VERSION="2.0.7",lt.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[st,{enable:!1}],[rt,{enable:!1},["rotate"]],[at,{direction:6}],[it,{direction:6},["swipe"]],[ut],[ut,{event:"doubletap",taps:2},["tap"]],[ot]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};ct.prototype={set:function(t){return pt(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){this.touchAction.preventDefaults(t);var n,i=this.recognizers,r=e.curRecognizer;(!r||r&&8&r.state)&&(r=e.curRecognizer=null);for(var o=0;o<i.length;)n=i[o],2===e.stopped||r&&n!=r&&!n.canRecognizeWith(r)?n.reset():n.recognize(t),!r&&14&n.state&&(r=e.curRecognizer=n),o++}},get:function(t){if(t instanceof Z)return t;for(var e=this.recognizers,n=0;n<e.length;n++)if(e[n].options.event==t)return e[n];return null},add:function(t){if(s(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(s(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,n=_(e,t);n!==-1&&(e.splice(n,1),this.touchAction.update())}return this},on:function(t,e){if(t!==r&&e!==r){var n=this.handlers;return a(g(t),function(t){n[t]=n[t]||[],n[t].push(e)}),this}},off:function(t,e){if(t!==r){var n=this.handlers;return a(g(t),function(t){e?n[t]&&n[t].splice(_(n[t],e),1):delete n[t]}),this}},emit:function(t,e){this.options.domEvents&&ft(t,e);var n=this.handlers[t]&&this.handlers[t].slice();if(n&&n.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var i=0;i<n.length;)n[i](e),i++}},
destroy:function(){this.element&&ht(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},pt(lt,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:32,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:ct,Input:T,TouchAction:G,TouchInput:Y,MouseInput:N,PointerEventInput:F,TouchMouseInput:U,SingleTouchInput:X,Recognizer:Z,AttrRecognizer:nt,Tap:ut,Pan:it,Swipe:at,Pinch:rt,Rotate:st,Press:ot,on:v,off:d,each:a,merge:kt,extend:_t,assign:pt,inherit:l,bindFn:c,prefixed:w}),(void 0!==e?e:"undefined"!=typeof self?self:{}).Hammer=lt,"function"==typeof r&&r.amd?r(function(){return lt}):t.exports?t.exports=lt:e.Hammer=lt}(window,document,"Hammer")}),J=s(function(t,e){(function(){var t,n,i,r,o,s,a,u,l,c,h,f,p,v,d,y,m,g,_,k,b,w,x={}.hasOwnProperty,z=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};l={is_unordered:!1,is_counting:!1,is_exclusive:!1,is_solitary:!1,prevent_default:!1,prevent_repeat:!1},b=["meta","alt","option","ctrl","shift","cmd"],_="ctrl",n={},n.debug=!1,t=function(){function t(t){var e,n;for(e in t)x.call(t,e)&&(n=t[e])!==!1&&(this[e]=n);this.keys=this.keys||[],this.count=this.count||0}return t.prototype.allows_key_repeat=function(){return!this.prevent_repeat&&"function"==typeof this.on_keydown},t.prototype.reset=function(){return this.count=0,this.keyup_fired=null},t}(),n.Listener=function(){function e(t,e){var n,i,r;"undefined"!=typeof jQuery&&null!==jQuery&&t instanceof jQuery&&(1!==t.length&&g("Warning: your jQuery selector should have exactly one object."),t=t[0]),this.should_suppress_event_defaults=!1,this.should_force_event_defaults=!1,this.sequence_delay=800,this._registered_combos=[],this._keys_down=[],this._active_combos=[],this._sequence=[],this._sequence_timer=null,this._prevent_capture=!1,this._defaults=e||{};for(i in l)x.call(l,i)&&(r=l[i],this._defaults[i]=this._defaults[i]||r);this.element=t||document.body,n=function(t,e,n){return t.addEventListener?t.addEventListener(e,n):t.attachEvent&&t.attachEvent("on"+e,n),n},this.keydown_event=n(this.element,"keydown",function(t){return function(e){return e=e||window.event,t._receive_input(e,!0),t._bug_catcher(e)}}(this)),this.keyup_event=n(this.element,"keyup",function(t){return function(e){return e=e||window.event,t._receive_input(e,!1)}}(this)),this.blur_event=n(window,"blur",function(t){return function(){var e,n,i,r;for(r=t._keys_down,n=0,i=r.length;n<i;n++)e=r[n],t._key_up(e,{});return t._keys_down=[]}}(this))}return e.prototype.destroy=function(){var t;return t=function(t,e,n){return null!=t.removeEventListener?t.removeEventListener(e,n):null!=t.removeEvent?t.removeEvent("on"+e,n):void 0},t(this.element,"keydown",this.keydown_event),t(this.element,"keyup",this.keyup_event),t(window,"blur",this.blur_event)},e.prototype._bug_catcher=function(t){var e,n;if("cmd"===_&&z.call(this._keys_down,"cmd")>=0&&"cmd"!==(e=s(null!=(n=t.keyCode)?n:t.key))&&"shift"!==e&&"alt"!==e&&"caps"!==e&&"tab"!==e)return this._receive_input(t,!1)},e.prototype._cmd_bug_check=function(t){return!("cmd"===_&&z.call(this._keys_down,"cmd")>=0&&z.call(t,"cmd")<0)},e.prototype._prevent_default=function(t,e){if((e||this.should_suppress_event_defaults)&&!this.should_force_event_defaults&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation))return t.stopPropagation()},e.prototype._get_active_combos=function(t){var e,n;return e=[],n=c(this._keys_down,function(e){return e!==t}),n.push(t),this._match_combo_arrays(n,function(t){return function(n){if(t._cmd_bug_check(n.keys))return e.push(n)}}(this)),this._fuzzy_match_combo_arrays(n,function(t){return function(n){if(!(z.call(e,n)>=0))return!n.is_solitary&&t._cmd_bug_check(n.keys)?e.push(n):void 0}}(this)),e},e.prototype._get_potential_combos=function(t){var e,n,i,r,o;for(n=[],o=this._registered_combos,i=0,r=o.length;i<r;i++)e=o[i],e.is_sequence||z.call(e.keys,t)>=0&&this._cmd_bug_check(e.keys)&&n.push(e);return n},e.prototype._add_to_active_combos=function(t){var e,n,i,r,o,s,a,u,l,c,h,f,p,v,d;if(u=!1,a=!0,r=!1,z.call(this._active_combos,t)>=0)return!0;if(this._active_combos.length)for(s=l=0,v=this._active_combos.length;0<=v?l<v:l>v;s=0<=v?++l:--l)if((e=this._active_combos[s])&&e.is_exclusive&&t.is_exclusive){if(i=e.keys,!u)for(c=0,f=i.length;c<f;c++)if(n=i[c],u=!0,z.call(t.keys,n)<0){u=!1;break}if(a&&!u)for(d=t.keys,h=0,p=d.length;h<p;h++)if(o=d[h],a=!1,z.call(i,o)<0){a=!0;break}u&&(r?null!=(e=this._active_combos.splice(s,1)[0])&&e.reset():(e=this._active_combos.splice(s,1,t)[0],null!=e&&e.reset(),r=!0),a=!1)}return a&&this._active_combos.unshift(t),u||a},e.prototype._remove_from_active_combos=function(t){var e,n,i;for(e=n=0,i=this._active_combos.length;0<=i?n<i:n>i;e=0<=i?++n:--n)if(this._active_combos[e]===t){t=this._active_combos.splice(e,1)[0],t.reset();break}},e.prototype._get_possible_sequences=function(){var t,e,n,i,r,o,s,a,u,l,h,f,p;for(r=[],h=this._registered_combos,s=0,l=h.length;s<l;s++)for(t=h[s],n=a=1,f=this._sequence.length;1<=f?a<=f:a>=f;n=1<=f?++a:--a)if(o=this._sequence.slice(-n),t.is_sequence&&(!(z.call(t.keys,"shift")<0)||(o=c(o,function(t){return"shift"!==t}),o.length))){for(e=u=0,p=o.length;0<=p?u<p:u>p;e=0<=p?++u:--u){if(t.keys[e]!==o[e]){i=!1;break}i=!0}i&&r.push(t)}return r},e.prototype._add_key_to_sequence=function(t,e){var n,i,r,o;if(this._sequence.push(t),i=this._get_possible_sequences(),i.length){for(r=0,o=i.length;r<o;r++)n=i[r],this._prevent_default(e,n.prevent_default);this._sequence_timer&&clearTimeout(this._sequence_timer),this.sequence_delay>-1&&(this._sequence_timer=setTimeout(function(){return this._sequence=[]},this.sequence_delay))}else this._sequence=[]},e.prototype._get_sequence=function(t){var e,n,i,r,o,s,a,u,l,h,f,p,v;for(f=this._registered_combos,a=0,h=f.length;a<h;a++)if(e=f[a],e.is_sequence){for(i=u=1,p=this._sequence.length;1<=p?u<=p:u>=p;i=1<=p?++u:--u)if(s=c(this._sequence,function(t){return z.call(e.keys,"shift")>=0||"shift"!==t}).slice(-i),e.keys.length===s.length)for(n=l=0,v=s.length;0<=v?l<v:l>v;n=0<=v?++l:--l)if(o=s[n],!(z.call(e.keys,"shift")<0&&"shift"===o||"shift"===t&&z.call(e.keys,"shift")<0)){if(e.keys[n]!==o){r=!1;break}r=!0}if(r)return e.is_exclusive&&(this._sequence=[]),e}return!1},e.prototype._receive_input=function(t,e){var n,i;return this._prevent_capture?void(this._keys_down.length&&(this._keys_down=[])):(n=s(null!=(i=t.keyCode)?i:t.key),(e||this._keys_down.length||"alt"!==n&&n!==_)&&n?e?this._key_down(n,t):this._key_up(n,t):void 0)},e.prototype._fire=function(t,e,n,i){if("function"==typeof e["on_"+t]&&this._prevent_default(n,e["on_"+t].call(e.this,n,e.count,i)!==!0),"release"===t&&(e.count=0),"keyup"===t)return e.keyup_fired=!0},e.prototype._match_combo_arrays=function(t,e){var n,i,s,a;for(a=this._registered_combos,i=0,s=a.length;i<s;i++)n=a[i],(!n.is_unordered&&o(t,n.keys)||n.is_unordered&&r(t,n.keys))&&e(n)},e.prototype._fuzzy_match_combo_arrays=function(t,e){var n,i,r,o;for(o=this._registered_combos,i=0,r=o.length;i<r;i++)n=o[i],(!n.is_unordered&&p(n.keys,t)||n.is_unordered&&f(n.keys,t))&&e(n)},e.prototype._keys_remain=function(t){var e,n,i,r,o;for(o=t.keys,i=0,r=o.length;i<r;i++)if(e=o[i],z.call(this._keys_down,e)>=0){n=!0;break}return n},e.prototype._key_down=function(t,e){var n,i,r,o,s,u,l,c,h,f,p,v,d,y,m;h=a(t,e),h&&(t=h),this._add_key_to_sequence(t,e),(c=this._get_sequence(t))&&this._fire("keydown",c,e);for(s in k)r=k[s],e[r]&&(s===t||z.call(this._keys_down,s)>=0||this._keys_down.push(s));for(s in k)if(r=k[s],s!==t&&z.call(this._keys_down,s)>=0&&!e[r]){if("cmd"===s&&"cmd"!==_)continue;for(o=f=0,m=this._keys_down.length;0<=m?f<m:f>m;o=0<=m?++f:--f)this._keys_down[o]===s&&this._keys_down.splice(o,1)}for(i=this._get_active_combos(t),l=this._get_potential_combos(t),p=0,d=i.length;p<d;p++)n=i[p],this._handle_combo_down(n,l,t,e);if(l.length)for(v=0,y=l.length;v<y;v++)u=l[v],this._prevent_default(e,u.prevent_default);z.call(this._keys_down,t)<0&&this._keys_down.push(t)},e.prototype._handle_combo_down=function(t,e,n,i){var r,o,s,a,u,l;if(z.call(t.keys,n)<0)return!1;if(this._prevent_default(i,t&&t.prevent_default),r=!1,z.call(this._keys_down,n)>=0&&(r=!0,!t.allows_key_repeat()))return!1;if(a=this._add_to_active_combos(t,n),t.keyup_fired=!1,o=!1,t.is_exclusive)for(u=0,l=e.length;u<l;u++)if(s=e[u],s.is_exclusive&&s.keys.length>t.keys.length){o=!0;break}return!o&&(t.is_counting&&"function"==typeof t.on_keydown&&(t.count+=1),a)?this._fire("keydown",t,i,r):void 0},e.prototype._key_up=function(t,e){var n,i,r,o,s,u,l,c,h,f,p,v,d,y,g,_,k,b,w;if(c=t,l=a(t,e),l&&(t=l),l=m[c],e.shiftKey?l&&z.call(this._keys_down,l)>=0||(t=c):c&&z.call(this._keys_down,c)>=0||(t=l),u=this._get_sequence(t),u&&this._fire("keyup",u,e),z.call(this._keys_down,t)<0)return!1;for(s=h=0,_=this._keys_down.length;0<=_?h<_:h>_;s=0<=_?++h:--h)if((k=this._keys_down[s])===t||k===l||k===c){this._keys_down.splice(s,1);break}for(i=this._active_combos.length,o=[],b=this._active_combos,f=0,d=b.length;f<d;f++)n=b[f],z.call(n.keys,t)>=0&&o.push(n);for(p=0,y=o.length;p<y;p++)r=o[p],this._handle_combo_up(r,e,t);if(i>1)for(w=this._active_combos,v=0,g=w.length;v<g;v++)void 0===(n=w[v])||z.call(o,n)>=0||this._keys_remain(n)||this._remove_from_active_combos(n)},e.prototype._handle_combo_up=function(t,e,n){var i,o;this._prevent_default(e,t&&t.prevent_default),o=this._keys_remain(t),t.keyup_fired||(i=this._keys_down.slice(),i.push(n),t.is_solitary&&!r(i,t.keys)||(this._fire("keyup",t,e),t.is_counting&&"function"==typeof t.on_keyup&&"function"!=typeof t.on_keydown&&(t.count+=1))),o||(this._fire("release",t,e),this._remove_from_active_combos(t))},e.prototype.simple_combo=function(t,e){return this.register_combo({keys:t,on_keydown:e})},e.prototype.counting_combo=function(t,e){return this.register_combo({keys:t,is_counting:!0,is_unordered:!1,on_keydown:e})},e.prototype.sequence_combo=function(t,e){return this.register_combo({keys:t,on_keydown:e,is_sequence:!0,is_exclusive:!0})},e.prototype.register_combo=function(e){var n,i,r,o;"string"==typeof e.keys&&(e.keys=e.keys.split(" ")),o=this._defaults;for(i in o)x.call(o,i)&&(r=o[i],void 0===e[i]&&(e[i]=r));if(n=new t(e),w(n))return this._registered_combos.push(n),n},e.prototype.register_many=function(t){var e,n,i,r;for(r=[],n=0,i=t.length;n<i;n++)e=t[n],r.push(this.register_combo(e));return r},e.prototype.unregister_combo=function(e){var n,i,s,a,u,l;if(!e)return!1;if(i=function(t){return function(e){var n,i,r,o;for(o=[],n=i=0,r=t._registered_combos.length;0<=r?i<r:i>r;n=0<=r?++i:--i){if(e===t._registered_combos[n]){t._registered_combos.splice(n,1);break}o.push(void 0)}return o}}(this),e instanceof t)return i(e);for("string"==typeof e&&(e=e.split(" ")),u=this._registered_combos,l=[],s=0,a=u.length;s<a;s++)null!=(n=u[s])&&(n.is_unordered&&r(e,n.keys)||!n.is_unordered&&o(e,n.keys)?l.push(i(n)):l.push(void 0));return l},e.prototype.unregister_many=function(t){var e,n,i,r;for(r=[],n=0,i=t.length;n<i;n++)e=t[n],r.push(this.unregister_combo(e));return r},e.prototype.get_registered_combos=function(){return this._registered_combos},e.prototype.reset=function(){return this._registered_combos=[]},e.prototype.listen=function(){return this._prevent_capture=!1},e.prototype.stop_listening=function(){return this._prevent_capture=!0},e.prototype.get_meta_key=function(){return _},e}(),u=function(){navigator.userAgent.indexOf("Mac OS X")!==-1&&(_="cmd")},i=function(){navigator.userAgent.indexOf("Opera")!==-1&&(y[17]="cmd")},s=function(t){return y[t]},c=function(t,e){var n;return t.filter?t.filter(e):function(){var i,r,o;for(o=[],i=0,r=t.length;i<r;i++)n=t[i],e(n)&&o.push(n);return o}()},r=function(t,e){var n,i,r;if(t.length!==e.length)return!1;for(i=0,r=t.length;i<r;i++)if(n=t[i],!(z.call(e,n)>=0))return!1;return!0},o=function(t,e){var n,i,r;if(t.length!==e.length)return!1;for(n=i=0,r=t.length;0<=r?i<r:i>r;n=0<=r?++i:--i)if(t[n]!==e[n])return!1;return!0},f=function(t,e){var n,i,r;for(i=0,r=t.length;i<r;i++)if(n=t[i],z.call(e,n)<0)return!1;return!0},h=Array.prototype.indexOf||function(t,e){var n,i,r;for(n=i=0,r=t.length;0<=r?i<=r:i>=r;n=0<=r?++i:--i)if(t[n]===e)return n;return-1},p=function(t,e){var n,i,r,o,s;for(r=0,o=0,s=t.length;o<s;o++){if(i=t[o],!((n=h.call(e,i))>=r))return!1;r=n}return!0},g=function(){if(n.debug)return console.log.apply(console,arguments)},v=function(t){var e,n,i;e=!1;for(i in y)if(n=y[i],t===n){e=!0;break}if(!e)for(i in m)if(n=m[i],t===n){e=!0;break}return e},w=function(t){var e,n,i,r,o,s,a,u,c,f,p,y,m,k;for(a=!0,t.keys.length||g("You're trying to bind a combo with no keys:",t),n=u=0,m=t.keys.length;0<=m?u<m:u>m;n=0<=m?++u:--u)i=t.keys[n],e=d[i],e&&(i=t.keys[n]=e),"meta"===i&&t.keys.splice(n,1,_),"cmd"===i&&g('Warning: use the "meta" key rather than "cmd" for Windows compatibility');for(k=t.keys,c=0,p=k.length;c<p;c++)i=k[c],v(i)||(g('Do not recognize the key "'+i+'"'),a=!1);if(z.call(t.keys,"meta")>=0||z.call(t.keys,"cmd")>=0){for(o=t.keys.slice(),f=0,y=b.length;f<y;f++)r=b[f],(n=h.call(o,r))>-1&&o.splice(n,1);o.length>1&&(g("META and CMD key combos cannot have more than 1 non-modifier keys",t,o),a=!1)}for(s in t)t[s],"undefined"===l[s]&&g("The property "+s+" is not a valid combo property. Your combo has still been registered.");return a},a=function(t,e){var n;return!!e.shiftKey&&(null!=(n=m[t])&&n)},k={cmd:"metaKey",ctrl:"ctrlKey",shift:"shiftKey",alt:"altKey"},d={escape:"esc",control:"ctrl",command:"cmd",break:"pause",windows:"cmd",option:"alt",caps_lock:"caps",apostrophe:"'",semicolon:";",tilde:"~",accent:"`",scroll_lock:"scroll",num_lock:"num"},m={"/":"?",".":">",",":"<","'":'"',";":":","[":"{","]":"}","\\":"|","`":"~","=":"+","-":"_",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")"},y={0:"\\",8:"backspace",9:"tab",12:"num",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"caps",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",44:"print",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"cmd",92:"cmd",93:"cmd",96:"num_0",97:"num_1",98:"num_2",99:"num_3",100:"num_4",101:"num_5",102:"num_6",103:"num_7",104:"num_8",105:"num_9",106:"num_multiply",107:"num_add",108:"num_enter",109:"num_subtract",110:"num_decimal",111:"num_divide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",124:"print",144:"num",145:"scroll",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",223:"`",224:"cmd",225:"alt",57392:"ctrl",63289:"num",59:";",61:"=",173:"-"},n._keycode_dictionary=y,n._is_array_in_array_sorted=p,u(),i(),null!==e?e.keypress=n:window.keypress=n}).call(this)}),Q=function(){function t(e,n){var i=this;v(this,t),this.keys={},n.forEach(function(t){i.keys[t]=!1,e.register_combo({keys:t,on_keydown:function(){i.keys[t]=!0},on_keyup:function(){i.keys[t]=!1},prevent_repeat:!0})})}return d(t,[{key:"pressed",value:function(t){return t in this.keys&&this.keys[t]}}]),t}(),Z=function(){function t(e,n,i){v(this,t),this.keys=e,this.delays=[0,n,i],this.timers={}}return d(t,[{key:"setInitialDelay",value:function(t){this.delays[1]=t}},{key:"setDelay",value:function(t){this.delays[2]=t}},{key:"update",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;this.keys.forEach(function(r){r in e.timers||(e.timers[r]={state:0,time:0});var o=e.timers[r];if(r in n&&n[r]){var s=e.delays[o.state];o.time+=1e3*t,o.time>=s&&(o.time-=s,o.state>=1&&o.time>s&&(o.time=0),o.state=Math.min(2,o.state+1),"function"==typeof i&&i(r))}else o.state=0,o.time=0})}}]),t}(),$=new J.keypress.Listener,tt=new G.Manager(document.body,{recognizers:[[G.Tap],[G.Pan,{direction:G.DIRECTION_ALL}]]});A.system([],function(){function t(){v(this,t),this.keys=new Q($,["z"]),this.undoTimer=new Z(["z"],250,60),$.simple_combo("esc",function(){Y.send("exitLevel")}),$.simple_combo("r",function(){Y.send("restart")}),tt.on("tap",function(t){t.center.x<128&&t.center.y<128&&Y.send("exitLevel")})}return d(t,[{key:"pre",value:function(){this.undoTimer.update(D.val,{z:this.keys.pressed("z")},function(t){return Y.send("undo")})}}]),t}()),A.system([],function(){function t(){var e=this;v(this,t),this.keys=new Q($,["i","o"]),$.simple_combo("u",function(){e.setScale(.25)})}return d(t,[{key:"initialize",value:function(){this.setScale(.25)}},{key:"pre",value:function(){this.keys.pressed("i")&&this.setScale(this.getScale()*(1+1*D.val)),this.keys.pressed("o")&&this.setScale(this.getScale()*(1-1*D.val))}},{key:"setScale",value:function(t){q.scale.x=t,q.scale.y=t,Y.send("updateCamera")}},{key:"getScale",value:function(){return q.scale.x}}]),t}()),A.system(["inputMovement"],function(){function t(){v(this,t),this.currentKey=void 0,this.moveDelta={x:0,y:0},this.lastMoveDelta={x:0,y:0},this.keys={},this.touching=!1,this.id=0,this.initKeyboardInput(),this.initTouchInput()}return d(t,[{key:"pre",value:function(){var t=this;if(Y.process("resetKeys",function(){t.resetKeys()}),!this.touching){var e=0;this.moveDelta={x:0,y:0},this.currentKey=void 0;for(var n in this.keys){var i=this.keys[n];i.down&&i.lastId>e&&(this.moveDelta.x=i.delta.x,this.moveDelta.y=i.delta.y,this.currentKey=n,e=i.lastId)}0==e&&(this.id=0)}0===this.moveDelta.x&&0===this.moveDelta.y||(this.lastMoveDelta.x=this.moveDelta.x,this.lastMoveDelta.y=this.moveDelta.y)}},{key:"every",value:function(t){var e=this;t.currentDirection.x=0,t.currentDirection.y=0;var n={};this.currentKey&&(n[this.currentKey]=!0),this.moveTimer.update(D.val,n,function(n){t.currentDirection.x=e.moveDelta.x,t.currentDirection.y=e.moveDelta.y}),t.lastDirection.x=this.lastMoveDelta.x,t.lastDirection.y=this.lastMoveDelta.y}},{key:"makeKey",value:function(t,e){return{delta:{x:t,y:e},down:!1,lastId:0}}},{key:"resetKeys",value:function(){for(var t in this.keys)this.keys[t].down=!1}},{key:"bindKey",value:function(t){var e=this;$.register_combo({keys:t,on_keydown:function(){e.keys[t].down=!0,e.keys[t].lastId=++e.id},on_keyup:function(){e.keys[t].down=!1},prevent_repeat:!0})}},{key:"initKeyboardInput",value:function(){var t=this;this.keys={w:this.makeKey(0,-1),a:this.makeKey(-1,0),s:this.makeKey(0,1),d:this.makeKey(1,0),up:this.makeKey(0,-1),left:this.makeKey(-1,0),down:this.makeKey(0,1),right:this.makeKey(1,0)};for(var e in this.keys)this.bindKey(e);this.moveTimer=new Z(Object.keys(this.keys),250,150,function(e){return t.handleMove(e)}),$.register_combo({keys:"shift",on_keydown:function(){t.moveTimer.setDelay(60)},on_keyup:function(){t.moveTimer.setDelay(150)},prevent_repeat:!0})}},{key:"initTouchInput",value:function(){var t=this,e={};e[G.DIRECTION_LEFT]={x:-1,y:0,key:"left"},e[G.DIRECTION_RIGHT]={x:1,y:0,key:"right"},e[G.DIRECTION_UP]={x:0,y:-1,key:"up"},e[G.DIRECTION_DOWN]={x:0,y:1,key:"down"},tt.on("pan",function(n){if(!t.touching)if(Math.abs(n.velocity)>.3&&n.offsetDirection in e){var i=e[n.offsetDirection];t.touching=!0,t.moveDelta={x:i.x,y:i.y},t.currentKey=i.key}else t.touching=!1}),tt.on("panend",function(e){t.touching=!1})}}]),t}());var et=function(){function t(){v(this,t),this.actions=[]}return d(t,[{key:"push",value:function(t){var e=new nt(t);return e.execute()?(this.actions.push(e),!0):(e.rollback(),!1)}},{key:"pushToLast",value:function(t){if(this.actions.length>0){if(this.actions.top().addChild(t))return!0;this.actions.top().rollbackLast()}return!1}},{key:"pop",value:function(){if(this.actions.length>0){var t=[];if(this.actions.top().undo(t))return this.actions.pop(),!0;this.actions.top().redo(t)}return!1}},{key:"reset",value:function(){this.actions=[]}}]),t}(),nt=function(){function t(e){v(this,t),this.children=[],this.action=e}return d(t,[{key:"execute",value:function(){var t=o(this.action,"execute",this);return this.addChildren(t)}},{key:"rollback",value:function(){for(;this.children.length>0;)this.children.top().rollback(),this.children.pop();o(this.action,"rollback",this)}},{key:"rollbackLast",value:function(){this.children.length>0&&(this.children.top().rollback(),this.children.pop())}},{key:"undo",value:function(t){for(var e=this.children.length-1;e>=0;--e){if(!this.children[e].undo(t))return!1}return t.push(this.action),o(this.action,"undo",this)!==!1}},{key:"redo",value:function(t){if(t)for(;t.length>0;)o(t.top(),"redo",this),t.pop()}},{key:"addChild",value:function(e){var n=new t(e);return this.children.push(n),n.execute()}},{key:"addChildren",value:function(t){if(t===!1)return!1;if(t&&t.length>0){var e=!0,n=!1,i=void 0;try{for(var r,o=t[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;if(!this.addChild(s))return!1}}catch(t){n=!0,i=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw i}}}return!0}}]),t}(),it=function(){function t(e){v(this,t),this.entity=e,this.timeImmune=a(e)}return d(t,[{key:"undo",value:function(){this.timeImmune||a(this.entity)||o(this,"rollback")}},{key:"redo",value:function(){this.timeImmune||a(this.entity)||o(this,"execute")}}]),t}(),rt=function(t){function e(t){v(this,e);var n=m(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t.entity));return n.event=t,n}return y(e,t),d(e,[{key:"invokeLogicComponent",value:function(t,e,n,r){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!(r&&n.toString()===r.toString()||n.has("attachable")&&n.get("attachable").attached)){var s=n.get("logic");if(s&&this.event.type in s&&"function"==typeof s[this.event.type]){var a=i(this.event,{baseEntity:n}),u=new s[this.event.type](a);if(o)return!!t.addChild(u)||(t.rollbackLast(),!1);e.push(u)}}return!0}},{key:"execute",value:function(t){var e=[],n=this.event.entity;if(this.event.position){var i=F.find(this.event.position,n,"platform");if(i){var r=this.invokeLogicComponent(t,e,i,n,!0);if(!r)return!1;if(i=F.find(this.event.position,n,"platform"),r&&!i){var o=F.get(this.event.position),s=!0,a=!1,u=void 0;try{for(var l,c=o.values()[Symbol.iterator]();!(s=(l=c.next()).done);s=!0){var h=l.value;h.has("platform")||this.invokeLogicComponent(t,e,h,n)}}catch(t){a=!0,u=t}finally{try{!s&&c.return&&c.return()}finally{if(a)throw u}}}}else{var f=F.get(this.event.position),p=!0,v=!1,d=void 0;try{for(var y,m=f.values()[Symbol.iterator]();!(p=(y=m.next()).done);p=!0){var g=y.value;this.invokeLogicComponent(t,e,g,n)}}catch(t){v=!0,d=t}finally{try{!p&&m.return&&m.return()}finally{if(v)throw d}}}}else this.invokeLogicComponent(t,e,this.event.entity,void 0);return e}},{key:"rollback",value:function(){}}]),e}(it),ot=function(t){function e(t){v(this,e);var n=m(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t.entity));return n.event=t,n.entity=t.entity,n.direction=t.direction,n}return y(e,t),d(e,[{key:"execute",value:function(){var t=this.entity.get("position"),e={x:t.x,y:t.y};return t.x+=this.direction.x,t.y+=this.direction.y,F.update(this.entity),1!==F.get(t).size&&(this.event.suppressEvents||this.event.entity.has("suppressEvents")?void 0:[new rt({type:"exit",position:e,newPosition:{x:t.x,y:t.y},direction:this.direction,entity:this.entity}),new rt({type:"moved",from:e,to:{x:t.x,y:t.y},direction:this.direction,entity:this.entity,movedBy:this.event.movedBy}),new rt({type:"enter",position:{x:t.x,y:t.y},oldPosition:e,direction:this.direction,entity:this.entity})])}},{key:"rollback",value:function(){var t=this.entity.get("position");t.x-=this.direction.x,t.y-=this.direction.y,F.update(this.entity)}}]),e}(it),st=function(t){function e(t){v(this,e);var n=m(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.entity=t,n}return y(e,t),d(e,[{key:"execute",value:function(){F.remove(this.entity),this.entity.has("sprite")&&this.entity.get("sprite").onRemove(),this.entity.detach()}},{key:"rollback",value:function(){this.entity.attach(A),this.entity.has("sprite")&&this.entity.get("sprite").onCreate(),F.update(this.entity)}}]),e}(it),at=function(t){function e(t){v(this,e);var n=m(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,void 0));return n.event=t,n}return y(e,t),d(e,[{key:"execute",value:function(){var t={name:this.event.create,position:{x:this.event.at.x,y:this.event.at.y},spritePosition:X.getVisualPosition(this.event.at),layer:5};this.entity=X.createEntity(t,15),g(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"entity",this.entity,this),o(this.event,"thenCall",this.entity)}},{key:"rollback",value:function(){F.remove(this.entity),this.entity.destroy()}}]),e}(it),ut=function(){function t(e){v(this,t),this.event=e}return d(t,[{key:"execute",value:function(){var t=[],e=F.find.apply(F,[this.event.position,void 0].concat(_(this.event.has)));return e&&t.push(new st(e)),t}}]),t}(),lt=function(t){function e(t,n){v(this,e);var i=m(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n));return i.baseEntity=t,i.entityToAttach=n,i.platform=t.get("platform"),i.attachable=n.get("attachable"),i}return y(e,t),d(e,[{key:"execute",value:function(){this.platform&&this.attachable&&(this.originalAttached=this.attachable.attached,this.originalHolding=this.platform.holding,this.attachable.attached=this.baseEntity,this.platform.holding=this.entityToAttach,this.entityToAttach.has("inputMovement")&&(this.baseEntity.set("inputMovement"),this.entityToAttach.remove("inputMovement")))}},{key:"rollback",value:function(){this.platform&&this.attachable&&(this.attachable.attached=this.originalAttached,this.platform.holding=this.originalHolding,this.baseEntity.has("inputMovement")&&(this.baseEntity.remove("inputMovement"),this.entityToAttach.set("inputMovement")))}}]),e}(it),ct=function(t){function e(t){v(this,e);var n=m(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.baseEntity=t,n.platform=t.get("platform"),n.attachable=n.platform.holding.get("attachable"),n}return y(e,t),d(e,[{key:"execute",value:function(){this.platform&&this.attachable&&(this.originalAttached=this.attachable.attached,this.originalHolding=this.platform.holding,this.originalAttached&&this.originalAttached.has("inputMovement")&&(this.originalHolding.set("inputMovement"),this.originalAttached.remove("inputMovement")),this.attachable.attached=void 0,this.platform.holding=void 0)}},{key:"rollback",value:function(){this.platform&&this.attachable&&(this.originalHolding&&this.originalHolding.has("inputMovement")&&(this.originalHolding.remove("inputMovement"),this.originalAttached.set("inputMovement")),this.attachable.attached=this.originalAttached,this.platform.holding=this.originalHolding)}}]),e}(it);A.system([],function(){function t(){v(this,t),this.actionStack=new et}return d(t,[{key:"move",value:function(t,e,n){if(0!==e.x||0!==e.y)return this.actionStack[n](new ot({entity:t,direction:{x:e.x,y:e.y}}))}},{key:"handleMovement",value:function(t){var e=t.get("forcedMovement"),n=t.get("inputMovement");if(e){if(!t.has("tween")){var i=this.move(t,e.direction,"pushToLast");i===!1&&t.remove("forcedMovement")}}else n&&this.move(t,n.currentDirection,"push")}},{key:"pre",value:function(){var t=this;Y.loop("loaded",function(e){t.actionStack.reset()}),Y.process("undo",function(){t.actionStack.pop()});var e=new Set,n=A.every(["position","forcedMovement"]),i=A.every(["position","inputMovement"]),r=!0,o=!1,s=void 0;try{for(var a,u=n[Symbol.iterator]();!(r=(a=u.next()).done);r=!0){var l=a.value;e.add(l.toString())}}catch(t){o=!0,s=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw s}}var c=!0,h=!1,f=void 0;try{for(var p,v=i[Symbol.iterator]();!(c=(p=v.next()).done);c=!0){var d=p.value;e.add(d.toString())}}catch(t){h=!0,f=t}finally{try{!c&&v.return&&v.return()}finally{if(h)throw f}}var y=!0,m=!1,g=void 0;try{for(var _,k=e[Symbol.iterator]();!(y=(_=k.next()).done);y=!0){var b=_.value,w=A.entities[b];w&&w.valid()&&this.handleMovement(w)}}catch(t){m=!0,g=t}finally{try{!y&&k.return&&k.return()}finally{if(m)throw g}}}}]),t}()),A.system([],function(){function t(){v(this,t)}return d(t,[{key:"initialize",value:function(){this.player=this.createPlayer({x:128,y:128})}},{key:"pre",value:function(){var t=this;Y.process("resetPlayer",function(e){t.player.destroy(),t.player=t.createPlayer(e.position)})}},{key:"createPlayer",value:function(t){var e=X.getVisualPosition(t),n=A.entity();return n.set("player").set("inputMovement").set("position",t.x,t.y).set("sprite",j,"player",20,e).set("cameraFollows").set("pushes").set("presses").set("attachable"),F.update(n),n}}]),t}());var ht=function(t){function e(t){return v(this,e),m(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t.baseEntity))}return y(e,t),d(e,[{key:"execute",value:function(){return!1}}]),e}(it);A.system([],function(){function t(){v(this,t)}return d(t,[{key:"initialize",value:function(){var t=this;X.register(["wall"],function(e,n){t.createWallEntity(e)})}},{key:"createWallEntity",value:function(t){t.set("blocksMovement").set("logic",{enter:ht})}}]),t}());var ft=function(t){function e(t){v(this,e);var n=m(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t.baseEntity));return n.event=t,n}return y(e,t),d(e,[{key:"execute",value:function(){return!this.event.entity.has("vehicle")}}]),e}(it),pt=function(t){function e(t){v(this,e);var n=m(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t.baseEntity));return n.event=t,n}return y(e,t),d(e,[{key:"execute",value:function(){return!0}}]),e}(it),vt=function(t){function e(t){v(this,e);var n=m(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t.baseEntity));return n.event=t,n}return y(e,t),d(e,[{key:"execute",value:function(){return this.event.entity.has("vehicle")}}]),e}(it),dt=function(t){function e(t){v(this,e);var n=m(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t.baseEntity));return n.event=t,n}return y(e,t),d(e,[{key:"execute",value:function(){return!this.event.entity.has("player")&&(this.event.entity.has("platform")?void 0:[new st(this.event.entity)])}}]),e}(it),yt=function(t){function e(t){v(this,e);var n=m(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t.baseEntity));return n.event=t,n}return y(e,t),d(e,[{key:"execute",value:function(){this.event.entity.set("forcedMovement",this.event.direction)}},{key:"rollback",value:function(){this.event.entity.remove("forcedMovement")}}]),e}(it),mt=function(t){function e(t){v(this,e);var n=m(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t.baseEntity));return n.event=t,n.direction=void 0,n}return y(e,t),d(e,[{key:"execute",value:function(){var t=this.event.entity.get("forcedMovement");t&&(this.direction=t.direction,this.event.entity.remove("forcedMovement"))}},{key:"rollback",value:function(){this.direction&&this.event.entity.set("forcedMovement",this.direction)}}]),e}(it);A.system([],function(){function t(){v(this,t)}return d(t,[{key:"initialize",value:function(){X.register(["normal"],function(t,e){t.set("terrain"),t.set("logic",{enter:ft})}),X.register(["normal_blocks"],function(t,e){t.set("terrain"),t.set("logic",{enter:pt})}),X.register(["water"],function(t,e){t.set("terrain"),t.set("logic",{enter:vt})}),X.register(["lava"],function(t,e){t.set("terrain"),t.set("logic",{enter:dt})}),X.register(["normal_colors","ice"],function(t,e){t.set("terrain"),t.set("logic",{exit:mt,enter:yt})})}}]),t}()),A.system(["pushable"],function(){function t(){v(this,t)}return d(t,[{key:"initialize",value:function(){var t=this;X.register(["block_none"],function(e,n){e.set("pushable").set("pushes").set("presses").set("logic",{onEnter:function(e){return t.blockEntered(e)}}),e.get("sprite").setZIndex(10)})}},{key:"blockEntered",value:function(t){var e={actions:[],allow:t.entity.has("pushes")};return e.allow&&e.actions.push({move:t.baseEntity,direction:t.direction}),e}}]),t}()),A.system([],function(){function t(){v(this,t),this.currentPuzzle=null,
this.lastPuzzle=null}return d(t,[{key:"pre",value:function(){var t=this;Y.process("restart",function(){t.enterLevel(t.currentPuzzle)}),Y.process("enterLevel",function(e){t.enterLevel(e)}),Y.process("exitLevel",function(e){t.exitLevel(e)})}},{key:"enterLevel",value:function(t){t&&(Y.send("loadTiles",{layer:t.layer,puzzle:t,animate:!this.currentPuzzle||this.currentPuzzle&&this.currentPuzzle.tileId!==t.tileId}),this.currentPuzzle=t,Y.send("resetPlayer",{position:this.currentPuzzle.position}))}},{key:"exitLevel",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.currentPuzzle&&(t&&console.log("Puzzle complete!"),Y.send("resetPlayer",{position:this.currentPuzzle.position}),"portal_solved"!==this.currentPuzzle.state&&(this.currentPuzzle.state=t?"portal_solved":"portal_unsolved"),Y.send("updatePuzzlePortal",{id:this.currentPuzzle.tileId,state:this.currentPuzzle.state}),Y.send("loadTiles",{layer:"world",puzzle:this.currentPuzzle}),this.currentPuzzle=null)}}]),t}());var gt=function(){function t(e){v(this,t),this.event=e}return d(t,[{key:"execute",value:function(){var t=this.event.baseEntity.get("puzzleGoal");t.completed&&this.hasPlayer(this.event.entity)&&Y.send("exitLevel",t.completed)}},{key:"hasPlayer",value:function(t){var e=t.get("platform");return t.has("player")||e&&e.holding&&e.holding.has("player")}}]),t}();A.system(["puzzleGoal"],function(){function t(){v(this,t),this.solved=!0}return d(t,[{key:"initialize",value:function(){X.register(["puzzle_end","puzzle_end_done"],function(t,e){t.set("puzzleGoal","puzzle_end_done"===e.name).set("logic",{enter:gt})})}},{key:"pre",value:function(){var t=this;this.solved=!0,A.every(["goal"],function(e,n){e.solved||(t.solved=!1)})}},{key:"every",value:function(t,e){if(t.completed!==this.solved){t.completed=this.solved;var n=e.get("sprite");n&&n.set(t.completed?"puzzle_end_done":"puzzle_end")}}}]),t}()),A.system([],function(){function t(){v(this,t),this.toUpdate=[]}return d(t,[{key:"initialize",value:function(){var t=this;X.register(["button_goal"],function(e){e.set("goal").set("logic",{onEnter:function(e){t.toUpdate.push(e.baseEntity)},onExit:function(e){t.toUpdate.push(e.baseEntity)}})})}},{key:"pre",value:function(){this.updateButtonGoals()}},{key:"updateButtonGoals",value:function(){var t=!0,e=!1,n=void 0;try{for(var i,r=this.toUpdate[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var o=i.value;o.get("goal").solved=F.has(o,"presses")}}catch(t){e=!0,n=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw n}}this.toUpdate=[]}}]),t}());var _t=function(){function t(e){v(this,t),this.event=e}return d(t,[{key:"execute",value:function(){if(this.event.entity.has("player")){var t=this.event.baseEntity.get("puzzlePortal").puzzle;Y.send("enterLevel",t)}}},{key:"rollback",value:function(){Y.send("exitLevel")}}]),t}();A.system(["puzzlePortal"],function(){function t(){v(this,t),this.puzzlePortals={}}return d(t,[{key:"initialize",value:function(){var t=this;X.register(["portal_unexplored","portal_unsolved","portal_solved"],function(e,n){t.processUpdateEvents(),n.id in t.puzzlePortals&&(n.name=t.puzzlePortals[n.id]),e.get("sprite").set(n.name),e.set("puzzlePortal",{layer:"lvl-"+n.id,position:n.position,state:n.name,tileId:n.id}).set("logic",{enter:_t})})}},{key:"pre",value:function(){this.processUpdateEvents()}},{key:"processUpdateEvents",value:function(){var t=this;Y.process("updatePuzzlePortal",function(e){t.puzzlePortals[e.id]=e.state})}}]),t}()),A.system([],function(){function t(){v(this,t)}return d(t,[{key:"initialize",value:function(){this.puzzleCamera=A.entity()}},{key:"pre",value:function(){var t=this;Y.loop("loaded",function(e){var n=A.every(["player"]).next().value;n&&t.setupPlayer(n,e)})}},{key:"setupPlayer",value:function(t,e){if("world"===e.layer)this.puzzleCamera.removeAll(),t.set("cameraFollows");else{var n=this.getPuzzleCenter();t.remove("cameraFollows"),this.puzzleCamera.set("cameraFollows").set("sprite",j,void 0,void 0,n)}}},{key:"getPuzzleCenter",value:function(){var t={x:1/0,y:1/0},e={x:0,y:0};return A.every(["partOfLayer","position"],function(n,i){t.x=Math.min(t.x,i.x),t.y=Math.min(t.y,i.y),e.x=Math.max(e.x,i.x),e.y=Math.max(e.y,i.y)}),X.getVisualPosition({x:(e.x+t.x)/2,y:(e.y+t.y)/2})}}]),t}()),A.system([""],function(){function t(){v(this,t)}return d(t,[{key:"initialize",value:function(){X.register(["puzzle_start"],function(t,e){t.remove("sprite")})}}]),t}());var kt=function(t){function e(t){v(this,e);var n=m(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t.baseEntity));return n.event=t,n.platform=n.event.baseEntity.get("platform"),n}return y(e,t),d(e,[{key:"execute",value:function(){var t=this,e=[];return this.platform.holding&&e.push(new ot({entity:this.platform.holding,direction:this.event.direction,suppressEvents:!0})),this.event.movedBy||e.push(new at({create:"pollution",at:this.event.from,thenCall:function(e){return t.createPollution(e)}})),e}},{key:"createPollution",value:function(t){t.set("pollution"),t.set("logic",{enter:function(){function t(){v(this,t)}return d(t,[{key:"execute",value:function(){return!1}}]),t}()})}}]),e}(it),bt=function(t){function e(t){v(this,e);var n=m(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t.baseEntity));return n.event=t,n.platform=n.event.baseEntity.get("platform"),n}return y(e,t),d(e,[{key:"execute",value:function(t){var e=void 0;if(this.event.entity.has("pushes")){if(e=t.addChild(new ot({entity:this.event.baseEntity,direction:this.event.direction,movedBy:this.event.entity})))return!0;t.rollbackLast()}var n=this.event.entity.get("platform");if(e===!1&&n&&n.holding&&n.holding.has("player")){var i=[];return this.platform.holding&&(i.push(new ct(this.event.baseEntity)),i.push(new ot({entity:this.platform.holding,direction:this.event.direction}))),i.push(new ct(this.event.entity)),i.push(new lt(this.event.baseEntity,n.holding)),i.push(new ot({entity:this.event.entity,direction:{x:-this.event.direction.x,y:-this.event.direction.y},suppressEvents:!0})),i.push(new ut({position:this.event.oldPosition,has:["pollution"]})),i}if(e===!1&&this.event.entity.has("attachable")){var r=[];return this.platform.holding&&(r.push(new ct(this.event.baseEntity)),r.push(new ot({entity:this.platform.holding,direction:this.event.direction}))),r.push(new lt(this.event.baseEntity,this.event.entity)),r}return!1}}]),e}(it);A.system([],function(){function t(){v(this,t)}return d(t,[{key:"initialize",value:function(){var t=this;X.register(["vehicle"],function(e,n){t.createVehicle(e,n)})}},{key:"createVehicle",value:function(t,e){t.set("vehicle").set("platform").set("pushes").set("goal",!0).set("logic",{moved:kt,enter:bt}),t.get("sprite").setZIndex(12)}}]),t}());var wt=function(t){function e(t){v(this,e);var n=m(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t.baseEntity));return n.event=t,n}return y(e,t),d(e,[{key:"execute",value:function(){return!!this.event.baseEntity.get("attachable").attached||!!this.event.entity.has("pushes")&&[new ot({entity:this.event.baseEntity,direction:this.event.direction,movedBy:this.event.entity})]}}]),e}(it);A.system([],function(){function t(){v(this,t)}return d(t,[{key:"initialize",value:function(){var t=this;X.register(["package"],function(e,n){t.createPackageEntity(e)})}},{key:"createPackageEntity",value:function(t){t.set("goal").set("package").set("attachable").set("presses").set("pushes"),t.get("sprite").setZIndex(13),t.set("logic",{enter:wt})}}]),t}());var xt=function(t){function e(t){v(this,e);var n=m(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t.baseEntity));return n.event=t,n.originalState=n.event.baseEntity.get("goal").solved,n}return y(e,t),d(e,[{key:"setState",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.event.baseEntity.get("goal").solved=t,this.event.baseEntity.get("sprite").set("destination"+(t?"_solved":"_unsolved"))}},{key:"setComplete",value:function(){this.setState(!0),this.event.entity.has("timeImmune")&&this.event.baseEntity.set("timeImmune").set("timeImmuneChanged")}},{key:"execute",value:function(){var t=this.event.entity.get("platform");if(this.event.entity.has("package"))return this.setComplete(),[new st(this.event.entity)];if(t&&t.holding&&t.holding.has("package")){this.setComplete();var e=t.holding;return[new ct(this.event.entity),new st(e)]}}},{key:"rollback",value:function(){this.setState(this.originalState)}}]),e}(it);A.system([],function(){function t(){v(this,t)}return d(t,[{key:"initialize",value:function(){var t=this;X.register(["destination_solved","destination_unsolved"],function(e,n){t.createDestinationEntity(e,n)})}},{key:"createDestinationEntity",value:function(t,e){t.set("goal","destination_solved"===e.name),t.set("logic",{enter:xt})}}]),t}());var zt=function(){function t(e){v(this,t),this.event=e}return d(t,[{key:"execute",value:function(){u(this.event.entity)||(this.event.entity.remove("timeImmune"),this.event.entity.set("timeImmuneChanged"))}},{key:"rollback",value:function(){u(this.event.entity)||(this.event.entity.set("timeImmune"),this.event.entity.set("timeImmuneChanged"))}}]),t}(),Tt=function(){function t(e){v(this,t),this.event=e}return d(t,[{key:"execute",value:function(){u(this.event.entity)||(this.event.entity.set("timeImmune"),this.event.entity.set("timeImmuneChanged"))}},{key:"rollback",value:function(){u(this.event.entity)||(this.event.entity.remove("timeImmune"),this.event.entity.set("timeImmuneChanged"))}}]),t}();A.system(["createTimeImmune","position"],function(){function t(){v(this,t)}return d(t,[{key:"initialize",value:function(){X.register(["time_immune"],function(t,e){t.set("createTimeImmune")}),X.register(["time_immune_area"],function(t,e){t.set("timeImmune",!0),t.set("timeImmuneChanged"),t.set("logic",{exit:zt,enter:Tt})})}},{key:"every",value:function(t,e,n){this.setTimeImmune(e),n.destroy()}},{key:"setTimeImmune",value:function(t){var e=F.get(t),n=!0,i=!1,r=void 0;try{for(var o,s=e.values()[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var a=o.value;a.has("terrain")||(a.set("timeImmune",!0),a.set("timeImmuneChanged"))}}catch(t){i=!0,r=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw r}}}}]),t}()),A.system(["sprite","position","positionChanged"],function(){function t(){v(this,t)}return d(t,[{key:"every",value:function(t,e,n,i){var r=l(t.sprite.position,e);if(r){var o=i.get("tween");if(o)o.update(r);else{var s=60;i.has("loadAnimation")&&(s=600,i.remove("loadAnimation")),i.set("tween",i,t.sprite.position,r,s)}}i.remove("positionChanged")}}]),t}()),A.system(["tween"],function(){function t(){v(this,t)}return d(t,[{key:"pre",value:function(){M.update(D.total)}}]),t}()),A.system(["sprite","timeImmuneChanged"],function(){function t(){v(this,t)}return d(t,[{key:"every",value:function(t,e,n){n.has("timeImmune")?(t.sprite.tint=3355443,t.sprite.alpha=.7):(t.sprite.tint=16777215,t.sprite.alpha=1),n.remove("timeImmuneChanged")}}]),t}()),A.system(["cameraFollows","sprite"],function(){function t(){v(this,t)}return d(t,[{key:"every",value:function(t,e,n){var i=e.sprite.position;Y.exists("updateCamera")&&(t.update(),Y.clear("updateCamera")),t.center&&(this.centerCamera(i,t),t.center=!1),i.x>t.deadzone.x+t.deadzone.width&&(t.deadzone.x=i.x-t.deadzone.width),i.x<t.deadzone.x&&(t.deadzone.x=i.x),i.y>t.deadzone.y+t.deadzone.height&&(t.deadzone.y=i.y-t.deadzone.height),i.y<t.deadzone.y&&(t.deadzone.y=i.y),j.position.x=-t.deadzone.x+t.borderSize.x,j.position.y=-t.deadzone.y+t.borderSize.y}},{key:"centerCamera",value:function(t,e){e.deadzone.x=t.x-e.deadzone.width/2,e.deadzone.y=t.y-e.deadzone.height/2}}]),t}()),A.system(["pixiStage"],function(){function t(){v(this,t),this.renderer=null}return d(t,[{key:"initialize",value:function(){this.renderer=PIXI.autoDetectRenderer(L.width,L.height,{antialias:!1}),document.body.appendChild(this.renderer.view),A.entity().set("pixiStage",q)}},{key:"every",value:function(t){this.renderer.render(t.root)}}]),t}());var It=0;c()}();

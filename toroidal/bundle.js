!function(){"use strict";function e(e,t){if(e&&"function"==typeof e[t]){for(var n,i=arguments.length,o=Array(i>2?i-2:0),r=2;r<i;r++)o[r-2]=arguments[r];return(n=e[t]).call.apply(n,[e].concat(o))}}function t(e){return"function"==typeof e}function n(e){return(e.x||0)+","+(e.y||0)}function i(e){var t=e.split(",");return t.length=2,{x:parseInt(t[0])||0,y:parseInt(t[1])||0}}function o(){for(var e={},t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];var o=!0,r=!1,s=void 0;try{for(var a,u=n[Symbol.iterator]();!(o=(a=u.next()).done);o=!0){var l=a.value;e=Object.assign(e,l)}}catch(e){r=!0,s=e}finally{try{!o&&u.return&&u.return()}finally{if(r)throw s}}return e}function r(e){e.children.sort(function(e,t){return e.zIndex=e.zIndex||0,t.zIndex=t.zIndex||0,e.zIndex-t.zIndex})}function s(e,t){if(e&&"debug"in e&&console.log("invoke("+t+"): "+e.debug),e&&"function"==typeof e[t]){for(var n,i=arguments.length,o=Array(i>2?i-2:0),r=2;r<i;r++)o[r-2]=arguments[r];return(n=e[t]).call.apply(n,[e].concat(o))}}function a(e){if("function"==typeof e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return e.apply(void 0,n)}}function u(e,t){return(e%t+t)%t}function l(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;return{x:e.x+(t.x-e.x)*n,y:e.y+(t.y-e.y)*n}}function c(e){var t=void 0;return e.texture?(t=new PIXI.Sprite(e.texture),t.anchor.x=e.anchor.x,t.anchor.y=e.anchor.y,t.tint=e.tint):t=new PIXI.Container,t.x=e.x,t.y=e.y,t.scale.x=e.scale.x,t.scale.y=e.scale.y,t.zIndex=e.zIndex,t.alpha=e.alpha,t}function h(e){var t=c(e);if(e.children){var n=!0,i=!1,o=void 0;try{for(var r,s=e.children[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var a=r.value;t.addChild(h(a))}}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}}return t}function d(e,t){return Math.floor(Math.random()*(t-e))+e}function f(e){if(e.length)return e[d(0,e.length)]}function p(e,t){return t={exports:{}},e(t,t.exports),t.exports}function v(e){return!!(e&&e.valid()&&e.has("timeImmune"))}function _(){var e=localStorage.getItem("playerPosition");return e?JSON.parse(atob(e)):{x:128,y:128}}function y(e){localStorage.setItem("playerPosition",btoa(JSON.stringify(e)))}function m(e){return e.has("timeImmune")&&e.get("timeImmune").permanent}function g(){document.body.appendChild(Q.view),PIXI.loader.add("textures","data/textures-1.json").load(b)}function b(e,t){Z.initialize(),Q.ticker.add(function(e){var t=Q.ticker.elapsedMS/1e3;Z.run(t)})}var k=e,w={invoke:k},x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},T=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},A=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),S=function e(t,n,i){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,n,i)}if("value"in o)return o.value;var s=o.get;if(void 0!==s)return s.call(i)},z=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},I=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},E=function e(t,n,i,o){var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var s=Object.getPrototypeOf(t);null!==s&&e(s,n,i,o)}else if("value"in r&&r.writable)r.value=i;else{var a=r.set;void 0!==a&&a.call(o,i)}return i},P=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},O=w.invoke,M=function(){function e(t,n){T(this,e),this.world=t,this.id=n,this.data={},this.valid()&&this.world.index.add(this)}return A(e,[{key:"has",value:function(){for(var e=this,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return[].concat(n).every(function(t){return t in e.data})}},{key:"get",value:function(e){if(this.has(e))return this.data[e]}},{key:"access",value:function(e){return this.has(e)||this.set(e),this.data[e]}},{key:"set",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return this.valid()&&e in this.world.components?(this.data[e]=new(Function.prototype.bind.apply(this.world.components[e],[null].concat(n))),O.apply(void 0,[this.data[e],"onCreate",this].concat(n))):n.length>0?this.data[e]=n[0]:this.data[e]={},this.valid()&&this.world.index.add(this,e),this}},{key:"update",value:function(e,t){var n=this.access(e);for(var i in t)n[i]=t[i];return this}},{key:"remove",value:function(e){return e in this.data&&(this.valid()&&this.world.index.remove(this,e),O(this.data[e],"onRemove"),delete this.data[e]),this}},{key:"removeAll",value:function(){for(var e in this.data)this.remove(e);this.data={}}},{key:"destroy",value:function(){this.removeAll(),this.valid()&&(this.world.index.remove(this),delete this.world.entities[this.id],this.id=void 0)}},{key:"valid",value:function(){return this.world&&void 0!==this.id}},{key:"toString",value:function(){return String(this.id)}},{key:"toJSON",value:function(){return JSON.stringify(this.data)}},{key:"fromJSON",value:function(e){var t=JSON.parse(e);for(var n in t){var i=this.access(n);"function"==typeof i.fromJSON?i.fromJSON(t[n]):this.update(n,t[n])}return this}},{key:"attach",value:function(e){e&&!this.valid()&&(this.world=e,this.id=this.world.idCounter++,this.world.entities[this.id]=this,this.world.index.addEntity(this))}},{key:"detach",value:function(){this.valid()&&(this.world.index.removeEntity(this),delete this.world.entities[this.id],this.id=void 0,this.world=void 0)}}]),e}(),C=M,D={Entity:C},L=function(){function e(t){T(this,e),this.clear(t)}return A(e,[{key:"clear",value:function(e){this.entities=e,this.index={}}},{key:"query",value:function(e){var t=this.hashComponents(e);return t in this.index?this.index[t].entities:this.build(t,e).entities}},{key:"hashComponents",value:function(e){return e.concat().sort().join(":")}},{key:"build",value:function(e,t){var n=new Map;for(var i in this.entities){var o=this.entities[i];o.has.apply(o,P(t))&&n.set(o.toString(),o)}return this.index[e]={components:new Set(t),entities:n}}},{key:"apply",value:function(e,t){var n=this;for(var i in this.index)!function(i){var o=n.index[i],r=e.some(function(e){return o.components.has(e)}),s=(void 0==e||0===e.length)&&0==o.components.size;(r||s)&&t(o.entities)}(i)}},{key:"add",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.apply(n,function(t){t.set(e.toString(),e)})}},{key:"remove",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.apply(n,function(t){t.delete(e.toString())})}},{key:"addEntity",value:function(e){this.add.apply(this,[e].concat(P(Object.keys(e.data))))}},{key:"removeEntity",value:function(e){this.remove.apply(this,[e].concat(P(Object.keys(e.data))))}}]),e}(),R=L,q={Index:R},F=w.invoke,B=D.Entity,j=q.Index,N=function(){function e(){T(this,e),this.systems=[],this.entities={},this.components={},this.entityTemplates={},this.idCounter=1,this.index=new j(this.entities)}return A(e,[{key:"clear",value:function(){for(var e in this.entities){var t=this.entities[e];for(var n in t.data){var i=t.data[n];"function"==typeof i.onRemove&&i.onRemove()}}this.entities={},this.index.clear(this.entities)}},{key:"component",value:function(e,t){if("function"==typeof t)return this.components[e]=t,e}},{key:"entity",value:function(e){var t=this.idCounter++,n=new B(this,t);if(e&&e in this.entityTemplates){var i=this.entityTemplates[e];for(var o in i){var r=JSON.parse(i[o]);n.update(o,r)}}return this.entities[t]=n,n}},{key:"system",value:function(e,n){if(t(n)){for(var i=arguments.length,o=Array(i>2?i-2:0),r=2;r<i;r++)o[r-2]=arguments[r];var s=new(Function.prototype.bind.apply(n,[null].concat(o)));return s.components=e,this.systems.push(s),this.systems.length-1}}},{key:"initialize",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=!0,o=!1,r=void 0;try{for(var s,a=this.systems[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var u=s.value;F.apply(void 0,[u,"initialize"].concat(t))}}catch(e){o=!0,r=e}finally{try{!i&&a.return&&a.return()}finally{if(o)throw r}}}},{key:"run",value:function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];var o=!0,r=!1,s=void 0;try{for(var a,u=this.systems[Symbol.iterator]();!(o=(a=u.next()).done);o=!0){var l=a.value;F.apply(void 0,[l,"pre"].concat(n)),t(l.every)&&this.every.apply(this,[l.components,l.every.bind(l)].concat(n)),F.apply(void 0,[l,"post"].concat(n))}}catch(e){r=!0,s=e}finally{try{!o&&u.return&&u.return()}finally{if(r)throw s}}}},{key:"every",value:function(e,n){var i=this.index.query(e);if(t(n)){for(var o=arguments.length,r=Array(o>2?o-2:0),s=2;s<o;s++)r[s-2]=arguments[s];var a=!0,u=!1,l=void 0;try{for(var c,h=i.values()[Symbol.iterator]();!(a=(c=h.next()).done);a=!0)!function(){var t=c.value;if(t.has.apply(t,P(e))){var i=e.map(function(e){return t.get(e)});n.apply(void 0,P(i).concat([t],r))}}()}catch(e){u=!0,l=e}finally{try{!a&&h.return&&h.return()}finally{if(u)throw l}}}return i.values()}},{key:"get",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return[].concat(P(this.every([].concat(t))))}},{key:"prototype",value:function(e){var t=0;if("string"==typeof e&&(e=JSON.parse(e)),"object"===(void 0===e?"undefined":x(e)))for(var n in e){var i=e[n],o={};for(var r in i)o[r]=JSON.stringify(i[r]);this.entityTemplates[n]=o,++t}return t}}]),e}(),G=N;Array.prototype.top=function(){if(this.length>=1)return this[this.length-1]};var W=function(){function e(){T(this,e),this.gameSize=this.getGameSize()}return A(e,[{key:"clear",value:function(){this.bounds=void 0}},{key:"update",value:function(){this.gameSize=this.getGameSize(),this.bounds=this.getBounds(),this.puzzleCenter=this.getPuzzleCenter(this.bounds),this.puzzleSize=this.getPuzzleSize(this.bounds)}},{key:"getGameSize",value:function(){return{width:window.innerWidth,height:window.innerHeight}}},{key:"getBounds",value:function(){var e={};return e.upperLeft={x:1/0,y:1/0},e.bottomRight={x:-1/0,y:-1/0},Z.every(["partOfLayer","position"],function(t,n){e.upperLeft.x=Math.min(e.upperLeft.x,n.x),e.upperLeft.y=Math.min(e.upperLeft.y,n.y),e.bottomRight.x=Math.max(e.bottomRight.x,n.x),e.bottomRight.y=Math.max(e.bottomRight.y,n.y)}),e.size={width:1+e.bottomRight.x-e.upperLeft.x,height:1+e.bottomRight.y-e.upperLeft.y},e}},{key:"getPuzzleCenter",value:function(e){return ne.getVisualPosition({x:(e.bottomRight.x+e.upperLeft.x)/2,y:(e.bottomRight.y+e.upperLeft.y)/2})}},{key:"getPuzzleSize",value:function(e){var t=ne.getVisualPosition(this.bounds.upperLeft),n=ne.getVisualPosition({x:this.bounds.bottomRight.x+1,y:this.bounds.bottomRight.y+1});return{width:n.x-t.x,height:n.y-t.y}}},{key:"getZeroPosition",value:function(e){return{x:e.x-this.bounds.upperLeft.x,y:e.y-this.bounds.upperLeft.y}}},{key:"getFullPosition",value:function(e){return{x:e.x+this.bounds.upperLeft.x,y:e.y+this.bounds.upperLeft.y}}}]),e}(),H=new W,X=function(){function e(){T(this,e),this.clear()}return A(e,[{key:"clear",value:function(){this.index={},this.previous={}}},{key:"update",value:function(e){var t=e.get("position");if(t&&e.valid()){this.wrap(t);var i=n(t);i in this.index||(this.index[i]=new Map),this.index[i].has(e.toString())||(this.index[i].set(e.toString(),e),e.toString()in this.previous&&this.index[this.previous[e.toString()]].delete(e.toString()),this.previous[e.toString()]=i)}}},{key:"get",value:function(e){var t={x:e.x,y:e.y};this.wrap(t);var i=this.index[n(t)];return i||new Map}},{key:"remove",value:function(e){var t=e.get("position");if(t){var i=n(t);i in this.index&&this.index[i].delete(e.toString()),delete this.previous[e.toString()]}}},{key:"has",value:function(e){for(var t=this.get(e.get("position")),n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];var r=!0,s=!1,a=void 0;try{for(var u,l=t.values()[Symbol.iterator]();!(r=(u=l.next()).done);r=!0){var c=u.value;if(c.has.apply(c,i))return!0}}catch(e){s=!0,a=e}finally{try{!r&&l.return&&l.return()}finally{if(s)throw a}}return!1}},{key:"find",value:function(e,t){for(var n=this.get(e),i=arguments.length,o=Array(i>2?i-2:0),r=2;r<i;r++)o[r-2]=arguments[r];var s=!0,a=!1,u=void 0;try{for(var l,c=n.values()[Symbol.iterator]();!(s=(l=c.next()).done);s=!0){var h=l.value;if(h.has.apply(h,o)&&(!t||t.toString()!==h.toString()))return h}}catch(e){a=!0,u=e}finally{try{!s&&c.return&&c.return()}finally{if(a)throw u}}}},{key:"count",value:function(e){for(var t=0,n=this.get(e),i=arguments.length,o=Array(i>1?i-1:0),r=1;r<i;r++)o[r-1]=arguments[r];var s=!0,a=!1,u=void 0;try{for(var l,c=n.values()[Symbol.iterator]();!(s=(l=c.next()).done);s=!0){var h=l.value;h.has.apply(h,o)&&++t}}catch(e){a=!0,u=e}finally{try{!s&&c.return&&c.return()}finally{if(a)throw u}}return t}},{key:"wrap",value:function(e){if(H.bounds){var t=H.getZeroPosition(e),n={x:u(t.x,H.bounds.size.width),y:u(t.y,H.bounds.size.height)};if(n.x!==t.x||n.y!==t.y){var i=H.getFullPosition(n);e._x=i.x,e._y=i.y}}}}]),e}(),V=function(){function e(){T(this,e),this.loaders={},this.loadTile=this.loadTile.bind(this)}return A(e,[{key:"setData",value:function(e){this.fullMapData=e.layers,this.options={tileSize:e.tileSize,idToName:e.idToName,nameToId:e.nameToId}}},{key:"register",value:function(e,t){var n=!0,i=!1,o=void 0;try{for(var r,s=e[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var a=r.value;a in this.loaders?this.loaders[a].push(t):this.loaders[a]=[t]}}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}}},{key:"inWorld",value:function(){return"world"===this.layer}},{key:"loadWorld",value:function(){var e=this;this.forEachTile("world",this.loadTile);for(var t in this.fullMapData)"world"!==t&&"portal_solved"!==oe.get(t)&&this.forEachTile(t,function(t){var n=e.createEntity(t);n.remove("position");var i=n.get("sprite");i&&(i.sprite.alpha=.5,i.sprite.tint=8947848)})}},{key:"loadTile",value:function(e,t){var n=this.createEntity(e,t);if(e.name in this.loaders){var i=!0,o=!1,r=void 0;try{for(var s,a=this.loaders[e.name][Symbol.iterator]();!(i=(s=a.next()).done);i=!0){(0,s.value)(n,e)}}catch(e){o=!0,r=e}finally{try{!i&&a.return&&a.return()}finally{if(o)throw r}}}}},{key:"loadTiles",value:function(e){H.clear(),this.layer=e.layer,e.puzzle||(e.puzzle={}),e.puzzle.position||(e.puzzle.position={x:128,y:128}),this.clearEntities(),this.inWorld()?this.loadWorld():this.forEachTile(e.layer,this.loadTile),H.update()}},{key:"forEachTile",value:function(e,t){for(var n=arguments.length,o=Array(n>2?n-2:0),r=2;r<n;r++)o[r-2]=arguments[r];for(var s in this.fullMapData[e]){var a=this.fullMapData[e][s],u=0,l=!0,c=!1,h=void 0;try{for(var d,f=a[Symbol.iterator]();!(l=(d=f.next()).done);l=!0){var p=d.value,v={id:s,name:this.options.idToName[p],position:i(s),spritePosition:this.getVisualPosition(i(s)),layer:e,layerLevel:u};t.apply(void 0,[v].concat(o)),++u}}catch(e){c=!0,h=e}finally{try{!l&&f.return&&f.return()}finally{if(c)throw h}}}}},{key:"getVisualPosition",value:function(e){return{x:e.x*this.options.tileSize.width,y:e.y*this.options.tileSize.height}}},{key:"createEntity",value:function(e,t){return t=t||e.layerLevel+1,Z.entity().set("position",e.position.x,e.position.y).set("sprite",ee,e.name,t,e.spritePosition).set("partOfLayer",e.layer)}},{key:"clearEntities",value:function(){Z.every(["partOfLayer"],function(e,t){t.destroy()})}}]),e}(),K=function(){function e(){T(this,e),this.buckets=new PIXI.Container,this.index=new Map}return A(e,[{key:"clear",value:function(){this.buckets.removeChildren(),this.index.clear()}},{key:"addChild",value:function(e){var t=parseInt(e.zIndex)||0;e.zIndex=t,this.index.has(t)||this.addBucket(t),this.getBucket(t).addChild(e)}},{key:"removeChild",value:function(e){this.index.has(e.zIndex)&&this.getBucket(e.zIndex).removeChild(e)}},{key:"getBucket",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.buckets.children[this.index.get(e)]}},{key:"addBucket",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=new PIXI.Container;t.zIndex=e,this.buckets.addChild(t),r(this.buckets),this.index=this.build(this.buckets)}},{key:"build",value:function(e){var t=new Map;return e.children.forEach(function(e,n){t.set(e.zIndex,n)}),t}}]),e}(),Y=function(){function e(){T(this,e),this.data={}}return A(e,[{key:"exists",value:function(e){return e in this.data}},{key:"count",value:function(e){return e in this.data?this.data[e].length:0}},{key:"send",value:function(e,t){e in this.data||(this.data[e]=[]),this.data[e].push(t)}},{key:"loop",value:function(e,t){if(e in this.data){var n=this.data[e],i=!0,o=!1,r=void 0;try{for(var s,a=n[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){t(s.value)}}catch(e){o=!0,r=e}finally{try{!i&&a.return&&a.return()}finally{if(o)throw r}}}}},{key:"process",value:function(e,t){this.loop(e,t),this.clear(e)}},{key:"clear",value:function(e){delete this.data[e]}},{key:"clearAll",value:function(){this.data={}}}]),e}(),U=new Y,$=function(){function e(t,n){T(this,e),this.stage=t,this.app=n,this.zIndexThreshold=9,this.gridSize={},this.diff={}}return A(e,[{key:"wrap",value:function(e){e.x=u(e.x,this.bounds.width),e.y=u(e.y,this.bounds.height)}},{key:"generateSprites",value:function(e,t,n){for(var i=new PIXI.Container,o=0;o<t.y;++o)for(var r=0;r<t.x;++r){var s={x:r*this.bounds.width-n.x,y:o*this.bounds.height-n.y},a=h(e);a.x=s.x-this.bounds.x,a.y=s.y-this.bounds.y,i.addChild(a)}return i}},{key:"adjustSprites",value:function(e,t){for(var n=0;n<e;++n){var i=this.app.stage.children[n];i.x+=t.x,i.y+=t.y}}},{key:"findZIndexThreshold",value:function(){var e=this;return this.stage.children.findIndex(function(t){return t.zIndex>=e.zIndexThreshold})}},{key:"update",value:function(e){this.bounds=e||this.stage.getBounds();var t={x:this.app.renderer.width,y:this.app.renderer.height},n={x:Math.ceil(t.x/(this.bounds.width*this.scale))+1,y:Math.ceil(t.y/(this.bounds.height*this.scale))+1};this.gridSize.x===n.x&&this.gridSize.y===n.y||(this.gridSize=n,this.fullUpdate=!0);var i={x:Math.ceil(this.app.stage.x/this.scale/this.bounds.width)*this.bounds.width,y:Math.ceil(this.app.stage.y/this.scale/this.bounds.height)*this.bounds.height};if(this.fullUpdate||this.diff.x===i.x&&this.diff.y===i.y||this.adjustSprites(this.findZIndexThreshold(),{x:this.diff.x-i.x,y:this.diff.y-i.y}),this.diff=i,this.fullUpdate||this.app.stage.children.length!==this.stage.children.length){this.fullUpdate=void 0,this.app.stage.removeChildren();var o=!0,r=!1,s=void 0;try{for(var a,u=this.stage.children[Symbol.iterator]();!(o=(a=u.next()).done);o=!0){var l=a.value,c=this.generateSprites(l,n,i);this.app.stage.addChild(c)}}catch(e){r=!0,s=e}finally{try{!o&&u.return&&u.return()}finally{if(r)throw s}}}else{var h=this.findZIndexThreshold();if(h<0)return;this.app.stage.removeChildren(h);for(var d=h;d<this.stage.children.length;++d){var f=this.generateSprites(this.stage.children[d],n,i);this.app.stage.addChild(f)}}}},{key:"scale",get:function(){return this.app.stage.scale.x},set:function(e){this.app.stage.scale.x=e,this.app.stage.scale.y=e,U.send("updateCamera")}},{key:"offset",set:function(e){this._offset={x:e&&e.x||0,y:e&&e.y||0},this.update()},get:function(){return this._offset}}]),e}(),J=function(){function e(){T(this,e),this.load()}return A(e,[{key:"load",value:function(){var e=localStorage.getItem("puzzlePortals")||btoa("{}");this.puzzlePortals=JSON.parse(atob(e))}},{key:"save",value:function(){localStorage.setItem("puzzlePortals",btoa(JSON.stringify(this.puzzlePortals)))}},{key:"update",value:function(){var e=this;U.process("updatePuzzlePortal",function(t){e.puzzlePortals[t.layer]=t.state,e.save()})}},{key:"get",value:function(e,t){return e in this.puzzlePortals?this.puzzlePortals[e]:t||"portal_unexplored"}}]),e}(),Z=new G,Q=new PIXI.Application(window.innerWidth,window.innerHeight,{backgroundColor:3424325}),ee=new K,te=new X,ne=new V,ie=new $(ee.buckets,Q),oe=new J;Z.component("position",function(){function e(){T(this,e)}return A(e,[{key:"onCreate",value:function(e){this.entity=e;for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.set.apply(this,n)}},{key:"onRemove",value:function(){te.remove(this.entity)}},{key:"update",value:function(){this.entity.set("positionChanged"),te.update(this.entity)}},{key:"set",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._x===e&&this._y===t||(this._x=e,this._y=t,this.update())}},{key:"read",value:function(){this.entity.remove("positionChanged")}},{key:"x",set:function(e){this._x!==e&&(this._x=e,this.update())},get:function(){return this._x}},{key:"y",set:function(e){this._y!==e&&(this._y=e,this.update())},get:function(){return this._y}}]),e}()),Z.component("sprite",function(){function e(t,n,i,o){T(this,e),this.container=t,this.create(n,i,o)}return A(e,[{key:"create",value:function(e,t,n){this.sprite=e?new PIXI.Sprite(PIXI.utils.TextureCache[e+".png"]):new PIXI.Sprite,this.sprite.anchor.set(.5),this.sprite.zIndex=t||0,n&&(this.sprite.position.x=n.x,this.sprite.position.y=n.y),this.onCreated()}},{key:"onRemove",value:function(){this.container.removeChild(this.sprite)}},{key:"onCreated",value:function(){this.container.addChild(this.sprite)}},{key:"set",value:function(e){this.sprite.texture=PIXI.utils.TextureCache[e+".png"]}},{key:"zIndex",set:function(e){this.onRemove(),this.sprite.zIndex=e,this.onCreated()},get:function(){return this.sprite.zIndex}}]),e}()),Z.component("inputMovement",function(){function e(){T(this,e),this.currentDirection={x:0,y:0},this.lastDirection={x:0,y:0}}return e}()),Z.component("forcedMovement",function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0};T(this,e),this.direction=t}return e}()),Z.component("cameraFollows",function(){function e(){T(this,e),this.update()}return A(e,[{key:"update",value:function(){this.center=!0;var e=ie.scale;this.borderSize={x:H.gameSize.width/e*.33,y:H.gameSize.height/e*.33},this.deadzone=new PIXI.Rectangle(this.borderSize.x,this.borderSize.y,H.gameSize.width/e-2*this.borderSize.x,H.gameSize.height/e-2*this.borderSize.y)}}]),e}()),Z.component("logicAction",function(){function e(t){T(this,e),this.action=t}return e}()),Z.component("logic",function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};T(this,e);for(var n in t)this[n]=t[n]}return e}()),Z.component("partOfLayer",function(){function e(t){T(this,e),this.layer=t}return e}()),Z.component("puzzlePortal",function(){function e(t){T(this,e),this.puzzle=t}return e}()),Z.component("puzzleGoal",function(){function e(t){T(this,e),this.completed=t||!1}return e}()),Z.component("pollutionImmune",function(){function e(t){T(this,e),this.count=t||0}return e}()),Z.component("goal",function(){function e(){T(this,e)}return A(e,[{key:"onCreate",value:function(e,t,n,i){this.entity=e,this.unsolvedTexture=n,this.solvedTexture=i,this.solved=t}},{key:"solved",set:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.state=e,this.solvedTexture&&this.unsolvedTexture&&this.entity.has("sprite")){var t=this.state?this.solvedTexture:this.unsolvedTexture;this.entity.get("sprite").set(t)}},get:function(){return this.state}}]),e}()),Z.component("tween",function(){function e(){T(this,e)}return A(e,[{key:"onCreate",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e3;if(this.entity=e,this.target=n,this.time=i,this.total=0,t)this.start=t;else{var o=this.entity.get("sprite").sprite;this.start={x:o.x,y:o.y}}}},{key:"update",value:function(e,t){this.total+=e;var n=Math.min(1,this.total/this.time),i=l(this.start,this.target,n),o=this.entity.get("sprite").sprite;o.x=i.x,o.y=i.y,1===n&&(this.entity.remove("tween"),a(t))}}]),e}()),Z.component("attachable",function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;T(this,e),this.attached=t}return e}()),Z.component("platform",function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;T(this,e),this.holding=t}return e}()),Z.component("timeImmune",function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];T(this,e),this.permanent=t}return e}()),Z.component("floats",function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];T(this,e),this.floating=t}return e}()),Z.component("directionSprite",function(){function e(){T(this,e)}return A(e,[{key:"onCreate",value:function(e,t){this.entity=e,this.directions=t}}]),e}());var re={world:{"127,57":[97],"128,57":[97],"129,57":[97],"130,57":[97],"131,57":[97],"132,57":[97],"133,57":[97],"134,57":[97],"135,57":[97],"136,57":[97],"137,57":[97],"138,57":[97],"139,57":[97],"140,57":[97],"141,57":[97],"142,57":[97],"143,57":[97],"144,57":[97],"145,57":[97],"146,57":[97],"147,57":[97],"148,57":[97],"149,57":[97],"150,57":[97],"151,57":[97],"152,57":[97],"153,57":[97],"154,57":[97],"155,57":[97],"156,57":[97],"157,57":[136],"158,57":[88],"159,57":[97],"160,57":[97],"161,57":[97],"162,57":[97],"163,57":[97],"164,57":[97],"127,58":[97],"128,58":[97],"129,58":[97],"130,58":[97],"131,58":[97],"132,58":[97],"133,58":[97],"134,58":[97],"135,58":[97],"136,58":[97],"137,58":[97],"138,58":[97],"139,58":[97],"140,58":[97],"141,58":[97],"142,58":[97],"143,58":[97],"144,58":[97],"145,58":[97],"146,58":[97],"147,58":[97],"148,58":[97],"149,58":[97],"150,58":[97],"151,58":[97],"152,58":[97],"153,58":[97],"154,58":[97],"155,58":[97],"156,58":[97],"157,58":[136],"158,58":[88],"159,58":[97],"160,58":[97],"161,58":[97],"162,58":[97],"163,58":[97],"164,58":[97],"127,59":[97],"128,59":[97],"129,59":[97],"130,59":[97],"131,59":[97],"132,59":[97],"133,59":[97],"134,59":[97],"135,59":[97],"136,59":[97],"137,59":[97],"138,59":[97],"139,59":[97],"140,59":[97],"141,59":[97],"142,59":[97],"143,59":[97],"144,59":[97],"145,59":[97],"146,59":[97],"147,59":[97],"148,59":[97],"149,59":[97],"150,59":[97],"151,59":[97],"152,59":[97],"153,59":[97],"154,59":[97],"155,59":[97],"156,59":[97],"157,59":[136],"158,59":[88],"159,59":[97],"160,59":[97],"161,59":[97],"162,59":[97],"163,59":[97],"164,59":[97],"127,60":[97],"128,60":[97],"129,60":[97],"162,60":[97],"163,60":[97],"164,60":[97],"127,61":[97],"128,61":[97],"129,61":[97],"161,61":[83],"162,61":[97],"163,61":[97],"164,61":[97],"127,62":[97],"128,62":[97],"129,62":[97],"162,62":[97],"163,62":[97],"164,62":[97],"165,62":[83],"127,63":[97],"128,63":[97],"129,63":[97],"162,63":[97],"163,63":[97],"164,63":[97],"127,64":[97],"128,64":[97],"129,64":[97],"162,64":[97],"163,64":[97],"164,64":[97],"127,65":[97],"128,65":[97],"129,65":[97],"162,65":[97],"163,65":[97],"164,65":[97],"127,66":[97],"128,66":[97],"129,66":[97],"162,66":[97],"163,66":[97],"164,66":[97],"127,67":[97],"128,67":[97],"129,67":[97],"162,67":[97],"163,67":[97],"164,67":[97],"165,67":[83],"127,68":[97],"128,68":[97],"129,68":[97],"161,68":[83],"162,68":[97],"163,68":[97],"164,68":[97],"127,69":[97],"128,69":[97],"129,69":[97],"162,69":[97],"163,69":[97],"164,69":[97],"127,70":[97],"128,70":[97],"129,70":[97],"162,70":[97],"163,70":[97],"164,70":[97],"127,71":[97],"128,71":[97],"129,71":[97],"161,71":[83],"162,71":[97],"163,71":[97],"164,71":[97],"127,72":[97],"128,72":[97],"129,72":[97],"162,72":[97],"163,72":[97],"164,72":[97],"127,73":[97],"128,73":[97],"129,73":[97],"162,73":[97],"163,73":[97],"164,73":[97],"127,74":[97],"128,74":[97],"129,74":[97],"162,74":[97],"163,74":[97],"164,74":[97],"127,75":[97],"128,75":[97],"129,75":[97],"162,75":[97],"163,75":[97],"164,75":[97],"165,75":[83],"127,76":[97],"128,76":[97],"129,76":[97],"161,76":[83],"162,76":[97],"163,76":[97],"164,76":[97],"127,77":[97],"128,77":[97],"129,77":[97],"162,77":[97],"163,77":[97],"164,77":[97],"127,78":[97],"128,78":[97],"129,78":[97],"162,78":[97],"163,78":[97],"164,78":[97],"127,79":[97],"128,79":[97],"129,79":[97],"162,79":[97],"163,79":[97],"164,79":[97],"127,80":[97],"128,80":[97],"129,80":[97],"162,80":[97],"163,80":[97],"164,80":[97],"127,81":[97],"128,81":[97],"129,81":[97],"162,81":[97],"163,81":[97],"164,81":[97],"165,81":[83],"127,82":[97],"128,82":[97],"129,82":[97],"161,82":[83],"162,82":[97],"163,82":[97],"164,82":[97],"127,83":[97],"128,83":[97],"129,83":[97],"162,83":[97],"163,83":[97],"164,83":[97],"127,84":[97],"128,84":[97],"129,84":[97],"162,84":[97],"163,84":[97],"164,84":[97],"127,85":[97],"128,85":[97],"129,85":[97],"162,85":[97],"163,85":[97],"164,85":[97],"127,86":[97],"128,86":[97],"129,86":[97],"162,86":[97],"163,86":[97],"164,86":[97],"127,87":[97],"128,87":[97],"129,87":[97],"162,87":[97],"163,87":[97],"164,87":[97],"127,88":[97],"128,88":[97],"129,88":[97],"162,88":[97],"163,88":[97],"164,88":[97],"165,88":[83],"127,89":[97],"128,89":[97],"129,89":[97],"162,89":[97],"163,89":[97],"164,89":[97],"127,90":[97],"128,90":[97],"129,90":[97],"162,90":[97],"163,90":[97],"164,90":[97],"127,91":[97],"128,91":[97],"129,91":[97],"162,91":[97],"163,91":[97],"164,91":[97],"127,92":[97],"128,92":[97],"129,92":[97],"162,92":[97],"163,92":[97],"164,92":[97],"127,93":[97],"128,93":[97],"129,93":[97],"162,93":[97],"163,93":[97],"164,93":[97],"127,94":[97],"128,94":[97],"129,94":[97],"162,94":[97],"163,94":[97],"164,94":[97],"127,95":[97],"128,95":[97],"129,95":[97],"162,95":[97],"163,95":[97],"164,95":[97],"127,96":[97],"128,96":[97],"129,96":[97],"162,96":[97],"163,96":[97],"164,96":[97],"126,97":[83],"127,97":[97],"128,97":[97],"129,97":[97],"162,97":[97],"163,97":[97],"164,97":[97],"127,98":[97],"128,98":[97],"129,98":[97],"162,98":[97],"163,98":[97],"164,98":[97],"127,99":[97],"128,99":[97],"129,99":[97],"162,99":[97],"163,99":[97],"164,99":[97],"127,100":[97],"128,100":[97],"129,100":[97],"162,100":[97],"163,100":[97],"164,100":[97],"127,101":[97],"128,101":[97],"129,101":[97],"162,101":[97],"163,101":[97],"164,101":[97],"127,102":[97],"128,102":[97],"129,102":[97],"162,102":[97],"163,102":[97],"164,102":[97],"127,103":[97],"128,103":[97],"129,103":[97],"130,103":[83],"162,103":[97],"163,103":[97],"164,103":[97],"126,104":[83],"127,104":[97],"128,104":[97],"129,104":[97],"162,104":[97],"163,104":[97],"164,104":[97],"127,105":[97],"128,105":[97],"129,105":[97],"162,105":[97],"163,105":[97],"164,105":[97],"127,106":[97],"128,106":[97],"129,106":[97],"130,106":[83],"162,106":[97],"163,106":[97],"164,106":[97],"127,107":[97],"128,107":[97],"129,107":[97],"162,107":[97],"163,107":[97],"164,107":[97],"127,108":[97],"128,108":[97],"129,108":[97],"162,108":[97],"163,108":[97],"164,108":[97],"126,109":[83],"127,109":[97],"128,109":[97],"129,109":[97],"162,109":[97],"163,109":[97],"164,109":[97],"127,110":[97],"128,110":[97],"129,110":[97],"162,110":[97],"163,110":[97],"164,110":[97],"127,111":[97],"128,111":[97],"129,111":[97],"130,111":[83],"162,111":[97],"163,111":[97],"164,111":[97],"127,112":[97],"128,112":[97],"129,112":[97],"162,112":[97],"163,112":[97],"164,112":[97],"127,113":[97],"128,113":[97],"129,113":[97],"162,113":[97],"163,113":[97],"164,113":[97],"126,114":[83],"127,114":[97],"128,114":[97],"129,114":[97],"130,114":[83],"162,114":[97],"163,114":[97],"164,114":[97],"127,115":[97],"128,115":[97],"129,115":[97],"162,115":[97],"163,115":[97],"164,115":[97],"127,116":[97],"128,116":[97],"129,116":[97],"162,116":[97],"163,116":[97],"164,116":[97],"127,117":[97],
"128,117":[97],"129,117":[97],"162,117":[97],"163,117":[97],"164,117":[97],"127,118":[97],"128,118":[97],"129,118":[97],"130,118":[83],"162,118":[97],"163,118":[97],"164,118":[97],"126,119":[83],"127,119":[97],"128,119":[97],"129,119":[97],"162,119":[97],"163,119":[97],"164,119":[97],"127,120":[97],"128,120":[97],"129,120":[97],"162,120":[97],"163,120":[97],"164,120":[97],"127,121":[97],"128,121":[97],"129,121":[97],"162,121":[97],"163,121":[97],"164,121":[97],"126,122":[83],"127,122":[97],"128,122":[97],"129,122":[97],"162,122":[97],"163,122":[97],"164,122":[97],"127,123":[97],"128,123":[97],"129,123":[97],"162,123":[97],"163,123":[97],"164,123":[97],"127,124":[97],"128,124":[97],"129,124":[97],"130,124":[83],"162,124":[97],"163,124":[97],"164,124":[97],"127,125":[97],"128,125":[97],"129,125":[97],"162,125":[97],"163,125":[97],"164,125":[97],"127,126":[88],"128,126":[88],"129,126":[88],"162,126":[97],"163,126":[97],"164,126":[97],"125,127":[111],"126,127":[111],"127,127":[73],"128,127":[73],"129,127":[73],"130,127":[111],"131,127":[111],"162,127":[97],"163,127":[97],"164,127":[97],"125,128":[111],"126,128":[73],"127,128":[73],"128,128":[73],"129,128":[73],"130,128":[73],"131,128":[111],"162,128":[97],"163,128":[97],"164,128":[97],"125,129":[111],"126,129":[73],"130,129":[73],"131,129":[111],"162,129":[97],"163,129":[97],"164,129":[97],"125,130":[111],"126,130":[73],"128,130":[113],"130,130":[73],"131,130":[111],"162,130":[97],"163,130":[97],"164,130":[97],"125,131":[111],"126,131":[73],"130,131":[73],"131,131":[111],"162,131":[97],"163,131":[97],"164,131":[97],"125,132":[111],"126,132":[73],"127,132":[73],"128,132":[73],"129,132":[73],"130,132":[73],"131,132":[111],"162,132":[97],"163,132":[97],"164,132":[97],"125,133":[111],"126,133":[111],"127,133":[111],"128,133":[111],"129,133":[111],"130,133":[111],"131,133":[111],"162,133":[97],"163,133":[97],"164,133":[97],"162,134":[97],"163,134":[97],"164,134":[97],"162,135":[97],"163,135":[97],"164,135":[97],"162,136":[97],"163,136":[97],"164,136":[97],"162,137":[97],"163,137":[97],"164,137":[97],"162,138":[97],"163,138":[97],"164,138":[97],"162,139":[97],"163,139":[97],"164,139":[97],"162,140":[97],"163,140":[97],"164,140":[97],"162,141":[97],"163,141":[97],"164,141":[97],"162,142":[97],"163,142":[97],"164,142":[97],"162,143":[97],"163,143":[97],"164,143":[97],"162,144":[97],"163,144":[97],"164,144":[97],"162,145":[97],"163,145":[97],"164,145":[97],"106,146":[83],"118,146":[83],"130,146":[83],"135,146":[83],"142,146":[83],"162,146":[97],"163,146":[97],"164,146":[97],"100,147":[97],"101,147":[97],"102,147":[97],"103,147":[97],"104,147":[97],"105,147":[73],"106,147":[126],"107,147":[73],"108,147":[97],"109,147":[97],"110,147":[97],"111,147":[97],"112,147":[97],"113,147":[97],"114,147":[97],"115,147":[97],"116,147":[97],"117,147":[97],"118,147":[97],"119,147":[97],"120,147":[97],"121,147":[97],"122,147":[97],"123,147":[97],"124,147":[97],"125,147":[97],"126,147":[97],"127,147":[97],"128,147":[97],"129,147":[97],"130,147":[97],"131,147":[97],"132,147":[97],"133,147":[97],"134,147":[97],"135,147":[97],"136,147":[97],"137,147":[97],"138,147":[97],"139,147":[97],"140,147":[97],"141,147":[97],"142,147":[97],"143,147":[97],"144,147":[97],"145,147":[97],"146,147":[136],"147,147":[88],"148,147":[129],"149,147":[97],"150,147":[97],"151,147":[97],"152,147":[97],"153,147":[97],"154,147":[97],"155,147":[97],"156,147":[97],"157,147":[97],"158,147":[97],"159,147":[97],"160,147":[97],"161,147":[97],"162,147":[97],"163,147":[97],"164,147":[97],"100,148":[97],"101,148":[97],"102,148":[97],"103,148":[97],"104,148":[97],"105,148":[73],"106,148":[73],"107,148":[73],"108,148":[97],"109,148":[97],"110,148":[97],"111,148":[97],"112,148":[97],"113,148":[97],"114,148":[97],"115,148":[97],"116,148":[97],"117,148":[97],"118,148":[97],"119,148":[97],"120,148":[97],"121,148":[97],"122,148":[97],"123,148":[97],"124,148":[97],"125,148":[97],"126,148":[97],"127,148":[97],"128,148":[97],"129,148":[97],"130,148":[97],"131,148":[97],"132,148":[97],"133,148":[97],"134,148":[97],"135,148":[97],"136,148":[97],"137,148":[97],"138,148":[97],"139,148":[97],"140,148":[97],"141,148":[97],"142,148":[97],"143,148":[97],"144,148":[97],"145,148":[97],"146,148":[97],"147,148":[97],"148,148":[126],"149,148":[97],"150,148":[97],"151,148":[97],"152,148":[97],"153,148":[97],"154,148":[97],"155,148":[97],"156,148":[97],"157,148":[97],"158,148":[97],"159,148":[97],"160,148":[97],"161,148":[97],"162,148":[97],"163,148":[97],"164,148":[97],"100,149":[97],"101,149":[97],"102,149":[97],"103,149":[97],"104,149":[97],"105,149":[97],"106,149":[97],"107,149":[97],"108,149":[97],"109,149":[97],"110,149":[97],"111,149":[97],"112,149":[97],"113,149":[97],"114,149":[97],"115,149":[97],"116,149":[97],"117,149":[97],"118,149":[97],"119,149":[97],"120,149":[97],"121,149":[97],"122,149":[97],"123,149":[97],"124,149":[97],"125,149":[97],"126,149":[126],"127,149":[97],"128,149":[97],"129,149":[97],"130,149":[97],"131,149":[97],"132,149":[126],"133,149":[97],"134,149":[97],"135,149":[97],"136,149":[97],"137,149":[97],"138,149":[97],"139,149":[97],"140,149":[97],"141,149":[97],"142,149":[97],"143,149":[97],"144,149":[97],"145,149":[97],"146,149":[97],"147,149":[88],"148,149":[129],"149,149":[97],"150,149":[97],"151,149":[97],"152,149":[97],"153,149":[97],"154,149":[97],"155,149":[97],"156,149":[97],"157,149":[97],"158,149":[97],"159,149":[97],"160,149":[97],"161,149":[97],"162,149":[97],"163,149":[97],"164,149":[97],"118,150":[83],"126,150":[83],"132,150":[83],"138,150":[83],"144,150":[83]},"lvl-161,61":{"161,60":[111],"160,61":[73],"161,62":[73],"161,61":[73],"160,62":[73,138],"161,63":[73],"160,63":[73],"159,63":[111],"159,62":[111],"158,63":[111],"158,62":[73,139],"157,63":[111],"157,62":[111],"157,61":[111],"158,61":[73],"157,60":[111],"158,60":[111],"159,60":[111],"160,60":[111],"159,61":[94]},"lvl-165,62":{"166,62":[73],"165,61":[73],"165,63":[73,138],"166,63":[73,138],"165,62":[73],"167,63":[111],"168,63":[111],"167,62":[94],"168,62":[94],"167,61":[111],"168,61":[111],"166,61":[73],"169,61":[111],"170,61":[73],"169,62":[73,139],"170,62":[111],"169,63":[111],"170,63":[73]},"lvl-165,67":{"166,67":[94],"165,66":[73],"165,68":[111],"166,68":[111],"165,67":[94],"165,69":[111],"166,69":[111],"165,70":[111],"166,70":[111],"167,70":[111],"168,70":[111],"167,69":[111],"168,69":[73],"167,68":[111],"168,68":[73],"167,67":[94],"168,67":[94,140],"167,66":[73],"168,66":[73],"167,65":[73],"166,66":[73],"166,65":[73,143],"165,65":[73],"168,65":[73],"169,65":[73],"170,65":[73],"169,66":[111],"170,66":[73],"169,67":[111],"170,67":[73],"169,68":[73],"170,68":[73],"169,69":[73,143],"170,69":[73],"169,70":[111],"170,70":[73,139],"171,70":[111],"172,70":[111],"171,69":[73],"172,69":[111],"171,68":[73],"172,68":[111],"171,67":[73],"172,67":[111],"171,66":[73],"172,66":[111],"171,65":[73],"172,65":[111]},"lvl-161,68":{"161,67":[111],"160,68":[73],"161,68":[73],"160,67":[73],"159,68":[73],"159,67":[73,139],"158,68":[73],"158,67":[73],"157,68":[111],"157,67":[111],"157,66":[94],"158,66":[73,143],"157,65":[111],"158,65":[111],"159,65":[111],"160,65":[111],"159,66":[73],"160,66":[73],"161,66":[73,140],"161,65":[111]},"lvl-161,71":{"161,70":[111],"160,71":[73,143],"161,72":[73],"161,71":[73],"160,72":[73,139],"161,73":[73],"160,73":[73],"159,73":[73],"159,72":[73],"158,73":[111],"158,72":[111],"157,73":[111],"157,72":[111],"157,71":[111],"158,71":[94,140],"157,70":[111],"158,70":[111],"159,70":[111],"160,70":[111],"159,71":[94]},"lvl-165,75":{"166,75":[73],"165,74":[111],"165,76":[73,138],"166,76":[73,138],"165,75":[73],"165,77":[73],"166,77":[73],"167,77":[73,138],"168,77":[73],"167,76":[73],"168,76":[111],"167,75":[73],"168,75":[94],"167,74":[73],"168,74":[111],"167,73":[73,140],"166,74":[111],"166,73":[111],"166,72":[111],"165,73":[111],"165,72":[111],"167,72":[73],"168,72":[111],"169,72":[111],"168,73":[111],"169,73":[111],"170,73":[111],"169,74":[111],"170,74":[111],"169,75":[94],"170,75":[94],"169,76":[111],"170,76":[111],"169,77":[94],"170,77":[73,143],"171,77":[73],"172,77":[73],"171,76":[111],"172,76":[111],"171,75":[73],"172,75":[73],"171,74":[73,139],"172,74":[73],"171,73":[73],"172,73":[73],"171,72":[111],"172,72":[111],"170,72":[111],"173,72":[111],"173,73":[111],"173,74":[111],"173,75":[111],"173,76":[73],"173,77":[73]},"lvl-161,76":{"161,75":[73],"160,76":[73,139],"161,77":[73,143],"161,76":[73],"160,77":[73],"161,78":[73],"160,78":[73],"159,78":[73],"159,77":[94],"158,78":[73],"158,77":[73],"157,78":[73],"157,77":[73],"156,78":[73],"156,77":[73],"156,76":[73],"157,76":[73],"156,75":[73],"157,75":[73],"158,75":[73],"159,75":[73],"158,76":[73],"159,76":[94,140],"160,75":[73]},"lvl-165,81":{"166,81":[73],"165,80":[73,138],"165,82":[73,138],"166,82":[73,140],"165,81":[73],"165,83":[73],"166,83":[73],"165,84":[111],"166,84":[73],"167,84":[111],"168,84":[111],"167,83":[73],"168,83":[94],"167,82":[73],"168,82":[111],"167,81":[73],"168,81":[73],"167,80":[111],"168,80":[73],"167,79":[111],"166,80":[73],"166,79":[73],"165,79":[73],"168,79":[73],"169,79":[73],"170,79":[73],"169,80":[73,138],"170,80":[111],"169,81":[73],"170,81":[111],"169,82":[73,143],"170,82":[111],"169,83":[94],"170,83":[94],"169,84":[111],"170,84":[111],"171,84":[111],"172,84":[111],"171,83":[73],"172,83":[111],"171,82":[73,139],"172,82":[111],"171,81":[73],"172,81":[111],"171,80":[111],"172,80":[111],"171,79":[73],"172,79":[73]},"lvl-161,82":{"161,81":[73],"160,82":[111],"161,83":[111],"161,82":[73],"160,83":[111],"161,84":[111],"160,84":[111],"161,85":[73],"160,85":[73],"161,86":[111],"160,86":[111],"159,86":[111],"159,85":[73,143],"158,86":[73],"158,85":[73],"157,86":[73],"157,85":[94],"156,86":[111],"156,85":[73],"155,86":[111],"155,85":[73],"154,86":[111],"154,85":[73],"154,84":[111],"155,84":[111],"154,83":[111],"155,83":[111],"154,82":[73],"155,82":[73],"154,81":[111],"155,81":[73],"154,80":[111],"155,80":[111],"156,80":[111],"157,80":[73],"156,81":[73,140,139],"157,81":[73],"156,82":[111],"157,82":[94],"156,83":[111],"157,83":[73],"156,84":[111],"157,84":[94],"158,84":[111],"159,84":[111],"158,83":[73,138],"159,83":[73],"158,82":[111],"159,82":[73],"158,81":[73],"159,81":[73,138],"158,80":[73],"159,80":[111],"160,80":[111],"161,80":[111],"160,81":[73]},"lvl-165,88":{"166,88":[73],"165,87":[73],"165,89":[111],"166,89":[73],"165,88":[73],"165,90":[111],"166,90":[73],"165,91":[111],"166,91":[73],"167,91":[73,139],"168,91":[73],"167,90":[73,143],"168,90":[73],"167,89":[73,138],"168,89":[111],"167,88":[73],"168,88":[94],"167,87":[73,138],"168,87":[111],"167,86":[73],"166,87":[73],"166,86":[111],"165,86":[111],"168,86":[111],"169,86":[111],"170,86":[111],"169,87":[111],"170,87":[111],"169,88":[94,140],"170,88":[94],"169,89":[111],"170,89":[111],"169,90":[111],"170,90":[111],"169,91":[73],"170,91":[111],"171,91":[73],"172,91":[73],"171,90":[73,143],"172,90":[73],"171,89":[73],"172,89":[73],"171,88":[73],"172,88":[73],"171,87":[111],"172,87":[111],"171,86":[111],"172,86":[111],"173,86":[111],"173,87":[111],"173,88":[111],"173,89":[111],"173,90":[111],"173,91":[111]},"lvl-126,97":{"126,96":[73],"125,97":[73,140],"126,98":[73],"126,97":[73],"125,98":[73],"126,99":[73,139],"125,99":[73],"124,99":[73],"124,98":[73],"123,99":[73],"123,98":[73],"122,99":[111],"122,98":[73,143],"121,99":[73,139],"121,98":[73],"120,99":[73],"120,98":[73],"119,99":[73],"119,98":[73],"118,99":[73],"118,98":[73],"117,99":[111],"117,98":[73,143],"117,97":[111],"118,97":[73],"117,96":[73,143],"118,96":[73],"117,95":[111],"118,95":[73],"119,95":[73],"120,95":[73],"119,96":[73],"120,96":[73],"119,97":[73,140],"120,97":[73,140],"121,97":[73],"122,97":[111],"121,96":[73],"122,96":[73,143],"121,95":[111],"122,95":[111],"123,95":[73],"124,95":[73],"123,96":[73],"124,96":[73],"123,97":[73],"124,97":[73,140],"125,96":[73],"125,95":[73],"126,95":[111]},"lvl-130,103":{"131,103":[73],"130,102":[73,140],"131,102":[73,143],"130,101":[73,140],"130,103":[73],"131,101":[73,143],"132,101":[111],"133,101":[73,139],"132,102":[73],"133,102":[73],"132,103":[111],"133,103":[111],"134,103":[111],"135,103":[111],"134,102":[73],"135,102":[73],"134,101":[73],"135,101":[73],"136,101":[73],"137,101":[111],"136,102":[73],"137,102":[111],"136,103":[111],"137,103":[111]},"lvl-126,104":{"126,103":[73,139],"125,104":[73],"126,105":[73],"126,104":[73],"125,105":[111],"124,105":[111],"124,104":[73],"123,105":[111],"123,104":[73],"122,105":[111],"122,104":[111],"121,105":[111],"121,104":[111],"120,105":[111],"120,104":[73],"120,103":[73],"121,103":[111],"120,102":[111],"121,102":[111],"122,102":[111],"123,102":[73],"122,103":[73,140],"123,103":[73,140,144],"124,103":[73,140,144],"125,103":[73,143],"124,102":[73],"125,102":[73],"126,102":[73]},"lvl-130,106":{"131,106":[73,139],"130,105":[73,140],"130,107":[73],"131,107":[111],"130,106":[73],"132,107":[111],"133,107":[73],"132,106":[73],"133,106":[73],"132,105":[111],"133,105":[73,143],"131,105":[73],"134,105":[73],"135,105":[111],"134,106":[73],"135,106":[111],"134,107":[73],"135,107":[111]},"lvl-126,109":{"126,108":[73,139],"125,109":[73,143],"126,110":[111],"126,109":[73],"125,110":[73],"124,110":[111],"124,109":[73],"123,110":[111],"123,109":[111],"122,110":[73],"122,109":[73],"121,110":[73],"121,109":[73,143],"120,110":[111],"120,109":[73],"119,110":[111],"119,109":[111],"119,108":[111],"120,108":[73],"119,107":[111],"120,107":[111],"121,107":[111],"122,107":[111],"121,108":[73],"122,108":[73,140],"123,108":[73,140],"124,108":[73],"123,107":[111],"124,107":[111],"125,107":[73],"126,107":[73],"125,108":[73]},"lvl-130,111":{"131,111":[73],"130,110":[73,140],"131,110":[73],"130,109":[111],"130,111":[73],"131,109":[111],"132,109":[73,143],"133,109":[73],"132,110":[73,139],"133,110":[73],"132,111":[73,140,144],"133,111":[73],"134,111":[73],"135,111":[73],"134,110":[111],"135,110":[111],"134,109":[111],"135,109":[111]},"lvl-126,114":{"126,113":[73],"125,114":[73,140],"126,115":[73,139],"126,114":[73],"125,115":[73],"126,116":[111],"125,116":[73],"124,116":[73],"124,115":[73,143],"123,116":[111],"123,115":[111],"123,114":[73],"124,114":[73],"123,113":[111],"124,113":[73,143],"123,112":[111],"124,112":[73],"125,112":[111],"126,112":[111],"125,113":[73,140]},"lvl-130,114":{"131,114":[73],"130,113":[73,140],"130,115":[73],"131,115":[73],"130,114":[73],"132,115":[73],"133,115":[73],"132,114":[73],"133,114":[73,143],"132,113":[73],"133,113":[73],"131,113":[73],"134,113":[73],"135,113":[73],"134,114":[73],"135,114":[73,139],"134,115":[73],"135,115":[73],"136,115":[73],"136,114":[73],"136,113":[73]},"lvl-130,118":{"131,118":[73],"130,117":[111],"130,119":[73],"131,119":[73,143],"130,118":[73],"130,120":[111],"131,120":[111],"132,120":[111],"133,120":[111],"132,119":[73],"133,119":[73,140],"132,118":[73],"133,118":[111],"132,117":[111],"133,117":[111],"131,117":[111],"134,117":[111],"135,117":[73,139],"134,118":[73],"135,118":[73],"134,119":[73],"135,119":[73],"134,120":[111],"135,120":[111],"136,120":[111],"137,120":[111],"136,119":[73],"137,119":[111],"136,118":[73],"137,118":[111],"136,117":[111],"137,117":[111]},"lvl-126,119":{"126,118":[73,143],"125,119":[73,139],"126,120":[111],"126,119":[73],"125,120":[111],"124,120":[73],"124,119":[73,73],"123,120":[111],"123,119":[73,140],"122,120":[111],"122,119":[73],"122,118":[73],"123,118":[73],"124,118":[73],"125,118":[73]},"lvl-126,122":{"125,122":[73],"126,123":[73,140],"126,122":[73],"125,123":[111],"126,124":[73],"125,124":[111],"126,125":[73,139],"125,125":[73],"124,125":[111],"124,124":[73],"123,125":[111],"123,124":[73],"122,125":[111],"122,124":[111],"122,123":[111],"123,123":[73],"122,122":[111],"123,122":[73],"124,122":[73],"124,123":[73,143]},"lvl-130,124":{"131,124":[73],"130,123":[111],"130,125":[111],"131,125":[111],"130,124":[73,140],"132,125":[111],"133,125":[111],"132,124":[73],"133,124":[73],"132,123":[73,143],"133,123":[73],"132,122":[73,139],"131,123":[111],"131,122":[73],"130,122":[111],"133,122":[73],"134,122":[111],"134,123":[111],"134,124":[111],"134,125":[111]},"lvl-106,146":{"107,146":[73],"106,145":[73],"105,146":[73],"106,146":[73],"105,145":[73],"104,146":[73],"104,145":[73],"103,146":[73],"103,145":[73],"102,146":[73],"102,145":[73],"101,146":[73],"101,145":[73],"100,146":[73],"100,145":[73],"100,144":[73],"101,144":[73],"100,143":[73],"101,143":[73],"100,142":[73],"101,142":[73],"100,141":[73],"101,141":[73],"100,140":[73],"101,140":[111],"100,139":[73],"101,139":[111],"100,138":[73],"101,138":[111],"100,137":[111],"101,137":[111],"102,137":[111],"103,137":[111],"102,138":[73,140],"103,138":[111],"102,139":[73,140],"103,139":[111],"102,140":[94],"103,140":[111],"102,141":[73],"103,141":[73],"102,142":[73],"103,142":[73],"102,143":[73],"103,143":[73,143],"102,144":[73],"103,144":[73],"104,144":[73],"105,144":[73],"104,143":[73,143],"105,143":[73,143],"104,142":[73],"105,142":[73],"104,141":[73],"105,141":[73],"104,140":[73,143],"105,140":[73,138,128],"104,139":[73],"105,139":[73],"104,138":[73],"105,138":[73],"104,137":[111],"105,137":[111],"106,137":[111],"107,137":[111],"106,138":[111],"107,138":[94,140],"106,139":[111],"107,139":[94],"106,140":[111],"107,140":[94],"106,141":[73],"107,141":[73],"106,142":[73],"107,142":[73],"106,143":[73,143],"107,143":[73,143,128],"106,144":[73],"107,144":[73],"108,144":[73],"107,145":[73],"108,145":[73],"109,145":[73],"108,146":[73],"109,146":[73],"110,146":[73],"111,146":[73],"110,145":[73],"111,145":[73],"110,144":[73],"111,144":[73],"110,143":[73,143,128],"109,144":[73],"109,143":[73,143,128],"109,142":[73],"108,143":[73,143,128],"108,142":[73],"108,141":[73],"109,141":[73],"108,140":[111],"109,140":[73],"108,139":[111],"109,139":[73],"108,138":[111],"109,138":[73],"108,137":[111],"109,137":[111],"110,137":[111],"111,137":[73],"110,138":[111],"111,138":[73],"110,139":[111],"111,139":[73,140],"110,140":[111],"111,140":[73],"110,141":[73],"111,141":[73],"110,142":[73],"111,142":[73],"112,142":[111],"111,143":[73,142],"112,143":[111],"112,144":[111],"112,145":[111],"112,146":[111],"112,141":[111],"112,140":[111],"112,139":[111],"112,138":[111],"112,137":[111]},"lvl-118,146":{"119,146":[73],"118,145":[111],"117,146":[73],"118,146":[73],"117,145":[94],"116,146":[73],"116,145":[111],"116,144":[111],"117,144":[73,140],"116,143":[111],"117,143":[73],"116,142":[111],"117,142":[111],"116,141":[111],"117,141":[73],"118,141":[73,142],"119,141":[73],"118,142":[111],"119,142":[111],"118,143":[111],"119,143":[111],"118,144":[111],"119,144":[73],"120,144":[73],"119,145":[73,143,128],"120,145":[73,138,128],"121,145":[73,143],"120,146":[73],"121,146":[73],"122,146":[73],"122,145":[111],"122,144":[111],"122,143":[111],"121,144":[73],"121,143":[73],"121,142":[111],"120,143":[111],"120,142":[111],"120,141":[111],"121,141":[111],"122,141":[111],"122,142":[111]},"lvl-130,146":{"130,145":[73],"129,146":[73],"130,146":[73],"129,145":[73],"128,146":[73],"128,145":[73],"127,146":[111],"127,145":[111],"126,146":[73],"126,145":[73],"125,146":[73],"125,145":[73],"125,144":[73,143],"126,144":[73,143,128],"125,143":[73],"126,143":[73],"125,142":[73],"126,142":[73,142],"127,142":[111],"128,142":[73],"127,143":[111],"128,143":[94,140],"127,144":[73,143],"128,144":[73],"129,144":[73],"130,144":[73],"129,143":[73],"130,143":[73],"129,142":[73],"130,142":[73]},"lvl-135,146":{"136,146":[73],"135,145":[111],"134,146":[73],"135,146":[73],"134,145":[73,143],"133,146":[73],"133,145":[111],"133,144":[73],"134,144":[73],"133,143":[73],"134,143":[73,143],"133,142":[73],"134,142":[111],"135,142":[111],"136,142":[111],"135,143":[73],"136,143":[73,143,128],"135,144":[94,140],"136,144":[73],"137,144":[73],"136,145":[73,142],"137,145":[111],"137,146":[111],"137,143":[73],"137,142":[111]},"lvl-142,146":{"143,146":[111],"142,145":[73],"141,146":[73],"142,146":[73],"141,145":[73,143,128],"140,146":[73],"140,145":[73,143],"140,144":[73],"141,144":[73],"140,143":[73],"141,143":[73,139],"140,142":[94],"141,142":[111],"140,141":[73],"141,141":[111],"140,140":[73,140],"141,140":[111],"140,139":[111],"141,139":[111],"142,139":[111],"143,139":[111],"142,140":[73,140],"143,140":[111],"142,141":[73],"143,141":[111],"142,142":[94],"143,142":[111],"142,143":[73],"143,143":[111],"142,144":[73],"143,144":[111],"143,145":[111]},"lvl-118,150":{"119,150":[111],"117,150":[111],"118,151":[73,140],"119,151":[111],"118,150":[73],"117,151":[111],"118,152":[73],"119,152":[111],"117,152":[111],"118,153":[73],"119,153":[111],"117,153":[111],"118,154":[73],"119,154":[111],"117,154":[111],"118,155":[73],"119,155":[111],"117,155":[111],"118,156":[73],"119,156":[111],"117,156":[111],"118,157":[73,142],"119,157":[73],"117,157":[73],"118,158":[73],"119,158":[73],"117,158":[73],"118,159":[73],"119,159":[73],"117,159":[73],"118,160":[111],"119,160":[111],"117,160":[111],"116,160":[111],"116,159":[73],"115,160":[111],"115,159":[73],"114,160":[111],"114,159":[111],"113,160":[111],"113,159":[73],"112,160":[111],"112,159":[73],"112,158":[73],"113,158":[73,143],"112,157":[73],"113,157":[73],"112,156":[73],"113,156":[73,143,128],"112,155":[73],"113,155":[73],"112,154":[111],"113,154":[73],"112,153":[111],"113,153":[73],"112,152":[73],"113,152":[73],"112,151":[73],"113,151":[73],"112,150":[111],"113,150":[111],"114,150":[111],"115,150":[73],"114,151":[73],"115,151":[73],"114,152":[111],"115,152":[111],"114,153":[111],"115,153":[111],"114,154":[111],"115,154":[111],"114,155":[111],"115,155":[111],"114,156":[111],"115,156":[111],"114,157":[111],"115,157":[73],"114,158":[111],"115,158":[73],"116,158":[73],"116,157":[73],"116,156":[73],"116,155":[73],"116,154":[73],"116,153":[73],"116,152":[73],"116,151":[73],"116,150":[73],"120,160":[111],"120,159":[111],"120,158":[111],"120,157":[111],"120,156":[111],"120,155":[111],"120,154":[111],"120,153":[111],"120,152":[111],"120,151":[111],"120,150":[111]},"lvl-126,150":{"127,150":[73,138,128],"125,150":[111],"126,151":[73,138,128],"127,151":[111],"126,150":[73],"125,151":[111],"126,152":[73],"127,152":[111],"125,152":[111],"126,153":[73],"127,153":[111],"125,153":[111],"126,154":[73],"127,154":[73],"125,154":[73],"124,154":[73],"124,153":[73],"123,154":[73],"123,153":[73],"123,152":[73],"124,152":[73,142,128],"123,151":[73],"124,151":[73],"123,150":[73],"124,150":[73]},"lvl-132,150":{"133,150":[73],"131,150":[73],"132,151":[73],"133,151":[73],"132,150":[73],"131,151":[73],"132,152":[73],"133,152":[73,142],"131,152":[73],"132,153":[73,143,128],"133,153":[73],"131,153":[73],"132,154":[73],"133,154":[73],"131,154":[111],"130,154":[111],"130,153":[73,143],"129,154":[111],"129,153":[73],"129,152":[73],"130,152":[73,140],"129,151":[73],"130,151":[73],"129,150":[73],"130,150":[73],"134,154":[111],"134,153":[111],"134,152":[111],"134,151":[111],"134,150":[73]},"lvl-138,150":{"139,150":[111],"137,150":[73],"138,151":[73],"139,151":[73],"138,150":[73],"137,151":[73,143,128],"138,152":[73,139],"139,152":[73],"137,152":[73],"138,153":[73],"139,153":[73,143],"137,153":[73,140],"138,154":[111],"139,154":[111],"137,154":[111],"136,154":[111],"136,153":[73],"136,152":[111],"136,151":[111],"136,150":[111],"140,154":[111],"140,153":[73],"140,152":[73],"140,151":[111],"140,150":[111]},"lvl-144,150":{"145,150":[111],"143,150":[111],"144,151":[73],"145,151":[111],"144,150":[73],"143,151":[111],"144,152":[73],"145,152":[73,142,128],"143,152":[73],"144,153":[111],"145,153":[111],"143,153":[111],"142,153":[111],"142,152":[73],"142,151":[111],"142,150":[111],"146,153":[111],"146,152":[73],"146,151":[111],"146,150":[111]}},se={width:256,height:256},ae={61:"exit",63:"ice",64:"lava",73:"normal",82:"portal_solved",83:"portal_unexplored",84:"portal_unsolved",88:"sign_blocks",91:"sign_sliding",94:"water",97:"normal_blocks",111:"wall",113:"controls",126:"sign_danger",127:"time_immune_area",128:"time_immune",129:"sign_time",136:"sign_bridges",138:"block_basic",139:"block_portal",140:"energy_source",141:"block_hub",142:"block_portal_on",143:"block_stabilizer",144:"block_stabilizer_on"},ue={wall:"111",controls:"113",sign_danger:"126",time_immune_area:"127",time_immune:"128",sign_time:"129",sign_bridges:"136",block_basic:"138",block_portal:"139",energy_source:"140",block_hub:"141",block_portal_on:"142",block_stabilizer:"143",block_stabilizer_on:"144",exit:"61",ice:"63",lava:"64",normal:"73",portal_solved:"82",portal_unexplored:"83",portal_unsolved:"84",sign_blocks:"88",sign_sliding:"91",water:"94",normal_blocks:"97"},le={layers:re,tileSize:se,idToName:ae,nameToId:ue};Z.system([],function(){function e(){T(this,e)}return A(e,[{key:"initialize",value:function(){ne.setData(le),U.send("loadTiles",{layer:"world"})}},{key:"pre",value:function(){U.clear("loaded"),U.process("loadTiles",function(e){ne.loadTiles(e),U.send("loaded",e)})}}]),e}());var ce=p(function(e){!function(t,n,i,o){function r(e,t,n){return setTimeout(c(e,n),t)}function s(e,t,n){return!!Array.isArray(e)&&(a(e,n[t],n),!0)}function a(e,t,n){var i;if(e)if(e.forEach)e.forEach(t,n);else if(e.length!==o)for(i=0;i<e.length;)t.call(n,e[i],i,e),i++;else for(i in e)e.hasOwnProperty(i)&&t.call(n,e[i],i,e)}function u(e,n,i){var o="DEPRECATED METHOD: "+n+"\n"+i+" AT \n";return function(){var n=new Error("get-stack-trace"),i=n&&n.stack?n.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",r=t.console&&(t.console.warn||t.console.log);return r&&r.call(t.console,o,i),e.apply(this,arguments)}}function l(e,t,n){var i,o=t.prototype;i=e.prototype=Object.create(o),i.constructor=e,i._super=o,n&&de(i,n)}function c(e,t){return function(){return e.apply(t,arguments)}}function h(e,t){return(void 0===e?"undefined":x(e))==ve?e.apply(t?t[0]||o:o,t):e}function d(e,t){return e===o?t:e}function f(e,t,n){a(y(t),function(t){e.addEventListener(t,n,!1)})}function p(e,t,n){a(y(t),function(t){e.removeEventListener(t,n,!1)})}function v(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function _(e,t){return e.indexOf(t)>-1}function y(e){return e.trim().split(/\s+/g)}function m(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var i=0;i<e.length;){if(n&&e[i][n]==t||!n&&e[i]===t)return i;i++}return-1}function g(e){return Array.prototype.slice.call(e,0)}function b(e,t,n){for(var i=[],o=[],r=0;r<e.length;){var s=t?e[r][t]:e[r];m(o,s)<0&&i.push(e[r]),o[r]=s,r++}return n&&(i=t?i.sort(function(e,n){return e[t]>n[t]}):i.sort()),i}function k(e,t){for(var n,i,r=t[0].toUpperCase()+t.slice(1),s=0;s<fe.length;){if(n=fe[s],(i=n?n+r:t)in e)return i;s++}return o}function w(){return ke++}function T(e){var n=e.ownerDocument||e;return n.defaultView||n.parentWindow||t}function A(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){h(e.options.enable,[e])&&n.handler(t)},this.init()}function S(e){var t=e.options.inputClass;return new(t||(Te?j:Ae?W:xe?X:B))(e,z)}function z(e,t,n){var i=n.pointers.length,o=n.changedPointers.length,r=t&ze&&i-o==0,s=t&(Ee|Pe)&&i-o==0;n.isFirst=!!r,n.isFinal=!!s,r&&(e.session={}),n.eventType=t,I(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function I(e,t){var n=e.session,i=t.pointers,o=i.length;n.firstInput||(n.firstInput=O(t)),o>1&&!n.firstMultiple?n.firstMultiple=O(t):1===o&&(n.firstMultiple=!1);var r=n.firstInput,s=n.firstMultiple,a=s?s.center:r.center,u=t.center=M(i);t.timeStamp=me(),t.deltaTime=t.timeStamp-r.timeStamp,t.angle=R(a,u),t.distance=L(a,u),E(n,t),t.offsetDirection=D(t.deltaX,t.deltaY);var l=C(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=l.x,t.overallVelocityY=l.y,t.overallVelocity=ye(l.x)>ye(l.y)?l.x:l.y,t.scale=s?F(s.pointers,i):1,t.rotation=s?q(s.pointers,i):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,P(n,t);var c=e.element;v(t.srcEvent.target,c)&&(c=t.srcEvent.target),t.target=c}function E(e,t){var n=t.center,i=e.offsetDelta||{},o=e.prevDelta||{},r=e.prevInput||{};t.eventType!==ze&&r.eventType!==Ee||(o=e.prevDelta={x:r.deltaX||0,y:r.deltaY||0},i=e.offsetDelta={x:n.x,y:n.y}),t.deltaX=o.x+(n.x-i.x),t.deltaY=o.y+(n.y-i.y)}function P(e,t){var n,i,r,s,a=e.lastInterval||t,u=t.timeStamp-a.timeStamp;if(t.eventType!=Pe&&(u>Se||a.velocity===o)){var l=t.deltaX-a.deltaX,c=t.deltaY-a.deltaY,h=C(u,l,c);i=h.x,r=h.y,n=ye(h.x)>ye(h.y)?h.x:h.y,s=D(l,c),e.lastInterval=t}else n=a.velocity,i=a.velocityX,r=a.velocityY,s=a.direction;t.velocity=n,t.velocityX=i,t.velocityY=r,t.direction=s}function O(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:_e(e.pointers[n].clientX),clientY:_e(e.pointers[n].clientY)},n++;return{timeStamp:me(),pointers:t,center:M(t),deltaX:e.deltaX,deltaY:e.deltaY}}function M(e){var t=e.length;if(1===t)return{x:_e(e[0].clientX),y:_e(e[0].clientY)};for(var n=0,i=0,o=0;o<t;)n+=e[o].clientX,i+=e[o].clientY,o++;return{x:_e(n/t),y:_e(i/t)}}function C(e,t,n){return{x:t/e||0,y:n/e||0}}function D(e,t){return e===t?Oe:ye(e)>=ye(t)?e<0?Me:Ce:t<0?De:Le}function L(e,t,n){n||(n=Be);var i=t[n[0]]-e[n[0]],o=t[n[1]]-e[n[1]];return Math.sqrt(i*i+o*o)}function R(e,t,n){n||(n=Be);var i=t[n[0]]-e[n[0]],o=t[n[1]]-e[n[1]];return 180*Math.atan2(o,i)/Math.PI}function q(e,t){return R(t[1],t[0],je)+R(e[1],e[0],je)}function F(e,t){return L(t[0],t[1],je)/L(e[0],e[1],je)}function B(){this.evEl=Ge,this.evWin=We,this.pressed=!1,A.apply(this,arguments)}function j(){this.evEl=Ve,this.evWin=Ke,A.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function N(){this.evTarget=Ue,this.evWin=$e,this.started=!1,A.apply(this,arguments)}function G(e,t){var n=g(e.touches),i=g(e.changedTouches);return t&(Ee|Pe)&&(n=b(n.concat(i),"identifier",!0)),[n,i]}function W(){this.evTarget=Ze,this.targetIds={},A.apply(this,arguments)}function H(e,t){var n=g(e.touches),i=this.targetIds;if(t&(ze|Ie)&&1===n.length)return i[n[0].identifier]=!0,[n,n];var o,r,s=g(e.changedTouches),a=[],u=this.target;if(r=n.filter(function(e){return v(e.target,u)}),t===ze)for(o=0;o<r.length;)i[r[o].identifier]=!0,o++;for(o=0;o<s.length;)i[s[o].identifier]&&a.push(s[o]),t&(Ee|Pe)&&delete i[s[o].identifier],o++;return a.length?[b(r.concat(a),"identifier",!0),a]:void 0}function X(){A.apply(this,arguments);var e=c(this.handler,this);this.touch=new W(this.manager,e),this.mouse=new B(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function V(e,t){e&ze?(this.primaryTouch=t.changedPointers[0].identifier,K.call(this,t)):e&(Ee|Pe)&&K.call(this,t)}function K(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var i=this.lastTouches,o=function(){var e=i.indexOf(n);e>-1&&i.splice(e,1)};setTimeout(o,Qe)}}function Y(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var o=this.lastTouches[i],r=Math.abs(t-o.x),s=Math.abs(n-o.y);if(r<=et&&s<=et)return!0}return!1}function U(e,t){this.manager=e,this.set(t)}function $(e){if(_(e,rt))return rt;var t=_(e,st),n=_(e,at);return t&&n?rt:t||n?t?st:at:_(e,ot)?ot:it}function J(e){this.options=de({},this.defaults,e||{}),this.id=w(),this.manager=null,this.options.enable=d(this.options.enable,!0),this.state=lt,this.simultaneous={},this.requireFail=[]}function Z(e){return e&pt?"cancel":e&dt?"end":e&ht?"move":e&ct?"start":""}function Q(e){return e==Le?"down":e==De?"up":e==Me?"left":e==Ce?"right":""}function ee(e,t){var n=t.manager;return n?n.get(e):e}function te(){J.apply(this,arguments)}function ne(){te.apply(this,arguments),this.pX=null,this.pY=null}function ie(){te.apply(this,arguments)}function oe(){J.apply(this,arguments),this._timer=null,this._input=null}function re(){te.apply(this,arguments)}function se(){te.apply(this,arguments)}function ae(){J.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function ue(e,t){return t=t||{},t.recognizers=d(t.recognizers,ue.defaults.preset),new le(e,t)}function le(e,t){this.options=de({},ue.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,
this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=S(this),this.touchAction=new U(this,this.options.touchAction),ce(this,!0),a(this.options.recognizers,function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])},this)}function ce(e,t){var n=e.element;if(n.style){var i;a(e.options.cssProps,function(o,r){i=k(n.style,r),t?(e.oldCssProps[i]=n.style[i],n.style[i]=o):n.style[i]=e.oldCssProps[i]||""}),t||(e.oldCssProps={})}}function he(e,t){var i=n.createEvent("Event");i.initEvent(e,!0,!0),i.gesture=t,t.target.dispatchEvent(i)}var de,fe=["","webkit","Moz","MS","ms","o"],pe=n.createElement("div"),ve="function",_e=Math.round,ye=Math.abs,me=Date.now;de="function"!=typeof Object.assign?function(e){if(e===o||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(i!==o&&null!==i)for(var r in i)i.hasOwnProperty(r)&&(t[r]=i[r])}return t}:Object.assign;var ge=u(function(e,t,n){for(var i=Object.keys(t),r=0;r<i.length;)(!n||n&&e[i[r]]===o)&&(e[i[r]]=t[i[r]]),r++;return e},"extend","Use `assign`."),be=u(function(e,t){return ge(e,t,!0)},"merge","Use `assign`."),ke=1,we=/mobile|tablet|ip(ad|hone|od)|android/i,xe="ontouchstart"in t,Te=k(t,"PointerEvent")!==o,Ae=xe&&we.test(navigator.userAgent),Se=25,ze=1,Ie=2,Ee=4,Pe=8,Oe=1,Me=2,Ce=4,De=8,Le=16,Re=Me|Ce,qe=De|Le,Fe=Re|qe,Be=["x","y"],je=["clientX","clientY"];A.prototype={handler:function(){},init:function(){this.evEl&&f(this.element,this.evEl,this.domHandler),this.evTarget&&f(this.target,this.evTarget,this.domHandler),this.evWin&&f(T(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&p(this.element,this.evEl,this.domHandler),this.evTarget&&p(this.target,this.evTarget,this.domHandler),this.evWin&&p(T(this.element),this.evWin,this.domHandler)}};var Ne={mousedown:ze,mousemove:Ie,mouseup:Ee},Ge="mousedown",We="mousemove mouseup";l(B,A,{handler:function(e){var t=Ne[e.type];t&ze&&0===e.button&&(this.pressed=!0),t&Ie&&1!==e.which&&(t=Ee),this.pressed&&(t&Ee&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}});var He={pointerdown:ze,pointermove:Ie,pointerup:Ee,pointercancel:Pe,pointerout:Pe},Xe={2:"touch",3:"pen",4:"mouse",5:"kinect"},Ve="pointerdown",Ke="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(Ve="MSPointerDown",Ke="MSPointerMove MSPointerUp MSPointerCancel"),l(j,A,{handler:function(e){var t=this.store,n=!1,i=e.type.toLowerCase().replace("ms",""),o=He[i],r=Xe[e.pointerType]||e.pointerType,s="touch"==r,a=m(t,e.pointerId,"pointerId");o&ze&&(0===e.button||s)?a<0&&(t.push(e),a=t.length-1):o&(Ee|Pe)&&(n=!0),a<0||(t[a]=e,this.callback(this.manager,o,{pointers:t,changedPointers:[e],pointerType:r,srcEvent:e}),n&&t.splice(a,1))}});var Ye={touchstart:ze,touchmove:Ie,touchend:Ee,touchcancel:Pe},Ue="touchstart",$e="touchstart touchmove touchend touchcancel";l(N,A,{handler:function(e){var t=Ye[e.type];if(t===ze&&(this.started=!0),this.started){var n=G.call(this,e,t);t&(Ee|Pe)&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:e})}}});var Je={touchstart:ze,touchmove:Ie,touchend:Ee,touchcancel:Pe},Ze="touchstart touchmove touchend touchcancel";l(W,A,{handler:function(e){var t=Je[e.type],n=H.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:e})}});var Qe=2500,et=25;l(X,A,{handler:function(e,t,n){var i="touch"==n.pointerType,o="mouse"==n.pointerType;if(!(o&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(i)V.call(this,t,n);else if(o&&Y.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var tt=k(pe.style,"touchAction"),nt=tt!==o,it="auto",ot="manipulation",rt="none",st="pan-x",at="pan-y",ut=function(){if(!nt)return!1;var e={},n=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(i){e[i]=!n||t.CSS.supports("touch-action",i)}),e}();U.prototype={set:function(e){"compute"==e&&(e=this.compute()),nt&&this.manager.element.style&&ut[e]&&(this.manager.element.style[tt]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return a(this.manager.recognizers,function(t){h(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),$(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(this.manager.session.prevented)return void t.preventDefault();var i=this.actions,o=_(i,rt)&&!ut[rt],r=_(i,at)&&!ut[at],s=_(i,st)&&!ut[st];if(o){var a=1===e.pointers.length,u=e.distance<2,l=e.deltaTime<250;if(a&&u&&l)return}return s&&r?void 0:o||r&&n&Re||s&&n&qe?this.preventSrc(t):void 0},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var lt=1,ct=2,ht=4,dt=8,ft=dt,pt=16;J.prototype={defaults:{},set:function(e){return de(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(s(e,"recognizeWith",this))return this;var t=this.simultaneous;return e=ee(e,this),t[e.id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return s(e,"dropRecognizeWith",this)?this:(e=ee(e,this),delete this.simultaneous[e.id],this)},requireFailure:function(e){if(s(e,"requireFailure",this))return this;var t=this.requireFail;return e=ee(e,this),-1===m(t,e)&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(s(e,"dropRequireFailure",this))return this;e=ee(e,this);var t=m(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){function t(t){n.manager.emit(t,e)}var n=this,i=this.state;i<dt&&t(n.options.event+Z(i)),t(n.options.event),e.additionalEvent&&t(e.additionalEvent),i>=dt&&t(n.options.event+Z(i))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=32},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(32|lt)))return!1;e++}return!0},recognize:function(e){var t=de({},e);if(!h(this.options.enable,[this,t]))return this.reset(),void(this.state=32);this.state&(ft|pt|32)&&(this.state=lt),this.state=this.process(t),this.state&(ct|ht|dt|pt)&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},l(te,J,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,i=t&(ct|ht),o=this.attrTest(e);return i&&(n&Pe||!o)?t|pt:i||o?n&Ee?t|dt:t&ct?t|ht:ct:32}}),l(ne,te,{defaults:{event:"pan",threshold:10,pointers:1,direction:Fe},getTouchAction:function(){var e=this.options.direction,t=[];return e&Re&&t.push(at),e&qe&&t.push(st),t},directionTest:function(e){var t=this.options,n=!0,i=e.distance,o=e.direction,r=e.deltaX,s=e.deltaY;return o&t.direction||(t.direction&Re?(o=0===r?Oe:r<0?Me:Ce,n=r!=this.pX,i=Math.abs(e.deltaX)):(o=0===s?Oe:s<0?De:Le,n=s!=this.pY,i=Math.abs(e.deltaY))),e.direction=o,n&&i>t.threshold&&o&t.direction},attrTest:function(e){return te.prototype.attrTest.call(this,e)&&(this.state&ct||!(this.state&ct)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=Q(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),l(ie,te,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[rt]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||this.state&ct)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),l(oe,J,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[it]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,i=e.distance<t.threshold,o=e.deltaTime>t.time;if(this._input=e,!i||!n||e.eventType&(Ee|Pe)&&!o)this.reset();else if(e.eventType&ze)this.reset(),this._timer=r(function(){this.state=ft,this.tryEmit()},t.time,this);else if(e.eventType&Ee)return ft;return 32},reset:function(){clearTimeout(this._timer)},emit:function(e){this.state===ft&&(e&&e.eventType&Ee?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=me(),this.manager.emit(this.options.event,this._input)))}}),l(re,te,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[rt]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||this.state&ct)}}),l(se,te,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Re|qe,pointers:1},getTouchAction:function(){return ne.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return n&(Re|qe)?t=e.overallVelocity:n&Re?t=e.overallVelocityX:n&qe&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&ye(t)>this.options.velocity&&e.eventType&Ee},emit:function(e){var t=Q(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),l(ae,J,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ot]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,i=e.distance<t.threshold,o=e.deltaTime<t.time;if(this.reset(),e.eventType&ze&&0===this.count)return this.failTimeout();if(i&&o&&n){if(e.eventType!=Ee)return this.failTimeout();var s=!this.pTime||e.timeStamp-this.pTime<t.interval,a=!this.pCenter||L(this.pCenter,e.center)<t.posThreshold;this.pTime=e.timeStamp,this.pCenter=e.center,a&&s?this.count+=1:this.count=1,this._input=e;if(0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=r(function(){this.state=ft,this.tryEmit()},t.interval,this),ct):ft}return 32},failTimeout:function(){return this._timer=r(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ft&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),ue.VERSION="2.0.7",ue.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[re,{enable:!1}],[ie,{enable:!1},["rotate"]],[se,{direction:Re}],[ne,{direction:Re},["swipe"]],[ae],[ae,{event:"doubletap",taps:2},["tap"]],[oe]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};le.prototype={set:function(e){return de(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){this.touchAction.preventDefaults(e);var n,i=this.recognizers,o=t.curRecognizer;(!o||o&&o.state&ft)&&(o=t.curRecognizer=null);for(var r=0;r<i.length;)n=i[r],2===t.stopped||o&&n!=o&&!n.canRecognizeWith(o)?n.reset():n.recognize(e),!o&&n.state&(ct|ht|dt)&&(o=t.curRecognizer=n),r++}},get:function(e){if(e instanceof J)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(s(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(s(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=m(t,e);-1!==n&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(e!==o&&t!==o){var n=this.handlers;return a(y(e),function(e){n[e]=n[e]||[],n[e].push(t)}),this}},off:function(e,t){if(e!==o){var n=this.handlers;return a(y(e),function(e){t?n[e]&&n[e].splice(m(n[e],t),1):delete n[e]}),this}},emit:function(e,t){this.options.domEvents&&he(e,t);var n=this.handlers[e]&&this.handlers[e].slice();if(n&&n.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var i=0;i<n.length;)n[i](t),i++}},destroy:function(){this.element&&ce(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},de(ue,{INPUT_START:ze,INPUT_MOVE:Ie,INPUT_END:Ee,INPUT_CANCEL:Pe,STATE_POSSIBLE:lt,STATE_BEGAN:ct,STATE_CHANGED:ht,STATE_ENDED:dt,STATE_RECOGNIZED:ft,STATE_CANCELLED:pt,STATE_FAILED:32,DIRECTION_NONE:Oe,DIRECTION_LEFT:Me,DIRECTION_RIGHT:Ce,DIRECTION_UP:De,DIRECTION_DOWN:Le,DIRECTION_HORIZONTAL:Re,DIRECTION_VERTICAL:qe,DIRECTION_ALL:Fe,Manager:le,Input:A,TouchAction:U,TouchInput:W,MouseInput:B,PointerEventInput:j,TouchMouseInput:X,SingleTouchInput:N,Recognizer:J,AttrRecognizer:te,Tap:ae,Pan:ne,Swipe:se,Pinch:ie,Rotate:re,Press:oe,on:f,off:p,each:a,merge:be,extend:ge,assign:de,inherit:l,bindFn:c,prefixed:k}),(void 0!==t?t:"undefined"!=typeof self?self:{}).Hammer=ue,"function"==typeof o&&o.amd?o(function(){return ue}):e.exports?e.exports=ue:t.Hammer=ue}(window,document)}),he=p(function(e,t){(function(){var e,n,i,o,r,s,a,u,l,c,h,d,f,p,v,_,y,m,g,b,k,w,x={}.hasOwnProperty,T=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};l={is_unordered:!1,is_counting:!1,is_exclusive:!1,is_solitary:!1,prevent_default:!1,prevent_repeat:!1},k=["meta","alt","option","ctrl","shift","cmd"],g="ctrl",n={},n.debug=!1,e=function(){function e(e){var t,n;for(t in e)x.call(e,t)&&!1!==(n=e[t])&&(this[t]=n);this.keys=this.keys||[],this.count=this.count||0}return e.prototype.allows_key_repeat=function(){return!this.prevent_repeat&&"function"==typeof this.on_keydown},e.prototype.reset=function(){return this.count=0,this.keyup_fired=null},e}(),n.Listener=function(){function t(e,t){var n,i,o;"undefined"!=typeof jQuery&&null!==jQuery&&e instanceof jQuery&&(1!==e.length&&m("Warning: your jQuery selector should have exactly one object."),e=e[0]),this.should_suppress_event_defaults=!1,this.should_force_event_defaults=!1,this.sequence_delay=800,this._registered_combos=[],this._keys_down=[],this._active_combos=[],this._sequence=[],this._sequence_timer=null,this._prevent_capture=!1,this._defaults=t||{};for(i in l)x.call(l,i)&&(o=l[i],this._defaults[i]=this._defaults[i]||o);this.element=e||document.body,n=function(e,t,n){return e.addEventListener?e.addEventListener(t,n):e.attachEvent&&e.attachEvent("on"+t,n),n},this.keydown_event=n(this.element,"keydown",function(e){return function(t){return t=t||window.event,e._receive_input(t,!0),e._bug_catcher(t)}}(this)),this.keyup_event=n(this.element,"keyup",function(e){return function(t){return t=t||window.event,e._receive_input(t,!1)}}(this)),this.blur_event=n(window,"blur",function(e){return function(){var t,n,i,o;for(o=e._keys_down,n=0,i=o.length;n<i;n++)t=o[n],e._key_up(t,{});return e._keys_down=[]}}(this))}return t.prototype.destroy=function(){var e;return e=function(e,t,n){return null!=e.removeEventListener?e.removeEventListener(t,n):null!=e.removeEvent?e.removeEvent("on"+t,n):void 0},e(this.element,"keydown",this.keydown_event),e(this.element,"keyup",this.keyup_event),e(window,"blur",this.blur_event)},t.prototype._bug_catcher=function(e){var t,n;if("cmd"===g&&T.call(this._keys_down,"cmd")>=0&&"cmd"!==(t=s(null!=(n=e.keyCode)?n:e.key))&&"shift"!==t&&"alt"!==t&&"caps"!==t&&"tab"!==t)return this._receive_input(e,!1)},t.prototype._cmd_bug_check=function(e){return!("cmd"===g&&T.call(this._keys_down,"cmd")>=0&&T.call(e,"cmd")<0)},t.prototype._prevent_default=function(e,t){if((t||this.should_suppress_event_defaults)&&!this.should_force_event_defaults&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation))return e.stopPropagation()},t.prototype._get_active_combos=function(e){var t,n;return t=[],n=c(this._keys_down,function(t){return t!==e}),n.push(e),this._match_combo_arrays(n,function(e){return function(n){if(e._cmd_bug_check(n.keys))return t.push(n)}}(this)),this._fuzzy_match_combo_arrays(n,function(e){return function(n){if(!(T.call(t,n)>=0))return!n.is_solitary&&e._cmd_bug_check(n.keys)?t.push(n):void 0}}(this)),t},t.prototype._get_potential_combos=function(e){var t,n,i,o,r;for(n=[],r=this._registered_combos,i=0,o=r.length;i<o;i++)t=r[i],t.is_sequence||T.call(t.keys,e)>=0&&this._cmd_bug_check(t.keys)&&n.push(t);return n},t.prototype._add_to_active_combos=function(e){var t,n,i,o,r,s,a,u,l,c,h,d,f,p,v;if(u=!1,a=!0,o=!1,T.call(this._active_combos,e)>=0)return!0;if(this._active_combos.length)for(s=l=0,p=this._active_combos.length;0<=p?l<p:l>p;s=0<=p?++l:--l)if((t=this._active_combos[s])&&t.is_exclusive&&e.is_exclusive){if(i=t.keys,!u)for(c=0,d=i.length;c<d;c++)if(n=i[c],u=!0,T.call(e.keys,n)<0){u=!1;break}if(a&&!u)for(v=e.keys,h=0,f=v.length;h<f;h++)if(r=v[h],a=!1,T.call(i,r)<0){a=!0;break}u&&(o?null!=(t=this._active_combos.splice(s,1)[0])&&t.reset():(t=this._active_combos.splice(s,1,e)[0],null!=t&&t.reset(),o=!0),a=!1)}return a&&this._active_combos.unshift(e),u||a},t.prototype._remove_from_active_combos=function(e){var t,n,i;for(t=n=0,i=this._active_combos.length;0<=i?n<i:n>i;t=0<=i?++n:--n)if(this._active_combos[t]===e){e=this._active_combos.splice(t,1)[0],e.reset();break}},t.prototype._get_possible_sequences=function(){var e,t,n,i,o,r,s,a,u,l,h,d,f;for(o=[],h=this._registered_combos,s=0,l=h.length;s<l;s++)for(e=h[s],n=a=1,d=this._sequence.length;1<=d?a<=d:a>=d;n=1<=d?++a:--a)if(r=this._sequence.slice(-n),e.is_sequence&&(!(T.call(e.keys,"shift")<0)||(r=c(r,function(e){return"shift"!==e}),r.length))){for(t=u=0,f=r.length;0<=f?u<f:u>f;t=0<=f?++u:--u){if(e.keys[t]!==r[t]){i=!1;break}i=!0}i&&o.push(e)}return o},t.prototype._add_key_to_sequence=function(e,t){var n,i,o,r;if(this._sequence.push(e),i=this._get_possible_sequences(),i.length){for(o=0,r=i.length;o<r;o++)n=i[o],this._prevent_default(t,n.prevent_default);this._sequence_timer&&clearTimeout(this._sequence_timer),this.sequence_delay>-1&&(this._sequence_timer=setTimeout(function(){return this._sequence=[]},this.sequence_delay))}else this._sequence=[]},t.prototype._get_sequence=function(e){var t,n,i,o,r,s,a,u,l,h,d,f,p;for(d=this._registered_combos,a=0,h=d.length;a<h;a++)if(t=d[a],t.is_sequence){for(i=u=1,f=this._sequence.length;1<=f?u<=f:u>=f;i=1<=f?++u:--u)if(s=c(this._sequence,function(e){return T.call(t.keys,"shift")>=0||"shift"!==e}).slice(-i),t.keys.length===s.length)for(n=l=0,p=s.length;0<=p?l<p:l>p;n=0<=p?++l:--l)if(r=s[n],!(T.call(t.keys,"shift")<0&&"shift"===r||"shift"===e&&T.call(t.keys,"shift")<0)){if(t.keys[n]!==r){o=!1;break}o=!0}if(o)return t.is_exclusive&&(this._sequence=[]),t}return!1},t.prototype._receive_input=function(e,t){var n,i;return this._prevent_capture?void(this._keys_down.length&&(this._keys_down=[])):(n=s(null!=(i=e.keyCode)?i:e.key),(t||this._keys_down.length||"alt"!==n&&n!==g)&&n?t?this._key_down(n,e):this._key_up(n,e):void 0)},t.prototype._fire=function(e,t,n,i){if("function"==typeof t["on_"+e]&&this._prevent_default(n,!0!==t["on_"+e].call(t.this,n,t.count,i)),"release"===e&&(t.count=0),"keyup"===e)return t.keyup_fired=!0},t.prototype._match_combo_arrays=function(e,t){var n,i,s,a;for(a=this._registered_combos,i=0,s=a.length;i<s;i++)n=a[i],(!n.is_unordered&&r(e,n.keys)||n.is_unordered&&o(e,n.keys))&&t(n)},t.prototype._fuzzy_match_combo_arrays=function(e,t){var n,i,o,r;for(r=this._registered_combos,i=0,o=r.length;i<o;i++)n=r[i],(!n.is_unordered&&f(n.keys,e)||n.is_unordered&&d(n.keys,e))&&t(n)},t.prototype._keys_remain=function(e){var t,n,i,o,r;for(r=e.keys,i=0,o=r.length;i<o;i++)if(t=r[i],T.call(this._keys_down,t)>=0){n=!0;break}return n},t.prototype._key_down=function(e,t){var n,i,o,r,s,u,l,c,h,d,f,p,v,_,y;h=a(e,t),h&&(e=h),this._add_key_to_sequence(e,t),(c=this._get_sequence(e))&&this._fire("keydown",c,t);for(s in b)o=b[s],t[o]&&(s===e||T.call(this._keys_down,s)>=0||this._keys_down.push(s));for(s in b)if(o=b[s],s!==e&&T.call(this._keys_down,s)>=0&&!t[o]){if("cmd"===s&&"cmd"!==g)continue;for(r=d=0,y=this._keys_down.length;0<=y?d<y:d>y;r=0<=y?++d:--d)this._keys_down[r]===s&&this._keys_down.splice(r,1)}for(i=this._get_active_combos(e),l=this._get_potential_combos(e),f=0,v=i.length;f<v;f++)n=i[f],this._handle_combo_down(n,l,e,t);if(l.length)for(p=0,_=l.length;p<_;p++)u=l[p],this._prevent_default(t,u.prevent_default);T.call(this._keys_down,e)<0&&this._keys_down.push(e)},t.prototype._handle_combo_down=function(e,t,n,i){var o,r,s,a,u,l;if(T.call(e.keys,n)<0)return!1;if(this._prevent_default(i,e&&e.prevent_default),o=!1,T.call(this._keys_down,n)>=0&&(o=!0,!e.allows_key_repeat()))return!1;if(a=this._add_to_active_combos(e,n),e.keyup_fired=!1,r=!1,e.is_exclusive)for(u=0,l=t.length;u<l;u++)if(s=t[u],s.is_exclusive&&s.keys.length>e.keys.length){r=!0;break}return!r&&(e.is_counting&&"function"==typeof e.on_keydown&&(e.count+=1),a)?this._fire("keydown",e,i,o):void 0},t.prototype._key_up=function(e,t){var n,i,o,r,s,u,l,c,h,d,f,p,v,_,m,g,b,k,w;if(c=e,l=a(e,t),l&&(e=l),l=y[c],t.shiftKey?l&&T.call(this._keys_down,l)>=0||(e=c):c&&T.call(this._keys_down,c)>=0||(e=l),u=this._get_sequence(e),u&&this._fire("keyup",u,t),T.call(this._keys_down,e)<0)return!1;for(s=h=0,g=this._keys_down.length;0<=g?h<g:h>g;s=0<=g?++h:--h)if((b=this._keys_down[s])===e||b===l||b===c){this._keys_down.splice(s,1);break}for(i=this._active_combos.length,r=[],k=this._active_combos,d=0,v=k.length;d<v;d++)n=k[d],T.call(n.keys,e)>=0&&r.push(n);for(f=0,_=r.length;f<_;f++)o=r[f],this._handle_combo_up(o,t,e);if(i>1)for(w=this._active_combos,p=0,m=w.length;p<m;p++)void 0===(n=w[p])||T.call(r,n)>=0||this._keys_remain(n)||this._remove_from_active_combos(n)},t.prototype._handle_combo_up=function(e,t,n){var i,r;this._prevent_default(t,e&&e.prevent_default),r=this._keys_remain(e),e.keyup_fired||(i=this._keys_down.slice(),i.push(n),e.is_solitary&&!o(i,e.keys)||(this._fire("keyup",e,t),e.is_counting&&"function"==typeof e.on_keyup&&"function"!=typeof e.on_keydown&&(e.count+=1))),r||(this._fire("release",e,t),this._remove_from_active_combos(e))},t.prototype.simple_combo=function(e,t){return this.register_combo({keys:e,on_keydown:t})},t.prototype.counting_combo=function(e,t){return this.register_combo({keys:e,is_counting:!0,is_unordered:!1,on_keydown:t})},t.prototype.sequence_combo=function(e,t){return this.register_combo({keys:e,on_keydown:t,is_sequence:!0,is_exclusive:!0})},t.prototype.register_combo=function(t){var n,i,o,r;"string"==typeof t.keys&&(t.keys=t.keys.split(" ")),r=this._defaults;for(i in r)x.call(r,i)&&(o=r[i],void 0===t[i]&&(t[i]=o));if(n=new e(t),w(n))return this._registered_combos.push(n),n},t.prototype.register_many=function(e){var t,n,i,o;for(o=[],n=0,i=e.length;n<i;n++)t=e[n],o.push(this.register_combo(t));return o},t.prototype.unregister_combo=function(t){var n,i,s,a,u,l;if(!t)return!1;if(i=function(e){return function(t){var n,i,o,r;for(r=[],n=i=0,o=e._registered_combos.length;0<=o?i<o:i>o;n=0<=o?++i:--i){if(t===e._registered_combos[n]){e._registered_combos.splice(n,1);break}r.push(void 0)}return r}}(this),t instanceof e)return i(t);for("string"==typeof t&&(t=t.split(" ")),u=this._registered_combos,l=[],s=0,a=u.length;s<a;s++)null!=(n=u[s])&&(n.is_unordered&&o(t,n.keys)||!n.is_unordered&&r(t,n.keys)?l.push(i(n)):l.push(void 0));return l},t.prototype.unregister_many=function(e){var t,n,i,o;for(o=[],n=0,i=e.length;n<i;n++)t=e[n],o.push(this.unregister_combo(t));return o},t.prototype.get_registered_combos=function(){return this._registered_combos},t.prototype.reset=function(){return this._registered_combos=[]},t.prototype.listen=function(){return this._prevent_capture=!1},t.prototype.stop_listening=function(){return this._prevent_capture=!0},t.prototype.get_meta_key=function(){return g},t}(),u=function(){-1!==navigator.userAgent.indexOf("Mac OS X")&&(g="cmd")},i=function(){-1!==navigator.userAgent.indexOf("Opera")&&(_[17]="cmd")},s=function(e){return _[e]},c=function(e,t){var n;return e.filter?e.filter(t):function(){var i,o,r;for(r=[],i=0,o=e.length;i<o;i++)n=e[i],t(n)&&r.push(n);return r}()},o=function(e,t){var n,i,o;if(e.length!==t.length)return!1;for(i=0,o=e.length;i<o;i++)if(n=e[i],!(T.call(t,n)>=0))return!1;return!0},r=function(e,t){var n,i,o;if(e.length!==t.length)return!1;for(n=i=0,o=e.length;0<=o?i<o:i>o;n=0<=o?++i:--i)if(e[n]!==t[n])return!1;return!0},d=function(e,t){var n,i,o;for(i=0,o=e.length;i<o;i++)if(n=e[i],T.call(t,n)<0)return!1;return!0},h=Array.prototype.indexOf||function(e,t){var n,i,o;for(n=i=0,o=e.length;0<=o?i<=o:i>=o;n=0<=o?++i:--i)if(e[n]===t)return n;return-1},f=function(e,t){var n,i,o,r,s;for(o=0,r=0,s=e.length;r<s;r++){if(i=e[r],!((n=h.call(t,i))>=o))return!1;o=n}return!0},m=function(){if(n.debug)return console.log.apply(console,arguments)},p=function(e){var t,n,i;t=!1;for(i in _)if(n=_[i],e===n){t=!0;break}if(!t)for(i in y)if(n=y[i],e===n){t=!0;break}return t},w=function(e){var t,n,i,o,r,s,a,u,c,d,f,_,y,b;for(a=!0,e.keys.length||m("You're trying to bind a combo with no keys:",e),n=u=0,y=e.keys.length;0<=y?u<y:u>y;n=0<=y?++u:--u)i=e.keys[n],t=v[i],t&&(i=e.keys[n]=t),"meta"===i&&e.keys.splice(n,1,g),"cmd"===i&&m('Warning: use the "meta" key rather than "cmd" for Windows compatibility');for(b=e.keys,c=0,f=b.length;c<f;c++)i=b[c],p(i)||(m('Do not recognize the key "'+i+'"'),a=!1);if(T.call(e.keys,"meta")>=0||T.call(e.keys,"cmd")>=0){for(r=e.keys.slice(),d=0,_=k.length;d<_;d++)o=k[d],(n=h.call(r,o))>-1&&r.splice(n,1);r.length>1&&(m("META and CMD key combos cannot have more than 1 non-modifier keys",e,r),a=!1)}for(s in e)e[s],"undefined"===l[s]&&m("The property "+s+" is not a valid combo property. Your combo has still been registered.");return a},a=function(e,t){var n;return!!t.shiftKey&&(null!=(n=y[e])&&n)},b={cmd:"metaKey",ctrl:"ctrlKey",shift:"shiftKey",alt:"altKey"},v={escape:"esc",control:"ctrl",command:"cmd",break:"pause",windows:"cmd",option:"alt",caps_lock:"caps",apostrophe:"'",semicolon:";",tilde:"~",accent:"`",scroll_lock:"scroll",num_lock:"num"},y={"/":"?",".":">",",":"<","'":'"',";":":","[":"{","]":"}","\\":"|","`":"~","=":"+","-":"_",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")"},_={0:"\\",8:"backspace",9:"tab",12:"num",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"caps",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",44:"print",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"cmd",92:"cmd",93:"cmd",96:"num_0",97:"num_1",98:"num_2",99:"num_3",100:"num_4",101:"num_5",102:"num_6",103:"num_7",104:"num_8",105:"num_9",106:"num_multiply",107:"num_add",108:"num_enter",109:"num_subtract",110:"num_decimal",111:"num_divide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",124:"print",144:"num",145:"scroll",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",223:"`",224:"cmd",225:"alt",57392:"ctrl",63289:"num",59:";",61:"=",173:"-"},n._keycode_dictionary=_,n._is_array_in_array_sorted=f,u(),i(),null!==t?t.keypress=n:window.keypress=n}).call(this)}),de=function(){function e(t,n){var i=this;T(this,e),this.keys={},n.forEach(function(e){i.keys[e]=!1,t.register_combo({keys:e,on_keydown:function(){i.keys[e]=!0},on_keyup:function(){i.keys[e]=!1},prevent_repeat:!0})})}return A(e,[{key:"pressed",value:function(e){return e in this.keys&&this.keys[e]}}]),e}(),fe=function(){function e(t,n,i){T(this,e),this.keys=t,this.delays=[0,n,i],this.timers={}}return A(e,[{key:"setInitialDelay",value:function(e){this.delays[1]=e}},{key:"setDelay",value:function(e){this.delays[2]=e}},{key:"update",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;this.keys.forEach(function(o){o in t.timers||(t.timers[o]={state:0,time:0});var r=t.timers[o];if(o in n&&n[o]){var s=t.delays[r.state];r.time+=1e3*e,r.time>=s&&(r.time-=s,r.state>=1&&r.time>s&&(r.time=0),r.state=Math.min(2,r.state+1),"function"==typeof i&&i(o))}else r.state=0,r.time=0})}}]),e}(),pe=60,ve=250,_e=.25,ye=new he.keypress.Listener,me=new ce.Manager(document.body,{recognizers:[[ce.Tap],[ce.Pan,{direction:ce.DIRECTION_ALL}]]});Z.system([],function(){function e(){T(this,e),this.keys=new de(ye,["z"]),this.undoTimer=new fe(["z"],ve,pe),ye.simple_combo("esc",function(){U.send("exitLevel")}),ye.simple_combo("r",function(){U.send("restart")}),me.on("tap",function(e){e.center.x<128&&e.center.y<128&&U.send("exitLevel")})}return A(e,[{key:"pre",value:function(e){this.undoTimer.update(e,{z:this.keys.pressed("z")},function(e){return U.send("undo")})}}]),e}()),Z.system([],function(){function e(){T(this,e),this.keys=new de(ye,["i","o"]),ye.simple_combo("u",function(){ie.scale=_e}),ye.simple_combo("p",function(){ie.scale=1})}return A(e,[{key:"initialize",value:function(){ie.scale=_e}},{key:"pre",value:function(e){this.keys.pressed("i")&&(ie.scale*=1+1*e),this.keys.pressed("o")&&(ie.scale*=1-1*e)}}]),e}()),Z.system(["inputMovement"],function(){function e(){T(this,e),this.currentKey=void 0,this.moveDelta={x:0,y:0},this.lastMoveDelta={x:0,y:0},this.keys={},this.touching=!1,this.id=0,this.initKeyboardInput(),this.initTouchInput()}return A(e,[{key:"pre",value:function(){var e=this;if(U.process("resetKeys",function(){e.resetKeys()}),!this.touching){var t=0;this.moveDelta={x:0,y:0},this.currentKey=void 0;for(var n in this.keys){var i=this.keys[n];i.down&&i.lastId>t&&(this.moveDelta.x=i.delta.x,this.moveDelta.y=i.delta.y,this.currentKey=n,t=i.lastId)}0==t&&(this.id=0)}0===this.moveDelta.x&&0===this.moveDelta.y||(this.lastMoveDelta.x=this.moveDelta.x,this.lastMoveDelta.y=this.moveDelta.y)}},{key:"every",value:function(e,t,n){var i=this;e.currentDirection.x=0,e.currentDirection.y=0;var o={};this.currentKey&&(o[this.currentKey]=!0),this.moveTimer.update(n,o,function(n){e.currentDirection.x=i.moveDelta.x,e.currentDirection.y=i.moveDelta.y,t.set("time",i.moveTimer.delays[2])}),e.lastDirection.x=this.lastMoveDelta.x,e.lastDirection.y=this.lastMoveDelta.y}},{key:"makeKey",value:function(e,t){return{delta:{x:e,y:t},down:!1,lastId:0}}},{key:"resetKeys",value:function(){for(var e in this.keys)this.keys[e].down=!1}},{key:"bindKey",value:function(e){var t=this;ye.register_combo({keys:e,on_keydown:function(){t.keys[e].down=!0,t.keys[e].lastId=++t.id},on_keyup:function(){t.keys[e].down=!1},prevent_repeat:!0})}},{key:"initKeyboardInput",value:function(){var e=this;this.keys={w:this.makeKey(0,-1),a:this.makeKey(-1,0),s:this.makeKey(0,1),d:this.makeKey(1,0),up:this.makeKey(0,-1),left:this.makeKey(-1,0),down:this.makeKey(0,1),right:this.makeKey(1,0)};for(var t in this.keys)this.bindKey(t);this.moveTimer=new fe(Object.keys(this.keys),ve,150,function(t){return e.handleMove(t)}),ye.register_combo({keys:"shift",on_keydown:function(){e.moveTimer.setDelay(pe)},on_keyup:function(){e.moveTimer.setDelay(150)},prevent_repeat:!0})}},{key:"initTouchInput",value:function(){var e=this,t={};t[ce.DIRECTION_LEFT]={x:-1,y:0,key:"left"},t[ce.DIRECTION_RIGHT]={x:1,y:0,key:"right"},t[ce.DIRECTION_UP]={x:0,y:-1,key:"up"},t[ce.DIRECTION_DOWN]={x:0,y:1,key:"down"},me.on("pan",function(n){if(!e.touching)if(Math.abs(n.velocity)>.3&&n.offsetDirection in t){var i=t[n.offsetDirection];e.touching=!0,e.moveDelta={x:i.x,y:i.y},e.currentKey=i.key}else e.touching=!1}),me.on("panend",function(t){e.touching=!1})}}]),e}());var ge=function(){function e(){T(this,e),this.actions=[]}return A(e,[{key:"push",value:function(e){var t=new be(e);return t.execute()?(this.actions.push(t),!0):(t.rollback(),!1)}},{key:"pushToLast",value:function(e){if(this.actions.length>0){
if(this.actions.top().addChild(e))return!0;this.actions.top().rollbackLast()}return!1}},{key:"pop",value:function(){if(this.actions.length>0){var e=[];if(this.actions.top().undo(e))return this.actions.pop(),!0;this.actions.top().redo(e)}return!1}},{key:"reset",value:function(){this.actions=[]}}]),e}(),be=function(){function e(t){T(this,e),this.children=[],this.action=t}return A(e,[{key:"execute",value:function(){var e=s(this.action,"execute",this);return this.addChildren(e)}},{key:"rollback",value:function(){for(;this.children.length>0;)this.children.top().rollback(),this.children.pop();s(this.action,"rollback",this)}},{key:"rollbackLast",value:function(){this.children.length>0&&(this.children.top().rollback(),this.children.pop())}},{key:"undo",value:function(e){for(var t=this.children.length-1;t>=0;--t){if(!this.children[t].undo(e))return!1}return e.push(this.action),!1!==s(this.action,"undo",this)}},{key:"redo",value:function(e){if(e)for(;e.length>0;)s(e.top(),"redo",this),e.pop()}},{key:"addChild",value:function(t){var n=new e(t);return this.children.push(n),n.execute()}},{key:"addChildren",value:function(e){if(!1===e)return!1;if("object"===(void 0===e?"undefined":x(e))&&void 0===e.length&&(e=[e]),e&&e.length>0){var t=!0,n=!1,i=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;if(!this.addChild(s))return!1}}catch(e){n=!0,i=e}finally{try{!t&&r.return&&r.return()}finally{if(n)throw i}}}return!0}}]),e}(),ke=["data/audio.ogg","data/audio.m4a"],we={block_activated_reversed:[0,730.8163265306123],block_activated:[2e3,730.8163265306123],block_deactivated_reversed:[4e3,901.6099773242629],block_deactivated:[6e3,901.6099773242629],block_slide_reversed:[8e3,243.80952380952436],block_slide:[1e4,243.80952380952436],build_bridge_reversed:[12e3,458.8888888888896],build_bridge:[14e3,458.8888888888896],"player_walk_floor.0":[16e3,201.72335600906877],"player_walk_floor.1":[18e3,174.14965986394648],"player_walk_floor.2":[2e4,204.62585034013614],"player_walk_floor.3":[22e3,193.01587301587375],"player_walk_floor.4":[24e3,184.30839002267518],"player_walk_floor.5":[26e3,206.07709750566983],"player_walk_floor.6":[28e3,184.30839002267518],"player_walk_floor.7":[3e4,142.94784580498998],"player_walk_floor_reversed.0":[32e3,201.72335600906877],"player_walk_floor_reversed.1":[34e3,174.14965986394293],"player_walk_floor_reversed.2":[36e3,204.62585034013614],"player_walk_floor_reversed.3":[38e3,193.01587301587375],"player_walk_floor_reversed.4":[4e4,184.30839002267874],"player_walk_floor_reversed.5":[42e3,206.07709750566983],"player_walk_floor_reversed.6":[44e3,184.30839002267874],"player_walk_floor_reversed.7":[46e3,142.94784580498998],"player_walk_grass.0":[48e3,247.43764172335858],"player_walk_grass.1":[5e4,246.71201814059174],"player_walk_grass.2":[52e3,208.9795918367372],"player_walk_grass.3":[54e3,240.18140589569015],"player_walk_grass.4":[56e3,235.8276643990962],"player_walk_grass.5":[58e3,219.86394557823274],"player_walk_grass.6":[6e4,240.18140589569015],"player_walk_grass.7":[62e3,224.94331065759354],"player_walk_grass_reversed.0":[64e3,247.43764172335148],"player_walk_grass_reversed.1":[66e3,246.71201814058463],"player_walk_grass_reversed.2":[68e3,208.9795918367372],"player_walk_grass_reversed.3":[7e4,240.18140589569725],"player_walk_grass_reversed.4":[72e3,235.8276643990962],"player_walk_grass_reversed.5":[74e3,219.86394557822564],"player_walk_grass_reversed.6":[76e3,240.18140589569725],"player_walk_grass_reversed.7":[78e3,224.94331065759354],"player_walk_water.0":[8e4,175.60090702947662],"player_walk_water.1":[82e3,238.00453514739672],"player_walk_water.2":[84e3,233.65079365079566],"player_walk_water.3":[86e3,354.1043083900206],"player_walk_water.4":[88e3,171.24716553287556],"player_walk_water.5":[9e4,127.34693877551706],"player_walk_water.6":[92e3,130.61224489796075],"player_walk_water.7":[94e3,157.46031746031974],"player_walk_water_reversed.0":[96e3,175.60090702947662],"player_walk_water_reversed.1":[98e3,238.00453514739672],"player_walk_water_reversed.2":[1e5,233.65079365079566],"player_walk_water_reversed.3":[102e3,354.1043083900206],"player_walk_water_reversed.4":[104e3,171.24716553287556],"player_walk_water_reversed.5":[106e3,127.34693877551706],"player_walk_water_reversed.6":[108e3,130.61224489796075],"player_walk_water_reversed.7":[11e4,157.46031746031974],portal_active_reversed:[112e3,4736.870748299324],portal_active:[118e3,4736.870748299324]},xe={src:ke,sprite:we},Te=p(function(e,t){!function(){var e=function(){this.init()};e.prototype={init:function(){var e=this||n;return e._counter=1e3,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.mobileAutoEnable=!0,e._setup(),e},volume:function(e){var t=this||n;if(e=parseFloat(e),t.ctx||c(),void 0!==e&&e>=0&&e<=1){if(t._volume=e,t._muted)return t;t.usingWebAudio&&(t.masterGain.gain.value=e);for(var i=0;i<t._howls.length;i++)if(!t._howls[i]._webAudio)for(var o=t._howls[i]._getSoundIds(),r=0;r<o.length;r++){var s=t._howls[i]._soundById(o[r]);s&&s._node&&(s._node.volume=s._volume*e)}return t}return t._volume},mute:function(e){var t=this||n;t.ctx||c(),t._muted=e,t.usingWebAudio&&(t.masterGain.gain.value=e?0:t._volume);for(var i=0;i<t._howls.length;i++)if(!t._howls[i]._webAudio)for(var o=t._howls[i]._getSoundIds(),r=0;r<o.length;r++){var s=t._howls[i]._soundById(o[r]);s&&s._node&&(s._node.muted=!!e||s._muted)}return t},unload:function(){for(var e=this||n,t=e._howls.length-1;t>=0;t--)e._howls[t].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,c()),e},codecs:function(e){return(this||n)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||n;if(e.state=e.ctx?e.ctx.state||"running":"running",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{var t=new Audio;void 0===t.oncanplaythrough&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{var t=new Audio;t.muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||n,t=null;try{t="undefined"!=typeof Audio?new Audio:null}catch(t){return e}if(!t||"function"!=typeof t.canPlayType)return e;var i=t.canPlayType("audio/mpeg;").replace(/^no$/,""),o=e._navigator&&e._navigator.userAgent.match(/OPR\/([0-6].)/g),r=o&&parseInt(o[0].split("/")[1],10)<33;return e._codecs={mp3:!(r||!i&&!t.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!i,opus:!!t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!t.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!t.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!t.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),dolby:!!t.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(t.canPlayType("audio/x-flac;")||t.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_enableMobileAudio:function(){var e=this||n,t=/iPhone|iPad|iPod|Android|BlackBerry|BB10|Silk|Mobi/i.test(e._navigator&&e._navigator.userAgent),i=!!("ontouchend"in window||e._navigator&&e._navigator.maxTouchPoints>0||e._navigator&&e._navigator.msMaxTouchPoints>0);if(!e._mobileEnabled&&e.ctx&&(t||i)){e._mobileEnabled=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var o=function t(){n._autoResume();var i=e.ctx.createBufferSource();i.buffer=e._scratchBuffer,i.connect(e.ctx.destination),void 0===i.start?i.noteOn(0):i.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),i.onended=function(){i.disconnect(0),e._mobileEnabled=!0,e.mobileAutoEnable=!1,document.removeEventListener("touchend",t,!0)}};return document.addEventListener("touchend",o,!0),e}},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&n.usingWebAudio){for(var t=0;t<e._howls.length;t++)if(e._howls[t]._webAudio)for(var i=0;i<e._howls[t]._sounds.length;i++)if(!e._howls[t]._sounds[i]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout(function(){e.autoSuspend&&(e._suspendTimer=null,e.state="suspending",e.ctx.suspend().then(function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())}))},3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&n.usingWebAudio)return"running"===e.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state?(e.ctx.resume().then(function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")}),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var n=new e,i=function(e){var t=this;if(!e.src||0===e.src.length)return void console.error("An array of source files must be passed with any new Howl.");t.init(e)};i.prototype={init:function(e){var t=this;return n.ctx||c(),t._autoplay=e.autoplay||!1,t._format="string"!=typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!=typeof e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!=typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._onresume=[],t._webAudio=n.usingWebAudio&&!t._html5,void 0!==n.ctx&&n.ctx&&n.mobileAutoEnable&&n._enableMobileAudio(),n._howls.push(t),t._autoplay&&t._queue.push({event:"play",action:function(){t.play()}}),t._preload&&t.load(),t},load:function(){var e=this,t=null;if(n.noAudio)return void e._emit("loaderror",null,"No audio support.");"string"==typeof e._src&&(e._src=[e._src]);for(var i=0;i<e._src.length;i++){var r,a;if(e._format&&e._format[i])r=e._format[i];else{if("string"!=typeof(a=e._src[i])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}r=/^data:audio\/([^;,]+);/i.exec(a),r||(r=/\.([^.]+)$/.exec(a.split("?",1)[0])),r&&(r=r[1].toLowerCase())}if(r||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),r&&n.codecs(r)){t=e._src[i];break}}return t?(e._src=t,e._state="loading","https:"===window.location.protocol&&"http:"===t.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new o(e),e._webAudio&&s(e),e):void e._emit("loaderror",null,"No codec support for selected audio sources.")},play:function(e,t){var i=this,o=null;if("number"==typeof e)o=e,e=null;else{if("string"==typeof e&&"loaded"===i._state&&!i._sprite[e])return null;if(void 0===e){e="__default";for(var r=0,s=0;s<i._sounds.length;s++)i._sounds[s]._paused&&!i._sounds[s]._ended&&(r++,o=i._sounds[s]._id);1===r?e=null:o=null}}var a=o?i._soundById(o):i._inactiveSound();if(!a)return null;if(o&&!e&&(e=a._sprite||"__default"),"loaded"!==i._state){a._sprite=e,a._ended=!1;var u=a._id;return i._queue.push({event:"play",action:function(){i.play(u)}}),u}if(o&&!a._paused)return t||setTimeout(function(){i._emit("play",a._id)},0),a._id;i._webAudio&&n._autoResume();var l=Math.max(0,a._seek>0?a._seek:i._sprite[e][0]/1e3),c=Math.max(0,(i._sprite[e][0]+i._sprite[e][1])/1e3-l),h=1e3*c/Math.abs(a._rate);a._paused=!1,a._ended=!1,a._sprite=e,a._seek=l,a._start=i._sprite[e][0]/1e3,a._stop=(i._sprite[e][0]+i._sprite[e][1])/1e3,a._loop=!(!a._loop&&!i._sprite[e][2]);var d=a._node;if(i._webAudio){var f=function(){i._refreshBuffer(a);var e=a._muted||i._muted?0:a._volume;d.gain.setValueAtTime(e,n.ctx.currentTime),a._playStart=n.ctx.currentTime,void 0===d.bufferSource.start?a._loop?d.bufferSource.noteGrainOn(0,l,86400):d.bufferSource.noteGrainOn(0,l,c):a._loop?d.bufferSource.start(0,l,86400):d.bufferSource.start(0,l,c),h!==1/0&&(i._endTimers[a._id]=setTimeout(i._ended.bind(i,a),h)),t||setTimeout(function(){i._emit("play",a._id)},0)},p="running"===n.state;if("loaded"===i._state&&p)f();else{var v=p||"loaded"!==i._state?"load":"resume";i.once(v,f,p?a._id:null),i._clearTimer(a._id)}}else{var _=function(){d.currentTime=l,d.muted=a._muted||i._muted||n._muted||d.muted,d.volume=a._volume*n.volume(),d.playbackRate=a._rate,d.play(),h!==1/0&&(i._endTimers[a._id]=setTimeout(i._ended.bind(i,a),h)),t||i._emit("play",a._id)},y="loaded"===i._state&&(window&&window.ejecta||!d.readyState&&n._navigator.isCocoonJS);if(4===d.readyState||y)_();else{var m=function e(){_(),d.removeEventListener(n._canPlayEvent,e,!1)};d.addEventListener(n._canPlayEvent,m,!1),i._clearTimer(a._id)}}return a._id},pause:function(e){var t=this;if("loaded"!==t._state)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var n=t._getSoundIds(e),i=0;i<n.length;i++){t._clearTimer(n[i]);var o=t._soundById(n[i]);if(o&&!o._paused&&(o._seek=t.seek(n[i]),o._rateSeek=0,o._paused=!0,t._stopFade(n[i]),o._node))if(t._webAudio){if(!o._node.bufferSource)continue;void 0===o._node.bufferSource.stop?o._node.bufferSource.noteOff(0):o._node.bufferSource.stop(0),t._cleanBuffer(o._node)}else isNaN(o._node.duration)&&o._node.duration!==1/0||o._node.pause();arguments[1]||t._emit("pause",o?o._id:null)}return t},stop:function(e,t){var n=this;if("loaded"!==n._state)return n._queue.push({event:"stop",action:function(){n.stop(e)}}),n;for(var i=n._getSoundIds(e),o=0;o<i.length;o++){n._clearTimer(i[o]);var r=n._soundById(i[o]);r&&(r._seek=r._start||0,r._rateSeek=0,r._paused=!0,r._ended=!0,n._stopFade(i[o]),r._node&&(n._webAudio?r._node.bufferSource&&(void 0===r._node.bufferSource.stop?r._node.bufferSource.noteOff(0):r._node.bufferSource.stop(0),n._cleanBuffer(r._node)):isNaN(r._node.duration)&&r._node.duration!==1/0||(r._node.currentTime=r._start||0,r._node.pause())),t||n._emit("stop",r._id))}return n},mute:function(e,t){var i=this;if("loaded"!==i._state)return i._queue.push({event:"mute",action:function(){i.mute(e,t)}}),i;if(void 0===t){if("boolean"!=typeof e)return i._muted;i._muted=e}for(var o=i._getSoundIds(t),r=0;r<o.length;r++){var s=i._soundById(o[r]);s&&(s._muted=e,i._webAudio&&s._node?s._node.gain.setValueAtTime(e?0:s._volume,n.ctx.currentTime):s._node&&(s._node.muted=!!n._muted||e),i._emit("mute",s._id))}return i},volume:function(){var e,t,i=this,o=arguments;if(0===o.length)return i._volume;if(1===o.length||2===o.length&&void 0===o[1]){i._getSoundIds().indexOf(o[0])>=0?t=parseInt(o[0],10):e=parseFloat(o[0])}else o.length>=2&&(e=parseFloat(o[0]),t=parseInt(o[1],10));var r;if(!(void 0!==e&&e>=0&&e<=1))return r=t?i._soundById(t):i._sounds[0],r?r._volume:0;if("loaded"!==i._state)return i._queue.push({event:"volume",action:function(){i.volume.apply(i,o)}}),i;void 0===t&&(i._volume=e),t=i._getSoundIds(t);for(var s=0;s<t.length;s++)(r=i._soundById(t[s]))&&(r._volume=e,o[2]||i._stopFade(t[s]),i._webAudio&&r._node&&!r._muted?r._node.gain.setValueAtTime(e,n.ctx.currentTime):r._node&&!r._muted&&(r._node.volume=e*n.volume()),i._emit("volume",r._id));return i},fade:function(e,t,i,o){var r=this,s=Math.abs(e-t),a=e>t?"out":"in",u=s/.01,l=u>0?i/u:i;if(l<4&&(u=Math.ceil(u/(4/l)),l=4),"loaded"!==r._state)return r._queue.push({event:"fade",action:function(){r.fade(e,t,i,o)}}),r;r.volume(e,o);for(var c=r._getSoundIds(o),h=0;h<c.length;h++){var d=r._soundById(c[h]);if(d){if(o||r._stopFade(c[h]),r._webAudio&&!d._muted){var f=n.ctx.currentTime,p=f+i/1e3;d._volume=e,d._node.gain.setValueAtTime(e,f),d._node.gain.linearRampToValueAtTime(t,p)}var v=e;d._interval=setInterval(function(n,i){u>0&&(v+="in"===a?.01:-.01),v=Math.max(0,v),v=Math.min(1,v),v=Math.round(100*v)/100,r._webAudio?(void 0===o&&(r._volume=v),i._volume=v):r.volume(v,n,!0),(t<e&&v<=t||t>e&&v>=t)&&(clearInterval(i._interval),i._interval=null,r.volume(t,n),r._emit("fade",n))}.bind(r,c[h],d),l)}}return r},_stopFade:function(e){var t=this,i=t._soundById(e);return i&&i._interval&&(t._webAudio&&i._node.gain.cancelScheduledValues(n.ctx.currentTime),clearInterval(i._interval),i._interval=null,t._emit("fade",e)),t},loop:function(){var e,t,n,i=this,o=arguments;if(0===o.length)return i._loop;if(1===o.length){if("boolean"!=typeof o[0])return!!(n=i._soundById(parseInt(o[0],10)))&&n._loop;e=o[0],i._loop=e}else 2===o.length&&(e=o[0],t=parseInt(o[1],10));for(var r=i._getSoundIds(t),s=0;s<r.length;s++)(n=i._soundById(r[s]))&&(n._loop=e,i._webAudio&&n._node&&n._node.bufferSource&&(n._node.bufferSource.loop=e,e&&(n._node.bufferSource.loopStart=n._start||0,n._node.bufferSource.loopEnd=n._stop)));return i},rate:function(){var e,t,i=this,o=arguments;if(0===o.length)t=i._sounds[0]._id;else if(1===o.length){var r=i._getSoundIds(),s=r.indexOf(o[0]);s>=0?t=parseInt(o[0],10):e=parseFloat(o[0])}else 2===o.length&&(e=parseFloat(o[0]),t=parseInt(o[1],10));var a;if("number"!=typeof e)return a=i._soundById(t),a?a._rate:i._rate;if("loaded"!==i._state)return i._queue.push({event:"rate",action:function(){i.rate.apply(i,o)}}),i;void 0===t&&(i._rate=e),t=i._getSoundIds(t);for(var u=0;u<t.length;u++)if(a=i._soundById(t[u])){a._rateSeek=i.seek(t[u]),a._playStart=i._webAudio?n.ctx.currentTime:a._playStart,a._rate=e,i._webAudio&&a._node&&a._node.bufferSource?a._node.bufferSource.playbackRate.value=e:a._node&&(a._node.playbackRate=e);var l=i.seek(t[u]),c=(i._sprite[a._sprite][0]+i._sprite[a._sprite][1])/1e3-l,h=1e3*c/Math.abs(a._rate);!i._endTimers[t[u]]&&a._paused||(i._clearTimer(t[u]),i._endTimers[t[u]]=setTimeout(i._ended.bind(i,a),h)),i._emit("rate",a._id)}return i},seek:function(){var e,t,i=this,o=arguments;if(0===o.length)t=i._sounds[0]._id;else if(1===o.length){var r=i._getSoundIds(),s=r.indexOf(o[0]);s>=0?t=parseInt(o[0],10):(t=i._sounds[0]._id,e=parseFloat(o[0]))}else 2===o.length&&(e=parseFloat(o[0]),t=parseInt(o[1],10));if(void 0===t)return i;if("loaded"!==i._state)return i._queue.push({event:"seek",action:function(){i.seek.apply(i,o)}}),i;var a=i._soundById(t);if(a){if(!("number"==typeof e&&e>=0)){if(i._webAudio){var u=i.playing(t)?n.ctx.currentTime-a._playStart:0,l=a._rateSeek?a._rateSeek-a._seek:0;return a._seek+(l+u*Math.abs(a._rate))}return a._node.currentTime}var c=i.playing(t);c&&i.pause(t,!0),a._seek=e,a._ended=!1,i._clearTimer(t),c&&i.play(t,!0),!i._webAudio&&a._node&&(a._node.currentTime=e),i._emit("seek",t)}return i},playing:function(e){var t=this;if("number"==typeof e){var n=t._soundById(e);return!!n&&!n._paused}for(var i=0;i<t._sounds.length;i++)if(!t._sounds[i]._paused)return!0;return!1},duration:function(e){var t=this,n=t._duration,i=t._soundById(e);return i&&(n=t._sprite[i._sprite][1]/1e3),n},state:function(){return this._state},unload:function(){for(var e=this,t=e._sounds,i=0;i<t.length;i++){if(t[i]._paused||e.stop(t[i]._id),!e._webAudio){/MSIE |Trident\//.test(n._navigator&&n._navigator.userAgent)||(t[i]._node.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"),t[i]._node.removeEventListener("error",t[i]._errorFn,!1),t[i]._node.removeEventListener(n._canPlayEvent,t[i]._loadFn,!1)}delete t[i]._node,e._clearTimer(t[i]._id);var o=n._howls.indexOf(e);o>=0&&n._howls.splice(o,1)}var s=!0;for(i=0;i<n._howls.length;i++)if(n._howls[i]._src===e._src){s=!1;break}return r&&s&&delete r[e._src],n.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,n,i){var o=this,r=o["_on"+e];return"function"==typeof t&&r.push(i?{id:n,fn:t,once:i}:{id:n,fn:t}),o},off:function(e,t,n){var i=this,o=i["_on"+e],r=0;if("number"==typeof t&&(n=t,t=null),t||n)for(r=0;r<o.length;r++){var s=n===o[r].id;if(t===o[r].fn&&s||!t&&s){o.splice(r,1);break}}else if(e)i["_on"+e]=[];else{var a=Object.keys(i);for(r=0;r<a.length;r++)0===a[r].indexOf("_on")&&Array.isArray(i[a[r]])&&(i[a[r]]=[])}return i},once:function(e,t,n){var i=this;return i.on(e,t,n,1),i},_emit:function(e,t,n){for(var i=this,o=i["_on"+e],r=o.length-1;r>=0;r--)o[r].id&&o[r].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,n)}.bind(i,o[r].fn),0),o[r].once&&i.off(e,o[r].fn,o[r].id));return i},_loadQueue:function(){var e=this;if(e._queue.length>0){var t=e._queue[0];e.once(t.event,function(){e._queue.shift(),e._loadQueue()}),t.action()}return e},_ended:function(e){var t=this,i=e._sprite;if(!t._webAudio&&t._node&&!t._node.ended)return setTimeout(t._ended.bind(t,e),100),t;var o=!(!e._loop&&!t._sprite[i][2]);if(t._emit("end",e._id),!t._webAudio&&o&&t.stop(e._id,!0).play(e._id),t._webAudio&&o){t._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=n.ctx.currentTime;var r=1e3*(e._stop-e._start)/Math.abs(e._rate);t._endTimers[e._id]=setTimeout(t._ended.bind(t,e),r)}return t._webAudio&&!o&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,t._clearTimer(e._id),t._cleanBuffer(e._node),n._autoSuspend()),t._webAudio||o||t.stop(e._id),t},_clearTimer:function(e){var t=this;return t._endTimers[e]&&(clearTimeout(t._endTimers[e]),delete t._endTimers[e]),t},_soundById:function(e){for(var t=this,n=0;n<t._sounds.length;n++)if(e===t._sounds[n]._id)return t._sounds[n];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new o(e)},_drain:function(){var e=this,t=e._pool,n=0,i=0;if(!(e._sounds.length<t)){for(i=0;i<e._sounds.length;i++)e._sounds[i]._ended&&n++;for(i=e._sounds.length-1;i>=0;i--){if(n<=t)return;e._sounds[i]._ended&&(e._webAudio&&e._sounds[i]._node&&e._sounds[i]._node.disconnect(0),e._sounds.splice(i,1),n--)}}},_getSoundIds:function(e){var t=this;if(void 0===e){for(var n=[],i=0;i<t._sounds.length;i++)n.push(t._sounds[i]._id);return n}return[e]},_refreshBuffer:function(e){var t=this;return e._node.bufferSource=n.ctx.createBufferSource(),e._node.bufferSource.buffer=r[t._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop),e._node.bufferSource.playbackRate.value=e._rate,t},_cleanBuffer:function(e){var t=this;if(t._scratchBuffer){e.bufferSource.onended=null,e.bufferSource.disconnect(0);try{e.bufferSource.buffer=t._scratchBuffer}catch(e){}}return e.bufferSource=null,t}};var o=function(e){this._parent=e,this.init()};o.prototype={init:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++n._counter,t._sounds.push(e),e.create(),e},create:function(){var e=this,t=e._parent,i=n._muted||e._muted||e._parent._muted?0:e._volume;return t._webAudio?(e._node=void 0===n.ctx.createGain?n.ctx.createGainNode():n.ctx.createGain(),e._node.gain.setValueAtTime(i,n.ctx.currentTime),e._node.paused=!0,e._node.connect(n.masterGain)):(e._node=new Audio,e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(n._canPlayEvent,e._loadFn,!1),e._node.src=t._src,e._node.preload="auto",e._node.volume=i*n.volume(),e._node.load()),e},reset:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++n._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,t=e._parent;t._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue()),e._node.removeEventListener(n._canPlayEvent,e._loadFn,!1)}};var r={},s=function(e){var t=e._src;if(r[t])return e._duration=r[t].duration,void l(e);if(/^data:[^;]+;base64,/.test(t)){for(var n=atob(t.split(",")[1]),i=new Uint8Array(n.length),o=0;o<n.length;++o)i[o]=n.charCodeAt(o);u(i.buffer,e)}else{var s=new XMLHttpRequest;s.open("GET",t,!0),s.responseType="arraybuffer",s.onload=function(){var t=(s.status+"")[0];if("0"!==t&&"2"!==t&&"3"!==t)return void e._emit("loaderror",null,"Failed loading audio file with status: "+s.status+".");u(s.response,e)},s.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete r[t],e.load())},a(s)}},a=function(e){try{e.send()}catch(t){e.onerror()}},u=function(e,t){n.ctx.decodeAudioData(e,function(e){e&&t._sounds.length>0&&(r[t._src]=e,l(t,e))},function(){t._emit("loaderror",null,"Decoding audio data failed.")})},l=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},c=function(){try{"undefined"!=typeof AudioContext?n.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?n.ctx=new webkitAudioContext:n.usingWebAudio=!1}catch(e){n.usingWebAudio=!1}var e=/iP(hone|od|ad)/.test(n._navigator&&n._navigator.platform),t=n._navigator&&n._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),i=t?parseInt(t[1],10):null;if(e&&i&&i<9){var o=/safari/.test(n._navigator&&n._navigator.userAgent.toLowerCase());(n._navigator&&n._navigator.standalone&&!o||n._navigator&&!n._navigator.standalone&&!o)&&(n.usingWebAudio=!1)}n.usingWebAudio&&(n.masterGain=void 0===n.ctx.createGain?n.ctx.createGainNode():n.ctx.createGain(),n.masterGain.gain.value=n._muted?0:1,n.masterGain.connect(n.ctx.destination)),n._setup()};t.Howler=n,t.Howl=i,"undefined"!=typeof window?(window.HowlerGlobal=e,window.Howler=n,window.Howl=i,window.Sound=o):"undefined"!=typeof global&&(global.HowlerGlobal=e,global.Howler=n,global.Howl=i,global.Sound=o)}(),function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var t=this;if(!t.ctx||!t.ctx.listener)return t;for(var n=t._howls.length-1;n>=0;n--)t._howls[n].stereo(e);return t},HowlerGlobal.prototype.pos=function(e,t,n){var i=this;return i.ctx&&i.ctx.listener?(t="number"!=typeof t?i._pos[1]:t,n="number"!=typeof n?i._pos[2]:n,"number"!=typeof e?i._pos:(i._pos=[e,t,n],i.ctx.listener.setPosition(i._pos[0],i._pos[1],i._pos[2]),i)):i},HowlerGlobal.prototype.orientation=function(e,t,n,i,o,r){var s=this;if(!s.ctx||!s.ctx.listener)return s;var a=s._orientation;return t="number"!=typeof t?a[1]:t,n="number"!=typeof n?a[2]:n,i="number"!=typeof i?a[3]:i,o="number"!=typeof o?a[4]:o,r="number"!=typeof r?a[5]:r,"number"!=typeof e?a:(s._orientation=[e,t,n,i,o,r],s.ctx.listener.setOrientation(e,t,n,i,o,r),s)},Howl.prototype.init=function(e){return function(t){var n=this;return n._orientation=t.orientation||[1,0,0],n._stereo=t.stereo||null,n._pos=t.pos||null,n._pannerAttr={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:360,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:360,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:0,distanceModel:void 0!==t.distanceModel?t.distanceModel:"inverse",maxDistance:void 0!==t.maxDistance?t.maxDistance:1e4,panningModel:void 0!==t.panningModel?t.panningModel:"HRTF",refDistance:void 0!==t.refDistance?t.refDistance:1,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:1},n._onstereo=t.onstereo?[{fn:t.onstereo}]:[],n._onpos=t.onpos?[{fn:t.onpos}]:[],n._onorientation=t.onorientation?[{fn:t.onorientation}]:[],e.call(this,t)}}(Howl.prototype.init),Howl.prototype.stereo=function(t,n){var i=this;if(!i._webAudio)return i;if("loaded"!==i._state)return i._queue.push({event:"stereo",action:function(){i.stereo(t,n)}}),i;var o=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===n){if("number"!=typeof t)return i._stereo;i._stereo=t,i._pos=[t,0,0]}for(var r=i._getSoundIds(n),s=0;s<r.length;s++){var a=i._soundById(r[s]);if(a){if("number"!=typeof t)return a._stereo;a._stereo=t,a._pos=[t,0,0],a._node&&(a._pannerAttr.panningModel="equalpower",a._panner&&a._panner.pan||e(a,o),"spatial"===o?a._panner.setPosition(t,0,0):a._panner.pan.value=t),i._emit("stereo",a._id)}}return i},Howl.prototype.pos=function(t,n,i,o){var r=this;if(!r._webAudio)return r;if("loaded"!==r._state)return r._queue.push({event:"pos",action:function(){r.pos(t,n,i,o)}}),r;if(n="number"!=typeof n?0:n,i="number"!=typeof i?-.5:i,void 0===o){if("number"!=typeof t)return r._pos;r._pos=[t,n,i]}for(var s=r._getSoundIds(o),a=0;a<s.length;a++){var u=r._soundById(s[a]);if(u){if("number"!=typeof t)return u._pos;u._pos=[t,n,i],u._node&&(u._panner&&!u._panner.pan||e(u,"spatial"),u._panner.setPosition(t,n,i)),r._emit("pos",u._id)}}return r},Howl.prototype.orientation=function(t,n,i,o){var r=this;if(!r._webAudio)return r;if("loaded"!==r._state)return r._queue.push({event:"orientation",action:function(){r.orientation(t,n,i,o)}}),r;if(n="number"!=typeof n?r._orientation[1]:n,i="number"!=typeof i?r._orientation[2]:i,void 0===o){if("number"!=typeof t)return r._orientation;r._orientation=[t,n,i]}for(var s=r._getSoundIds(o),a=0;a<s.length;a++){var u=r._soundById(s[a]);if(u){if("number"!=typeof t)return u._orientation;u._orientation=[t,n,i],u._node&&(u._panner||(u._pos||(u._pos=r._pos||[0,0,-.5]),e(u,"spatial")),u._panner.setOrientation(t,n,i)),r._emit("orientation",u._id)}}return r},Howl.prototype.pannerAttr=function(){var t,n,i,o=this,r=arguments;if(!o._webAudio)return o;if(0===r.length)return o._pannerAttr;if(1===r.length){if("object"!==x(r[0]))return i=o._soundById(parseInt(r[0],10)),i?i._pannerAttr:o._pannerAttr;t=r[0],void 0===n&&(o._pannerAttr={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:o._coneInnerAngle,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:o._coneOuterAngle,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:o._coneOuterGain,distanceModel:void 0!==t.distanceModel?t.distanceModel:o._distanceModel,maxDistance:void 0!==t.maxDistance?t.maxDistance:o._maxDistance,panningModel:void 0!==t.panningModel?t.panningModel:o._panningModel,refDistance:void 0!==t.refDistance?t.refDistance:o._refDistance,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:o._rolloffFactor})}else 2===r.length&&(t=r[0],n=parseInt(r[1],10));for(var s=o._getSoundIds(n),a=0;a<s.length;a++)if(i=o._soundById(s[a])){var u=i._pannerAttr;u={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:u.coneInnerAngle,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:u.coneOuterAngle,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:u.coneOuterGain,distanceModel:void 0!==t.distanceModel?t.distanceModel:u.distanceModel,maxDistance:void 0!==t.maxDistance?t.maxDistance:u.maxDistance,panningModel:void 0!==t.panningModel?t.panningModel:u.panningModel,refDistance:void 0!==t.refDistance?t.refDistance:u.refDistance,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:u.rolloffFactor};var l=i._panner;l?(l.coneInnerAngle=u.coneInnerAngle,l.coneOuterAngle=u.coneOuterAngle,l.coneOuterGain=u.coneOuterGain,l.distanceModel=u.distanceModel,l.maxDistance=u.maxDistance,l.panningModel=u.panningModel,l.refDistance=u.refDistance,l.rolloffFactor=u.rolloffFactor):(i._pos||(i._pos=o._pos||[0,0,-.5]),e(i,"spatial"))}return o},Sound.prototype.init=function(e){return function(){var t=this,n=t._parent
;t._orientation=n._orientation,t._stereo=n._stereo,t._pos=n._pos,t._pannerAttr=n._pannerAttr,e.call(this),t._stereo?n.stereo(t._stereo):t._pos&&n.pos(t._pos[0],t._pos[1],t._pos[2],t._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var t=this,n=t._parent;return t._orientation=n._orientation,t._pos=n._pos,t._pannerAttr=n._pannerAttr,e.call(this)}}(Sound.prototype.reset);var e=function(e,t){t=t||"spatial","spatial"===t?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.panningModel=e._pannerAttr.panningModel,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.value=e._stereo),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id)}}()}),Ae=function(){function e(){T(this,e),this.variations=this.findVariations(xe)}return A(e,[{key:"findVariations",value:function(){var e={};for(var t in xe.sprite){var n=t.split(".");if(n.length>=2){var i=n.pop(),o=n.join(".");e[o]?e[o].push(i):e[o]=[i]}else e[t]=[]}return e}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.variations[e+(t?"_reversed":"")];if(n&&n.length>0)return f(n)}},{key:"name",value:function(e,t){return e+(arguments.length>2&&void 0!==arguments[2]&&arguments[2]?"_reversed":"")+(t?"."+t:"")}}]),e}(),Se=function(){function e(){T(this,e),this.variations=new Ae,this.howler=new Te.Howl(xe),this.queue=[],this.frameId=0}return A(e,[{key:"play",value:function(){++this.frameId;var e=!0,t=!1,n=void 0;try{for(var i,o=this.queue[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var r=i.value;r&&this.howler.play(r)}}catch(e){t=!0,n=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw n}}this.queue=[]}},{key:"add",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t=t||this.variations.get(e,n),this.queue.push(this.variations.name(e,t,n)),!n)return this.createReversedSoundCallback(e,t,this.frameId,this.queue.length-1)}},{key:"createReversedSoundCallback",value:function(e,t,n,i){var o=this;return function(){o.frameId===n?delete o.queue[i]:o.add(e,t,!0)}}}]),e}(),ze=new Se,Ie=function(){function e(t,n){T(this,e),this.entity=t,this.timeEntity=n||t,this.timeImmune=v(this.timeEntity)}return A(e,[{key:"undo",value:function(){this.timeImmune||v(this.timeEntity)||s(this,"rollback")}},{key:"redo",value:function(){this.timeImmune||v(this.timeEntity)||s(this,"execute")}}]),e}(),Ee=function(e){function t(e){T(this,t);var n=I(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.entity));return n.event=e,n}return z(t,e),A(t,[{key:"invokeLogicComponent",value:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!(i&&n.toString()===i.toString()||n.has("attachable")&&n.get("attachable").attached)){var s=n.get("logic");if(s&&this.event.type in s&&"function"==typeof s[this.event.type]){var a=o(this.event,{baseEntity:n}),u=new s[this.event.type](a);if(r)return!!e.addChild(u)||(e.rollbackLast(),!1);t.push(u)}}return!0}},{key:"execute",value:function(e){var t=[],n=this.event.entity;if(this.event.position){var i=te.find(this.event.position,n,"platform");if(i){var o=this.invokeLogicComponent(e,t,i,n,!0);if(!o)return!1;if(i=te.find(this.event.position,n,"platform"),o&&!i){var r=te.get(this.event.position),s=!0,a=!1,u=void 0;try{for(var l,c=r.values()[Symbol.iterator]();!(s=(l=c.next()).done);s=!0){var h=l.value;h.has("platform")||this.invokeLogicComponent(e,t,h,n)}}catch(e){a=!0,u=e}finally{try{!s&&c.return&&c.return()}finally{if(a)throw u}}}}else{var d=te.get(this.event.position),f=!0,p=!1,v=void 0;try{for(var _,y=d.values()[Symbol.iterator]();!(f=(_=y.next()).done);f=!0){var m=_.value;this.invokeLogicComponent(e,t,m,n)}}catch(e){p=!0,v=e}finally{try{!f&&y.return&&y.return()}finally{if(p)throw v}}}}else this.invokeLogicComponent(e,t,this.event.entity,void 0);return t}},{key:"rollback",value:function(){}}]),t}(Ie),Pe=function(e){function t(e){T(this,t);var n=I(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.entity));return n.event=e,n.entity=e.entity,n.direction=e.direction,n}return z(t,e),A(t,[{key:"execute",value:function(){var e=this.entity.get("position"),t=this.entity.get("direction");return this.oldPosition={x:e.x,y:e.y},t&&(this.oldDirection={x:t.x,y:t.y}),e.set(e.x+this.direction.x,e.y+this.direction.y),t&&(t.x=this.direction.x,t.y=this.direction.y),1!==te.get(e).size&&(this.event.suppressEvents||this.event.entity.has("suppressEvents")?void 0:[new Ee({type:"exit",position:this.oldPosition,newPosition:{x:e.x,y:e.y},direction:this.direction,entity:this.entity}),new Ee({type:"moved",from:this.oldPosition,to:{x:e.x,y:e.y},direction:this.direction,entity:this.entity,movedBy:this.event.movedBy}),new Ee({type:"enter",position:{x:e.x,y:e.y},oldPosition:this.oldPosition,direction:this.direction,entity:this.entity})])}},{key:"rollback",value:function(){var e=this.entity.get("position"),t=this.entity.get("direction");e.set(e.x-this.direction.x,e.y-this.direction.y),t&&(t.x=this.oldDirection.x,t.y=this.oldDirection.y)}}]),t}(Ie),Oe=function(e){function t(e){T(this,t);var n=I(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.entity=e,n}return z(t,e),A(t,[{key:"execute",value:function(){te.remove(this.entity),this.entity.has("sprite")&&this.entity.get("sprite").onRemove(),this.entity.detach()}},{key:"rollback",value:function(){this.entity.attach(Z),this.entity.has("sprite")&&this.entity.get("sprite").onCreated(),te.update(this.entity)}}]),t}(Ie),Me=function(e){function t(e){T(this,t);var n=I(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,void 0));return n.event=e,n}return z(t,e),A(t,[{key:"execute",value:function(){var e={name:this.event.create,position:{x:this.event.at.x,y:this.event.at.y},spritePosition:ne.getVisualPosition(this.event.at),layer:5};this.entity=ne.createEntity(e,this.event.zIndex||15),E(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"entity",this.entity,this),s(this.event,"thenCall",this.entity)}},{key:"rollback",value:function(){this.entity.destroy()}}]),t}(Ie),Ce=function(){function e(t){T(this,e),this.event=t}return A(e,[{key:"execute",value:function(){var e=[],t=te.find.apply(te,[this.event.position,void 0].concat(P(this.event.has)));return t&&e.push(new Oe(t)),e}}]),e}(),De=function(e){function t(e,n){T(this,t);var i=I(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n));return i.baseEntity=e,i.entityToAttach=n,i.platform=e.get("platform"),i.attachable=n.get("attachable"),i}return z(t,e),A(t,[{key:"execute",value:function(){this.platform&&this.attachable&&(this.originalAttached=this.attachable.attached,this.originalHolding=this.platform.holding,this.attachable.attached=this.baseEntity,this.platform.holding=this.entityToAttach,this.entityToAttach.has("inputMovement")&&(this.baseEntity.set("inputMovement"),this.entityToAttach.remove("inputMovement")))}},{key:"rollback",value:function(){this.platform&&this.attachable&&(this.attachable.attached=this.originalAttached,this.platform.holding=this.originalHolding,this.baseEntity.has("inputMovement")&&(this.baseEntity.remove("inputMovement"),this.entityToAttach.set("inputMovement")))}}]),t}(Ie),Le=function(e){function t(e){T(this,t);var n=I(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.baseEntity=e,n.platform=e.get("platform"),n.attachable=n.platform.holding.get("attachable"),n}return z(t,e),A(t,[{key:"execute",value:function(){this.platform&&this.attachable&&(this.originalAttached=this.attachable.attached,this.originalHolding=this.platform.holding,this.originalAttached&&this.originalAttached.has("inputMovement")&&(this.originalHolding.set("inputMovement"),this.originalAttached.remove("inputMovement")),this.attachable.attached=void 0,this.platform.holding=void 0)}},{key:"rollback",value:function(){this.platform&&this.attachable&&(this.originalHolding&&this.originalHolding.has("inputMovement")&&(this.originalHolding.remove("inputMovement"),this.originalAttached.set("inputMovement")),this.attachable.attached=this.originalAttached,this.platform.holding=this.originalHolding)}}]),t}(Ie),Re=function(e){function t(e){T(this,t);var n=I(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.baseEntity));return n.event=e,n}return z(t,e),A(t,[{key:"execute",value:function(){if(this.event.baseEntity.has("floats")&&this.event.baseEntity.get("floats").floating)return!0;if(this.event.entity.has("pushes")){var e=this.event.entity.get("time");return[new Fe(this.event.baseEntity,"time",void 0,e),new Pe({entity:this.event.baseEntity,direction:this.event.direction,movedBy:this.event.entity}),new Fe(this.event.baseEntity,"time",void 0,e)]}return!1}}]),t}(Ie),qe=function(e){function t(e){T(this,t);var n=I(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.baseEntity));return n.event=e,n}return z(t,e),A(t,[{key:"execute",value:function(){return new Be("block_slide")}}]),t}(Ie),Fe=function(e){function t(e,n,i,o,r){T(this,t);var s=I(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));return s.component=n,s.property=i,s.value=o,s.previous=i?e.get(n)[i]:e.get(n),s}return z(t,e),A(t,[{key:"execute",value:function(){this.property?this.entity.get(this.component)[this.property]=this.value:this.entity.set(this.component,this.value)}},{key:"rollback",value:function(){this.property?this.entity.get(this.component)[this.property]=this.previous:this.previous?this.entity.set(this.component,this.previous):this.entity.remove(this.component)}}]),t}(Ie),Be=function(e){function t(e){var n;T(this,t);for(var i=arguments.length,o=Array(i>1?i-1:0),r=1;r<i;r++)o[r-1]=arguments[r];var s=I(this,(n=t.__proto__||Object.getPrototypeOf(t)).call.apply(n,[this].concat(o)));return s.sound=e,s}return z(t,e),A(t,[{key:"execute",value:function(){this.playReversed=ze.add(this.sound)}},{key:"rollback",value:function(){this.playReversed()}}]),t}(Ie);Z.system([],function(){function e(){T(this,e),this.actionStack=new ge}return A(e,[{key:"move",value:function(e,t,n){if(0!==t.x||0!==t.y)return this.actionStack[n](new Pe({entity:e,direction:{x:t.x,y:t.y}}))}},{key:"handleMovement",value:function(e){var t=e.get("forcedMovement"),n=e.get("inputMovement");if(t){if(!e.has("tween")){var i=this.move(e,t.direction,"pushToLast");!1===i&&e.remove("forcedMovement")}}else n&&this.move(e,n.currentDirection,"push")}},{key:"pre",value:function(){var e=this;U.loop("loaded",function(t){e.actionStack.reset()}),U.process("undo",function(){e.actionStack.pop()});var t=new Set,n=Z.every(["position","forcedMovement"]),i=Z.every(["position","inputMovement"]),o=!0,r=!1,s=void 0;try{for(var a,u=n[Symbol.iterator]();!(o=(a=u.next()).done);o=!0){var l=a.value;t.add(l.toString())}}catch(e){r=!0,s=e}finally{try{!o&&u.return&&u.return()}finally{if(r)throw s}}var c=!0,h=!1,d=void 0;try{for(var f,p=i[Symbol.iterator]();!(c=(f=p.next()).done);c=!0){var v=f.value;t.add(v.toString())}}catch(e){h=!0,d=e}finally{try{!c&&p.return&&p.return()}finally{if(h)throw d}}var _=!0,y=!1,m=void 0;try{for(var g,b=t[Symbol.iterator]();!(_=(g=b.next()).done);_=!0){var k=g.value,w=Z.entities[k];w&&w.valid()&&this.handleMovement(w)}}catch(e){y=!0,m=e}finally{try{!_&&b.return&&b.return()}finally{if(y)throw m}}}}]),e}()),Z.system(["sprite","direction","directionSprite"],function(){function e(){T(this,e)}return A(e,[{key:"every",value:function(e,t,i){var o=i.directions[n(t)]||i.directions.default;o&&e.set(o)}}]),e}());var je=function(e){function t(e){T(this,t);var n=I(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.baseEntity));return n.event=e,n}return z(t,e),A(t,[{key:"execute",value:function(){this.event.baseEntity.has("inWorld")&&y(this.event.to);var e="floor",t=te.find(this.event.to,void 0,"terrain");return t&&(e=t.get("terrain")),[new Be("player_walk_"+e,this.event.baseEntity)]}},{key:"rollback",value:function(){this.event.baseEntity.has("inWorld")&&y(this.event.from)}}]),t}(Ie);Z.system([],function(){function e(){T(this,e)}return A(e,[{key:"initialize",value:function(){this.player=this.createPlayer(_(),!0)}},{key:"pre",value:function(){var e=this;U.process("resetPlayer",function(t){e.player.destroy(),e.player=e.createPlayer(t.position)})}},{key:"createPlayer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=ne.getVisualPosition(e),i=Z.entity();return i.set("player").set("inputMovement").set("position",e.x,e.y).set("sprite",ee,"player_down",20,n).set("cameraFollows").set("pushes").set("presses").set("attachable").set("direction",{x:0,y:1}).set("directionSprite",{default:"player_down","0,1":"player_down","1,0":"player_right","0,-1":"player_up","-1,0":"player_left"}).set("logic",{moved:je}),(t||ne.inWorld())&&i.set("inWorld"),i}}]),e}());var Ne=function(e){function t(e){return T(this,t),I(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.baseEntity))}return z(t,e),A(t,[{key:"execute",value:function(){return!1}}]),t}(Ie);Z.system([],function(){function e(){T(this,e)}return A(e,[{key:"initialize",value:function(){var e=this;ne.register(["wall"],function(t,n){e.createWallEntity(t)})}},{key:"createWallEntity",value:function(e){e.set("blocksMovement").set("logic",{enter:Ne})}}]),e}());var Ge=function(e){function t(e){T(this,t);var n=I(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.baseEntity));return n.event=e,n}return z(t,e),A(t,[{key:"execute",value:function(){return!this.event.entity.has("vehicle")}}]),t}(Ie),We=function(e){function t(e){T(this,t);var n=I(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.baseEntity));return n.event=e,n}return z(t,e),A(t,[{key:"execute",value:function(){return!0}}]),t}(Ie),He=function(e){function t(e){T(this,t);var n=I(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.baseEntity));return n.event=e,n}return z(t,e),A(t,[{key:"execute",value:function(){if(this.event.baseEntity.has("bridged"))return!0;if(this.event.entity.has("floats")){var e=this.event.entity.get("extraZIndex")||0;return[new Fe(this.event.entity,"floats","floating",!0),new Fe(this.event.entity,"sprite","zIndex",10+e),new Fe(this.event.baseEntity,"bridged",void 0,void 0,this.event.entity),new Be("build_bridge",this.event.entity)]}return this.event.entity.has("vehicle")}}]),t}(Ie),Xe=function(e){function t(e){T(this,t);var n=I(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.baseEntity));return n.event=e,n}return z(t,e),A(t,[{key:"execute",value:function(){return!this.event.entity.has("player")&&(this.event.entity.has("platform")?void 0:[new Oe(this.event.entity)])}}]),t}(Ie),Ve=function(e){function t(e){T(this,t);var n=I(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.baseEntity));return n.event=e,n}return z(t,e),A(t,[{key:"execute",value:function(){this.event.entity.set("forcedMovement",this.event.direction)}},{key:"rollback",value:function(){this.event.entity.remove("forcedMovement")}}]),t}(Ie),Ke=function(e){function t(e){T(this,t);var n=I(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.baseEntity));return n.event=e,n.direction=void 0,n}return z(t,e),A(t,[{key:"execute",value:function(){var e=this.event.entity.get("forcedMovement");e&&(this.direction=e.direction,this.event.entity.remove("forcedMovement"))}},{key:"rollback",value:function(){this.direction&&this.event.entity.set("forcedMovement",this.direction)}}]),t}(Ie);Z.system([],function(){function e(){T(this,e)}return A(e,[{key:"initialize",value:function(){ne.register(["normal"],function(e){e.set("terrain","grass"),e.set("logic",{enter:Ge})}),ne.register(["normal_blocks"],function(e){e.set("terrain","floor"),e.set("logic",{enter:We})}),ne.register(["water"],function(e){e.set("terrain","water"),e.set("logic",{enter:He})}),ne.register(["lava"],function(e){e.set("terrain","lava"),e.set("logic",{enter:Xe})}),ne.register(["normal_colors","ice"],function(e){e.set("terrain","ice"),e.set("logic",{exit:Ke,enter:Ve})})}}]),e}()),Z.system([],function(){function e(){T(this,e),this.currentPuzzle=null,this.lastPuzzle=null}return A(e,[{key:"pre",value:function(){var e=this;U.process("restart",function(){e.enterLevel(e.currentPuzzle)}),U.process("enterLevel",function(t){e.enterLevel(t)}),U.process("exitLevel",function(t){e.exitLevel(t)})}},{key:"enterLevel",value:function(e){e&&(U.send("loadTiles",{layer:e.layer,puzzle:e}),this.currentPuzzle=e,U.send("resetPlayer",{position:this.currentPuzzle.position}))}},{key:"exitLevel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.currentPuzzle&&(U.send("resetPlayer",{position:this.currentPuzzle.position}),"portal_solved"!==this.currentPuzzle.state&&(this.currentPuzzle.state=e?"portal_solved":"portal_unsolved"),U.send("updatePuzzlePortal",{layer:this.currentPuzzle.layer,state:this.currentPuzzle.state}),U.send("loadTiles",{layer:"world",puzzle:this.currentPuzzle}),this.currentPuzzle=null)}}]),e}());var Ye=function(){function e(t){T(this,e),this.event=t}return A(e,[{key:"execute",value:function(){if(this.event.entity.has("player")){var e=this.event.baseEntity.get("puzzlePortal").puzzle;U.send("enterLevel",e)}}},{key:"rollback",value:function(){U.send("exitLevel")}}]),e}();Z.system(["puzzlePortal"],function(){function e(){T(this,e)}return A(e,[{key:"initialize",value:function(){ne.register(["portal_unexplored","portal_unsolved","portal_solved"],function(e,t){var n="lvl-"+t.id;t.name=oe.get(n,t.name),e.get("sprite").set(t.name),e.get("sprite").zIndex=8,e.set("puzzlePortal",{layer:n,position:t.position,state:t.name,tileId:t.id}).set("logic",{enter:Ye})})}},{key:"pre",value:function(){oe.update()}}]),e}()),Z.system([""],function(){function e(){T(this,e)}return A(e,[{key:"initialize",value:function(){ne.register(["puzzle_start"],function(e,t){e.remove("sprite")})}}]),e}());var Ue=function(e){function t(e){T(this,t);var n=I(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.baseEntity));return n.event=e,n.platform=n.event.baseEntity.get("platform"),n}return z(t,e),A(t,[{key:"execute",value:function(){var e=this,t=[];return this.platform.holding&&t.push(new Pe({entity:this.platform.holding,direction:this.event.direction,suppressEvents:!0})),this.event.movedBy||t.push(new Me({create:"pollution",at:this.event.from,thenCall:function(t){return e.createPollution(t)}})),t}},{key:"createPollution",value:function(e){e.set("pollution"),e.set("logic",{enter:function(){function e(){T(this,e)}return A(e,[{key:"execute",value:function(){return!1}}]),e}()})}}]),t}(Ie),$e=function(e){function t(e){T(this,t);var n=I(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.baseEntity));return n.event=e,n.platform=n.event.baseEntity.get("platform"),n}return z(t,e),A(t,[{key:"execute",value:function(e){var t=void 0;if(this.event.entity.has("pushes")){if(t=e.addChild(new Pe({entity:this.event.baseEntity,direction:this.event.direction,movedBy:this.event.entity})))return!0;e.rollbackLast()}var n=this.event.entity.get("platform");if(!1===t&&n&&n.holding&&n.holding.has("player")){var i=[];return this.platform.holding&&(i.push(new Le(this.event.baseEntity)),i.push(new Pe({entity:this.platform.holding,direction:this.event.direction}))),i.push(new Le(this.event.entity)),i.push(new De(this.event.baseEntity,n.holding)),i.push(new Pe({entity:this.event.entity,direction:{x:-this.event.direction.x,y:-this.event.direction.y},suppressEvents:!0})),i.push(new Ce({position:this.event.oldPosition,has:["pollution"]})),i}if(!1===t&&this.event.entity.has("attachable")){var o=[];return this.platform.holding&&(o.push(new Le(this.event.baseEntity)),o.push(new Pe({entity:this.platform.holding,direction:this.event.direction}))),o.push(new De(this.event.baseEntity,this.event.entity)),o}return!1}}]),t}(Ie);Z.system([],function(){function e(){T(this,e)}return A(e,[{key:"initialize",value:function(){var e=this;ne.register(["vehicle"],function(t,n){e.createVehicle(t,n)})}},{key:"createVehicle",value:function(e,t){e.set("vehicle").set("platform").set("pushes").set("goal",!0).set("logic",{moved:Ue,enter:$e}),e.get("sprite").zIndex=12}}]),e}());var Je=function(){function e(t){T(this,e),this.event=t}return A(e,[{key:"execute",value:function(){m(this.event.entity)||(this.event.entity.remove("timeImmune"),this.event.entity.set("timeImmuneChanged"))}},{key:"rollback",value:function(){m(this.event.entity)||(this.event.entity.set("timeImmune"),this.event.entity.set("timeImmuneChanged"))}}]),e}(),Ze=function(){function e(t){T(this,e),this.event=t}return A(e,[{key:"execute",value:function(){m(this.event.entity)||(this.event.entity.set("timeImmune"),this.event.entity.set("timeImmuneChanged"))}},{key:"rollback",value:function(){m(this.event.entity)||(this.event.entity.remove("timeImmune"),this.event.entity.set("timeImmuneChanged"))}}]),e}();Z.system(["createTimeImmune","position"],function(){function e(){T(this,e)}return A(e,[{key:"initialize",value:function(){ne.register(["time_immune"],function(e,t){e.set("createTimeImmune")}),ne.register(["time_immune_area"],function(e,t){e.set("timeImmune",!0),e.set("timeImmuneChanged"),e.set("logic",{exit:Je,enter:Ze})})}},{key:"every",value:function(e,t,n){this.setTimeImmune(t),n.destroy()}},{key:"setTimeImmune",value:function(e){var t=te.get(e),n=!0,i=!1,o=void 0;try{for(var r,s=t.values()[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var a=r.value;a.has("terrain")||(a.set("timeImmune",!0),a.set("timeImmuneChanged"))}}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}}}]),e}());var Qe=function(e){function t(e){T(this,t);var n=I(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.event=e,n.goal=n.event.baseEntity.get("goal"),n.previousState=n.goal.solved,n.buttonGoal=void 0!=te.find(n.event.to,void 0,"energySource"),n}return z(t,e),A(t,[{key:"execute",value:function(){var e=[];return this.goal.solved!==this.buttonGoal&&e.push(new Be(this.buttonGoal?"block_activated":"block_deactivated",this.event.baseEntity)),this.goal.solved=this.buttonGoal,[S(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"execute",this).call(this)].concat(e)}},{key:"rollback",value:function(){this.goal.solved=this.previousState}}]),t}(qe);Z.system([],function(){function e(){T(this,e)}return A(e,[{key:"initialize",value:function(){var e=this;ne.register(["block_basic"],function(t,n){e.createBlockEntity(t,n)}),ne.register(["block_stabilizer","block_stabilizer_on"],function(t,n){e.createBlockEntity(t,n),t.set("extraZIndex",2),t.set("goal","block_stabilizer_on"===n.name,"block_stabilizer","block_stabilizer_on"),t.set("usesEnergy"),t.get("logic").moved=Qe})}},{key:"createBlockEntity",value:function(e,t){e.set("block").set("floats"),e.get("sprite").zIndex=13,e.set("logic",{enter:Re,moved:qe})}}]),e}());var et=function(e){function t(e){return T(this,t),I(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return z(t,e),A(t,[{key:"execute",value:function(e){var n=S(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"execute",this).call(this),i=e.addChildren(n);!1===i&&e.rollback();var o=this.event.baseEntity.get("puzzleGoal").completed;return(!0===n||!1===i)&&this.event.entity.has("player")&&o?(U.send("exitLevelAttempt"),!0):(!0===n&&this.event.entity.has("player")&&U.send("exitLevelAttempt"),i)}}]),t}(Re);Z.system(["puzzleGoal"],function(){function e(){T(this,e),this.solved=!0}return A(e,[{key:"initialize",value:function(){ne.register(["block_portal","block_portal_on"],function(e,t){e.set("block").set("floats").set("puzzleGoal","block_portal_on"===t.name).set("logic",{enter:et,moved:qe}),e.get("sprite").zIndex=12})}},{key:"pre",value:function(){var e=this;this.solved=!0,Z.every(["goal"],function(t,n){t.solved||(e.solved=!1)})}},{key:"every",value:function(e,t){if(e.completed!==this.solved){e.completed=this.solved;var n=t.get("sprite");n&&n.set(e.completed?"block_portal_on":"block_portal")}}},{key:"post",value:function(){var e=this;U.process("exitLevelAttempt",function(){e.solved&&U.send("exitLevel",!0)})}}]),e}()),Z.system([],function(){function e(){T(this,e)}return A(e,[{key:"initialize",value:function(){ne.register(["energy_source"],function(e,t){e.set("energySource"),e.get("sprite").zIndex=11})}}]),e}()),Z.system([],function(){function e(){T(this,e)}return A(e,[{key:"pre",value:function(){ze.play()}}]),e}()),Z.system(["sprite","position","positionChanged"],function(){function e(){T(this,e)}return A(e,[{key:"every",value:function(e,t,n,i){var o=i.get("time")||60,r=ne.getVisualPosition(t),s=void 0;if(t.previous&&(Math.abs(t.x-t.previous.x)>1||Math.abs(t.y-t.previous.y)>1)){var a={x:t.previous.x>t.x?-1:t.previous.x<t.x?1:0,y:t.previous.y>t.y?-1:t.previous.y<t.y?1:0};s={x:t.x+a.x,y:t.y+a.y},s=ne.getVisualPosition(s)}i.set("tween",s,r,o),i.remove("positionChanged"),t.previous={x:t.x,y:t.y}}}]),e}()),Z.system(["tween"],function(){function e(){T(this,e)}return A(e,[{key:"every",value:function(e,t,n){e.update(1e3*n,function(){t.remove("time")})}}]),e}()),Z.system(["sprite","timeImmuneChanged"],function(){function e(){T(this,e)}return A(e,[{key:"every",value:function(e,t,n){n.has("timeImmune")?(e.sprite.tint=15658734,e.sprite.alpha=.6):(e.sprite.tint=16777215,e.sprite.alpha=1),n.remove("timeImmuneChanged")}}]),e}()),Z.system(["cameraFollows","sprite"],function(){function e(){T(this,e)}return A(e,[{key:"every",value:function(e,t,n){var i=t.sprite.position;U.exists("updateCamera")&&(e.update(),U.clear("updateCamera")),this.centerCamera(i,e),e.center=!1,i.x>e.deadzone.x+e.deadzone.width&&(e.deadzone.x=i.x-e.deadzone.width),i.x<e.deadzone.x&&(e.deadzone.x=i.x),i.y>e.deadzone.y+e.deadzone.height&&(e.deadzone.y=i.y-e.deadzone.height),i.y<e.deadzone.y&&(e.deadzone.y=i.y);Q.stage.x,Q.stage.y;ie.bounds&&(Q.stage.x=(-e.deadzone.x+e.borderSize.x+ie.bounds.x)*Q.stage.scale.x,Q.stage.y=(-e.deadzone.y+e.borderSize.y+ie.bounds.y)*Q.stage.scale.y)}},{key:"centerCamera",value:function(e,t){t.deadzone.x=e.x-t.deadzone.width/2,t.deadzone.y=e.y-t.deadzone.height/2}}]),e}());Z.system([],function(){function e(){T(this,e)}return A(e,[{key:"initialize",value:function(){var e=this;this.previousWorldScale=ie.scale,this.lastInWorld=!0,window.onresize=function(t){ne.layer&&e.handleResize()}}},{key:"pre",value:function(){var e=this;U.loop("loaded",function(t){var n=ne.inWorld();n?e.scaleWorld():e.scalePuzzle(),e.lastInWorld=n})}},{key:"handleResize",value:function(){H.update(),Q.renderer.resize(H.gameSize.width,H.gameSize.height),U.send("updateCamera")}},{key:"scalePuzzle",value:function(){this.lastInWorld&&(this.previousWorldScale=ie.scale),H.update();var e=H.puzzleSize,t=H.gameSize,n=t.width/t.height,i=e.width/e.height;ie.scale=n<i?t.width/e.width*.6:t.height/e.height*.6}},{key:"scaleWorld",value:function(){ie.scale=this.previousWorldScale}}]),e}()),Z.system([],function(){function e(){T(this,e)}return A(e,[{key:"pre",value:function(){ie.update(ee.getBucket(1).getBounds()),U.exists("loaded")&&(ie.fullUpdate=!0)}}]),e}()),window.onload=g}();
